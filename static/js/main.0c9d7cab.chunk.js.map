{"version":3,"sources":["icons/icon-chffr-wheel.svg","timeline/playback.js","timeline/cache.js","url.js","timeline/segments.js","timeline/actions/types.js","timeline/reducers/globalState.js","timeline/reducers/index.js","demo/index.js","timeline/store.js","timeline/actions/index.js","timeline/startup.js","timeline/commands.js","timeline/timeline.js","timeline/index.js","components/AppHeader/TimeFilter.js","icons/index.js","components/TimeDisplay/index.js","components/AppHeader/index.js","actions/types.js","actions/index.js","utils/index.js","components/Annotations/shopButton.js","components/Annotations/eonUpsell.js","components/Dashboard/DeviceList.js","components/Dashboard/DeviceSettingsModal.js","api/geocode.js","components/Timeline/thumbnails.js","colors.js","theme.js","components/Timeline/index.js","components/Dashboard/DriveListItem.js","utils/conversions.js","components/Dashboard/DriveList.js","components/Dashboard/index.js","components/Annotations/AnnotationListItem.js","components/Annotations/greyPandaUpsell.js","components/Annotations/AnnotationList.js","components/Annotations/AnnotationTabs.js","components/DriveMap/index.js","components/DriveVideo/hlsSource.js","components/DriveVideo/canvas.js","components/DriveVideo/buffering.js","components/DriveVideo/index.js","components/Annotations/Media.js","components/Annotations/footer.js","defs/segments.js","components/Annotations/index.js","components/explorer.js","components/anonymous.js","reducers/workerState.js","reducers/zoom.js","reducers/index.js","devtools.js","store.js","analytics.js","App.js","registerServiceWorker.js","index.js","timeline/logIndex.js","timeline/initialState.js","timeline/logReader/index.js","timeline/logReader/logReader.worker.js"],"names":["module","exports","initialState","require","ACTION_SEEK","ACTION_PAUSE","ACTION_PLAY","ACTION_LOOP","ACTION_BUFFER_VIDEO","ACTION_BUFFER_DATA","ACTION_DISABLE_BUFFER","currentOffset","state","offset","Date","now","startTime","playSpeed","loop","loopOffset","start","duration","cachePort","ExpireEvent","Event","onExpire","listen","handleMessage","msg","data","command","broadcast","route","segment","postMessage","getEntry","touch","partial","getDongleID","pathname","parts","split","filter","m","length","getZoom","Number","end","ACTION_UPDATE_SEGMENTS","ACTION_LOAD_SEGMENT_METADATA","ACTION_SEGMENT_METADATA","ACTION_RESOLVE_ANNOTATION","SEGMENT_LENGTH","getCurrentSegment","o","undefined","segments","i","len","thisSegment","segmentIndex","Math","floor","url","routeOffset","startOffset","events","deviceType","videoAvailableBetweenOffsets","hpgps","hasVideo","hasDriverCamera","hasDriverCameraStream","cameraStreamSegCount","driverCameraStreamSegCount","distanceMiles","getNextSegment","finishSegment","lastEngage","vidAvail","lastVideoRange","slice","sort","a","b","route_offset_millis","route_offset_nanos","forEach","event","type","end_offset_nanos","offset_nanos","end_offset_millis","offset_millis","end_route_offset_nanos","end_route_offset_millis","segmentsFromMetadata","segmentsData","curSegment","curVideoStartOffset","proc_log","proc_qlog","segmentHasDriverCamera","proc_dcamera","segmentHasDriverCameraStream","segmentHasVideo","proc_camera","canonical_route_name","isFinite","pop","join","start_time_utc_millis","startCoord","start_lng","start_lat","replace","devicetype","locStart","locEnd","push","max","canonical_name","concat","endCoord","end_lng","end_lat","API","hasSegmentMetadata","segmentData","dongleId","console","log","parseSegmentMetadata","_segments","annotations","routeStartTimes","map","_segment","round","segmentNum","end_time_utc_millis","JSON","parse","events_json","plannedDisengageEvents","should_take_control","_event","timestamp","canonical_segment_name","annotation","offset_nanos_part","id","error","is_planned","reason","alert","reduce","closestAlert","nextAlert","closestAlertDiff","abs","alertText2","warn","time","dongle_id","hasCameraAtOffset","some","int","updateSegments","fetchSegmentMetadata","promise","insertSegmentMetadata","resolveAnnotation","reducer","_state","action","found","s","e","warning","currentSegment","nextSegment","range","ACTION_STARTUP_DATA","ACTION_SELECT_DEVICE","ACTION_SELECT_TIME_RANGE","ACTION_UPDATE_DEVICE","isDemoCached","reducers","globalState","deviceIndex","device","devices","find","alias","create_time","device_type","imei","is_owner","last_segment_utc_millis","serial","profile","findIndex","d","store","createStore","reduceReducers","desiredPlaySpeed","speed","min","bufferingVideo","buffering","bufferingData","shouldBuffer","isBuffering","Segments","Reducers","isDemoQuery","qs","window","location","search","demo","init","localforage","getItem","isDemo","selectDevice","demoProfile","demoDevices","dispatch","Devices","listDevices","Account","getProfile","PortState","CreateStore","initAuthPromise","Auth","then","token","Request","configure","hasGottenSegmentData","hasGottenSegmentDataPromise","Promise","resolve","segmentDataHandler","Demo","selectDeviceAction","all","subscribe","getState","commands","close","port","unlisten","broadcastChannel","port1","play","Playback","pause","seek","bufferVideo","bufferData","disableBuffer","hello","selectTimeRange","selectTimeRangeAction","selectLoop","updateDevice","updateDeviceAction","ports","setCachePort","onmessage","Cache","stop","demoSegments","BroadcastEvent","DataLogEvent","SegmentTimerStore","segmentsRequest","annotationsRequest","scheduleSegmentUpdate","timeUntilNext","stopTimer","curTime","timeUntilLoop","loopStartOffset","loopStartSegment","timeout","checkSegmentMetadata","annotationsData","Drives","getSegmentMetadata","Annotations","listAnnotations","stack","ensureSegmentDataTimer","ensureSegmentData","entry","LogReaderWorker","UnloadEvent","StateEvent","IndexEvent","InitEvent","InitPromise","addEventListener","startPath","timeline","options","onStateChange","onIndexed","this","buffers","requestId","openRequests","initPromise","expire","bind","hasInit","readyPromise","zoom","AuthStorage","getCommaAccessToken","reject","Error","logReader","onData","handleData","disconnect","setState","LogIndex","index","logIndex","_eventCount","logMonoTime","currentLogMonoTime","getLogIndex","curIndex","eventCount","Array","u","getEvent","_logIndex","buffer","capnp","getRoot","CapnpEvent","toJSON","timestampToOffset","EventWhich","FRAME","Frame","TimestampEof","curSegLog","INIT_DATA","initData","Object","create","defineProperty","writable","value","InitData","Params","parsedEntries","Entries","_paramEntry","Key","byteOffset","Value","paramEntry","fromPointer","get","getEventByType","MODEL","LIVE20","LIVE100","LIVE_MAP_DATA","LIVE_MPC","CAR_STATE","DRIVER_MONITORING","THUMBNAIL","which","maxTimeDiff","monoTime","curSegNum","indexes","keys","calibrations","TimeSelect","props","handleSelectChange","handleClose","changeStart","changeEnd","handleSave","showPicker","selection","target","setHours","getHours","Timelineworker","getTime","timeRange","weekAgo","fecha","format","twoWeeksAgo","minDate","toISOString","substr","name","selectedOption","onChange","className","classes","headerDropdown","last24HoursText","lastWeekText","last2WeeksText","aria-labelledby","aria-describedby","open","onClose","modal","label","showTodayButton","buttonGroup","variant","onClick","color","Component","stateToProps","Obstruction","connect","withStyles","styles","theme","root","position","padding","spacing","unit","width","margin","left","top","transform","textAlign","fontWeight","marginRight","minWidth","AccountIcon","HistoryBackIcon","HistoryForwardIcon","transform-origin","CommaIcon","chevronPath","rotation","ChevronIcon","DownArrow","UpArrow","RightArrow","timerSteps","jumpBack","amount","TimelineWorker","jumpForward","TimeDisplay","textHolder","React","createRef","updateTime","togglePause","increaseSpeed","decreaseSpeed","displayTime","getDisplayTime","mounted","raf","current","newDisplayTime","indexOf","isPaused","cx","base","isExpanded","expanded","isThin","container","item","xs","align","iconBox","aria-label","icon","dateTime","style","paddingTop","ref","currentTime","alignItems","direction","tinyArrow","tinyArrowIcon","backgroundColor","palette","grey","height","borderRadius","maxWidth","opacity","pointerEvents","transition","paddingBottom","border","display","iconButton","maxHeight","borderRight","justifyContent","fontSize","marginTop","AppHeader","handleClickedAccount","handleLogOut","anchorEl","currentTarget","removeItem","MyCommaAuth","logOut","auth","Boolean","lg","Link","to","logo","src","logoImg","logoText","timeDisplay","selectArea","TimeFilter","aria-owns","aria-haspopup","accountIcon","anchorOrigin","vertical","horizontal","transformOrigin","userMeta","disableGutters","paragraph","email","points","component","href","borderBottom","textDecoration","fontFamily","marginLeft","paddingRight","outline","white","userMetaLink","WORKER_STATE_UPDATE","TIMELINE_SELECTION_CHANGED","selectRange","workerState","curPath","document","desiredPath","urlForState","Types","path","filterEvent","ShopButton","link","shopLink","EonUpsell","imageContainer","eon","content","hook","DeviceList","editingDevice","deviceAlias","isWaitingForApi","handleAliasChange","handleAliasFieldKeyPress","renderDevice","setDeviceAlias","toggleDeviceEdit","cancelEdit","nextProps","selectedDevice","handleDeviceSelected","key","trim","Raven","captureException","message","onlyHasAppDevice","idx","shared","filterDrivingDevice","isSelected","deviceTypePretty","deviceAvatar","deviceInfo","deviceId","isSuperUser","overflowY","cursor","flexDirection","editDeviceIcon","nameField","saveButton","textField","marginBottom","DeviceSettingsModal","loadingDeviceAlias","loadingDeviceShare","hasSavedAlias","shareEmail","handleEmailChange","callOnEnter","shareDevice","hasShared","method","grantDeviceReadPermission","err","statusCode","isOpen","form","formRow","onKeyPress","wrapper","size","fabProgress","minHeight","zIndex","MAPBOX_TOKEN","process","mbxGeocoding","geocodingClient","geocodeApi","getNeighborhood","context","getLocality","getRegion","reverseLookup","coords","reverseGeocode","query","limit","send","response","features","body","region","short_code","locality","text","_neighborhood","neighborhood","accessToken","gutter","renderImage","imgStyles","blank","backgroundSize","backgroundRepeat","backgroundImage","backgroundPosition","startImage","Thumbnails","thumbnail","imgCount","ceil","imgArr","percentToOffset","seconds","imageIndex","endImage","endOffset","Colors","transparent","white10","white12","white20","white30","white40","white50","black","blue50","blue100","blue200","blue300","blue400","blue500","blue600","blue700","blue800","blue900","blue950","blue999","lightBlue50","lightBlue100","lightBlue200","lightBlue300","lightBlue400","lightBlue500","lightBlue600","lightBlue700","lightBlue800","lightBlue900","desatBlue800","red50","red100","red200","red300","red400","red500","red600","red700","red800","red900","lightRed50","lightRed100","lightRed200","lightRed300","lightRed400","lightRed500","lightRed600","lightRed700","lightRed800","lightRed900","lightRed950","lightRed999","green50","green100","green200","green300","green400","green500","green600","green700","green800","green900","lightGreen50","lightGreen100","lightGreen200","lightGreen300","lightGreen400","lightGreen500","lightGreen600","lightGreen700","lightGreen800","lightGreen900","orange50","orange100","orange200","orange300","orange400","orange500","orange600","orange700","orange800","orange900","lightOrange50","lightOrange100","lightOrange200","createMuiTheme","typography","overrides","MuiPaper","MuiSelect","select","selectMenu","MuiInput","grey800","overflow","input","MuiFormLabel","MuiTab","disableUnderline","IconComponent","placeholder","background","default","grey999","primary","light","grey50","main","grey900","dark","states","drivingBlue","engagedGreen","alertOrange","alertRed","50","100","grey100","200","grey200","300","grey300","400","grey400","500","grey500","600","grey600","700","grey700","800","900","950","grey950","999","lightGrey","lightGrey200","10","12","20","30","40","AlertStatusCodes","percentFromMouseEvent","boundingBox","getBoundingClientRect","pageX","Timeline","getOffset","handleClick","handleMouseMove","handleMouseDown","handleMouseUp","handleMouseLeave","renderSegment","sendSeek","debounce","offsetValue","rulerRemaining","rulerRemainingHovered","dragBar","hoverBead","zoomOverride","dragStart","mouseX","hoverPercent","isHovered","stopListening","forceUpdate","removeEventListener","seekIndex","percent","offsetToPercent","parentElement","isDragSelecting","noseek","dragSelection","querySelector","dragEnd","selectedArea","startPercent","endPercent","endTime","setTimeout","x","toFixed","perc","zoomed","draggerStyle","dragHighlight","endColor","zoomStart","zoomEnd","barStyle","colored","startPerc","widthPerc","zoomDuration","renderSegmentEvents","uncoloredSegment","localStorage","showCurrentEvent","eventStart","eventEnd","segmentColor","alertStatus","hasThumbnails","tooltipped","hasRuler","rounded","hasGradient","hoverOffset","timeString","isNaN","timestampAtOffset","role","onMouseDown","onMouseUp","onMouseMove","onMouseLeave","ruler","statusGradient","renderDragger","renderZoom","title","bounds","onResize","rect","measureRef","thumbnails","mapStateToProps","bottom","borderLeft","whiteSpace","userSelect","DriveListDrive","startLocation","endLocation","handleDriveClicked","drive","GeocodeApi","startDate","formatDriveDuration","milliseconds","minutes","hours","getDrivePoints","classNames","driveHeader","driveHeaderIntro","driveAvatar","driveTitle","toString","driveArrow","driveTimeline","paddingLeft","DriveList","goToAnnotation","filterShortDrives","renderDriveListHeader","renderDriveListSettings","handleClickedSettings","handleClosedSettings","handleOpenedSettingsModal","handleCanceledSettings","handleClosedSettingsModal","showDeviceSettingsModal","deviceAliasSaved","ride","zoomBuffer","driveList","lastEnd","lastSegmentEnd","curRideChunk","unshift","memo","renderZeroRides","drives","DriveListItem","zeroRidesEle","zeroState","header","headerLabel","settingsArea","settingsButton","settingsButtonIcon","onCancel","textTransform","Dashboard","firstAnnotationSegment","count","segCount","sidebar","sidebarHeader","annotateButton","selectedDongleId","flexGrow","DISENGAGEMENT_REASONS","AnnotationEntry","handleChange","handleComment","validate","saving","comment","errorElem","createAnnotation","updateAnnotation","isJoi","eventId","dateString","selectClassName","defaultExpanded","summaryContent","bubble","heading","getTitle","date","pillBody","pillText","alignContent","renderFormField","disabled","displayEmpty","inputProps","isPlanned","disengagementReason","reasonDetailed","panelActions","disableFocusListener","disableHoverListener","resolveButton","cancelButton","formField","toLowerCase","formLabel","formLabelText","PureComponent","GreyPandaUpsellRow","rowFill","image","LOOP_DURATION","AnnotationList","list","memoize","resolved","unresolved","filterEntry","recomputeList","recomputeRowHeights","forceUpdateGrid","handleExpanded","loopStartTime","loopEndTime","getRowHeight","renderEntry","AnnotationListItem","isUpsellDemo","overscanRowCount","rowCount","rowHeight","rowRenderer","AnnotationTabs","selectedTab","annotationsViewer","indicator","annotationsViewerTabIndicator","annotationsViewerTabs","upsellDemo","tabLabelText","badge","tabLabelBadge","badgeContent","annotationsViewerList","renderTab","right","DriveMap","populateMap","isLoadingCoords","routeSigUrl","DerivedDataApi","getCoords","coordsArr","coord","lng","lat","setPath","initMap","posAtOffset","updateMarkerPos","nextRoute","viewport","latitude","longitude","shouldFlyTo","getMap","getSource","markerSource","getMarkerSource","pos","setData","coordinates","moveViewportTo","_data","transitionDuration","transitionInterpolator","LinearInterpolator","properties","geometry","offsetSeconds","offsetFractionalPart","coordIdx","nextCoordIdx","floorLng","floorLat","mapComponent","on","addSource","addLayer","source","layout","paint","contentRect","mapContainer","mapStyle","onViewportChange","mapboxApiAccessToken","attributionControl","dragPan","HLSSource","hls","Hls","enableWorker","disablePtsDtsCorrectionInMp4Remux","Events","MANIFEST_PARSED","video","BUFFER_APPENDED","eventName","onBufferAppend","ERROR","fatal","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","destroy","nextState","detachMedia","prevProps","prevState","loadSource","attachMedia","onSourceLoaded","strokeRoundedRect","ctx","radius","strokeWidth","strokeStyle","roundedRectPath","lineWidth","stroke","closePath","fillRoundedRect","fillStyle","fill","K","SQRT2","beginPath","moveTo","lineTo","bezierCurveTo","Buffering","thickness","wheelImg","Image","vwp_h","VideoPreview","checkDataBuffer","isDataBuffering","monoTimeLength","lastEvent","nextEvent","getNextLogIndex","LogMonoTime","nextEventTime","monSec","checkVideoBuffer","videoPlayer","front","wasConnected","stopListeningToVideo","subscribeToStateChange","shouldShowPreview","bufferTime","playerState","player","buffered","desiredVideoTime","currentVideoTime","curVideoTime","timeDiff","desiredBufferedVideoTime","remainingTime","buf","waiting","seeking","timeDiffAbs","paused","updatePreviewImage","shouldShowThumbnail","playbackRate","imageRef","nearestImageFrame","updatePreview","onDisableBuffering","canvas_road","canvas_lead","canvas_carstate","canvas_maxspeed","canvas_speed","canvas_face","intrinsic","frame","rafLoop","updateVideoSource","cancel","videoApi","VideoApi","getQcameraStreamIndex","getQcameraStreamIndexUrl","catch","getRearCameraStreamIndexUrl","load","renderCanvas","currentThumbnail","retVal","thumbnailMonoTime","thumbnailTimeDiff","base64","btoa","String","fromCharCode","Uint8Array","Thumbnail","thumbnailData","calibration","getCalibration","params","shouldScale","driverMonitoring","currentDriverMonitoring","renderEventToCanvas","renderDriverMonitoring","shouldShowUI","lastCalibrationTime","extrinsic","LiveCalibration","ExtrinsicMatrix","model","currentModel","mpc","currentMPC","carState","currentCarState","drawLaneFull","live20","currentLive20","renderLeadCars","renderCarState","live100","currentLive100","liveMapData","currentLiveMapData","currentInitData","renderMaxSpeed","renderSpeed","canvas","renderEvent","logTime","monoIndex","getContext","setTransform","clearRect","_events","needsRender","eventsSig","apply","scale","lastLive20MonoTime","leadOne","Live20","LeadOne","leadTwo","LeadTwo","Status","renderLeadCar","leadData","is2ndCar","drel","DRel","vrel","VRel","yrel","YRel","carSpaceToImageSpace","y","sz","fillAlpha","g_xo","g_yo","drawLaneBoundary","Model","LeftLane","RightLane","drawLaneTrack","Path","LiveMpc","isMpc","isEnabled","CarState","CruiseState","Enabled","lane","Prob","Points","Poly","drawLaneLine","Std","off","isGhost","started","px","py","track_bg","path_height","X","Y","createLinearGradient","addColorStop","drawCarStateBorder","drawCarStateWheel","drawSpeed","Live100","VEgo","isMetric","textBaseline","font","fillText","vwp_w","LiveMapData","drawMaxSpeed","maxSpeed","VCruise","maxSpeedCalc","isSpeedLimitValid","SpeedLimitValid","speedLimit","SpeedLimit","speedLimitCalc","speedLimitOffset","speedLimitOffsetParam","parseFloat","isCruiseSet","isSetOverLimit","isEgoOverLimit","speedLimWidth","bdr_s","textTopY","textBottomY","DecelForTurn","turnSpeed","VCurvature","arc","PI","Available","translate","rotate","SteeringAngle","save","wheelImgPattern","createPattern","strokeRect","DriverMonitoring","FaceProb","xW","xOffset","noseSize","isDistracted","FacePosition","v","toX","toY","flatMatrix","rot_matrix","FaceOrientation","p1","matmul","p2","isBlinking","LeftBlinkProb","RightBlinkProb","LeftEyeProb","RightEyeProb","pose","getDriverPose","pitch_error","pitch","yaw_error","yaw","sqrt","pow","angles_desc","pos_desc","pitch_net","yaw_net","roll_net","face_pixel_position","yaw_focal_angle","atan2","FULL_W","roll","H","cr","cos","sr","sin","cp","sp","cy","sy","rr","rp","ry","multiply","matrix","b0","b1","b2","b3","firstFrameTime","videoContainer","hidden","autoPlay","muted","fluid","isVideoChild","disableCompletely","videoUiCanvas","videoImage","MediaType","VIDEO","DRIVER_VIDEO","HUD","MAP","Media","renderMediaOptions","inView","DriveVideo","onVideoChange","noVideo","mediaOptions","mediaOption","mediaOptionText","mediaOptionDisabled","mediaOptionIcon","mediaSource","mediaSourceSelect","AnnotationsFooter","copySegmentName","downloadSegmentFile","openInCabana","openWayInOsmEditor","updateWayId","showCopiedSnack","wayId","parseInt","WayId","el","createElement","setAttribute","appendChild","execCommand","removeChild","snackTimer","seg","segmentKeyPath","RawApi","getRouteFiles","files","seekTime","routeStartTime","win","stringify","focus","footerButton","ContentProps","DeviceType","visibleSegment","headerContext","history","back","headerTitle","headerActions","headerTimeline","viewer","renderAnnotationsElement","footer","ExplorerApp","settingDongle","checkProps","isZoomed","wasZoomed","curDongle","DEMO_LINK","origin","AnonymousLanding","sessionStorage","redirectURL","tagline","AuthConfig","oauthRedirectLink","logInButton","logInText","demoLink","demoLinkText","lineHeight","verticalAlign","extend","composeEnhancers","getComposeEnhancers","compose","createHistory","GA_TRACKING_ID","initGoogleAnalytics","gtag","page_title","page_location","page_path","Redux","connectRouter","thunk","routerMiddleware","updateState","App","initialized","cancelInit","Collector","initDemoTimeline","Jepsen","initDemoState","callback","checkDemo","setItem","code","AuthApi","refreshAccessToken","REDIRECT_URI","setCommaAccessToken","isAuthenticated","render","redirectLink","Explorer","authRoutes","ananymousRoutes","renderLoading","hostname","match","config","environment","install","unregister","navigator","serviceWorker","ready","registration","ReactDOM","Theme","utils","DateFnsUtils","getElementById","binSearch","milis","nanos","searchIndex","indexBuffer","bufferIndex","lastIndex","byteLength","messageBuff","BufferUtils","readMessage","getLogMonoTime","messageSize","LIVE_CALIBRATION","incAmount","splice","createIndex","_buffer","Buffer","from","addToIndex","_index","_newBuff","newBuff","findMonoTime","curMillis","MAX_SAFE_INTEGER","getDefaultStartDate","getDefaultEndDate","DataEvent","relayMessage","getWorker","channel","MessageChannel","logPort","apiPort","port2","Worker"],"mappings":"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","file":"static/js/main.0c9d7cab.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/icon-chffr-wheel.368fbfd6.svg\";","// basic helper functions for controlling playback\n// we shouldn't want to edit the raw state most of the time, helper functions are better\n\nconst initialState = require('./initialState');\n\nconst ACTION_SEEK = 'action_seek';\nconst ACTION_PAUSE = 'action_pause';\nconst ACTION_PLAY = 'action_play';\nconst ACTION_LOOP = 'action_loop';\nconst ACTION_BUFFER_VIDEO = 'action_buffer_video';\nconst ACTION_BUFFER_DATA = 'action_buffer_data';\nconst ACTION_DISABLE_BUFFER = 'action_disable_buffer';\n\n// fetch current playback offset\nexport function currentOffset(state) {\n  let offset = state.offset + (Date.now() - state.startTime) * state.playSpeed;\n\n  if (state.loop && state.loop.startTime) {\n    // respect the loop\n    const loopOffset = state.loop.startTime - state.start;\n    if (offset > loopOffset + state.loop.duration) {\n      offset = ((offset - loopOffset) % state.loop.duration) + loopOffset;\n    }\n  }\n\n  return offset;\n}\n\nexport function reducer(_state = initialState, action) {\n  let state = _state;\n  // console.log(action);\n  let loopOffset = null;\n  if (state.loop && state.loop.startTime !== null) {\n    loopOffset = state.loop.startTime - state.start;\n  }\n  switch (action.type) {\n    case ACTION_SEEK:\n      state = {\n        ...state,\n        offset: action.offset,\n        startTime: Date.now()\n      };\n\n      if (loopOffset !== null) {\n        if (state.offset < loopOffset || state.offset > (loopOffset + state.loop.duration)) {\n          // a seek outside of loop should break out of the loop\n          state.loop = { startTime: null, duration: null };\n          state.loopOffset = null;\n        } else {\n          if (state.offset > (loopOffset + state.loop.duration)) {\n            state.offset = (loopOffset + state.loop.duration) - 1000; // 1 second before end\n          }\n          // intentionally second in case we're in a sub-1-second loop (madness)\n          if (state.offset < loopOffset) {\n            state.offset = loopOffset;\n          }\n        }\n      }\n      break;\n    case ACTION_PAUSE:\n      state = {\n        ...state,\n        offset: currentOffset(state),\n        playSpeed: 0,\n        desiredPlaySpeed: 0\n      };\n      break;\n    case ACTION_PLAY:\n      if (action.speed !== state.desiredPlaySpeed) {\n        state = {\n          ...state,\n          offset: currentOffset(state),\n          desiredPlaySpeed: action.speed,\n          playSpeed: action.speed,\n          startTime: Date.now()\n        };\n      }\n      break;\n    case ACTION_LOOP:\n      state = {\n        ...state,\n        loop: {\n          startTime: action.startTime,\n          duration: action.duration\n        }\n      };\n      if (action.duration > 0 && action.startTime > 0) {\n        state.start = Math.min(action.startTime, state.start);\n        state.end = Math.max(action.startTime + action.duration, state.end);\n      }\n      break;\n    case ACTION_BUFFER_VIDEO:\n      state.bufferingVideo = action.buffering;\n      break;\n    case ACTION_BUFFER_DATA:\n      state.bufferingData = action.buffering;\n      break;\n    case ACTION_DISABLE_BUFFER:\n      state.shouldBuffer = false;\n      break;\n    default:\n      break;\n  }\n\n  const offset = state.offset + (Date.now() - state.startTime) * state.playSpeed;\n  // normalize over loop\n  if (state.loop && state.loop.startTime !== null) {\n    loopOffset = state.loop.startTime - state.start;\n    // has loop, trap offset within the loop\n    if (offset < loopOffset) {\n      state.startTime = Date.now();\n      state.offset = loopOffset;\n    } else if (offset > loopOffset + state.loop.duration) {\n      state.offset = ((offset - loopOffset) % state.loop.duration) + loopOffset;\n      state.startTime = Date.now();\n    }\n  }\n\n  state.bufferingVideo = !!state.bufferingVideo;\n  state.bufferingData = !!state.bufferingData;\n  state.isBuffering = state.shouldBuffer && (state.bufferingVideo || state.bufferingData);\n\n  if (state.isBuffering) {\n    if (state.playSpeed > 0) {\n      console.log('Entering buffer state, pausing things');\n      state.offset = currentOffset(state);\n      state.playSpeed = 0;\n    }\n  } else if (state.playSpeed !== state.desiredPlaySpeed) {\n    console.log('Exiting buffer state, resuming things');\n    state.offset = currentOffset(state);\n    state.startTime = Date.now();\n    state.playSpeed = state.desiredPlaySpeed;\n  }\n\n  return state;\n}\n\nexport function timestampToOffset(state, timestamp) {\n  return timestamp - state.start;\n}\n\n// seek to a specific offset\nexport function seek(offset) {\n  return {\n    type: ACTION_SEEK,\n    offset\n  };\n}\n\n// pause the playback\nexport function pause() {\n  return {\n    type: ACTION_PAUSE\n  };\n}\n\n// resume / change play speed\nexport function play(speed = 1) {\n  return {\n    type: ACTION_PLAY,\n    speed\n  };\n}\n\nexport function selectLoop(startTime, duration) {\n  return {\n    type: ACTION_LOOP,\n    startTime,\n    duration\n  };\n}\n\n// update video buffering state\nexport function bufferVideo(buffering = true) {\n  return {\n    type: ACTION_BUFFER_VIDEO,\n    buffering\n  };\n}\n\n// update data buffering state\nexport function bufferData(buffering = true) {\n  return {\n    type: ACTION_BUFFER_DATA,\n    buffering\n  };\n}\n\nexport function disableBuffer() {\n  return {\n    type: ACTION_DISABLE_BUFFER\n  };\n}\n","import Event from 'geval/event';\nimport { partial } from 'ap';\n// cache all of the data\n\nlet cachePort = null;\n\nconst ExpireEvent = Event();\nexport const onExpire = ExpireEvent.listen;\n\nfunction handleMessage(msg) {\n  if (!msg || !msg.data) {\n    return;\n  }\n  switch (msg.data.command) {\n    case 'expire':\n      ExpireEvent.broadcast(msg.data.data);\n      break;\n    default:\n      break;\n  }\n}\n\nexport function setCachePort(port) {\n  if (cachePort) {\n    cachePort.onmessage = null;\n  }\n  cachePort = port;\n  cachePort.onmessage = handleMessage;\n}\n\nfunction start(route, segment) {\n  cachePort.postMessage({\n    command: 'start',\n    data: { route, segment }\n  });\n}\n\nfunction touch(route, segment) {\n  cachePort.postMessage({\n    command: 'touch',\n    data: { route, segment }\n  });\n}\n\nexport function getEntry(route, segment) {\n  touch(route, segment);\n  return {\n    start: partial(start, route, segment)\n  };\n}\n","\nexport function getDongleID(pathname) {\n  let parts = pathname.split('/');\n  parts = parts.filter((m) => m.length);\n\n  if (parts[0] === 'auth') {\n    return null;\n  }\n\n  return parts[0] || null;\n}\n\nexport function getZoom(pathname) {\n  let parts = pathname.split('/');\n  parts = parts.filter((m) => m.length);\n\n  if (parts.length >= 3 && parts[0] !== 'auth') {\n    return {\n      start: Number(parts[1]),\n      end: Number(parts[2])\n    };\n  }\n  return {\n    start: null,\n    end: null\n  };\n}\n\nexport function getPathname(options) {\n  const path = [\n    options.dongleId\n  ];\n\n  if (options.start && options.end) {\n    path.push(options.start);\n    path.push(options.end);\n  }\n\n  return path.join('/');\n}\n","import initialState from './initialState';\nimport { currentOffset } from './playback';\n\nconst ACTION_UPDATE_SEGMENTS = 'update_segments';\nconst ACTION_LOAD_SEGMENT_METADATA = 'load_segment_metadata';\nconst ACTION_SEGMENT_METADATA = 'segment_metadata';\nconst ACTION_RESOLVE_ANNOTATION = 'resolve_annotation';\n\nconst SEGMENT_LENGTH = 1000 * 60;\n\n/*\nsegments look like, but can contain additional data if they want\nfor example, caching url metadata\n{\n  route: 'dongleid|date',\n  segment: 5\n}\n*/\n\nfunction getCurrentSegment(state, o) {\n  const offset = o === undefined ? currentOffset(state) : o;\n  if (!state.segments) {\n    return null;\n  }\n\n  const { segments } = state;\n\n  for (let i = 0, len = segments.length; i < len; ++i) {\n    const thisSegment = segments[i];\n    // the next segment is after the offset, that means this offset is in a blank\n    if (thisSegment.offset > offset) {\n      break;\n    }\n    if (thisSegment.offset + thisSegment.duration > offset) {\n      const segmentIndex = Math.floor((offset - thisSegment.offset) / SEGMENT_LENGTH);\n      return {\n        url: thisSegment.url,\n        route: thisSegment.route,\n        segment: segmentIndex,\n        routeOffset: thisSegment.offset,\n        startOffset: thisSegment.offset + segmentIndex * SEGMENT_LENGTH,\n        duration: thisSegment.duration,\n        events: thisSegment.events,\n        deviceType: thisSegment.deviceType,\n        videoAvailableBetweenOffsets: thisSegment.videoAvailableBetweenOffsets,\n        hpgps: thisSegment.hpgps,\n        hasVideo: thisSegment.hasVideo,\n        hasDriverCamera: thisSegment.hasDriverCamera,\n        hasDriverCameraStream: thisSegment.hasDriverCameraStream,\n        cameraStreamSegCount: thisSegment.cameraStreamSegCount,\n        driverCameraStreamSegCount: thisSegment.driverCameraStreamSegCount,\n        distanceMiles: thisSegment.distanceMiles,\n      };\n    }\n  }\n  return null;\n}\n\nfunction getNextSegment(state, o) {\n  const offset = o === undefined ? currentOffset(state) : o;\n  if (!state.segments) {\n    return null;\n  }\n\n  const { segments } = state;\n\n  for (let i = 0, len = segments.length; i < len; ++i) {\n    const thisSegment = segments[i];\n    // the next segment is after the offset, that means this offset is in a blank\n    if (thisSegment.offset > offset) {\n      return {\n        url: thisSegment.url,\n        route: thisSegment.route,\n        segment: 0,\n        routeOffset: thisSegment.offset,\n        startOffset: thisSegment.offset,\n        events: thisSegment.events,\n        videoAvailableBetweenOffsets: thisSegment.videoAvailableBetweenOffsets,\n        deviceType: thisSegment.deviceType,\n        hpgps: thisSegment.hpgps,\n        hasVideo: thisSegment.hasVideo,\n        hasDriverCamera: thisSegment.hasDriverCamera,\n        hasDriverCameraStream: thisSegment.hasDriverCameraStream,\n        cameraStreamSegCount: thisSegment.cameraStreamSegCount,\n        driverCameraStreamSegCount: thisSegment.driverCameraStreamSegCount,\n        distanceMiles: thisSegment.distanceMiles,\n      };\n      // already returned, unreachable code\n      // break;\n    }\n    if (thisSegment.offset + thisSegment.duration > offset) {\n      const segmentIndex = Math.floor((offset - thisSegment.offset) / SEGMENT_LENGTH);\n      if (segmentIndex + 1 < thisSegment.segments) {\n        return {\n          url: thisSegment.url,\n          route: thisSegment.route,\n          segment: segmentIndex + 1,\n          routeOffset: thisSegment.offset,\n          startOffset: thisSegment.offset + (segmentIndex + 1) * SEGMENT_LENGTH,\n          duration: thisSegment.duration,\n          events: thisSegment.events,\n          deviceType: thisSegment.deviceType,\n          videoAvailableBetweenOffsets: thisSegment.videoAvailableBetweenOffsets,\n          hpgps: thisSegment.hpgps,\n          hasVideo: thisSegment.hasVideo,\n          hasDriverCamera: thisSegment.hasDriverCamera,\n          hasDriverCameraStream: thisSegment.hasDriverCameraStream,\n          cameraStreamSegCount: thisSegment.cameraStreamSegCount,\n          driverCameraStreamSegCount: thisSegment.driverCameraStreamSegCount,\n          distanceMiles: thisSegment.distanceMiles,\n        };\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction finishSegment(segment) {\n  let lastEngage = null;\n\n  if (segment.hasVideo) {\n    const vidAvail = segment.videoAvailableBetweenOffsets;\n    let lastVideoRange = vidAvail[vidAvail.length - 1];\n    if (!lastVideoRange) {\n      lastVideoRange = [segment.offset, segment.offset + segment.duration];\n    }\n    segment.videoAvailableBetweenOffsets = [ // eslint-disable-line no-param-reassign\n      ...vidAvail.slice(0, vidAvail.length - 1),\n      [lastVideoRange[0], segment.offset + segment.duration]\n    ];\n  }\n  segment.events = segment.events.sort((a, b) => { // eslint-disable-line no-param-reassign\n    if (a.route_offset_millis === b.route_offset_millis) {\n      return a.route_offset_nanos - b.route_offset_nanos;\n    }\n    return a.route_offset_millis - b.route_offset_millis;\n  });\n  segment.events.forEach((event) => {\n    // NOTE sometimes theres 2 disengages in a row and that is NONSENSE\n    switch (event.type) {\n      case 'engage':\n        lastEngage = event;\n        break;\n      case 'disengage':\n        if (lastEngage) {\n          lastEngage.data = {\n            end_offset_nanos: event.offset_nanos,\n            end_offset_millis: event.offset_millis,\n            end_route_offset_nanos: event.route_offset_nanos,\n            end_route_offset_millis: event.route_offset_millis\n          };\n        }\n        break;\n      default:\n        break;\n    }\n  });\n}\n\nfunction segmentsFromMetadata(segmentsData) {\n  let curSegment = null;\n  let curVideoStartOffset = null;\n  const segments = [];\n  segmentsData.segments.forEach((segment) => {\n    if (!segment.url) {\n      return;\n    }\n    if (!(segment.proc_log === 40 || segment.proc_qlog === 40)) {\n      return;\n    }\n    const segmentHasDriverCamera = (segment.proc_dcamera >= 0);\n    const segmentHasDriverCameraStream = (segment.proc_dcamera === 40);\n    const segmentHasVideo = (segment.proc_camera === 40);\n    if (segmentHasVideo && curVideoStartOffset === null) {\n      curVideoStartOffset = segment.offset;\n    }\n    /*\n      route: '99c94dc769b5d96e|2018-04-09--11-29-08',\n      offset: 41348000,\n      duration: 214000,\n      segments: 4\n    */\n    if (!curSegment || curSegment.route !== segment.canonical_route_name) {\n      if (curSegment) {\n        finishSegment(curSegment);\n      }\n      let { url } = segment;\n      const parts = url.split('/');\n\n      if (Number.isFinite(Number(parts.pop()))) {\n        // url has a number at the end\n        url = parts.join('/');\n      }\n      curSegment = {\n        offset: segment.offset - (segment.segment * SEGMENT_LENGTH),\n        route: segment.canonical_route_name,\n        startTime: segment.start_time_utc_millis,\n        startCoord: [segment.start_lng, segment.start_lat],\n        duration: 0,\n        segments: 0,\n        url: url.replace('chffrprivate.blob.core.windows.net', 'chffrprivate-vzn.azureedge.net'),\n        events: [],\n        videoAvailableBetweenOffsets: [],\n        hasVideo: segmentHasVideo,\n        deviceType: segment.devicetype,\n        hpgps: segment.hpgps,\n        hasDriverCamera: segmentHasDriverCamera,\n        hasDriverCameraStream: segmentHasDriverCameraStream,\n        locStart: '',\n        locEnd: '',\n        distanceMiles: 0.0,\n        cameraStreamSegCount: 0,\n        driverCameraStreamSegCount: 0,\n      };\n      segments.push(curSegment);\n    }\n    if (!segmentHasVideo && curVideoStartOffset !== null) {\n      curSegment.videoAvailableBetweenOffsets.push([curVideoStartOffset, segment.offset]);\n      curVideoStartOffset = null;\n    }\n    curSegment.hasVideo = (curSegment.hasVideo || segmentHasVideo);\n    curSegment.hasDriverCamera = (curSegment.hasDriverCamera || segmentHasDriverCamera);\n    if (!curSegment.hasDriverCameraStream) {\n      curSegment.hasDriverCameraStream = segmentHasDriverCameraStream;\n    }\n    curSegment.hpgps = (curSegment.hpgps || segment.hpgps);\n    curSegment.duration = (segment.offset - curSegment.offset) + segment.duration;\n    curSegment.segments = Math.max(curSegment.segments, Number(segment.canonical_name.split('--').pop()) + 1);\n    curSegment.events = curSegment.events.concat(segment.events);\n    curSegment.endCoord = [segment.end_lng, segment.end_lat];\n    curSegment.distanceMiles += segment.length;\n    curSegment.cameraStreamSegCount += Math.floor(segmentHasVideo);\n    curSegment.driverCameraStreamSegCount += Math.floor(segmentHasDriverCameraStream);\n  });\n\n  if (curSegment) {\n    finishSegment(curSegment);\n  }\n\n  return segments;\n}\n\nfunction reducer(_state = initialState, action) {\n  let state = _state;\n  let found = false;\n  switch (action.type) {\n    case ACTION_LOAD_SEGMENT_METADATA:\n      state = {\n        ...state,\n        segmentData: {\n          promise: action.promise,\n          start: action.start,\n          end: action.end,\n          dongleId: state.dongleId\n        }\n      };\n      break;\n    case ACTION_SEGMENT_METADATA:\n      state = {\n        ...state,\n        segmentData: action.data,\n        segments: action.segments\n      };\n      break;\n    case ACTION_RESOLVE_ANNOTATION:\n      state = { ...state };\n      state.segments = state.segments.map((s) => {\n        let segment = s;\n        if (found || segment.route !== action.route) {\n          return segment;\n        }\n        segment = {\n          ...segment,\n          events: segment.events.map((e) => {\n            let event = e;\n            if (found || event.time !== action.event.time || event.type !== action.event.type) {\n              return event;\n            }\n            event = {\n              ...event,\n              id: action.annotation.id,\n              annotation: action.annotation\n            };\n            found = true;\n            return event;\n          })\n        };\n\n        return segment;\n      });\n      if (!found) {\n        console.warning('Resolving unknonwn annotation');\n      }\n      break;\n    default:\n      break;\n  }\n  const currentSegment = getCurrentSegment(state);\n  const nextSegment = getNextSegment(state);\n\n  if (currentSegment) {\n    state.route = currentSegment.route;\n    state.segment = currentSegment.segment;\n  } else {\n    state.route = false;\n    state.segment = 0;\n  }\n\n  state.currentSegment = currentSegment;\n  state.nextSegment = nextSegment;\n\n  state.range = state.end - state.start;\n\n  return state;\n}\n\nfunction updateSegments() {\n  return {\n    type: ACTION_UPDATE_SEGMENTS\n  };\n}\n\nfunction fetchSegmentMetadata(start, end, promise) {\n  return {\n    type: ACTION_LOAD_SEGMENT_METADATA,\n    start,\n    end,\n    promise\n  };\n}\n\nfunction insertSegmentMetadata(data) {\n  return {\n    type: ACTION_SEGMENT_METADATA,\n    segments: segmentsFromMetadata(data),\n    data\n  };\n}\n\nfunction resolveAnnotation(annotation, event, route) {\n  return {\n    type: ACTION_RESOLVE_ANNOTATION,\n    annotation,\n    event,\n    route\n  };\n}\n\nfunction parseSegmentMetadata(state, _segments, annotations) {\n  const routeStartTimes = {};\n  let segments = _segments;\n  segments = segments.map((_segment) => {\n    const segment = _segment;\n    segment.offset = Math.round(segment.start_time_utc_millis) - state.start;\n    if (!routeStartTimes[segment.canonical_route_name]) {\n      const segmentNum = Number(segment.canonical_name.split('--')[2]);\n      segment.segment = segmentNum;\n      routeStartTimes[segment.canonical_route_name] = segment.offset;\n      if (segmentNum > 0) {\n        routeStartTimes[segment.canonical_route_name] -= (SEGMENT_LENGTH * segmentNum);\n      }\n      segment.routeOffset = routeStartTimes[segment.canonical_route_name];\n    } else {\n      segment.routeOffset = routeStartTimes[segment.canonical_route_name];\n    }\n\n    segment.duration = Math.round(segment.end_time_utc_millis - segment.start_time_utc_millis);\n    segment.events = JSON.parse(segment.events_json) || [];\n    const plannedDisengageEvents = segment.events.filter((event) => event.type === 'alert' && event.data && event.data.should_take_control);\n\n    segment.events.forEach((_event) => {\n      const event = _event;\n      event.timestamp = segment.start_time_utc_millis + event.offset_millis;\n      // segment.start_time_utc_millis + event.offset_millis\n      // segment.start_time_utc_millis - state.start + state.start\n\n      event.canonical_segment_name = segment.canonical_name;\n      annotations.forEach((annotation) => {\n        // debugger;\n        if (annotation.canonical_segment_name === event.canonical_segment_name\n          && annotation.offset_millis === event.offset_millis\n          && annotation.offset_nanos_part === event.offset_nanos) {\n          if (event.id) {\n            console.error('Server returned more than one matching annotation-to-event', event, annotation);\n            // debugger;\n          }\n          event.id = annotation.id;\n          event.annotation = annotation;\n        }\n      });\n\n      if (event.data && event.data.is_planned) {\n        let reason;\n\n        const alert = plannedDisengageEvents.reduce((closestAlert, nextAlert) => {\n          const closestAlertDiff = Math.abs(closestAlert.offset_millis - event.offset_millis);\n          if (Math.abs(nextAlert.offset_millis - event.offset_millis) < closestAlertDiff) {\n            return nextAlert;\n          }\n          return closestAlert;\n        }, plannedDisengageEvents[0]);\n        if (alert) {\n          reason = alert.data.alertText2;\n        } else {\n          console.warn('Expected alert corresponding to planned disengagement', event);\n          reason = 'Planned disengagement';\n        }\n\n        event.id = `planned_disengage_${event.time}`;\n        event.annotation = {\n          start_time_utc_millis: event.timestamp,\n          data: {\n            reason,\n          },\n          offset_nanos_part: event.offset_nanos,\n          end_time_utc_millis: event.timestamp,\n          canonical_segment_name: event.canonical_segment_name,\n          dongle_id: state.dongleId,\n          type: event.type,\n          id: event.id,\n          offset_millis: event.offset_millis\n        };\n      }\n    });\n    return segment;\n  });\n\n  return {\n    start: state.start,\n    dongleId: state.dongleId,\n    end: state.end,\n    segments\n  };\n}\n\nfunction hasSegmentMetadata(state) {\n  if (!state) {\n    return false;\n  }\n  if (!state.segmentData) {\n    console.log('No segment data at all');\n    return false;\n  }\n  if (!state.segmentData.segments) {\n    console.log('Still loading...');\n    return false;\n  }\n  if (state.dongleId !== state.segmentData.dongleId) {\n    console.log('Bad dongle id');\n    return false;\n  }\n  if (state.start < state.segmentData.start) {\n    console.log('Bad start offset');\n    return false;\n  }\n  if (state.end > state.segmentData.end) {\n    console.log('Bad end offset');\n    return false;\n  }\n\n  return true;\n}\n\nfunction hasCameraAtOffset(segment, offset) {\n  return segment.videoAvailableBetweenOffsets.some((int) => offset >= int[0] && offset <= int[1]);\n}\n\nconst API = {\n  // helpers\n  getCurrentSegment,\n  getNextSegment,\n  hasSegmentMetadata,\n  parseSegmentMetadata,\n  hasCameraAtOffset,\n\n  // actions\n  updateSegments,\n  fetchSegmentMetadata,\n  insertSegmentMetadata,\n  resolveAnnotation,\n\n  // constants\n  SEGMENT_LENGTH,\n\n  // reducer\n  reducer\n};\nexport default API;\n","// init\nexport const ACTION_STARTUP_DATA = 'ACTION_STARTUP_DATA';\n\n// global state management\nexport const ACTION_SELECT_DEVICE = 'ACTION_SELECT_DEVICE';\nexport const ACTION_SELECT_TIME_RANGE = 'ACTION_SELECT_TIME_RANGE';\nexport const ACTION_UPDATE_DEVICE = 'ACTION_UPDATE_DEVICE';\n","import {\n  ACTION_SELECT_DEVICE,\n  ACTION_SELECT_TIME_RANGE,\n  ACTION_STARTUP_DATA,\n  ACTION_UPDATE_DEVICE,\n} from '../actions/types';\n\nconst initialState = {};\n\nexport default function reducer(_state = initialState, action) {\n  let state = _state;\n  let deviceIndex = null;\n  switch (action.type) {\n    case ACTION_STARTUP_DATA:\n      if (!state.dongleId) {\n        state = {\n          ...state,\n          dongleId: action.devices[0].dongle_id,\n          device: action.devices[0]\n        };\n      } else {\n        state = {\n          ...state,\n          device: action.devices.find((device) => device.dongle_id === state.dongleId)\n        };\n        if (!state.device) {\n          state.device = {\n            alias: null,\n            create_time: 1513041169,\n            device_type: 'unknown',\n            dongle_id: '0000000000000000',\n            imei: '000000000000000',\n            is_owner: false,\n            last_segment_utc_millis: null,\n            serial: '00000000'\n          };\n        }\n      }\n      state.devices = action.devices;\n      state.profile = action.profile;\n      break;\n    case ACTION_SELECT_DEVICE:\n      state = {\n        ...state,\n        dongleId: action.dongleId\n      };\n      if (state.devices) {\n        state.device = state.devices.find((device) => device.dongle_id === action.dongleId);\n      }\n      if (state.segmentData && state.segmentData.dongleId !== state.dongleId) {\n        state.segmentData = null;\n        state.segments = [];\n      }\n      break;\n    case ACTION_SELECT_TIME_RANGE:\n      state.start = action.start;\n      state.end = action.end;\n      state.segmentData = null;\n      state.segments = [];\n      break;\n    case ACTION_UPDATE_DEVICE:\n      deviceIndex = state.devices.findIndex((d) => d.dongle_id === action.device.dongle_id);\n      state.devices[deviceIndex] = action.device;\n      state.device = action.device;\n      break;\n    default:\n      return state;\n  }\n  return state;\n}\n","import globalState from './globalState';\n\nconst reducers = {\n  globalState,\n};\nexport default reducers;\n","import qs from 'query-string';\nimport window from 'global/window';\nimport localforage from 'localforage';\n\nlet isDemoCached;\nexport function isDemoQuery() {\n  return qs.parse(window.location.search).demo === '1';\n}\nexport async function init() {\n  if (isDemoCached !== undefined) return isDemoCached;\n\n  isDemoCached = await localforage.getItem('isDemo') === '1' || isDemoQuery();\n  return isDemoCached;\n}\nexport function isDemo() {\n  return isDemoQuery() || isDemoCached;\n}\n","import { createStore } from 'redux';\nimport reduceReducers from 'reduce-reducers';\n\nimport { reducer as playbackReducer } from './playback';\nimport Segments from './segments';\nimport Reducers from './reducers';\n\nconst store = createStore(reduceReducers(playbackReducer, Segments.reducer, Reducers.globalState));\n\nexport default store;\n","import {\n  ACTION_SELECT_DEVICE,\n  ACTION_SELECT_TIME_RANGE,\n  ACTION_UPDATE_DEVICE,\n} from './types';\n\nexport function updateDevice(device) {\n  return {\n    type: ACTION_UPDATE_DEVICE,\n    device,\n  };\n}\n\nexport function selectDevice(dongleId) {\n  return {\n    type: ACTION_SELECT_DEVICE,\n    dongleId\n  };\n}\n\nexport function selectTimeRange(start, end) {\n  return {\n    type: ACTION_SELECT_TIME_RANGE,\n    start,\n    end\n  };\n}\n","import { devices as Devices, account as Account } from '@commaai/comma-api';\n\nimport store from './store';\nimport { ACTION_STARTUP_DATA } from './actions/types';\n\nconst demoProfile = require('../demo/profile.json');\nconst demoDevices = require('../demo/devices.json');\n\nexport default async function init(isDemo) {\n  if (isDemo) {\n    store.dispatch({\n      type: ACTION_STARTUP_DATA,\n      profile: demoProfile,\n      devices: demoDevices,\n    });\n  } else {\n    console.log('Fetching devices!');\n    let devices = Devices.listDevices();\n    let profile = Account.getProfile();\n    devices = await devices;\n    profile = await profile;\n    console.log('Device list:', devices);\n\n    store.dispatch({\n      type: ACTION_STARTUP_DATA,\n      profile,\n      devices\n    });\n  }\n}\n","import CreateStore from 'weakmap-shim/create-store';\nimport Auth from '@commaai/my-comma-auth';\nimport { request as Request } from '@commaai/comma-api'; // eslint-disable-line\n\nimport {\n  selectDevice as selectDeviceAction,\n  selectTimeRange as selectTimeRangeAction,\n  updateDevice as updateDeviceAction,\n} from './actions';\nimport Segments from './segments';\nimport init from './startup';\nimport * as Playback from './playback';\nimport store from './store';\nimport * as Cache from './cache';\nimport * as Demo from '../demo';\n\nexport const PortState = CreateStore();\n\n// fire off init method / construct init promises\nexport const initAuthPromise = Auth.init().then((token) => {\n  Request.configure(token);\n});\nlet hasGottenSegmentData = null;\nconst hasGottenSegmentDataPromise = new Promise(((resolve) => {\n  hasGottenSegmentData = function segmentDataHandler() {\n    hasGottenSegmentData = null;\n    resolve();\n  };\n}));\n\nstore.subscribe(() => {\n  const state = store.getState();\n\n  if (hasGottenSegmentData && Segments.hasSegmentMetadata(state)) {\n    hasGottenSegmentData();\n  }\n});\n\nfunction close(port) {\n  if (PortState(port).unlisten) {\n    PortState(port).unlisten();\n  }\n  if (PortState(port).broadcastChannel) {\n    PortState(port).broadcastChannel.port1.close();\n  }\n  port.close();\n}\n\nfunction seek(offset) {\n  store.dispatch(Playback.seek(offset));\n}\n\nfunction pause(/* port */) {\n  store.dispatch(Playback.pause());\n}\n\nfunction play(speed) {\n  store.dispatch(Playback.play(speed));\n}\n\nfunction bufferVideo(isBuffering) {\n  store.dispatch(Playback.bufferVideo(isBuffering));\n}\n\nfunction bufferData(isBuffering) {\n  store.dispatch(Playback.bufferData(isBuffering));\n}\n\nfunction disableBuffer(data) {\n  store.dispatch(Playback.disableBuffer(data));\n}\n\nasync function hello(data) {\n  await Demo.init();\n  await initAuthPromise;\n  store.dispatch(selectDeviceAction(data.dongleId));\n\n  await Promise.all([\n    init(Demo.isDemo()),\n    hasGottenSegmentDataPromise\n  ]);\n\n  return 'hello';\n}\n\nfunction resolveAnnotation(data) {\n  const { annotation, event, route } = data;\n\n  store.dispatch(Segments.resolveAnnotation(annotation, event, route));\n}\n\nfunction selectDevice(dongleId) {\n  store.dispatch(selectDeviceAction(dongleId));\n}\n\nfunction updateDevice(device) {\n  store.dispatch(updateDeviceAction(device));\n}\n\nfunction selectTimeRange(data) {\n  const { start, end } = data;\n  store.dispatch(selectTimeRangeAction(start, end));\n}\n\nfunction selectLoop(data) {\n  const { startTime, duration } = data;\n  store.dispatch(Playback.selectLoop(startTime, duration));\n}\n\nfunction cachePort(data, ports) {\n  console.log('Was handed this port!', ports);\n  Cache.setCachePort(ports[0]);\n}\n\nfunction stop() {\n  console.log('Stopping worker!');\n  // if (SegmentTimerStore(state).stopTimer) {\n  //   SegmentTimerStore(state).stopTimer();\n  //   SegmentTimerStore(state).stopTimer = null;\n  // }\n}\n\nexport const commands = {\n  close,\n  play,\n  pause,\n  seek,\n  bufferVideo,\n  bufferData,\n  disableBuffer,\n  hello,\n  resolve: resolveAnnotation,\n  selectDevice,\n  selectTimeRange,\n  selectLoop,\n  updateDevice,\n  cachePort,\n  stop\n};\n","import Event from 'geval/event';\nimport CreateStore from 'weakmap-shim/create-store';\nimport { timeout } from 'thyming';\nimport Collector from 'collect-methods';\nimport { partial } from 'ap';\n\nimport { annotations as Annotations, drives as Drives } from '@commaai/comma-api'; // eslint-disable-line\n\nimport { currentOffset } from './playback';\nimport Segments from './segments';\nimport * as Cache from './cache';\nimport store from './store';\nimport * as Demo from '../demo';\nimport { commands, initAuthPromise } from './commands';\n\nconst demoSegments = require('../demo/segments.json');\n\nconst BroadcastEvent = Event();\nconst DataLogEvent = Event();\nconst SegmentTimerStore = CreateStore();\n\nlet segmentsRequest = null;\nlet annotationsRequest = null;\n\nexport function getState() {\n  return store.getState();\n}\n\nfunction scheduleSegmentUpdate(state) {\n  let timeUntilNext = 30000;\n  const offset = currentOffset(state);\n\n  if (SegmentTimerStore(state).stopTimer) {\n    SegmentTimerStore(state).stopTimer();\n    SegmentTimerStore(state).stopTimer = null;\n  }\n  if (state.nextSegment) {\n    timeUntilNext = state.nextSegment.startOffset - offset;\n  }\n  if (timeUntilNext < 0) {\n    // debugger;\n  }\n  if (state.currentSegment) {\n    const time = (state.currentSegment.routeOffset + state.currentSegment.duration) - offset;\n    timeUntilNext = Math.min(time, timeUntilNext);\n  }\n  if (timeUntilNext < 0) {\n    // debugger;\n  }\n  if (state.loop && state.loop.startTime) {\n    const curTime = state.start + offset;\n    // curTime will be between start and end because we used currentOffset to get it\n    // currentOffset takes into account loops using modulo over duration\n    const timeUntilLoop = 1 + state.loop.startTime + state.loop.duration - curTime;\n    const loopStartOffset = state.loop.startTime - state.start;\n    const loopStartSegment = Segments.getCurrentSegment(state, loopStartOffset);\n    if (!state.currentSegment\n      || !loopStartSegment\n      || loopStartSegment.startOffset !== state.currentSegment.startOffset) {\n      timeUntilNext = Math.min(timeUntilLoop, timeUntilNext);\n    }\n  }\n  if (timeUntilNext < 0) {\n    // debugger;\n  }\n\n  if (timeUntilNext > 0) {\n    timeUntilNext = Math.max(200, timeUntilNext);\n    console.log('Waiting', timeUntilNext, 'for something to change...');\n    SegmentTimerStore(state).stopTimer = timeout(() => {\n      // empty action to churn the butter\n      store.dispatch(Segments.updateSegments());\n    }, timeUntilNext);\n  } else {\n    console.log('There is not task i think its worth waiting for...', timeUntilNext);\n    // debugger;\n  }\n}\n\nasync function checkSegmentMetadata(state) {\n  if (!state.dongleId) {\n    return;\n  }\n  if (Segments.hasSegmentMetadata(state)) {\n    // already has metadata, don't bother\n    return;\n  }\n  await Demo.init();\n  if (segmentsRequest || annotationsRequest) {\n    return;\n  }\n  console.log('We need to update the segment metadata...');\n  const { dongleId } = state;\n  const { start } = state;\n  const { end } = state;\n\n  let segmentData = null;\n  let annotationsData = null;\n  if (Demo.isDemo()) {\n    segmentsRequest = Promise.resolve(demoSegments);\n    annotationsRequest = Promise.resolve([]);\n  } else {\n    segmentsRequest = Drives.getSegmentMetadata(start, end, dongleId);\n    annotationsRequest = Annotations.listAnnotations(start, end, dongleId);\n  }\n  store.dispatch(Segments.fetchSegmentMetadata(start, end));\n\n  try {\n    segmentData = await segmentsRequest;\n    annotationsData = await annotationsRequest;\n  } catch (e) {\n    console.error('Failure fetching segment metadata', e.stack || e);\n    // /@TODO retry this call!\n    return;\n  } finally {\n    segmentsRequest = null;\n    annotationsRequest = null;\n  }\n  if (state.start !== start || state.end !== end || state.dongleId !== dongleId) {\n    checkSegmentMetadata(getState());\n    return;\n  }\n\n  segmentData = Segments.parseSegmentMetadata(state, segmentData, annotationsData);\n  // broken\n  store.dispatch(Segments.insertSegmentMetadata(segmentData));\n  // ensureSegmentData(getState());\n}\n\nlet ensureSegmentDataTimer = null;\nasync function ensureSegmentData(state) {\n  if (ensureSegmentDataTimer) {\n    ensureSegmentDataTimer();\n    ensureSegmentDataTimer = null;\n  }\n\n  let entry = null;\n  if (Date.now() - state.startTime < 1000) {\n    ensureSegmentDataTimer = timeout(() => {\n      ensureSegmentDataTimer = null;\n      return ensureSegmentData(getState());\n    }, 1100 - (Date.now() - state.startTime));\n    return;\n  }\n  if (state.route) {\n    entry = Cache.getEntry(state.route, state.segment, DataLogEvent.broadcast);\n    if (entry) {\n      entry.start();\n    }\n    if (state.segment !== 0) {\n      entry = Cache.getEntry(state.route, 0, DataLogEvent.broadcast);\n      if (entry) {\n        entry.start();\n      }\n    }\n  }\n  const { nextSegment } = state;\n  if (nextSegment) {\n    entry = Cache.getEntry(nextSegment.route, nextSegment.segment, DataLogEvent.broadcast);\n    if (entry) {\n      entry.start();\n    }\n  }\n}\n\nexport function init() {\n  // set up initial schedules\n  initAuthPromise.then(() => {\n    scheduleSegmentUpdate(getState());\n    checkSegmentMetadata(getState());\n  });\n\n  store.subscribe(() => {\n    const state = getState();\n    checkSegmentMetadata(state);\n    scheduleSegmentUpdate(state);\n    ensureSegmentData(state);\n\n    BroadcastEvent.broadcast({\n      command: 'state',\n      data: state\n    });\n  });\n}\n\nexport async function handleMessage(port, msg) {\n  if (msg.data.command) {\n    if (!commands[msg.data.command]) {\n      console.error('Invalid command!', msg.data);\n      return;\n    }\n    let result = commands[msg.data.command](port, msg.data.data, msg.ports);\n    if (result && msg.data.requestId) {\n      result = await result;\n      if (result) {\n        port.postMessage({\n          requestId: msg.data.requestId,\n          command: 'return-value',\n          data: result\n        });\n      }\n    }\n  }\n}\n","/* eslint-disable class-methods-use-this */\nimport window from 'global/window';\nimport Event from 'geval/event';\nimport * as capnp from 'capnp-ts';\nimport { Event as CapnpEvent, Event_Which as EventWhich } from '@commaai/log_reader/capnp/log.capnp';\nimport toJSON from '@commaai/capnp-json';\n\nimport { storage as AuthStorage } from '@commaai/my-comma-auth';\nimport * as Playback from './playback';\nimport * as LogIndex from './logIndex';\nimport * as Cache from './cache';\nimport { getDongleID, getZoom } from '../url';\nimport { getState, init as initTimeline } from './timeline';\nimport { commands } from './commands';\nimport store from './store';\n\nconst LogReaderWorker = require('./logReader');\n\nconst UnloadEvent = Event();\nconst StateEvent = Event();\nconst IndexEvent = Event();\nconst InitEvent = Event();\nconst InitPromise = new Promise(((resolve) => {\n  InitEvent.listen(resolve);\n}));\n\nwindow.addEventListener('beforeunload', UnloadEvent.broadcast);\nconst startPath = window.location ? window.location.pathname : '';\n\n// helper functions\n\nexport class TimelineInterface {\n  constructor(options) {\n    this.options = options || {};\n    this.buffers = {};\n    this.requestId = 1;\n    this.openRequests = {};\n    this.initPromise = InitPromise;\n\n    this.expire = this.expire.bind(this);\n  }\n\n  onStateChange = StateEvent.listen\n\n  onIndexed = IndexEvent.listen\n\n  async init(isDemo) {\n    if (!this.hasInit) {\n      this.hasInit = true;\n      this.isDemo = isDemo;\n\n      initTimeline();\n\n      this.readyPromise = commands.hello({\n        dongleId: getDongleID(startPath),\n        zoom: getZoom(startPath),\n      });\n\n      const token = await AuthStorage.getCommaAccessToken();\n      if (!(token || isDemo)) {\n        return new Promise((resolve, reject) => reject(Error('No auth')));\n      }\n\n      // if (false && typeof TimelineSharedWorker === 'function') {\n      //   worker = new TimelineSharedWorker();\n      //   t.isShared = true;\n      //   t.logReader = new LogReaderWorker();\n      if (typeof LogReaderWorker === 'function') {\n        this.logReader = new LogReaderWorker();\n      }\n\n      // broadcast message\n      // handle message\n      // cache port\n      commands.cachePort(null, [this.logReader.port || this.logReader]);\n\n      LogReaderWorker.onData((msg) => {\n        this.handleData(msg);\n      });\n\n      UnloadEvent.listen(() => this.disconnect());\n      Cache.onExpire(this.expire);\n      this.setState(getState());\n      store.subscribe(() => {\n        const state = store.getState();\n        this.setState(state);\n      });\n\n      InitEvent.broadcast(token);\n    }\n    return this.readyPromise;\n  }\n\n  async stop() {\n    if (!this.hasInit) {\n      return;\n    }\n    await commands.stop();\n    this.hasInit = false;\n    if (this.logReader) {\n      this.logReader = null;\n    }\n  }\n\n  async getPort() {\n    await this.initPromise;\n    return this.port;\n  }\n\n  async disconnect() {\n    return commands.close();\n  }\n\n  async seek(offset) {\n    return commands.seek(Math.round(offset));\n  }\n\n  async play(speed = 1) {\n    return commands.play(speed);\n  }\n\n  async pause() {\n    return commands.pause();\n  }\n\n  async disableBuffer() {\n    return commands.disableBuffer(true);\n  }\n\n  async bufferVideo(isBuffering = true) {\n    return commands.bufferVideo(isBuffering);\n  }\n\n  async bufferData(isBuffering = true) {\n    return commands.bufferData(isBuffering);\n  }\n\n  async selectTimeRange(start, end) {\n    return commands.selectTimeRange({ start, end });\n  }\n\n  async selectLoop(startTime, duration) {\n    return commands.selectLoop({ startTime, duration });\n  }\n\n  async selectDevice(dongleId) {\n    await this.readyPromise;\n    if (this.state.dongleId === dongleId) {\n      return true;\n    }\n    return commands.selectDevice(dongleId);\n  }\n\n  async resolveAnnotation(annotation, event, route) {\n    return commands.resolve({ annotation, event, route });\n  }\n\n  async updateDevice(device) {\n    return commands.updateDevice(device,);\n  }\n\n  setState(state) {\n    this.state = state;\n    StateEvent.broadcast(state);\n    if (this.logReader) {\n      const port = this.logReader.port || this.logReader;\n      if (this.state.route) {\n        port.postMessage({\n          command: 'touch',\n          data: {\n            route: this.state.route,\n            segment: this.state.segment,\n          }\n        });\n      }\n      if (this.state.nextSegment) {\n        port.postMessage({\n          command: 'touch',\n          data: {\n            route: this.state.nextSegment.route,\n            segment: this.state.nextSegment.segment,\n          }\n        });\n      }\n    }\n  }\n\n  expire(data) {\n    console.log('Expiring cache entry', data);\n    if (this.buffers[data.route] && this.buffers[data.route][data.segment]) {\n      delete this.buffers[data.route][data.segment];\n    }\n  }\n\n  async handleData(msg) {\n    if (!this.buffers[msg.data.route]) {\n      this.buffers[msg.data.route] = {};\n    }\n    if (!this.buffers[msg.data.route][msg.data.segment]) {\n      this.buffers[msg.data.route][msg.data.segment] = LogIndex.createIndex(msg.data.data);\n    } else {\n      LogIndex.addToIndex(this.buffers[msg.data.route][msg.data.segment], msg.data.data);\n    }\n    IndexEvent.broadcast(msg.data.route);\n  }\n\n  getStartMonoTime(route, segment = 0) {\n    if (!this.buffers[route]\n      || !this.buffers[route][segment]\n      || !this.buffers[route][segment].index) {\n      return 0;\n    }\n    return this.buffers[route][segment].index[0][0];\n  }\n\n  getIndex() {\n    if (!this.state || !this.state.route) {\n      return [];\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return [];\n    }\n\n    return this.buffers[this.state.route][this.state.segment].index;\n  }\n\n  currentLogMonoTime() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return null;\n    }\n    let offset = this.currentOffset();\n    const [segment] = this.state.segments.filter((a) => a.route === this.state.route);\n    const logIndex = this.buffers[this.state.route][this.state.segment];\n    if (!segment) {\n      return null;\n    }\n    offset -= segment.offset;\n    const startTime = logIndex.index[0][0];\n\n    return offset + startTime;\n  }\n\n  lastEvents(_eventCount = 10) {\n    const logMonoTime = this.currentLogMonoTime();\n    if (!logMonoTime) {\n      return [];\n    }\n    const logIndex = this.getLogIndex();\n\n    const curIndex = LogIndex.findMonoTime(logIndex, logMonoTime);\n    const eventCount = Math.min(_eventCount, curIndex);\n\n    return [...Array(eventCount)].map((u, i) => this.getEvent(curIndex - i, logIndex));\n  }\n\n  getLogIndex() {\n    return this.buffers[this.state.route]\n      ? this.buffers[this.state.route][this.state.segment]\n      : null;\n  }\n\n  getNextLogIndex() {\n    if (!this.state.nextSegment) {\n      return null;\n    }\n    return this.buffers[this.state.nextSegment.route]\n      ? this.buffers[this.state.nextSegment.route][this.state.nextSegment.segment]\n      : null;\n  }\n\n  getEvent(index, _logIndex) {\n    // millis, nanos, offset, len, buffer\n    const logIndex = _logIndex || this.buffers[this.state.route][this.state.segment];\n    if (index < 0 || index >= logIndex.index.length) {\n      // console.log('Invalid event index', index);\n      return null;\n    }\n    const entry = logIndex.index[index];\n    const buffer = logIndex.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n    const msg = new capnp.Message(buffer, false);\n    const event = msg.getRoot(CapnpEvent);\n    return toJSON(event);\n  }\n\n  currentOffset() {\n    if (this.state) {\n      return Playback.currentOffset(this.state);\n    }\n    return 0;\n  }\n\n  timestampToOffset(timestamp) {\n    if (this.state) {\n      return Playback.timestampToOffset(this.state, timestamp);\n    }\n    return 0;\n  }\n\n  firstFrameTime() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][0]) {\n      return null;\n    }\n\n    const logIndex = this.buffers[this.state.route][0];\n    for(let i = 0; i < logIndex.index.length; i++) {\n      const entry = logIndex.index[i];\n      if (entry[5] === EventWhich.FRAME) {\n        const buffer = logIndex.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n        const msg = new capnp.Message(buffer, false);\n        const event = toJSON(msg.getRoot(CapnpEvent));\n        return event.Frame.TimestampEof / 1e9;\n      }\n    }\n    return null;\n  }\n\n  currentInitData() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return null;\n    }\n\n    const [segment] = this.state.segments.filter((a) => a.route === this.state.route);\n    if (!segment) {\n      return null;\n    }\n\n    // check if any buffered logs have the initdata packet\n    const curSegLog = this.buffers[this.state.route][this.state.segment];\n    const entry = curSegLog.index[0];\n    if (entry[5] !== EventWhich.INIT_DATA) {\n      return null;\n    }\n\n    const buffer = curSegLog.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n    const msg = new capnp.Message(buffer, false);\n    const event = msg.getRoot(CapnpEvent);\n\n    let initData = toJSON(event);\n    // Cast params key-value pointers to Text, as capnp-ts does not yet\n    // apply parameterized struct types like we use for\n    // params: Map(Text, Text)\n    initData = Object.create(initData);\n    Object.defineProperty(initData, 'InitData', { writable: true, value: Object.create(initData.InitData) });\n    Object.defineProperty(initData.InitData, 'Params', { writable: true, value: Object.create(initData.InitData.Params) });\n    const parsedEntries = initData.InitData.Params.Entries.map((_paramEntry) => {\n      if (!_paramEntry.Key.byteOffset || !_paramEntry.Value.byteOffset) {\n        return null;\n      }\n      try {\n        const paramEntry = Object.create(_paramEntry);\n        Object.defineProperty(paramEntry, 'Key', {\n          writable: false,\n          value: capnp.Text.fromPointer(paramEntry.Key).get()\n        });\n        Object.defineProperty(paramEntry, 'Value', {\n          writable: true,\n          value: capnp.Text.fromPointer(paramEntry.Value).get()\n        });\n\n        return paramEntry;\n      } catch(e) {\n        return null;\n      }\n    }).filter((paramEntry) => !!paramEntry);\n    Object.defineProperty(initData.InitData.Params, 'Entries', { writable: true, value: parsedEntries });\n\n    return initData;\n  }\n\n  currentModel() {\n    return this.getEventByType(EventWhich.MODEL, 1000);\n  }\n\n  currentLive20() {\n    return this.getEventByType(EventWhich.LIVE20, 1000);\n  }\n\n  currentLive100() {\n    return this.getEventByType(EventWhich.LIVE100, 1000);\n  }\n\n  currentLiveMapData() {\n    return this.getEventByType(EventWhich.LIVE_MAP_DATA, 4000);\n  }\n\n  currentMPC() {\n    return this.getEventByType(EventWhich.LIVE_MPC, 1000);\n  }\n\n  currentCarState() {\n    return this.getEventByType(EventWhich.CAR_STATE, 1000);\n  }\n\n  currentDriverMonitoring() {\n    return this.getEventByType(EventWhich.DRIVER_MONITORING, 1000);\n  }\n\n  currentThumbnail() {\n    return this.getEventByType(EventWhich.THUMBNAIL, 6000);\n  }\n\n  getEventByType(which, maxTimeDiff = -1) {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return null;\n    }\n    const monoTime = this.currentLogMonoTime();\n    let offset = this.currentOffset();\n    const [segment] = this.state.segments.filter((a) => a.route === this.state.route);\n    if (!segment) {\n      return null;\n    }\n\n    for (let curSegNum = this.state.segment; curSegNum >= 0; --curSegNum) {\n      const logIndex = this.buffers[this.state.route][curSegNum];\n      if (!logIndex) {\n        return null;\n      }\n      offset -= segment.offset;\n      const startTime = logIndex.index[0][0];\n      const logMonoTime = offset + startTime;\n      let curIndex = logIndex.index.length - 1;\n      if (curSegNum === this.state.segment) {\n        curIndex = LogIndex.findMonoTime(logIndex, logMonoTime);\n      }\n\n      for (curIndex; curIndex >= 0; --curIndex) {\n        const entry = logIndex.index[curIndex];\n        if (maxTimeDiff !== -1 && monoTime - entry[0] > maxTimeDiff) {\n          return null;\n        }\n        if (entry[5] === which) {\n          const buffer = logIndex.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n          const msg = new capnp.Message(buffer, false);\n          const event = msg.getRoot(CapnpEvent);\n          return toJSON(event);\n        }\n      }\n    }\n\n    return null;\n  }\n\n  getCalibration() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    const indexes = this.buffers[this.state.route];\n\n    if (!indexes) {\n      return null;\n    }\n\n    for (let i = 0, keys = Object.keys(indexes), len = keys.length; i < len; ++i) {\n      const index = indexes[keys[i]];\n      if (index.calibrations && index.calibrations.length) {\n        return index.calibrations[index.calibrations.length - 1];\n      }\n    }\n    return null;\n  }\n}\n// create instance and expose it\nconst timeline = new TimelineInterface();\nexport default timeline;\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport fecha from 'fecha';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport Divider from '@material-ui/core/Divider';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport Modal from '@material-ui/core/Modal';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Paper from '@material-ui/core/Paper';\n\nimport { DateTimePicker } from 'material-ui-pickers';\n\nimport Timelineworker from '../../timeline';\n\nconst styles = (theme) => ({\n  root: {},\n  modal: {\n    position: 'absolute',\n    padding: theme.spacing.unit * 2,\n    width: theme.spacing.unit * 50,\n    margin: '0 auto',\n    left: '50%',\n    top: '40%',\n    transform: 'translate(-50%, -50%)'\n  },\n  buttonGroup: {\n    textAlign: 'right'\n  },\n  headerDropdown: {\n    fontWeight: 500,\n    marginRight: 12,\n    minWidth: 310,\n    textAlign: 'center',\n  },\n});\n\nconst LOOKBACK_WINDOW_MILLIS = 30 * 24 * 3600 * 1000; // 30 days\n\nclass TimeSelect extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleSelectChange = this.handleSelectChange.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.changeStart = this.changeStart.bind(this);\n    this.changeEnd = this.changeEnd.bind(this);\n    this.handleSave = this.handleSave.bind(this);\n\n    this.state = {\n      showPicker: false\n    };\n  }\n\n  handleSelectChange(e) {\n    const selection = e.target.value;\n    const d = new Date();\n    d.setHours(d.getHours() + 1, 0, 0, 0);\n\n    switch (selection) {\n      case '24-hours':\n        Timelineworker.selectTimeRange(d.getTime() - (1000 * 60 * 60 * 24), d.getTime());\n        break;\n      case '1-week':\n        Timelineworker.selectTimeRange(d.getTime() - (1000 * 60 * 60 * 24 * 7), d.getTime());\n        break;\n      case '2-weeks':\n        Timelineworker.selectTimeRange(d.getTime() - (1000 * 60 * 60 * 24 * 14), d.getTime());\n        break;\n      case 'custom':\n        this.setState({\n          showPicker: true,\n          start: this.props.start,\n          end: this.props.end\n        });\n        break;\n    }\n  }\n\n  handleClose() {\n    this.setState({\n      showPicker: false\n    });\n  }\n\n  changeStart(value) {\n    this.setState({\n      start: value.getTime()\n    });\n  }\n\n  changeEnd(value) {\n    this.setState({\n      end: value.getTime()\n    });\n  }\n\n  handleSave() {\n    Timelineworker.selectTimeRange(this.state.start, this.state.end);\n    this.setState({\n      showPicker: false,\n      start: null,\n      end: null\n    });\n  }\n\n  selectedOption() {\n    const timeRange = this.props.end - this.props.start;\n\n    if (Math.abs(this.props.end - Date.now()) < 1000 * 60 * 60) {\n      // ends right around now\n      if (timeRange === 1000 * 60 * 60 * 24 * 14) {\n        return '2-weeks';\n      } if (timeRange === 1000 * 60 * 60 * 24 * 7) {\n        return '1-week';\n      } if (timeRange === 1000 * 60 * 60 * 24) {\n        return '24-hours';\n      }\n    }\n\n    return 'custom';\n  }\n\n  lastWeekText() {\n    if (!this.props.start || !this.props.end) {\n      return '--';\n    }\n\n    const weekAgo = Date.now() - (1000 * 60 * 60 * 24 * 7);\n    return `Last Week${\n      fecha.format(new Date(weekAgo), ' (MMM Do - ')\n    }${fecha.format(new Date(), 'MMM Do)')}`;\n  }\n\n  last2WeeksText() {\n    if (!this.props.start || !this.props.end) {\n      return '--';\n    }\n\n    const twoWeeksAgo = Date.now() - (1000 * 60 * 60 * 24 * 14);\n    return `2 Weeks${\n      fecha.format(new Date(twoWeeksAgo), ' (M/D - ')\n    }${fecha.format(new Date(), 'M/D)')}`;\n  }\n\n  last24HoursText() {\n    if (!this.props.start || !this.props.end) {\n      return '--';\n    }\n    return 'Last 24 Hours';\n  }\n\n  render() {\n    const minDate = new Date(Date.now() - LOOKBACK_WINDOW_MILLIS).toISOString().substr(0, 10);\n\n    return (\n      <>\n        <FormControl>\n          <Select\n            name=\"timerange\"\n            value={this.selectedOption()}\n            onChange={this.handleSelectChange}\n            className={this.props.classes.headerDropdown}\n          >\n            <MenuItem value=\"custom\">Custom</MenuItem>\n            <MenuItem value=\"24-hours\">{ this.last24HoursText() }</MenuItem>\n            <MenuItem value=\"1-week\">{ this.lastWeekText() }</MenuItem>\n            <MenuItem value=\"2-weeks\">{ this.last2WeeksText() }</MenuItem>\n          </Select>\n        </FormControl>\n        <Modal\n          aria-labelledby=\"simple-modal-title\"\n          aria-describedby=\"simple-modal-description\"\n          open={this.state.showPicker}\n          onClose={this.handleClose}\n        >\n          <Paper className={this.props.classes.modal}>\n            <DateTimePicker\n              minDate={minDate}\n              value={new Date(this.state.start || this.props.start || 0)}\n              onChange={this.changeStart}\n              label=\"Start time\"\n              showTodayButton\n            />\n            <DateTimePicker\n              minDate={minDate}\n              value={new Date(this.state.end || this.props.end || 0)}\n              onChange={this.changeEnd}\n              label=\"End time\"\n              showTodayButton\n            />\n            <br />\n            <br />\n            <Divider />\n            <br />\n            <div className={this.props.classes.buttonGroup}>\n              <Button variant=\"contained\" onClick={this.handleClose}>\n                Cancel\n              </Button>\n              &nbsp;\n              <Button variant=\"contained\" color=\"secondary\" onClick={this.handleSave}>\n                Save\n              </Button>\n            </div>\n          </Paper>\n        </Modal>\n      </>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  end: 'workerState.end',\n  start: 'workerState.start'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(TimeSelect));\n","/* eslint-disable react/jsx-props-no-spreading */\nimport React from 'react';\nimport SvgIcon from '@material-ui/core/SvgIcon';\n\nexport function AccountIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <g transform=\"translate(-198.000000, -189.000000)\">\n        <path d=\"M210,189 C203.381053,189 198,194.381053 198,201 C198,207.618947 203.381053,213 210,213 C216.618947,213 222,207.618947 222,201 C222,194.381053 216.618947,189 210,189 Z M216.724916,207.352941 C216.374763,206.716762 215.824522,206.182371 215.099204,205.902453 L212.623121,204.808224 C211.972836,204.553753 211.522639,203.917573 211.472617,203.205053 L211.422595,202.747004 C212.573099,201.856353 213.348438,200.125945 213.348438,198.293749 C213.348438,195.647243 211.697716,193.815047 209.671829,193.815047 C207.645942,193.815047 205.99522,195.647243 205.99522,198.293749 C205.99522,200.125945 206.770559,201.830905 207.921063,202.747004 L207.871041,203.205053 C207.821019,203.917573 207.370822,204.528305 206.720537,204.808224 L204.244453,205.902453 C203.544147,206.182371 202.968895,206.716762 202.618742,207.352941 C201.068063,205.622534 200.117647,203.332288 200.117647,200.813019 C200.117647,195.469113 204.394519,191.117647 209.646818,191.117647 C214.899117,191.117647 219.175989,195.469113 219.175989,200.813019 C219.201,203.332288 218.250584,205.622534 216.724916,207.352941 Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n\nexport function HistoryBackIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M16.8880175,1.0391027 C13.9587286,-0.258687148 10.6253998,-0.358517136 7.5951009,0.839442723 C5.57490164,1.63808263 3.75672231,2.93587248 2.44359279,4.63298228 L1.93854298,2.83604249 C1.83753301,2.23706256 1.3324832,1.93757259 0.726423422,2.03740258 C0.221373607,2.23706256 -0.0816562816,2.7362125 0.0193536814,3.23536244 L1.02945331,7.32839196 C1.13046327,7.8275419 1.53450313,8.12703187 2.03955294,8.12703187 C2.1405629,8.12703187 2.24157287,8.12703187 2.24157287,8.12703187 L6.38298135,7.12873198 C6.88803116,7.028902 7.29207101,6.42992207 7.09005109,5.93077212 C7.09005109,5.3317922 6.48399131,5.03230223 5.9789415,5.23196221 L4.26177213,5.63128216 C5.37288172,4.33349231 6.68601124,3.33519243 8.30217064,2.7362125 C10.8274197,1.73791262 13.5546887,1.83774261 16.0799378,2.93587248 C18.5041769,4.03400235 20.4233662,5.93077212 21.4334658,8.42652183 C22.4435655,10.9222715 22.3425555,13.6176812 21.2314459,16.1134309 C20.1203363,18.6091806 18.201147,20.4061204 15.6758979,21.4044203 C12.1405492,22.7022102 8.20116068,22.1032302 5.37288172,19.6074805 C4.16076216,18.5093506 3.15066253,17.2115608 2.54460276,15.714111 C2.34258283,15.214961 1.73652305,14.9154711 1.23147324,15.115131 C0.726423422,15.314791 0.423393533,15.913771 0.625413459,16.4129209 C1.3324832,18.2098607 2.54460276,19.9069705 3.95874224,21.1049303 C6.18096142,23.0017001 9.00924038,24 11.9385293,24 C13.4536788,24 14.8678182,23.70051 16.2819577,23.2013601 C19.3122566,22.0034002 21.6354858,19.8071405 22.9486153,16.9120708 C24.2617448,14.0170012 24.3627548,10.7226116 23.1506352,7.72771191 C21.9385156,4.73281227 19.9183164,2.33689255 16.8880175,1.0391027 Z\" />\n      <path d=\"M11.7081415,6.22222222 C11.0832566,6.22222222 10.6666667,6.61010101 10.6666667,7.19191919 L10.6666667,13.010101 C10.6666667,13.3010101 10.7708142,13.5919192 11.0832566,13.7858586 L15.2491561,16.6949495 C15.4574511,16.7919192 15.6657461,16.8888889 15.8740411,16.8888889 C16.1864835,16.8888889 16.498926,16.7919192 16.707221,16.5010101 C17.0196634,16.1131313 16.9155159,15.4343434 16.498926,15.1434343 L12.7496164,12.5252525 L12.7496164,7.19191919 C12.7496164,6.61010101 12.3330265,6.22222222 11.7081415,6.22222222 Z\" />\n    </SvgIcon>\n  );\n}\nexport function HistoryForwardIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <g transform=\"matrix(-1, 0, 0, 1, 0, 0)\" transform-origin=\"center\">\n        <path d=\"M16.8880175,1.0391027 C13.9587286,-0.258687148 10.6253998,-0.358517136 7.5951009,0.839442723 C5.57490164,1.63808263 3.75672231,2.93587248 2.44359279,4.63298228 L1.93854298,2.83604249 C1.83753301,2.23706256 1.3324832,1.93757259 0.726423422,2.03740258 C0.221373607,2.23706256 -0.0816562816,2.7362125 0.0193536814,3.23536244 L1.02945331,7.32839196 C1.13046327,7.8275419 1.53450313,8.12703187 2.03955294,8.12703187 C2.1405629,8.12703187 2.24157287,8.12703187 2.24157287,8.12703187 L6.38298135,7.12873198 C6.88803116,7.028902 7.29207101,6.42992207 7.09005109,5.93077212 C7.09005109,5.3317922 6.48399131,5.03230223 5.9789415,5.23196221 L4.26177213,5.63128216 C5.37288172,4.33349231 6.68601124,3.33519243 8.30217064,2.7362125 C10.8274197,1.73791262 13.5546887,1.83774261 16.0799378,2.93587248 C18.5041769,4.03400235 20.4233662,5.93077212 21.4334658,8.42652183 C22.4435655,10.9222715 22.3425555,13.6176812 21.2314459,16.1134309 C20.1203363,18.6091806 18.201147,20.4061204 15.6758979,21.4044203 C12.1405492,22.7022102 8.20116068,22.1032302 5.37288172,19.6074805 C4.16076216,18.5093506 3.15066253,17.2115608 2.54460276,15.714111 C2.34258283,15.214961 1.73652305,14.9154711 1.23147324,15.115131 C0.726423422,15.314791 0.423393533,15.913771 0.625413459,16.4129209 C1.3324832,18.2098607 2.54460276,19.9069705 3.95874224,21.1049303 C6.18096142,23.0017001 9.00924038,24 11.9385293,24 C13.4536788,24 14.8678182,23.70051 16.2819577,23.2013601 C19.3122566,22.0034002 21.6354858,19.8071405 22.9486153,16.9120708 C24.2617448,14.0170012 24.3627548,10.7226116 23.1506352,7.72771191 C21.9385156,4.73281227 19.9183164,2.33689255 16.8880175,1.0391027 Z\" />\n        <path d=\"M11.7081415,6.22222222 C11.0832566,6.22222222 10.6666667,6.61010101 10.6666667,7.19191919 L10.6666667,13.010101 C10.6666667,13.3010101 10.7708142,13.5919192 11.0832566,13.7858586 L15.2491561,16.6949495 C15.4574511,16.7919192 15.6657461,16.8888889 15.8740411,16.8888889 C16.1864835,16.8888889 16.498926,16.7919192 16.707221,16.5010101 C17.0196634,16.1131313 16.9155159,15.4343434 16.498926,15.1434343 L12.7496164,12.5252525 L12.7496164,7.19191919 C12.7496164,6.61010101 12.3330265,6.22222222 11.7081415,6.22222222 Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\nexport function CommaIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <g transform=\"scale(0.35, 0.35)\" transform-origin=\"center\">\n        <path d=\"M2.3325273,44 C2.3325273,42.9819019 2.25294268,42.1290181 2.37000751,41.3070321 C2.41990001,40.9564305 2.82901847,40.5810595 3.16268975,40.3693706 C4.78942848,39.3369727 6.55659633,38.5126886 8.07113779,37.32861 C12.9769087,33.4931864 15.8847893,28.4440632 16.0437152,21.8852845 C16.0887401,20.0229846 15.4041177,19.5577289 13.8399272,20.2831908 C9.32477801,22.3776079 4.46938637,21.1496084 1.87814052,17.2574961 C-0.947721751,13.012484 -0.549798677,7.36046894 2.83607643,3.65221184 C7.16090397,-1.08410221 14.2770341,-1.22582393 19.1842653,3.29752453 C22.1237851,6.00709044 23.5205316,9.50570155 23.8688055,13.4851451 C25.0365333,26.8169447 18.349722,37.8056121 6.17936039,42.6328324 C4.97488253,43.1103451 3.73973905,43.5025696 2.3325273,44\" />\n      </g>\n    </SvgIcon>\n  );\n}\n\nfunction chevronPath(rotation = 270) {\n  return (\n    <path d=\"M16.8625817,0.35528597 C16.3546389,-0.125475313 15.550396,-0.125475313 15.0847818,0.398991541 L5.3492107,11.1068565 C4.88359643,11.6313233 4.88359643,12.4180236 5.3492107,12.8987849 L15.0847818,23.6066499 C15.3387532,23.8688833 15.6773817,24 16.0160103,24 C16.3123103,24 16.6509389,23.8688833 16.9049103,23.6503554 C17.4128531,23.1695941 17.4551817,22.3391883 16.9472388,21.8147214 L7.97358203,12.0246735 L16.9049103,2.19091996 C17.3705245,1.66645311 17.3705245,0.836047253 16.8625817,0.35528597 Z\" transform={`rotate(${rotation})`} transform-origin=\"center\" />\n  );\n}\n\nexport function ChevronIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      { chevronPath(270) }\n    </SvgIcon>\n  );\n}\nexport const DownArrow = ChevronIcon;\n\nexport function UpArrow(props) {\n  return (\n    <SvgIcon {...props}>\n      { chevronPath(90) }\n    </SvgIcon>\n  );\n}\n\nexport function RightArrow(props) {\n  return (\n    <SvgIcon {...props}>\n      { chevronPath(180) }\n    </SvgIcon>\n  );\n}\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport raf from 'raf';\nimport fecha from 'fecha';\nimport { partial } from 'ap';\nimport cx from 'classnames';\nimport PropTypes from 'prop-types';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport IconButton from '@material-ui/core/IconButton';\nimport PlayArrow from '@material-ui/icons/PlayArrow';\nimport Pause from '@material-ui/icons/Pause';\n\nimport {\n  DownArrow, UpArrow, HistoryForwardIcon, HistoryBackIcon\n} from '../../icons';\n\nimport TimelineWorker from '../../timeline';\n\nconst timerSteps = [\n  0.1,\n  0.25,\n  0.5,\n  1,\n  2,\n  3,\n  4,\n  5\n];\n\nfunction jumpBack(amount) {\n  TimelineWorker.seek(TimelineWorker.currentOffset() - amount);\n}\n\nfunction jumpForward(amount) {\n  TimelineWorker.seek(TimelineWorker.currentOffset() + amount);\n}\nconst styles = (theme) => ({\n  base: {\n    backgroundColor: theme.palette.grey[999],\n    height: '64px',\n    borderRadius: '32px',\n    padding: theme.spacing.unit,\n    maxWidth: 510,\n    margin: '0 auto',\n    minWidth: 450,\n    opacity: 0,\n    pointerEvents: 'none',\n    transition: 'opacity 0.1s ease-in-out',\n    '&.isExpanded': {\n      opacity: 1,\n      pointerEvents: 'auto',\n    },\n    '&.isThin': {\n      height: 50,\n      paddingBottom: 0,\n      paddingTop: 0,\n    },\n  },\n  icon: {\n    width: '98%',\n    height: '98%',\n    '&.dim': {\n      color: theme.palette.grey[700]\n    },\n    '&.small': {\n      width: '60%',\n      height: '60%',\n    },\n    '&.circle': {\n      border: `1px solid ${theme.palette.grey[900]}`,\n      borderRadius: '50%'\n    }\n  },\n  tinyArrow: {\n    display: 'flex',\n    height: 12,\n  },\n  tinyArrowIcon: {\n    width: 12,\n    height: 12,\n    color: theme.palette.grey[700]\n  },\n  iconButton: {\n    maxWidth: '100%',\n    maxHeight: '100%'\n  },\n  iconBox: {\n    display: 'inline-block',\n    borderRight: `1px solid ${theme.palette.grey[900]}`\n  },\n  dateTime: {\n    alignItems: 'center',\n    display: 'flex',\n    justifyContent: 'center',\n  },\n  currentTime: {\n    fontSize: 15,\n    fontWeight: 500,\n    display: 'block',\n    marginTop: 4,\n  }\n});\n\nclass TimeDisplay extends Component {\n  static getDerivedStateFromProps(props, state) {\n    if (props.playSpeed !== 0 && props.playSpeed !== state.playSpeed) {\n      return {\n        ...state,\n        playSpeed: props.playSpeed\n      };\n    }\n    return state;\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.textHolder = React.createRef();\n\n    this.updateTime = this.updateTime.bind(this);\n    this.togglePause = this.togglePause.bind(this);\n    this.increaseSpeed = this.increaseSpeed.bind(this);\n    this.decreaseSpeed = this.decreaseSpeed.bind(this);\n\n    this.state = {\n      playSpeed: 1,\n      displayTime: this.getDisplayTime()\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    raf(this.updateTime);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  getDisplayTime() {\n    const currentOffset = TimelineWorker.currentOffset();\n    const { start } = this.props;\n    if (!Number.isFinite(start)) {\n      return '...';\n    }\n    const now = new Date(currentOffset + start);\n    const dateString = fecha.format(now, 'ddd, D MMM, YYYY @ HH:mm:ss');\n    // var dateString = fecha.format(now, 'MMM D @ HH:mm:ss');\n\n    return dateString;\n  }\n\n  updateTime() {\n    if (!this.mounted || !this.textHolder.current) {\n      return;\n    }\n    const newDisplayTime = this.getDisplayTime();\n    const { displayTime } = this.state;\n    if (newDisplayTime !== displayTime) {\n      this.setState({ displayTime: newDisplayTime });\n    }\n\n    raf(this.updateTime);\n  }\n\n  decreaseSpeed() {\n    const { playSpeed } = this.state;\n    let curIndex = timerSteps.indexOf(playSpeed);\n    if (curIndex === -1) {\n      curIndex = timerSteps.indexOf(1);\n    }\n    curIndex = Math.max(0, curIndex - 1);\n    TimelineWorker.play(timerSteps[curIndex]);\n  }\n\n  increaseSpeed() {\n    const { playSpeed } = this.state;\n    let curIndex = timerSteps.indexOf(playSpeed);\n    if (curIndex === -1) {\n      curIndex = timerSteps.indexOf(1);\n    }\n    curIndex = Math.min(timerSteps.length - 1, curIndex + 1);\n    TimelineWorker.play(timerSteps[curIndex]);\n  }\n\n  togglePause(e) {\n    const { playSpeed } = this.props;\n    if (playSpeed === 0) {\n      TimelineWorker.play(this.state.playSpeed);\n    } else {\n      TimelineWorker.pause();\n    }\n  }\n\n  render() {\n    const { classes } = this.props;\n    const isPaused = this.props.playSpeed === 0;\n    return (\n      <div\n        className={cx(classes.base, {\n          isExpanded: this.props.expanded,\n          isThin: this.props.isThin,\n        })}\n      >\n        <Grid container>\n          <Grid item xs={3}>\n            <Grid container>\n              <Grid item align=\"center\" xs={6} className={classes.iconBox}>\n                <IconButton\n                  onClick={partial(jumpBack, 10000)}\n                  aria-label=\"Jump back 10 seconds\"\n                >\n                  <HistoryBackIcon className={`${classes.icon} small dim`} />\n                </IconButton>\n              </Grid>\n              <Grid item align=\"center\" xs={6} className={classes.iconBox}>\n                <IconButton\n                  onClick={partial(jumpForward, 10000)}\n                  aria-label=\"Jump forward 10 seconds\"\n                >\n                  <HistoryForwardIcon className={`${classes.icon} small dim`} />\n                </IconButton>\n              </Grid>\n            </Grid>\n          </Grid>\n          <Grid item xs={6} className={classes.dateTime}>\n            { !this.props.isThin && (\n              <Typography variant=\"caption\" align=\"center\" style={{ paddingTop: 4 }}>\n                CURRENT PLAYBACK TIME\n              </Typography>\n            )}\n            <Typography variant=\"body1\" align=\"center\">\n              <span ref={this.textHolder} className={classes.currentTime}>\n                { this.state.displayTime }\n              </span>\n            </Typography>\n          </Grid>\n          <Grid item xs={3}>\n            <Grid container>\n              <Grid item align=\"center\" xs={4} className={classes.iconBox}>\n                <Grid container alignItems=\"center\" direction=\"column\">\n                  <Grid item className={classes.tinyArrow}>\n                    <IconButton\n                      className={classes.tinyArrowIcon}\n                      onClick={this.increaseSpeed}\n                      aria-label=\"Increase play speed by 1 step\"\n                    >\n                      <UpArrow className={classes.tinyArrowIcon} />\n                    </IconButton>\n                  </Grid>\n                  <Grid item>\n                    <Typography variant=\"body2\" align=\"center\">\n                      { this.state.playSpeed }\nx\n                    </Typography>\n                  </Grid>\n                  <Grid item className={classes.tinyArrow}>\n                    <IconButton\n                      className={classes.tinyArrowIcon}\n                      onClick={this.decreaseSpeed}\n                      aria-label=\"Decrease play speed by 1 step\"\n                    >\n                      <DownArrow className={classes.tinyArrowIcon} />\n                    </IconButton>\n                  </Grid>\n                </Grid>\n              </Grid>\n              <Grid item align=\"center\" xs={8}>\n                <IconButton\n                  onClick={this.togglePause}\n                  aria-label={isPaused ? 'Unpause' : 'Pause'}\n                >\n                  { isPaused\n                    ? (<PlayArrow className={`${classes.icon} circle`} />)\n                    : (<Pause className={`${classes.icon} circle`} />)}\n                </IconButton>\n              </Grid>\n            </Grid>\n          </Grid>\n        </Grid>\n      </div>\n    );\n  }\n}\n\nTimeDisplay.propTypes = {\n  classes: PropTypes.object.isRequired,\n  playSpeed: PropTypes.number.isRequired,\n  start: PropTypes.number.isRequired\n};\n\nconst stateToProps = Obstruction({\n  expanded: 'zoom.expanded',\n  playSpeed: 'workerState.desiredPlaySpeed',\n  start: 'workerState.start',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(TimeDisplay));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport Obstruction from 'obstruction';\nimport fecha from 'fecha';\nimport localforage from 'localforage';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport Input from '@material-ui/core/Input';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport ListItem from '@material-ui/core/ListItem';\nimport IconButton from '@material-ui/core/IconButton';\n\nimport MyCommaAuth from '@commaai/my-comma-auth';\n\nimport TimeFilter from './TimeFilter';\nimport TimeDisplay from '../TimeDisplay';\nimport { AccountIcon } from '../../icons';\n\nimport Timelineworker from '../../timeline';\n\nconst styles = (theme) => ({\n  base: {\n    backgroundColor: '#1D2225',\n    borderBottom: '1px solid rgba(255, 255, 255, 0.1)',\n    display: 'flex',\n    width: '100%',\n  },\n  logo: {\n    alignItems: 'center',\n    display: 'flex',\n    maxWidth: 200,\n    textDecoration: 'none',\n  },\n  logoImg: {\n    height: '34px',\n    margin: '0px 28px',\n    width: 'auto',\n  },\n  logoText: {\n    fontFamily: 'MaisonNeueExtended',\n    fontSize: 18,\n    fontWeight: 600,\n  },\n  timeDisplay: {\n    alignItems: 'center',\n  },\n  selectArea: {\n    alignItems: 'center',\n    display: 'flex',\n    justifyContent: 'flex-end',\n    marginLeft: 'auto',\n    paddingRight: 28,\n  },\n  accountIcon: {\n    color: '#272D30',\n    height: 34,\n    width: 34,\n  },\n  userMeta: {\n    outline: 'none',\n    padding: `${theme.spacing.unit}px ${theme.spacing.unit * 2}px`,\n    borderBottom: `1px solid ${theme.palette.white[12]}`,\n  },\n  userMetaLink: {\n    textDecoration: 'none',\n    color: '#fff',\n  },\n});\n\nclass AppHeader extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleClickedAccount = this.handleClickedAccount.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.handleLogOut = this.handleLogOut.bind(this);\n\n    this.state = {\n      anchorEl: null,\n    };\n  }\n\n  handleClickedAccount(event) {\n    this.setState({ anchorEl: event.currentTarget });\n  }\n\n  handleClose() {\n    this.setState({ anchorEl: null });\n  }\n\n  handleLogOut() {\n    this.handleClose();\n    localforage.removeItem('isDemo');\n    MyCommaAuth.logOut();\n  }\n\n  render() {\n    const { profile, classes } = this.props;\n    const { auth, anchorEl } = this.state;\n    const open = Boolean(anchorEl);\n\n    if (!profile) {\n      return [];\n    }\n\n    return (\n      <header className={classes.base}>\n        <Grid container spacing={0}>\n          <Grid item container xs={2} lg={4}>\n            <Link to=\"/\" className={classes.logo}>\n              <img src=\"/images/comma-white.png\" className={classes.logoImg} />\n              <Typography className={classes.logoText}>\n                explorer\n              </Typography>\n            </Link>\n          </Grid>\n          <Grid item container xs={6} lg={4} className={classes.timeDisplay}>\n            <TimeDisplay isThin />\n          </Grid>\n          <Grid\n            item\n            xs={4}\n            align=\"right\"\n            className={classes.selectArea}\n          >\n            <TimeFilter />\n            <IconButton\n              aria-owns={open ? 'menu-appbar' : null}\n              aria-haspopup=\"true\"\n              onClick={this.handleClickedAccount}\n            >\n              <AccountIcon className={classes.accountIcon} />\n            </IconButton>\n            <Menu\n              id=\"menu-appbar\"\n              open={open}\n              onClose={this.handleClose}\n              anchorEl={anchorEl}\n              anchorOrigin={{\n                vertical: 'top',\n                horizontal: 'right',\n              }}\n              transformOrigin={{\n                vertical: 'top',\n                horizontal: 'right',\n              }}\n            >\n              <ListItem classes={{ root: classes.userMeta }} disableGutters>\n                <div>\n                  <Typography variant=\"body2\" paragraph>\n                    { profile.email }\n                  </Typography>\n                  <Typography variant=\"body1\" paragraph>\n                    { profile.points }\n                    {' '}\npoints\n                  </Typography>\n                </div>\n              </ListItem>\n              <li>\n                <MenuItem\n                  component=\"a\"\n                  href=\"/useradmin/\"\n                  target=\"_blank\"\n                >\nManage Account\n                </MenuItem>\n              </li>\n              <MenuItem onClick={this.handleLogOut}>Log out</MenuItem>\n            </Menu>\n          </Grid>\n        </Grid>\n      </header>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  dongleId: 'workerState.dongleId',\n  start: 'workerState.start',\n  end: 'workerState.end',\n  profile: 'workerState.profile',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(AppHeader));\n","export const WORKER_STATE_UPDATE = 'workerstate';\nexport const TIMELINE_SELECTION_CHANGED = 'timeline_selection_changed';\n","import { push } from 'connected-react-router';\nimport document from 'global/document';\nimport * as Types from './types';\nimport Timelineworker from '../timeline';\nimport { getDongleID } from '../url';\n\nexport function updateState(data) {\n  return {\n    type: Types.WORKER_STATE_UPDATE,\n    data\n  };\n}\n\nexport function selectRange(start, end) {\n  return (dispatch, getState) => {\n    const state = getState();\n    if (!state.workerState.dongleId) {\n      dispatch({\n        type: Types.TIMELINE_SELECTION_CHANGED,\n        start,\n        end\n      });\n      return;\n    }\n    const curPath = document.location.pathname;\n    const dongleId = getDongleID(curPath) || state.workerState.dongleId;\n    const desiredPath = urlForState(dongleId, start, end);\n\n    if (state.zoom.start !== start || state.zoom.end !== end) {\n      dispatch({\n        type: Types.TIMELINE_SELECTION_CHANGED,\n        start,\n        end\n      });\n    }\n\n    if (!state.workerState.loop.startTime\n      || !state.workerState.loop.duration\n      || state.workerState.loop.startTime < start\n      || state.workerState.loop.startTime + state.workerState.loop.duration > end\n      || state.workerState.loop.duration < end - start) {\n      Timelineworker.selectLoop(start, end - start);\n    }\n\n    if (curPath !== desiredPath) {\n      dispatch(push(desiredPath));\n    }\n  };\n}\n\nexport function selectDevice(dongleId) {\n  return (dispatch, getState) => {\n    const state = getState();\n    if (state.workerState.dongleId !== dongleId) {\n      Timelineworker.selectDevice(dongleId);\n    }\n    const curPath = document.location.pathname;\n    const desiredPath = urlForState(dongleId, state.zoom.start, state.zoom.end);\n\n    if (curPath !== desiredPath) {\n      dispatch(push(desiredPath));\n    }\n  };\n}\n\nfunction urlForState(dongleId, start, end) {\n  const path = [dongleId];\n\n  if (start && end) {\n    path.push(start);\n    path.push(end);\n  }\n\n  return `/${path.join('/')}`;\n}\n","export function filterEvent(event) {\n  return (event.type === 'disengage' || event.type === 'disengage_steer');\n}\n\nexport function formatDriveDuration(duration) {\n  const milliseconds = Math.floor((duration % 1000) / 100);\n  let seconds = Math.floor((duration / 1000) % 60);\n  let minutes = Math.floor((duration / (1000 * 60)) % 60);\n  let hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n  hours = (hours < 10) ? hours : hours;\n  minutes = (minutes < 10) ? minutes : minutes;\n  seconds = (seconds < 10) ? seconds : seconds;\n  return {\n    hours,\n    minutes,\n    seconds,\n    milliseconds,\n  };\n}\n\nexport function getDrivePoints(duration) {\n  const minutes = Math.floor(duration / (1000 * 60));\n  const points = Math.floor(minutes * 1.5); // panda\n  return points;\n}\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n\nconst styles = (theme) => ({\n  shopLink: {\n    textDecoration: 'none',\n  }\n});\n\nclass ShopButton extends Component {\n  render() {\n    return (\n      <a href={this.props.link} target=\"_blank\" className={this.props.classes.shopLink}>\n        <Button variant=\"outlined\">\n          Shop\n        </Button>\n      </a>\n    );\n  }\n}\n\nexport default withStyles(styles)(ShopButton);\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\n\nimport ShopButton from './shopButton';\n\nconst styles = (theme) => ({\n  root: {\n    display: 'flex',\n    paddingTop: '48px'\n  },\n  eon: {\n    display: 'block',\n    width: '100%',\n  },\n  content: {\n    padding: '20px 12px',\n    textAlign: 'center'\n  },\n  imageContainer: {\n    display: 'flex',\n    alignItems: 'center',\n  }\n});\n\nclass EonUpsell extends Component {\n  render() {\n    return (\n      <div className={this.props.classes.root}>\n        <Grid item xs={6} className={this.props.classes.imageContainer}>\n          <img\n            src=\"https://comma.ai/eon-offroad-transparent-01.png\"\n            className={this.props.classes.eon}\n          />\n        </Grid>\n        <Grid item xs={6} className={this.props.classes.content}>\n          <Typography>{ this.props.hook }</Typography>\n          <ShopButton link=\"https://comma.ai/shop/products/eon-dashcam-devkit/?ref=explorer\" />\n        </Grid>\n      </div>\n    );\n  }\n}\n\nexport default withStyles(styles)(EonUpsell);\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport Raven from 'raven-js';\nimport cx from 'classnames';\n\nimport {\n  withStyles,\n  Grid,\n  Button,\n  Typography,\n  FormHelperText,\n  ExpansionPanel,\n  ExpansionPanelSummary,\n  LinearProgress,\n  FormControl,\n  TextField,\n} from '@material-ui/core';\nimport Pencil from '@material-ui/icons/Edit';\n\nimport { devices as Devices } from '@commaai/comma-api';\nimport Timelineworker from '../../timeline';\nimport EonUpsell from '../Annotations/eonUpsell';\n\nconst styles = (theme) => ({\n  base: {\n    height: '100%',\n    overflowY: 'scroll',\n  },\n  device: {\n    alignItems: 'center',\n    cursor: 'pointer',\n    display: 'flex',\n    padding: 32,\n    paddingTop: 16,\n    paddingBottom: 16,\n    '&.isSelected': {\n      backgroundColor: '#171B1D',\n    }\n  },\n  deviceAvatar: {\n    backgroundColor: '#1D2225',\n    borderRadius: 30,\n    height: 46,\n    width: 46,\n  },\n  deviceInfo: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    marginLeft: 16,\n  },\n  deviceAlias: {},\n  deviceId: {\n    color: '#525E66',\n    fontFamily: 'MaisonNeueMono',\n  },\n\n  editDeviceIcon: {\n    color: 'white',\n    '&:hover': {\n      color: theme.palette.grey[100]\n    }\n  },\n  nameField: {\n    marginRight: theme.spacing.unit,\n  },\n  saveButton: {\n    marginRight: theme.spacing.unit,\n  },\n  textField: {\n    marginBottom: theme.spacing.unit\n  },\n});\n\nclass DeviceList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      editingDevice: null,\n      deviceAlias: '',\n      isWaitingForApi: false,\n      error: null,\n    };\n\n    this.handleAliasChange = this.handleAliasChange.bind(this);\n    this.handleAliasFieldKeyPress = this.handleAliasFieldKeyPress.bind(this);\n    this.renderDevice = this.renderDevice.bind(this);\n    this.setDeviceAlias = this.setDeviceAlias.bind(this);\n    this.toggleDeviceEdit = this.toggleDeviceEdit.bind(this);\n    this.cancelEdit = this.cancelEdit.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.selectedDevice !== this.props.selectedDevice\n        && nextProps.selectedDevice !== this.state.editingDevice) {\n      this.setState({ editingDevice: null });\n    }\n  }\n\n  toggleDeviceEdit(device) {\n    if (this.state.editingDevice === device.dongle_id) {\n      this.setState({ editingDevice: null });\n    } else {\n      this.props.handleDeviceSelected(device.dongle_id);\n      this.setState({ editingDevice: device.dongle_id, deviceAlias: device.alias });\n    }\n  }\n\n  cancelEdit() {\n    this.setState({ editingDevice: null });\n  }\n\n  handleAliasChange(e) {\n    this.setState({ deviceAlias: e.target.value });\n  }\n\n  handleAliasFieldKeyPress(dongle_id, e) {\n    if (e.key === 'Enter' && !this.state.isWaitingForApi) {\n      this.setDeviceAlias(dongle_id);\n    }\n  }\n\n  async setDeviceAlias(dongle_id) {\n    this.setState({ isWaitingForApi: true });\n    try {\n      const device = await Devices.setDeviceAlias(dongle_id, this.state.deviceAlias.trim());\n      Timelineworker.updateDevice(device);\n      this.setState({ isWaitingForApi: false, editingDevice: null });\n    } catch (e) {\n      Raven.captureException(e);\n      this.setState({ error: e.message, isWaitingForApi: false });\n    }\n  }\n\n  deviceTypePretty(deviceType) {\n    if (deviceType === 'neo') {\n      return 'EON';\n    }\n    return deviceType;\n  }\n\n  render() {\n    const { devices } = this.props;\n    const dongleId = this.props.selectedDevice;\n    let found = !dongleId;\n    let onlyHasAppDevice = true;\n    devices.forEach((device, idx) => {\n      if (device.dongle_id === dongleId) {\n        found = true;\n      }\n      onlyHasAppDevice = onlyHasAppDevice && (device.device_type !== 'neo' && device.device_type !== 'panda');\n    });\n\n    if (!found) {\n      devices.push({\n        dongle_id: dongleId,\n        shared: true,\n        alias: 'Shared device',\n      });\n    }\n\n    return (\n      <div className={this.props.classes.base}>\n        { devices.filter(this.filterDrivingDevice).map(this.renderDevice) }\n        { onlyHasAppDevice && <EonUpsell hook=\"Upgrade to an EON to augment your driving experience\" /> }\n      </div>\n    );\n  }\n\n  renderDevice(device) {\n    const { classes } = this.props;\n    const isSelected = (this.props.selectedDevice === device.dongle_id);\n    const alias = device.alias || this.deviceTypePretty(device.device_type);\n    return (\n      <div\n        key={device.dongle_id}\n        onClick={partial(this.props.handleDeviceSelected, device.dongle_id)}\n        className={cx(classes.device, [{ isSelected }])}\n      >\n        <div className={classes.deviceAvatar} />\n        <div className={classes.deviceInfo}>\n          <Typography variant=\"body2\" className={classes.deviceAlias}>\n            { alias }\n          </Typography>\n          <Typography variant=\"caption\" className={classes.deviceId}>\n            (\n            { device.dongle_id }\n)\n          </Typography>\n        </div>\n      </div>\n    );\n\n    const oldRender = (\n      <ExpansionPanel\n        classes={{ expanded: classes.expanded }}\n        key={device.dongle_id}\n        expanded={this.props.selectedDevice === device.dongle_id}\n        onChange={partial(this.props.handleDeviceSelected, device.dongle_id)}\n        className={classes.expansion}\n      >\n        <ExpansionPanelSummary>\n          <Grid container>\n            <Grid item xs={10}>\n              { this.state.editingDevice === device.dongle_id\n                ? (\n                  <>\n                    { this.state.isWaitingForApi && <LinearProgress /> }\n                    { this.state.error !== null && <FormHelperText error>{ this.state.error }</FormHelperText> }\n                    <TextField\n                      id=\"name\"\n                      label=\"Name\"\n                      className={classes.textField}\n                      value={this.state.deviceAlias}\n                      onChange={this.handleAliasChange}\n                      onKeyPress={partial(this.handleAliasFieldKeyPress, device.dongle_id)}\n                    />\n                  </>\n                )\n                : (\n                  <Typography className={classes.deviceListItemName}>\n                    { (`${alias} (${device.dongle_id})`) }\n                  </Typography>\n                )}\n            </Grid>\n            { (!device.shared && (device.is_owner || this.props.isSuperUser))\n              && (\n              <Grid item xs={2}>\n                <Pencil className={classes.editDeviceIcon} onClick={partial(this.toggleDeviceEdit, device)} />\n              </Grid>\n              )}\n            { this.state.editingDevice === device.dongle_id\n              && (\n                <>\n                  <Grid item xs={6}>\n                    <Button\n                      variant=\"outlined\"\n                      onClick={partial(this.setDeviceAlias, device.dongle_id)}\n                      className={classes.saveButton}\n                    >\n                    Save\n                    </Button>\n                  </Grid>\n                  <Grid item xs={6}>\n                    <Button variant=\"outlined\" onClick={this.cancelEdit}>\n                    Cancel\n                    </Button>\n                  </Grid>\n                </>\n              )}\n          </Grid>\n        </ExpansionPanelSummary>\n      </ExpansionPanel>\n    );\n  }\n\n  filterDrivingDevice(device) {\n    return device.device_type !== 'panda';\n  }\n}\n\nconst stateToProps = Obstruction({\n  devices: 'workerState.devices',\n  isSuperUser: 'workerState.profile.superuser',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DeviceList));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport Raven from 'raven-js';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport Modal from '@material-ui/core/Modal';\nimport Paper from '@material-ui/core/Paper';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\n\nimport CheckIcon from '@material-ui/icons/Check';\nimport SaveIcon from '@material-ui/icons/Save';\nimport ShareIcon from '@material-ui/icons/Share';\n\nimport { devices as Devices } from '@commaai/comma-api';\nimport Timelineworker from '../../timeline';\n\nconst styles = (theme) => ({\n  modal: {\n    position: 'absolute',\n    padding: theme.spacing.unit * 2,\n    width: theme.spacing.unit * 50,\n    left: '50%',\n    top: '40%',\n    transform: 'translate(-50%, -50%)'\n  },\n  textField: {\n  },\n  buttonGroup: {\n    textAlign: 'right'\n  },\n  form: {\n    paddingTop: theme.spacing.unit,\n    paddingBottom: theme.spacing.unit\n  },\n  formRow: {\n    minHeight: 75\n  },\n  fabProgress: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    zIndex: 1,\n  },\n  wrapper: {\n    margin: theme.spacing.unit,\n    position: 'relative',\n    display: 'inline-block'\n  }\n});\n\nclass DeviceSettingsModal extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      deviceAlias: '',\n      loadingDeviceAlias: false,\n      loadingDeviceShare: false,\n      hasSavedAlias: false,\n      shareEmail: ''\n    };\n\n    this.handleAliasChange = this.handleAliasChange.bind(this);\n    this.handleEmailChange = this.handleEmailChange.bind(this);\n    this.callOnEnter = this.callOnEnter.bind(this);\n    this.setDeviceAlias = this.setDeviceAlias.bind(this);\n    this.shareDevice = this.shareDevice.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.device && nextProps.device.alias !== this.state.deviceAlias) {\n      this.setState({ deviceAlias: nextProps.device.alias });\n    }\n  }\n\n  handleAliasChange(e) {\n    this.setState({\n      deviceAlias: e.target.value,\n      hasSavedAlias: e.target.value === this.props.device.dongle_id ? this.state.hasSavedAlias : false\n    });\n  }\n\n  handleEmailChange(e) {\n    this.setState({\n      shareEmail: e.target.value,\n      hasShared: false\n    });\n  }\n\n  callOnEnter(method, e) {\n    if (e.key === 'Enter') {\n      method();\n    }\n  }\n\n  async setDeviceAlias() {\n    const { dongle_id } = this.props.device;\n\n    if (this.state.loadingDeviceAlias) {\n      return;\n    }\n\n    this.setState({\n      loadingDeviceAlias: true,\n      hasSavedAlias: false\n    });\n    try {\n      const device = await Devices.setDeviceAlias(dongle_id, this.state.deviceAlias.trim());\n      Timelineworker.updateDevice(device);\n      this.setState({\n        loadingDeviceAlias: false,\n        hasSavedAlias: true\n      });\n    } catch (e) {\n      Raven.captureException(e);\n      this.setState({ error: e.message, loadingDeviceAlias: false });\n    }\n  }\n\n  async shareDevice() {\n    if (this.state.loadingDeviceShare) {\n      return;\n    }\n\n    const { dongle_id } = this.props.device;\n    const email = this.state.shareEmail;\n\n    this.setState({\n      loadingDeviceShare: true,\n      hasShared: false\n    });\n    try {\n      await Devices.grantDeviceReadPermission(dongle_id, this.state.shareEmail.trim());\n      this.setState({\n        loadingDeviceShare: false,\n        shareEmail: '',\n        hasShared: true\n      });\n    } catch (e) {\n      const err = e;\n      console.log(e, err);\n      console.log(err.statusCode);\n      debugger;\n      Raven.captureException(e);\n      this.setState({ error: e.message, loadingDeviceShare: false });\n    }\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <Modal\n        aria-labelledby=\"device-settings-modal\"\n        aria-describedby=\"device-settings-modal-description\"\n        open={this.props.isOpen}\n        onClose={this.props.onClose}\n      >\n        <Paper className={classes.modal}>\n          <Typography variant=\"title\">\n            Edit Device\n          </Typography>\n          <Divider />\n          <div className={classes.form}>\n            <div className={classes.formRow}>\n              <TextField\n                id=\"device_alias\"\n                label=\"Device Name\"\n                className={classes.textField}\n                value={this.state.deviceAlias}\n                onChange={this.handleAliasChange}\n                onKeyPress={partial(this.callOnEnter, this.setDeviceAlias)}\n              />\n              { (this.props.device.alias !== this.state.deviceAlias || this.state.hasSavedAlias)\n                  && (\n                  <div className={classes.wrapper}>\n                    <IconButton\n                      variant=\"fab\"\n                      onClick={this.setDeviceAlias}\n                    >\n                      { this.state.hasSavedAlias && <CheckIcon /> || <SaveIcon /> }\n                    </IconButton>\n                    {this.state.loadingDeviceAlias && <CircularProgress size={48} className={classes.fabProgress} />}\n                  </div>\n                  )}\n            </div>\n            <div className={classes.formRow}>\n              <TextField\n                id=\"device_share\"\n                label=\"Share by Email\"\n                className={classes.textField}\n                value={this.state.shareEmail}\n                onChange={this.handleEmailChange}\n                onKeyPress={partial(this.callOnEnter, this.shareDevice)}\n              />\n              { (this.state.shareEmail.length > 0 || this.state.hasShared)\n                  && (\n                  <div className={classes.wrapper}>\n                    <IconButton\n                      variant=\"fab\"\n                      onClick={this.shareDevice}\n                    >\n                      { this.state.hasShared && <CheckIcon /> || <ShareIcon /> }\n                    </IconButton>\n                    {this.state.loadingDeviceShare && <CircularProgress size={48} className={classes.fabProgress} />}\n                  </div>\n                  )}\n            </div>\n          </div>\n          <div className={classes.buttonGroup}>\n            <Button variant=\"contained\" onClick={this.props.onClose}>\n              Close\n            </Button>\n            &nbsp;\n          </div>\n        </Paper>\n      </Modal>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  device: 'workerState.device',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DeviceSettingsModal));\n","import Raven from 'raven-js';\n\nexport const MAPBOX_TOKEN = process.env.REACT_APP_MAPBOX_TOKEN;\n\nconst mbxGeocoding = require('@mapbox/mapbox-sdk/services/geocoding');\n\nlet geocodingClient = null;\nif (MAPBOX_TOKEN) {\n  geocodingClient = mbxGeocoding({\n    accessToken: MAPBOX_TOKEN\n  });\n} else {\n  console.warn('Missing mapbox token');\n}\n\nexport default function geocodeApi() {\n  function getNeighborhood(context) {\n    return (context.id.indexOf('neighborhood') !== -1);\n  }\n\n  function getLocality(context) {\n    return (context.id.indexOf('place') !== -1);\n  }\n\n  function getRegion(context) {\n    return (context.id.indexOf('region') !== -1);\n  }\n\n  return {\n    async reverseLookup(coords) {\n      if (geocodingClient === null) {\n        return null;\n      }\n\n      const response = await geocodingClient.reverseGeocode({\n        query: [coords[0], coords[1]],\n        limit: 1,\n      }).send();\n\n      try {\n        const { features } = response.body;\n        if (features[0].context) {\n          let region = features[0].context.filter(getRegion)[0].short_code;\n          if (region.indexOf('US-') !== -1) { region = region.substr(3); }\n          const locality = features[0].context.filter(getLocality)[0].text;\n          const _neighborhood = features[0].context.filter(getNeighborhood)[0];\n          const neighborhood = _neighborhood ? _neighborhood.text : locality;\n\n          return {\n            region,\n            locality,\n            neighborhood,\n          };\n        }\n      } catch (err) {\n        Raven.captureException(err);\n      }\n    }\n  };\n}\n","import React from 'react';\nimport { partial } from 'ap';\n\nconst gutter = 0;\n\nfunction renderImage(imgStyles, data, i) {\n  if (data.blank) {\n    return (\n      <div\n        key={i}\n        className=\"thumbnailImage blank\"\n        style={{\n          ...imgStyles,\n          width: imgStyles.width * data.length,\n        }}\n      />\n    );\n  }\n  return (\n    <div\n      key={i}\n      className=\"thumbnailImage images\"\n      style={{\n        ...imgStyles,\n        width: imgStyles.width * data.length,\n        marginLeft: gutter,\n        backgroundSize: `auto ${imgStyles.height}px`,\n        backgroundRepeat: 'repeat-x',\n        backgroundImage: `url(${data.url})`,\n        backgroundPosition: `${data.startImage * imgStyles.width}px`\n      }}\n    />\n  );\n}\n\nexport default function Thumbnails(props) {\n  const { thumbnail } = props;\n  const imgStyles = {\n    display: 'inline-block',\n    height: thumbnail.height,\n    width: (1164 / 874) * thumbnail.height,\n  };\n  // console.log('Thumbnail props', props);\n  const imgCount = Math.ceil(thumbnail.width / imgStyles.width);\n  imgStyles.marginRight = gutter / 2;\n\n  const imgArr = [];\n  let currentSegment = null;\n\n  if (!Number.isFinite(imgCount)) {\n    return [];\n  }\n  for (let i = 0; i < imgCount; ++i) {\n    const offset = props.percentToOffset((i + 0.5) / imgCount);\n    const segment = props.getCurrentSegment(offset);\n    if (!segment) {\n      if (currentSegment && !currentSegment.blank) {\n        imgArr.push(currentSegment);\n        currentSegment = null;\n      }\n      if (!currentSegment) {\n        currentSegment = {\n          blank: true,\n          length: 0\n        };\n      }\n      currentSegment.length += 1;\n    } else {\n      // 12 per file, 5s each\n      let seconds = Math.floor((offset - segment.routeOffset) / 1000);\n      const url = `${segment.url}/${segment.segment}/sprite.jpg`;\n      seconds %= 60;\n\n      if (currentSegment && (currentSegment.blank || currentSegment.segment !== segment.segment)) {\n        imgArr.push(currentSegment);\n        currentSegment = null;\n      }\n\n      const imageIndex = Math.floor(seconds / 5);\n\n      if (currentSegment) {\n        if (imageIndex === currentSegment.endImage + 1) {\n          currentSegment.endImage = imageIndex;\n        } else {\n          imgArr.push(currentSegment);\n          currentSegment = null;\n        }\n      }\n\n      if (!currentSegment) {\n        currentSegment = {\n          segment: segment.segment,\n          startOffset: seconds,\n          startImage: imageIndex,\n          endImage: imageIndex,\n          length: 0,\n          url\n        };\n      }\n\n      currentSegment.length += 1;\n      currentSegment.endOffset = seconds;\n    }\n  }\n\n  if (currentSegment) {\n    imgArr.push(currentSegment);\n  }\n\n  return imgArr.map(partial(renderImage, imgStyles));\n}\n","const Colors = {\n  transparent: 'transparent',\n  white: '#fff',\n  white10: 'rgba(255, 255, 255, 0.1)',\n  white12: 'rgba(255, 255, 255, 0.12)',\n  white20: 'rgba(255, 255, 255, 0.2)',\n  white30: 'rgba(255, 255, 255, 0.3)',\n  white40: 'rgba(255, 255, 255, 0.4)',\n  white50: 'rgba(255, 255, 255, 0.5)',\n  black: '#030404',\n  blue50: '#258FDA',\n  blue100: '#2284c9',\n  blue200: '#1f79b8',\n  blue300: '#1c6ea8',\n  blue400: '#1a6397',\n  blue500: '#175886',\n  blue600: '#144d75',\n  blue700: '#114265',\n  blue800: '#0e3754',\n  blue900: '#0b2c43',\n  blue950: '#061622',\n  blue999: '#030b11',\n  lightBlue50: '#eef6fc',\n  lightBlue100: '#ddeef9',\n  lightBlue200: '#cde5f6',\n  lightBlue300: '#bcddf4',\n  lightBlue400: '#abd4f1',\n  lightBlue500: '#9acbee',\n  lightBlue600: '#8ac3eb',\n  lightBlue700: '#79bae8',\n  lightBlue800: '#68b1e5',\n  lightBlue900: '#57a9e3',\n  desatBlue800: '#657f92',\n  red50: '#da2535',\n  red100: '#c92231',\n  red200: '#b81f2d',\n  red300: '#971a25',\n  red400: '#861721',\n  red500: '#75141d',\n  red600: '#651118',\n  red700: '#540e14',\n  red800: '#430b10',\n  red900: '#32090c',\n  lightRed50: '#fceeef',\n  lightRed100: '#f9dde0',\n  lightRed200: '#f6cdd0',\n  lightRed300: '#f4bcc1',\n  lightRed400: '#f1abb1',\n  lightRed500: '#ee9aa2',\n  lightRed600: '#eb8a92',\n  lightRed700: '#e87983',\n  lightRed800: '#e56873',\n  lightRed900: '#e35764',\n  lightRed950: '#e04754',\n  lightRed999: '#dd3645',\n  green50: '#22c967',\n  green100: '#20b85f',\n  green200: '#1da756',\n  green300: '#1a974e',\n  green400: '#178645',\n  green500: '#14753c',\n  green600: '#116534',\n  green700: '#0e542b',\n  green800: '#0c4323',\n  green900: '#09321a',\n  lightGreen50: '#eefcf4',\n  lightGreen100: '#def9e9',\n  lightGreen200: '#cdf6de',\n  lightGreen300: '#bcf4d3',\n  lightGreen400: '#abf1c8',\n  lightGreen500: '#9beebd',\n  lightGreen600: '#8aebb2',\n  lightGreen700: '#79e8a7',\n  lightGreen800: '#68e59c',\n  lightGreen900: '#25da70',\n  orange50: '#da6f25',\n  orange100: '#c96722',\n  orange200: '#b85e1f',\n  orange300: '#a7551c',\n  orange400: '#964d19',\n  orange500: '#864417',\n  orange600: '#753c14',\n  orange700: '#643311',\n  orange800: '#532b0e',\n  orange900: '#42220b',\n  lightOrange50: '#fcf4ee',\n  lightOrange100: '#f9e8dd',\n  lightOrange200: '#f6ddcc',\n  lightOrange200: '#f4d2bb',\n  lightOrange300: '#f1c7aa',\n  lightOrange400: '#eebc9a',\n  lightOrange500: '#ebb189',\n  lightOrange600: '#e8a678',\n  lightOrange700: '#e59b67',\n  lightOrange800: '#e08546',\n  lightOrange900: '#dd7a35',\n  yellow50: '#f1ebaa',\n  yellow100: '#eee79a',\n  yellow200: '#ebe389',\n  yellow300: '#e8df78',\n  yellow400: '#e5db67',\n  yellow500: '#e3d756',\n  yellow600: '#e0d346',\n  yellow700: '#ddcf35',\n  yellow800: '#daca25',\n  yellow900: '#c9bb22',\n  grey50: '#6e7d84',\n  grey100: '#65737a',\n  grey200: '#5c696f',\n  grey300: '#535f64',\n  grey400: '#4b5559',\n  grey500: '#424a4f',\n  grey600: '#394044',\n  grey700: '#303639',\n  grey800: '#272c2f',\n  grey900: '#1e2224',\n  grey950: '#151819',\n  grey999: '#0c0e0f',\n  lightGrey50: '#f8f9f9',\n  lightGrey100: '#eeeff0',\n  lightGrey200: '#e3e6e8',\n  lightGrey300: '#d8dcdf',\n  lightGrey400: '#cdd3d6',\n  lightGrey500: '#c3c9cd',\n  lightGrey600: '#b8c0c4',\n  lightGrey700: '#adb6bb',\n  lightGrey800: '#a3adb2',\n  lightGrey900: '#98a3a9',\n  lightGrey950: '#8d9aa1',\n  lightGrey999: '#77878f',\n};\n\nexport default Colors;\n","import { createMuiTheme } from '@material-ui/core/styles';\nimport Colors from './colors';\nimport { ChevronIcon } from './icons';\n\nconst theme = createMuiTheme({\n  typography: {\n    fontFamily: 'MaisonNeue',\n  },\n  overrides: {\n    MuiPaper: {\n      root: {\n        backgroundColor: '#30373B'\n      },\n    },\n    MuiSelect: {\n      select: {\n        padding: '12px',\n        paddingRight: '48px',\n        margin: '0px',\n        '&>div': {\n          margin: '0',\n        }\n      },\n      selectMenu: {\n        paddingRight: 54,\n      },\n      icon: {\n        marginRight: 20,\n        color: '#272D30'\n      }\n    },\n    MuiInput: {\n      root: {\n        position: 'relative',\n        border: `1px solid ${Colors.grey800}`,\n        borderRadius: 20,\n        overflow: 'hidden'\n      },\n      input: {\n        padding: '12px 16px',\n        '&::placeholder': {\n          opacity: 1,\n          color: Colors.white30\n        }\n      }\n    },\n    MuiFormLabel: {\n      root: {\n        marginLeft: 16,\n        marginTop: 4\n      }\n    },\n    MuiTab: {\n      root: {\n        minHeight: 40,\n      }\n    },\n  },\n  props: {\n    MuiSelect: {\n      disableUnderline: true,\n      IconComponent: ChevronIcon\n    },\n    MuiInput: {\n      disableUnderline: true\n    }\n  },\n  palette: {\n    type: 'dark',\n    placeholder: Colors.white30,\n    background: {\n      default: Colors.grey999\n    },\n    primary: {\n      light: Colors.grey50,\n      main: Colors.grey900,\n      dark: Colors.grey999\n    },\n    states: {\n      drivingBlue: Colors.blue500,\n      engagedGreen: Colors.green400,\n      alertOrange: Colors.orange50,\n      alertRed: Colors.red100,\n    },\n    grey: {\n      50: Colors.grey50,\n      100: Colors.grey100,\n      200: Colors.grey200,\n      300: Colors.grey300,\n      400: Colors.grey400,\n      500: Colors.grey500,\n      600: Colors.grey600,\n      700: Colors.grey700,\n      800: Colors.grey800,\n      900: Colors.grey900,\n      950: Colors.grey950,\n      999: Colors.grey999\n    },\n    lightGrey: {\n      200: Colors.lightGrey200,\n    },\n    white: {\n      10: Colors.white10,\n      12: Colors.white12,\n      20: Colors.white20,\n      30: Colors.white30,\n      40: Colors.white40,\n      50: Colors.white50,\n    },\n    error: {\n      main: 'rgba(209,106,35,0.72)'\n    }\n  }\n});\n\nexport default theme;\n","// timeline minimap\n// rapidly change high level timeline stuff\n// rapid seeking, etc\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { withStyles } from '@material-ui/core/styles';\nimport raf from 'raf';\nimport debounce from 'debounce';\nimport document from 'global/document';\nimport fecha from 'fecha';\nimport cx from 'classnames';\nimport { partial } from 'ap';\nimport PropTypes from 'prop-types';\n\nimport Measure from 'react-measure';\nimport Tooltip from '@material-ui/core/Tooltip';\n\nimport Thumbnails from './thumbnails';\nimport theme from '../../theme';\nimport TimelineWorker from '../../timeline';\nimport Segments from '../../timeline/segments';\nimport { selectRange } from '../../actions';\n\nconst styles = (/* theme */) => ({\n  base: {\n    backgroundColor: '#1D2225',\n    minHeight: '32px',\n    overflow: 'hidden',\n    position: 'relative',\n    width: '100%',\n    '&.hasThumbnails.hasRuler': {\n      minHeight: '80px',\n    },\n  },\n  rounded: {\n    borderRadius: '10px 10px 0px 0px'\n  },\n  segments: {\n    position: 'absolute',\n    top: '0px',\n    left: '0px',\n    width: '100%',\n    height: '100%',\n    '&.hasThumbnails': {\n      height: '40%'\n    },\n    '&.hasThumbnails.hasRuler': {\n      height: '100%',\n    },\n  },\n  segment: {\n    position: 'relative',\n    height: '100%',\n    background: theme.palette.states.drivingBlue,\n  },\n  ruler: {\n    background: '#272D30d9',\n    bottom: 0,\n    position: 'absolute',\n    top: 12,\n    width: '100%',\n  },\n  rulerRemaining: {\n    background: '#1D2225',\n    borderLeft: '1px solid #D8DDDF',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    height: '100%',\n    opacity: 0.45,\n    pointerEvents: 'none',\n    width: '100%',\n  },\n  statusGradient: {\n    background: 'linear-gradient(rgba(0, 0, 0, 0.0) 4%, rgba(255, 255, 255, 0.025) 10%, rgba(0, 0, 0, 0.1) 25%, rgba(0, 0, 0, 0.4))',\n    height: 12,\n    left: 0,\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  },\n  segmentColor: {\n    position: 'absolute',\n    display: 'inline-block',\n    height: '100%',\n    width: '100%',\n    '&.active': {},\n    '&.engage': {\n      background: theme.palette.states.engagedGreen,\n    },\n    '&.alert': {\n      '&.userPrompt': {\n        background: theme.palette.states.alertOrange,\n      },\n      '&.critical': {\n        background: theme.palette.states.alertRed,\n      }\n    }\n  },\n  uncoloredSegment: {\n    background: theme.palette.states.drivingBlue,\n    height: '100%',\n    width: '100%',\n  },\n  hoverBead: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: 50,\n    height: '100%'\n  },\n  dragHighlight: {\n    background: 'rgba(255, 255, 255, 0.1)',\n    position: 'absolute',\n    height: '100%',\n  },\n  thumbnails: {\n    position: 'absolute',\n    height: '60%',\n    top: 12,\n    width: '100%',\n    whiteSpace: 'nowrap',\n    userSelect: 'none',\n    '& img': {\n      pointerEvents: 'none',\n    },\n    '&.hasRuler': {\n      height: '30%',\n    },\n    '& > div': {\n      display: 'inline-block'\n    }\n  },\n});\n\nconst AlertStatusCodes = [\n  'normal',\n  'userPrompt',\n  'critical'\n];\n\nfunction percentFromMouseEvent(e) {\n  const boundingBox = e.currentTarget.getBoundingClientRect();\n  const x = e.pageX - boundingBox.left;\n  return x / boundingBox.width;\n}\n\nclass Timeline extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getOffset = this.getOffset.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.handleMouseLeave = this.handleMouseLeave.bind(this);\n    this.percentToOffset = this.percentToOffset.bind(this);\n    this.renderSegment = this.renderSegment.bind(this);\n    this.sendSeek = debounce(this.sendSeek.bind(this), 1000 / 60);\n\n\n    this.offsetValue = React.createRef();\n    this.rulerRemaining = React.createRef();\n    this.rulerRemainingHovered = React.createRef();\n    this.dragBar = React.createRef();\n    this.hoverBead = React.createRef();\n    // this.canvas_speed = React.createRef();\n    const { zoomOverride, zoom } = this.props;\n    this.state = {\n      dragStart: null,\n      zoom: zoomOverride || zoom,\n      mouseX: 0,\n      hoverPercent: 0,\n      isHovered: false,\n      thumbnail: {\n        height: 0,\n        width: 0\n      }\n    };\n  }\n\n  componentWillMount() {\n    document.addEventListener('mouseup', this.handleMouseUp, false);\n    this.stopListening = TimelineWorker.onIndexed(() => this.forceUpdate());\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    raf(this.getOffset);\n  }\n\n  componentWillReceiveProps(props) {\n    this.setState({\n      zoom: props.zoomOverride || props.zoom\n    });\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    document.removeEventListener('mouseup', this.handleMouseUp, false);\n    this.stopListening();\n  }\n\n  getOffset() {\n    if (!this.mounted) {\n      return;\n    }\n    raf(this.getOffset);\n    let offset = TimelineWorker.currentOffset();\n    if (this.seekIndex) {\n      offset = this.seekIndex;\n    }\n    offset = Math.floor(offset);\n    const percent = this.offsetToPercent(offset);\n    if (this.rulerRemaining.current && this.rulerRemaining.current.parentElement) {\n      this.rulerRemaining.current.style.left = `${Math.floor(10000 * percent) / 100}%`;\n    }\n    const { isHovered } = this.state;\n    if (!isHovered\n      && this.rulerRemainingHovered.current\n      && this.rulerRemainingHovered.current.parentElement) {\n      this.rulerRemainingHovered.current.style.left = `${Math.floor(10000 * percent) / 100}%`;\n    }\n  }\n\n  handleClick(e) {\n    if (this.isDragSelecting) {\n      console.log('Is a drag event');\n      this.isDragSelecting = false;\n      return;\n    }\n    const { noseek } = this.props;\n    if (noseek) {\n      return;\n    }\n    const percent = percentFromMouseEvent(e);\n\n    TimelineWorker.seek(this.percentToOffset(percent));\n  }\n\n  handleMouseDown(e) {\n    const { classes, dragSelection } = this.props;\n    if (!dragSelection) {\n      return;\n    }\n    // make sure they're clicking & dragging and not just moving the mouse around\n    if (e.currentTarget.parentElement.querySelector(`.${classes.base}:active`) !== e.currentTarget) {\n      return;\n    }\n\n    const percent = percentFromMouseEvent(e);\n    this.setState({\n      dragStart: percent,\n      dragEnd: percent\n    });\n  }\n\n  handleMouseUp(e) {\n    const { dragStart, dragEnd } = this.state;\n    const { dragSelection } = this.props;\n    if (!dragSelection) {\n      return;\n    }\n    if (!dragStart) {\n      return;\n    }\n    const selectedArea = Math.abs(dragStart - dragEnd) * 100;\n    const startPercent = Math.min(dragStart, dragEnd);\n    const endPercent = Math.max(dragStart, dragEnd);\n    const startOffset = Math.round(this.percentToOffset(startPercent));\n    const endOffset = Math.round(this.percentToOffset(endPercent));\n\n    if (selectedArea > 0.1) {\n      const currentOffset = TimelineWorker.currentOffset();\n      if (currentOffset < startOffset || currentOffset > endOffset) {\n        TimelineWorker.seek(startOffset);\n      }\n      const { start, dispatch } = this.props;\n      const startTime = startOffset + start;\n      const endTime = endOffset + start;\n\n      this.isDragSelecting = true;\n      setTimeout(() => { this.isDragSelecting = false; });\n      dispatch(selectRange(startTime, endTime));\n    } else if (e.currentTarget !== document) {\n      this.handleClick(e);\n    }\n\n    this.setState({\n      dragStart: null,\n      dragEnd: null\n    });\n  }\n\n  handleMouseMove(e) {\n    const boundingBox = e.currentTarget.getBoundingClientRect();\n    const x = e.pageX - boundingBox.left;\n    const percent = x / boundingBox.width;\n\n    this.setState({\n      mouseX: x,\n      hoverPercent: percent,\n      isHovered: true,\n    });\n\n    // mouseover highlight\n    if (this.rulerRemainingHovered.current && this.rulerRemainingHovered.current.parentElement) {\n      let { hoverPercent } = this.state;\n      hoverPercent = (hoverPercent * 100).toFixed(2);\n      this.rulerRemainingHovered.current.style.left = `${hoverPercent}%`;\n    }\n\n    const { classes, dragSelection } = this.props;\n    const { dragStart } = this.state;\n    // drag highlight\n    if (e.currentTarget.parentElement.querySelector(`.${classes.base}:active`) !== e.currentTarget) {\n      return; // ignore mouseover\n    }\n    if (!dragSelection) {\n      this.seekIndex = this.percentToOffset(percent);\n      this.sendSeek();\n    } if (dragStart) {\n      this.setState({\n        dragEnd: percent\n      });\n    }\n    // do other things for drag selection!\n  }\n\n  handleMouseLeave() {\n    this.setState({ isHovered: false });\n  }\n\n  percentToOffset(perc) {\n    const { zoom } = this.state;\n    const { zoomed, range, start } = this.props;\n    if (zoomed) {\n      return perc * (zoom.end - zoom.start) + (zoom.start - start);\n    }\n    return perc * range;\n  }\n\n  offsetToPercent(offset) {\n    const { zoom } = this.state;\n    const { zoomed, range, start } = this.props;\n    if (zoomed) {\n      return (offset - (zoom.start - start)) / (zoom.end - zoom.start);\n    }\n    return offset / range;\n  }\n\n  sendSeek() {\n    if (this.seekIndex) {\n      TimelineWorker.seek(this.seekIndex);\n      this.seekIndex = null;\n    }\n  }\n\n  renderDragger() {\n    const { dragStart, dragEnd } = this.state;\n    const { dragSelection, classes } = this.props;\n    if (!dragSelection || !dragStart) {\n      return [];\n    }\n    const draggerStyle = {\n      left: `${100 * Math.min(dragStart, dragEnd)}%`,\n      width: `${100 * Math.abs(dragStart - dragEnd)}%`,\n    };\n    return (\n      <div\n        ref={this.dragBar}\n        className={classes.dragHighlight}\n        style={draggerStyle}\n      />\n    );\n  }\n\n  renderZoom() {\n    const {\n      zoom, dragSelection, zoomed, start, range\n    } = this.props;\n    if (!dragSelection || !zoom.expanded || zoomed) {\n      return [];\n    }\n    const color = `${theme.palette.grey[50]}cc`;\n    const endColor = `${theme.palette.grey[200]}aa`;\n    const zoomStart = (zoom.start - start) / range;\n    const zoomEnd = (zoom.end - start) / range;\n    const barStyle = {\n      background: `linear-gradient(to left,${color},${endColor},${color})`,\n      left: `${100 * Math.min(zoomStart, zoomEnd)}%`,\n      width: `${100 * Math.abs(zoomStart - zoomEnd)}%`,\n    };\n    return (\n      <div\n        style={barStyle}\n      />\n    );\n  }\n\n  renderSegment(segment) {\n    const {\n      classes, range, zoomed, start, colored\n    } = this.props;\n    const { zoom } = this.state;\n    let startPerc = (100 * segment.offset) / range;\n    let widthPerc = (100 * segment.duration) / range;\n    if (zoomed) {\n      const startOffset = zoom.start - start;\n      const endOffset = zoom.end - start;\n      const zoomDuration = endOffset - startOffset;\n      if (segment.offset > endOffset) {\n        return [];\n      }\n      if (segment.offset + segment.duration < startOffset) {\n        return [];\n      }\n      startPerc = (100 * (segment.offset - startOffset)) / zoomDuration;\n      widthPerc = (100 * segment.duration) / zoomDuration;\n    }\n    const style = {\n      position: 'absolute',\n      width: `${widthPerc}%`,\n      left: `${startPerc}%`,\n    };\n    return (\n      <div\n        key={segment.route + segment.offset}\n        className={classes.segment}\n        style={style}\n      >\n        { colored ? this.renderSegmentEvents(segment) : (\n          <div className={classes.uncoloredSegment} />\n        ) }\n      </div>\n    );\n  }\n\n  renderSegmentEvents(segment) {\n    const { classes } = this.props;\n    return segment.events\n      .filter((event) => event.data && event.data.end_route_offset_millis)\n      .map((event) => {\n        const style = {\n          left: `${(event.route_offset_millis / segment.duration) * 100}%`,\n          width: `${((event.data.end_route_offset_millis - event.route_offset_millis) / segment.duration) * 100}%`,\n        };\n        if (localStorage.showCurrentEvent) {\n          const time = TimelineWorker.currentOffset();\n          const eventStart = event.route_offset_millis + segment.offset;\n          const eventEnd = event.data.end_route_offset_millis + segment.offset;\n          if (time > eventStart && time < eventEnd) {\n            console.log('Current event:', event);\n          }\n        }\n        return (\n          <div\n            key={segment.route + event.time + event.type}\n            style={style}\n            className={cx(classes.segmentColor, event.type, {\n              [`${AlertStatusCodes[event.data.alertStatus]}`]: event.data.alertStatus,\n            })}\n          />\n        );\n      });\n  }\n\n  render() {\n    const {\n      classes,\n      hasThumbnails,\n      tooltipped,\n      hasRuler,\n      start,\n      className,\n      style,\n      rounded,\n      segments,\n      hasGradient\n    } = this.props;\n    const { hoverPercent, thumbnail, mouseX } = this.state;\n    const hoverOffset = this.percentToOffset(hoverPercent);\n    let timeString = null;\n    if (tooltipped) {\n      if (Number.isNaN(hoverOffset)) {\n        timeString = 'N/A';\n      } else {\n        const timestampAtOffset = start + hoverOffset;\n        timeString = fecha.format(timestampAtOffset, 'M/D HH:mm:ss');\n      }\n    }\n    return (\n      <div\n        className={className}\n        style={style}\n      >\n        <div\n          role=\"presentation\"\n          className={cx(classes.base, {\n            rounded,\n            hasRuler,\n            hasThumbnails,\n          })}\n          onMouseDown={this.handleMouseDown}\n          onMouseUp={this.handleMouseUp}\n          onMouseMove={this.handleMouseMove}\n          onMouseLeave={this.handleMouseLeave}\n          onClick={this.handleClick}\n        >\n          <div className={cx(classes.segments, { hasThumbnails, hasRuler })}>\n            { segments && segments.map(this.renderSegment) }\n            { hasRuler && (\n              <div className={classes.ruler}>\n                <div\n                  ref={this.rulerRemaining}\n                  className={classes.rulerRemaining}\n                />\n                <div\n                  ref={this.rulerRemainingHovered}\n                  className={classes.rulerRemaining}\n                />\n              </div>\n            ) }\n            { hasGradient && (\n              <div\n                className={cx(classes.statusGradient, {\n                  hasRuler,\n                })}\n              />\n            ) }\n            { this.renderDragger() }\n            { this.renderZoom() }\n          </div>\n          { tooltipped\n            && (\n            <Tooltip title={timeString}>\n              <div\n                ref={this.hoverBead}\n                className={classes.hoverBead}\n                style={{ left: mouseX - 25 }}\n              />\n            </Tooltip>\n            )}\n          { hasThumbnails\n            && (\n            <Measure\n              bounds\n              onResize={(rect) => this.setState({ thumbnail: rect.bounds })}\n            >\n              { (options) => (\n                <div\n                  ref={options.measureRef}\n                  className={cx(classes.thumbnails, {\n                    hasRuler,\n                  })}\n                >\n                  <Thumbnails\n                    getCurrentSegment={partial(Segments.getCurrentSegment, this.props)}\n                    percentToOffset={this.percentToOffset}\n                    thumbnail={thumbnail}\n                    className={classes.thumbnail}\n                    hasRuler={hasRuler}\n                  />\n                </div>\n              )}\n            </Measure>\n            )}\n        </div>\n      </div>\n    );\n  }\n}\n\nTimeline.propTypes = {\n  zoom: PropTypes.object.isRequired,\n  zoomOverride: PropTypes.object,\n  zoomed: PropTypes.bool,\n  colored: PropTypes.bool,\n  start: PropTypes.number.isRequired,\n  range: PropTypes.number.isRequired,\n  classes: PropTypes.object.isRequired,\n  dragSelection: PropTypes.bool,\n  hasThumbnails: PropTypes.bool,\n  hasRuler: PropTypes.bool,\n  tooltipped: PropTypes.bool,\n  hasGradient: PropTypes.bool,\n  rounded: PropTypes.bool,\n  segments: PropTypes.array.isRequired,\n  className: PropTypes.string,\n  style: PropTypes.object,\n  dispatch: PropTypes.func.isRequired,\n  noseek: PropTypes.bool,\n};\n\nfunction mapStateToProps(state) {\n  return {\n    ...state.workerState,\n    zoom: state.zoom\n  };\n}\n\nexport default connect(mapStateToProps)(withStyles(styles)(Timeline));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\nimport { classNames } from 'react-extras';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\n\nimport { selectRange } from '../../actions';\nimport { formatDriveDuration, getDrivePoints } from '../../utils';\nimport GeocodeApi from '../../api/geocode';\nimport Timeline from '../Timeline';\nimport { RightArrow } from '../../icons';\nimport { KM_PER_MI } from '../../utils/conversions';\n\nconst styles = (theme) => ({\n  drive: {\n    background: 'rgba(255, 255, 255, 0.0)',\n    background: 'linear-gradient(to bottom, #30373B 0%, #1D2225 100%)',\n    borderTop: '1px solid rgba(255, 255, 255, .05)',\n    borderRadius: 8,\n    cursor: 'pointer',\n    display: 'flex',\n    flexDirection: 'column',\n    marginBottom: 12,\n    overflow: 'hidden',\n    padding: 0,\n    transition: 'background .2s',\n    '&:hover': {}\n  },\n  driveHeader: {\n    alignItems: 'center',\n    padding: 18,\n    paddingLeft: 24,\n    paddingRight: 24,\n  },\n  driveHeaderIntro: {\n    display: 'flex',\n  },\n  driveAvatar: {\n    alignItems: 'center',\n    background: '#404B4F',\n    borderRadius: 30,\n    color: '#fff',\n    display: 'flex',\n    fontWeight: 600,\n    height: 52,\n    justifyContent: 'center',\n    margin: '0px 3%',\n    width: 52,\n  },\n  driveTitle: {\n    marginLeft: '10%',\n  },\n  driveTimeline: {},\n  driveArrow: {\n    color: '#404B4F',\n    height: '100%',\n    marginLeft: '25%',\n    width: 32,\n  },\n});\n\nclass DriveListDrive extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      startLocation: null,\n      endLocation: null,\n    };\n\n    this.handleDriveClicked = this.handleDriveClicked.bind(this);\n  }\n\n  componentDidMount() {\n    const { drive } = this.props;\n    this.mounted = true;\n    GeocodeApi().reverseLookup(drive.startCoord).then((startLocation) => {\n      if (!this.mounted) {\n        return;\n      }\n      this.setState({ startLocation });\n    });\n    GeocodeApi().reverseLookup(drive.endCoord).then((endLocation) => {\n      if (!this.mounted) {\n        return;\n      }\n      this.setState({ endLocation });\n    });\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleDriveClicked(drive) {\n    const startTime = drive.startTime - 1000;\n    const endTime = drive.startTime + drive.duration + 1000;\n    this.props.dispatch(selectRange(startTime, endTime));\n  }\n\n  render() {\n    const { drive, deviceAlias, classes } = this.props;\n    const { startLocation, endLocation } = this.state;\n    const startTime = fecha.format(new Date(drive.startTime), 'HH:mm');\n    const startDate = fecha.format(new Date(drive.startTime), 'ddd, MMM D');\n    const endTime = fecha.format(new Date(drive.startTime + drive.duration + 1000), 'HH:mm');\n    const duration = formatDriveDuration(drive.duration);\n    const points = getDrivePoints(drive.duration);\n    return (\n      <li\n        key={drive.startTime}\n        className={classNames(classes.drive, 'DriveEntry')}\n        onClick={partial(this.handleDriveClicked, drive)}\n      >\n        <div className={classes.driveHeader}>\n          <Grid container>\n            <Grid item xs={4} className={classes.driveHeaderIntro}>\n              <div className={classes.driveAvatar}>\n                { drive.annotations }\n              </div>\n              <div className={classes.driveTitle}>\n                <Typography variant=\"body2\">\n                  { `${startDate} @ ${startTime} to ${endTime}` }\n                </Typography>\n                <Typography>\n                  { deviceAlias }\n                </Typography>\n              </div>\n            </Grid>\n            <Grid item xs={2}>\n              <Typography variant=\"body2\">\n                { duration.hours > 0 && `${duration.hours.toString()}hr ` }\n                { `${duration.minutes} min` }\n              </Typography>\n              <Typography>\n                { `${points} points` }\n              </Typography>\n            </Grid>\n            <Grid item xs={2}>\n              <Typography variant=\"body2\">\n                { startLocation && startLocation.neighborhood }\n              </Typography>\n              <Typography>\n                { startLocation && (`${startLocation.locality}, ${startLocation.region}`) }\n              </Typography>\n            </Grid>\n            <Grid item xs={2}>\n              <Typography variant=\"body2\">\n                { endLocation && endLocation.neighborhood }\n              </Typography>\n              <Typography>\n                { endLocation && (`${endLocation.locality}, ${endLocation.region}`) }\n              </Typography>\n            </Grid>\n            <Grid item xs={1}>\n              <Typography variant=\"body2\">\n                { `${+drive.distanceMiles.toFixed(1)} mi` }\n              </Typography>\n              <Typography>\n                { `${+(drive.distanceMiles * KM_PER_MI).toFixed(1)} km` }\n              </Typography>\n            </Grid>\n            <Grid item xs={1}>\n              <RightArrow className={classes.driveArrow} />\n            </Grid>\n          </Grid>\n        </div>\n        <Timeline\n          className={classes.driveTimeline}\n          zoomed\n          colored\n          hasThumbnails\n          hasGradient\n          zoomOverride={{\n            start: drive.startTime,\n            end: drive.startTime + drive.duration\n          }}\n        />\n      </li>\n    );\n  }\n}\n\nexport default connect(() => ({}))(withStyles(styles)(DriveListDrive));\n","export const KM_PER_MI = 1.60934;\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\n\nimport {\n  withStyles,\n  Typography,\n  Grid,\n  Menu,\n  MenuItem,\n  ListItem,\n  IconButton,\n} from '@material-ui/core';\nimport SettingsIcon from '@material-ui/icons/Settings';\n\nimport { filterEvent } from '../../utils';\nimport { selectRange } from '../../actions';\nimport DeviceSettingsModal from './DeviceSettingsModal';\nimport DriveListItem from './DriveListItem';\n\nconst MIN_TIME_BETWEEN_ROUTES = 60000; // 1 minute\n\nconst styles = (theme) => ({\n  header: {\n    alignItems: 'center',\n    borderBottom: '1px solid rgba(255, 255, 255, 0.1)',\n    padding: 16,\n    paddingLeft: 48,\n    paddingRight: 60,\n  },\n  headerLabel: {\n    cursor: 'default',\n    textTransform: 'uppercase',\n  },\n  drives: {\n    height: '100%',\n    margin: 0,\n    overflowY: 'scroll',\n    padding: 16,\n    paddingLeft: 24,\n    paddingRight: 24,\n  },\n  zeroState: {\n    padding: '16px 48px',\n  },\n  settingsArea: {\n    display: 'flex',\n    justifyContent: 'flex-end',\n  },\n  settingsButton: {\n    border: '1px solid #272D30'\n  },\n  settingsButtonIcon: {\n    color: '#272D30',\n  },\n});\n\nclass DriveList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.goToAnnotation = this.goToAnnotation.bind(this);\n    this.filterShortDrives = this.filterShortDrives.bind(this);\n    this.renderDriveListHeader = this.renderDriveListHeader.bind(this);\n    this.renderDriveListSettings = this.renderDriveListSettings.bind(this);\n    this.handleClickedSettings = this.handleClickedSettings.bind(this);\n    this.handleClosedSettings = this.handleClosedSettings.bind(this);\n    this.handleOpenedSettingsModal = this.handleOpenedSettingsModal.bind(this);\n    this.handleCanceledSettings = this.handleCanceledSettings.bind(this);\n    this.handleClosedSettingsModal = this.handleClosedSettingsModal.bind(this);\n\n    this.state = {\n      anchorEl: null,\n      showDeviceSettingsModal: false\n    };\n  }\n\n  componentWillReceiveProps(props) {\n    if (props.device && !this.state.deviceAliasSaved) {\n      this.setState({ deviceAliasSaved: props.device.alias });\n    }\n  }\n\n  filterShortDrives(ride) {\n    return ride.duration > 60000;\n  }\n\n  goToAnnotation(segment) {\n    const startTime = segment.startTime - this.props.zoomBuffer;\n    const endTime = segment.startTime + segment.duration + this.props.zoomBuffer;\n    this.props.dispatch(selectRange(startTime, endTime));\n  }\n\n  handleClickedSettings(event) {\n    this.setState({ anchorEl: event.currentTarget });\n  }\n\n  handleClosedSettings() {\n    this.setState({ anchorEl: null });\n  }\n\n  handleOpenedSettingsModal(device) {\n    this.setState({ showDeviceSettingsModal: true });\n  }\n\n  handleClosedSettingsModal() {\n    this.setState({ showDeviceSettingsModal: false });\n  }\n\n  handleCanceledSettings() {\n    this.setState({\n      anchorEl: null,\n      showDeviceSettingsModal: false,\n    });\n  }\n\n  handleClose() {\n    this.setState({\n      showPicker: false\n    });\n  }\n\n  render() {\n    const { classes, device, segments } = this.props;\n\n    if (!device) {\n      return [];\n    }\n\n    const driveList = [];\n    let lastEnd = 0;\n    let lastSegmentEnd = 0;\n    let curRideChunk = null;\n    this.props.segments.forEach((segment) => {\n      if (!curRideChunk || segment.startTime - lastEnd > MIN_TIME_BETWEEN_ROUTES) {\n        curRideChunk = {\n          segments: 0,\n          startTime: segment.startTime,\n          offset: segment.offset,\n          duration: 0,\n          annotations: 0,\n          startCoord: segment.startCoord,\n          endCoord: segment.endCoord,\n          distanceMiles: segment.distanceMiles,\n        };\n        driveList.unshift(curRideChunk);\n        lastSegmentEnd = segment.startTime;\n      }\n      curRideChunk.duration += segment.startTime - lastSegmentEnd;\n      curRideChunk.duration += segment.duration;\n      lastSegmentEnd = segment.startTime + segment.duration;\n      curRideChunk.segments++;\n      lastEnd = segment.startTime + segment.duration;\n      curRideChunk.annotations += segment.events.filter(filterEvent)\n        .reduce((memo, event) => (event.id ? memo : memo + 1), 0);\n    });\n\n    return (\n      <>\n        { this.renderDriveListHeader() }\n        { driveList.length === 0 && this.renderZeroRides() }\n        <ul className={classes.drives}>\n          { driveList.filter(this.filterShortDrives).map((drive) => (\n            <DriveListItem\n              key={drive.startTime}\n              drive={drive}\n              deviceAlias={device.alias}\n            />\n          ))}\n        </ul>\n      </>\n    );\n  }\n\n  renderZeroRides() {\n    const { classes } = this.props;\n    let zeroRidesEle = null;\n    const { device } = this.props;\n    const hasDrivesInQuery = (device && device.last_segment_utc_millis !== null)\n      && (device.last_segment_utc_millis >= this.props.start);\n\n    if (hasDrivesInQuery) {\n      zeroRidesEle = <Typography>Loading...</Typography>;\n    } else {\n      zeroRidesEle = (\n        <Typography>\nLooks like you haven\n          {'\\''}\nt driven in the selected time range.\n        </Typography>\n      );\n    }\n\n    return (\n      <div className={classes.zeroState}>\n        <Grid container>\n          { zeroRidesEle }\n        </Grid>\n      </div>\n    );\n  }\n\n  renderDriveListHeader() {\n    const { classes, device } = this.props;\n    return (\n      <div className={classes.header}>\n        <Grid container alignItems=\"center\">\n          <Grid item xs={4}>\n            <Typography variant=\"title\">\n              { device.alias }\n              {' '}\nDrives\n            </Typography>\n          </Grid>\n          <Grid item xs={2}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Duration\n            </Typography>\n          </Grid>\n          <Grid item xs={2}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Origin\n            </Typography>\n          </Grid>\n          <Grid item xs={2}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Destination\n            </Typography>\n          </Grid>\n          <Grid item xs={1}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Distance\n            </Typography>\n          </Grid>\n          <Grid item xs={1} className={classes.settingsArea}>\n            { ((device && !device.shared && device.is_owner) || this.props.isSuperUser)\n              && this.renderDriveListSettings()}\n          </Grid>\n        </Grid>\n      </div>\n    );\n  }\n\n  renderDriveListSettings() {\n    const { classes, device } = this.props;\n    const { anchorEl } = this.state;\n    const open = Boolean(anchorEl);\n    return (\n      <>\n        <IconButton\n          className={classes.settingsButton}\n          onClick={partial(this.handleOpenedSettingsModal, device)}\n        >\n          <SettingsIcon className={classes.settingsButtonIcon} />\n        </IconButton>\n        <DeviceSettingsModal\n          isOpen={this.state.showDeviceSettingsModal}\n          onClose={this.handleClosedSettingsModal}\n          onCancel={this.handleCanceledSettings}\n        />\n      </>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  segments: 'workerState.segments',\n  start: 'workerState.start',\n  device: 'workerState.device',\n  isSuperUser: 'workerState.profile.superuser',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DriveList));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Modal from '@material-ui/core/Modal';\n\nimport { selectRange, selectDevice } from '../../actions';\nimport { filterEvent } from '../../utils';\nimport DeviceList from './DeviceList';\nimport DriveList from './DriveList';\nimport Timelineworker from '../../timeline';\n\nconst ZOOM_BUFFER = 1000; // 1 second on either end\n\nconst styles = (theme) => ({\n  base: {\n    background: 'linear-gradient(180deg, #1D2225 0%, #16181A 100%)',\n    display: 'flex',\n    overflow: 'hidden',\n    flexGrow: 1,\n    minWidth: '100%',\n  },\n  sidebar: {\n    background: 'linear-gradient(180deg, #1B2023 0%, #111516 100%)',\n    display: 'flex',\n    flexDirection: 'column',\n    minWidth: 280,\n    width: '20%',\n  },\n  sidebarHeader: {\n    alignItems: 'center',\n    padding: 24,\n  },\n  window: {\n    display: 'flex',\n    flexGrow: 1,\n    flexDirection: 'column',\n  },\n  annotateButton: {\n    background: '#fff',\n    borderRadius: 30,\n    color: '#404B4F',\n    height: 50,\n    textTransform: 'none',\n    width: '80%',\n    '&:hover': {\n      background: '#fff',\n      color: '#404B4F',\n    }\n  },\n});\n\nclass Dashboard extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleDeviceSelected = this.handleDeviceSelected.bind(this);\n    this.goToAnnotation = this.goToAnnotation.bind(this);\n  }\n\n  handleDeviceSelected(dongleId) {\n    this.props.dispatch(selectDevice(dongleId));\n  }\n\n  goToAnnotation(segment) {\n    if (segment == null) { return; }\n    const startTime = segment.startTime - ZOOM_BUFFER;\n    const endTime = segment.startTime + segment.duration + ZOOM_BUFFER;\n    this.props.dispatch(selectRange(startTime, endTime));\n  }\n\n  render() {\n    const { classes } = this.props;\n    let firstAnnotationSegment = null;\n    const newAnnotations = this.props.segments.reduce((count, segment) => {\n      const segCount = segment.events.filter(filterEvent).reduce((memo, event) => (event.id ? memo : memo + 1), 0);\n      if (!firstAnnotationSegment && segCount > 0) {\n        firstAnnotationSegment = segment;\n      }\n      return count + segCount;\n    }, 0);\n\n    return (\n      <div className={classes.base}>\n        <div className={classes.sidebar}>\n          <div className={classes.sidebarHeader}>\n            <Button\n              size=\"large\"\n              variant=\"outlined\"\n              className={classes.annotateButton}\n              onClick={partial(this.goToAnnotation, firstAnnotationSegment)}\n            >\n              Annotate\n            </Button>\n          </div>\n          <DeviceList\n            selectedDevice={this.props.selectedDongleId}\n            handleDeviceSelected={this.handleDeviceSelected}\n          />\n        </div>\n        <div className={classes.window}>\n          <DriveList />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  segments: 'workerState.segments',\n  selectedDongleId: 'workerState.dongleId',\n  device: 'workerState.device',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(Dashboard));\n","import React, { PureComponent } from 'react';\nimport fecha from 'fecha';\nimport Raven from 'raven-js';\nimport { classNames } from 'react-extras';\n\nimport {\n  withStyles,\n  Grid,\n  Typography,\n  ExpansionPanel,\n  ExpansionPanelSummary,\n  ExpansionPanelDetails,\n  ExpansionPanelActions,\n  Divider,\n  Select,\n  MenuItem,\n  Button,\n  TextField,\n  Tooltip,\n  FormHelperText,\n  LinearProgress,\n} from '@material-ui/core';\n\nimport { annotations as Annotations } from '@commaai/comma-api';\nimport Timelineworker from '../../timeline';\n\nconst DISENGAGEMENT_REASONS = [\n  { value: 'arbitrary', title: 'I wanted to take over', header: true },\n  { value: 'different-way', title: 'Go a different way' },\n  { value: 'lanes', title: 'Change lanes' },\n  { value: 'too-slow', title: 'Accelerate quicker' },\n  { value: 'exit', title: 'Take an exit' },\n  { value: 'stop-light', title: 'Stop at light' },\n  { value: 'stop-sign', title: 'Stop at sign' },\n  { value: 'other-desire', title: 'Other (explain in comment)' },\n\n  { value: 'danger', title: 'I needed to take over for safety', header: true },\n  { value: 'sharp-turn', title: 'Turn too sharp' },\n  { value: 'bad-lanes', title: 'Lanes misidentified' },\n  { value: 'bad-lead-car', title: 'Lead car misidentified' },\n  { value: 'other-safety', title: 'Other (explain in comment)' },\n];\n\nconst styles = (theme) => ({\n  base: {\n    backgroundColor: '#272D30',\n  },\n  isExpanded: {\n    minHeight: 'initial',\n    margin: '0px 0',\n    backgroundColor: '#1D2225',\n  },\n  bubble: {\n    background: 'linear-gradient(to bottom, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.55) 100%)',\n    border: '1px solid rgba(255, 255, 255, 0.2)',\n    borderRadius: 60,\n    height: 28,\n    width: 28,\n  },\n  heading: {\n    fontWeight: 500,\n    paddingLeft: '5%',\n  },\n  date: {\n    color: theme.palette.grey[100],\n    fontWeight: 500,\n  },\n  pillBody: {\n    textAlign: 'center',\n  },\n  pillText: {\n    color: '#65737a',\n    border: '1px solid #65737a57',\n    borderRadius: 15,\n    display: 'inline-block',\n    fontWeight: 500,\n    margin: '0 auto',\n    padding: '6px 10px',\n  },\n  summaryContent: {\n    padding: '0px',\n    '&>:last-child': {\n      padding: '0px'\n    }\n  },\n  formField: {\n    alignItems: 'center',\n    display: 'flex',\n    marginBottom: 12,\n    width: '100%',\n  },\n  formLabel: {\n    paddingRight: '24px'\n  },\n  formLabelText: {\n    fontWeight: 500,\n    textAlign: 'right',\n  },\n  select: {\n    margin: 0,\n    width: '100%',\n  },\n  placeholder: {\n    color: theme.palette.placeholder\n  },\n  panelActions: {\n    justifyContent: 'flex-start',\n    paddingBottom: 36,\n    paddingLeft: '27%',\n    paddingRight: 24,\n    paddingTop: 0,\n  },\n  resolveButton: {\n    background: 'linear-gradient(to bottom, rgb(82, 94, 102) 0%, rgb(64, 75, 79) 100%)',\n    borderRadius: 30,\n    color: '#fff',\n    padding: '12px 24px',\n    textTransform: 'none',\n  },\n  cancelButton: {\n    background: 'transparent',\n    border: '1px solid #272D30',\n    borderRadius: 30,\n    padding: '12px 24px',\n    textTransform: 'none',\n  },\n  reasonDetailed: {\n    paddingLeft: '30px',\n    color: theme.palette.lightGrey[200],\n  }\n});\n\nclass AnnotationEntry extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleComment = this.handleComment.bind(this);\n    this.validate = this.validate.bind(this);\n\n    if (this.props.event.annotation) {\n      this.state = {\n        ...this.props.event.annotation.data,\n        saving: false,\n        id: this.props.event.id\n      };\n    } else {\n      this.state = {\n        saving: false\n      };\n    }\n  }\n\n  componentWillReceiveProps(props) {\n    if (props.event.annotation) {\n      this.setState({\n        ...props.event.annotation.data,\n        saving: false,\n        id: props.event.id\n      });\n    } else {\n      this.setState({\n        saving: false\n      });\n    }\n  }\n\n  handleChange(e) {\n    this.setState({\n      reason: e.target.value\n    });\n  }\n\n  handleComment(e) {\n    this.setState({\n      comment: e.target.value\n    });\n  }\n\n  async validate() {\n    const { event, segment } = this.props;\n    if (this.state.saving) {\n      return false;\n    }\n    if (!this.state.reason || this.state.reason === '') {\n      this.setState({\n        error: 'You must select a reason',\n        errorElem: 'reason'\n      });\n      return;\n    }\n\n    if (this.state.reason === 'other' && !this.state.comment.length) {\n      this.setState({\n        error: 'You must describe your reason',\n        errorElem: 'comment'\n      });\n      return;\n    }\n\n    // no error\n    this.setState({\n      error: false,\n      errorElem: false,\n      saving: true\n    });\n\n    let data = null;\n\n    try {\n      if (!this.state.id) {\n        data = await Annotations.createAnnotation({\n          canonical_segment_name: event.canonical_segment_name,\n          offset_nanos_part: event.offset_nanos,\n          offset_millis: event.offset_millis,\n          start_time_utc_millis: event.timestamp,\n          end_time_utc_millis: event.timestamp,\n          type: event.type,\n          data: {\n            reason: this.state.reason,\n            comment: this.state.comment\n          }\n        });\n        Timelineworker.resolveAnnotation(data, event, segment.route);\n      } else {\n        data = await Annotations.updateAnnotation(this.state.id, {\n          reason: this.state.reason,\n          comment: this.state.comment\n        });\n      }\n\n      Timelineworker.selectLoop(null, null);\n    } catch (e) {\n      Raven.captureException(e);\n      // no error\n      const error = e;\n      const { message } = error;\n      if (!error.isJoi) {\n        this.setState({\n          error: message,\n          errorElem: 'reason',\n          saving: false\n        });\n      } else {\n        this.setState({\n          error: message,\n          errorElem: 'reason',\n          saving: false\n        });\n      }\n      return;\n    }\n\n    this.setState({\n      id: data.id,\n      error: false,\n      errorElem: false,\n      saving: false\n    });\n  }\n\n  render() {\n    const {\n      event, eventId, segment, classes, style\n    } = this.props;\n    const dateString = fecha.format(new Date(event.timestamp), 'MMM D @ HH:mm:ss');\n    const reason = this.state.reason || '';\n    const comment = this.state.comment || '';\n    let selectClassName = this.props.classes.select;\n    if (!reason.length) {\n      selectClassName += ` ${this.props.classes.placeholder}`;\n    }\n\n    return (\n      <ExpansionPanel\n        style={style}\n        classes={{ expanded: classes.isExpanded }}\n        className={classNames(classes.base, 'AnnotationListEntry')}\n        key={eventId}\n        expanded={this.props.expanded}\n        onChange={this.props.onChange}\n        defaultExpanded={this.props.defaultExpanded}\n      >\n        <ExpansionPanelSummary\n          classes={{ content: classes.summaryContent }}\n        >\n          <Grid container alignItems=\"center\">\n            <Grid item xs={1}>\n              <div className={classes.bubble} />\n            </Grid>\n            <Grid item xs={5}>\n              <Typography className={classes.heading}>\n                { this.getTitle() }\n              </Typography>\n            </Grid>\n            <Grid item xs={3}>\n              <Typography className={classes.date}>\n                [\n                { dateString }\n]\n              </Typography>\n            </Grid>\n            <Grid item xs={3} className={classes.pillBody}>\n              <Typography className={classes.pillText}>\n                Disengaged\n              </Typography>\n            </Grid>\n          </Grid>\n        </ExpansionPanelSummary>\n        { !this.state.saving && <Divider style={{ marginBottom: 4 }} /> }\n        { this.state.saving && <LinearProgress /> }\n        <ExpansionPanelDetails>\n          <Grid container alignContent=\"center\" alignItems=\"center\">\n            { this.renderFormField('Reason', (\n              <Select\n                disabled={this.state.saving}\n                displayEmpty\n                error={this.state.errorElem === 'reason'}\n                value={reason}\n                onChange={this.handleChange}\n                className={selectClassName}\n                inputProps={{ name: 'reason', id: 'reason-simple' }}\n              >\n                { reason === ''\n                  && (\n                  <MenuItem disabled value=\"\">\n                    Choose one\n                  </MenuItem>\n                  )}\n                { this.isPlanned()\n                  && (\n                  <MenuItem value={event.annotation.data.reason}>\n                    { event.annotation.data.reason }\n                  </MenuItem>\n                  )}\n                { DISENGAGEMENT_REASONS.map((disengagementReason) => (\n                  <MenuItem\n                    key={disengagementReason.value}\n                    value={disengagementReason.value}\n                    className={!disengagementReason.header ? this.props.classes.reasonDetailed : ''}\n                  >\n                    { disengagementReason.title }\n                  </MenuItem>\n                ))}\n              </Select>\n            ))}\n            { this.renderFormField('Comment', (\n              <TextField\n                onChange={this.handleComment}\n                placeholder=\"Add a comment...\"\n                className={classes.select}\n                error={this.state.errorElem === 'Comment'}\n                disabled={this.state.saving}\n                value={comment}\n              />\n            ))}\n          </Grid>\n        </ExpansionPanelDetails>\n        <ExpansionPanelActions className={classes.panelActions}>\n          <Tooltip\n            id=\"tooltip-annot\"\n            title=\"Grey Panda required to annotate\"\n            disableFocusListener={segment.hpgps || this.isPlanned()}\n            disableHoverListener={segment.hpgps || this.isPlanned()}\n          >\n            <div>\n              <Button\n                onClick={this.validate}\n                size=\"large\"\n                disabled={this.state.saving || this.isPlanned() || !segment.hpgps}\n                className={classes.resolveButton}\n              >\n                Resolve Annotation\n              </Button>\n            </div>\n          </Tooltip>\n          <Button\n            size=\"large\"\n            disabled={this.state.saving}\n            onClick={this.props.onChange}\n            className={classes.cancelButton}\n          >\n            Cancel\n          </Button>\n        </ExpansionPanelActions>\n      </ExpansionPanel>\n    );\n  }\n\n  renderFormField(label, form) {\n    const { classes } = this.props;\n    return (\n      <div className={classes.formField}>\n        { this.state.errorElem === label.toLowerCase() && (\n        <Grid item xs={12}>\n          <FormHelperText error>\n            { this.state.error }\n          </FormHelperText>\n        </Grid>\n        )}\n        <Grid item xs={3} className={classes.formLabel}>\n          <Typography className={classes.formLabelText}>\n            { label }\n:\n          </Typography>\n        </Grid>\n        <Grid item xs={9} style={{ paddingRight: 40 }}>\n          { form }\n        </Grid>\n      </div>\n    );\n  }\n\n  getTitle() {\n    if (this.isPlanned()) {\n      return 'Planned Disengagement';\n    } if (this.props.event.type === 'disengage_steer') {\n      return 'Steering Override';\n    } if (this.props.event.type === 'disengage') {\n      return 'Disengagement';\n    }\n  }\n\n  isPlanned() {\n    const { event } = this.props;\n    return (event.data && event.annotation && event.data.is_planned);\n  }\n}\n\nexport default withStyles(styles)(AnnotationEntry);\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\n\nimport ShopButton from './shopButton';\n\nconst styles = (theme) => ({\n  root: {\n    height: '96px',\n    padding: '12px 0',\n  },\n  rowFill: {\n    height: '100%',\n    textAlign: 'center'\n  },\n  image: {\n    display: 'inline-block',\n    height: '72px',\n    width: 'auto'\n  }\n});\n\nclass GreyPandaUpsellRow extends Component {\n  render() {\n    return (\n      <Grid container className={this.props.classes.root}>\n        <Grid item xs={6} className={this.props.classes.rowFill}>\n          <img src=\"/images/grey-panda-tsp.png\" className={this.props.classes.image} />\n        </Grid>\n        <Grid item xs={6} className={this.props.classes.rowFill}>\n          <Typography>\n            Upgrade to a Grey Panda and help improve openpilot\n          </Typography>\n          <ShopButton link=\"https://comma.ai/shop/products/panda-obd-ii-dongle/?ref=explorer\" />\n        </Grid>\n      </Grid>\n    );\n  }\n}\n\nexport default withStyles(styles)(GreyPandaUpsellRow);\n","import React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\nimport { withStyles } from '@material-ui/core/styles';\nimport { AutoSizer, List } from 'react-virtualized';\nimport memoize from 'memoize-one';\n\nimport AnnotationListItem from './AnnotationListItem';\nimport GreyPandaUpsellRow from './greyPandaUpsell';\nimport Timelineworker from '../../timeline';\nimport { selectRange } from '../../actions';\nimport { filterEvent } from '../../utils';\n\nconst LOOP_DURATION = 10000;\n\nconst styles = (theme) => ({\n  base: {\n    border: '1px solid rgba(255,255,255,0.04)',\n    borderRadius: 5,\n    overflow: 'hidden'\n  }\n});\n\nclass AnnotationList extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      expanded: false\n    };\n  }\n\n  // TODO: Migrate deprecated lifecycle method\n  componentWillReceiveProps(nextProps) {\n    if (this.state.expanded) {\n      if (nextProps.loop.startTime === null || nextProps.resolved !== this.props.resolved) {\n        this.setState({ expanded: false }, () => {\n          this.recomputeList();\n        });\n      }\n    }\n  }\n\n  list = null\n\n  filter = memoize((resolved, unresolved, list) => list.filter(this.filterEntry));\n\n  recomputeList = () => {\n    if (this.list) {\n      this.list.recomputeRowHeights();\n      this.list.forceUpdateGrid();\n    }\n  }\n\n  handleExpanded = (eventId, timestamp) => {\n    const { zoom } = this.props;\n    const isExpanded = this.state.expanded !== eventId && eventId;\n    this.setState({\n      expanded: isExpanded ? eventId : null\n    });\n\n    this.recomputeList();\n\n    if (isExpanded) {\n      const loopStartTime = timestamp - LOOP_DURATION / 2;\n      const loopEndTime = loopStartTime + LOOP_DURATION;\n      if (zoom && (loopStartTime < zoom.start || loopEndTime > zoom.end)) {\n        this.props.dispatch(selectRange(loopStartTime, loopEndTime));\n      } else {\n        // 5 seconds before, 5 seconds after...\n        Timelineworker.selectLoop(loopStartTime, LOOP_DURATION);\n      }\n    } else if (zoom && zoom.expanded) {\n      Timelineworker.selectLoop(zoom.start, zoom.end - zoom.start);\n    }\n  }\n\n  getEvent(index) {\n    const { segment } = this.props;\n    const events = (segment || {}).events || [];\n    const filteredList = this.filter(this.props.resolved, this.props.unresolved, events);\n\n    return filteredList[index];\n  }\n\n  getRowHeight = ({ index }) => {\n    const event = this.getEvent(index);\n\n    const eventId = `${event.time}:${index}`;\n\n    const expanded = this.state.expanded === eventId;\n\n    return !expanded ? 64 : 314; // TODO: is 314 safe?\n  }\n\n  render() {\n    const {\n      segment, classes, isUpsellDemo, resolved, unresolved\n    } = this.props;\n    const events = (segment || {}).events || [];\n\n    return (\n      <div className={classes.base} style={{ height: '100%' }}>\n        {!(segment.hpgps || isUpsellDemo || resolved) && <GreyPandaUpsellRow />}\n        <AutoSizer>\n          {({ height, width }) => (\n            <List\n              ref={(ref) => this.list = ref}\n              height={height}\n              width={width}\n              overscanRowCount={10}\n              // noRowsRenderer={this.noRowsRenderer}\n              rowCount={this.filter(resolved, unresolved, events).length}\n              rowHeight={this.getRowHeight}\n              rowRenderer={this.renderEntry}\n            />\n          )}\n        </AutoSizer>\n      </div>\n    );\n  }\n\n  filterEntry = (event) => {\n    if (this.props.resolved && !event.id) {\n      return false;\n    }\n    if (this.props.unresolved && event.id) {\n      return false;\n    }\n    return filterEvent(event);\n  }\n\n  renderEntry = ({ index, key, style }) => {\n    const { segment } = this.props;\n    const event = this.getEvent(index);\n    const eventId = `${event.time}:${index}`;\n    return (\n      <AnnotationListItem\n        key={eventId}\n        style={style}\n        segment={segment}\n        eventId={eventId}\n        event={event}\n        expanded={this.state.expanded === eventId}\n        disabled={!segment.hpgps}\n        onChange={partial(this.handleExpanded, eventId, event.timestamp)}\n      />\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  start: 'workerState.start',\n  loop: 'workerState.loop',\n  zoom: 'zoom'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(AnnotationList));\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\nimport { classNames } from 'react-extras';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport Badge from '@material-ui/core/Badge';\n\nimport AnnotationList from './AnnotationList';\nimport { filterEvent } from '../../utils';\n\nconst styles = (theme) => ({\n  root: {\n  },\n  upsellDemo: {\n    cursor: 'default',\n    pointerEvents: 'none',\n    opacity: 0.8\n  },\n  annotationsViewer: {\n    display: 'flex',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    overflow: 'hidden',\n    flexDirection: 'column',\n  },\n  annotationsViewerTabs: {\n    marginBottom: 12,\n    width: '100%',\n  },\n  tabLabelBadge: {\n    backgroundColor: theme.palette.grey[100],\n    borderRadius: 24,\n    marginRight: 24,\n    minWidth: 28,\n    top: -4,\n  },\n  tabLabelText: {\n    fontWeight: 500,\n    paddingLeft: 24,\n    textTransform: 'none',\n  },\n  annotationsViewerTabIndicator: {\n    backgroundColor: theme.palette.grey[100],\n    borderRadius: 8,\n    height: 6,\n  },\n  annotationsViewerList: {\n    height: '100%',\n    overflowY: 'scroll',\n  },\n});\n\nclass AnnotationTabs extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n\n    this.state = {\n      selectedTab: 0\n    };\n  }\n\n  handleChange(event, selectedTab) {\n    this.setState({ selectedTab });\n  }\n\n  count(resolved) {\n    return this.props.segment.events.filter((event) => {\n      if (!filterEvent(event)) {\n        return false;\n      }\n      if (resolved && event.id) {\n        return true;\n      }\n      if (!resolved && !event.id) {\n        return true;\n      }\n    }).length;\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <div style={{ position: 'relative', height: '100%' }}>\n        <div className={classes.annotationsViewer}>\n          <Tabs\n            value={this.state.selectedTab}\n            onChange={this.handleChange}\n            classes={{\n              indicator: classes.annotationsViewerTabIndicator\n            }}\n            className={classNames(classes.annotationsViewerTabs, {\n              [classes.upsellDemo]: this.props.isUpsellDemo\n            })}\n          >\n            <Tab label={(\n              <Typography className={classes.tabLabelText}>\n                <Badge classes={{ badge: classes.tabLabelBadge }} badgeContent={this.count(false)}>\n                  &nbsp;\n                </Badge>\n                Annotations Unresolved\n              </Typography>\n            )}\n            />\n            <Tab label={(\n              <Typography className={classes.tabLabelText}>\n                <Badge classes={{ badge: classes.tabLabelBadge }} badgeContent={this.count(true)}>\n                  &nbsp;\n                </Badge>\n                Resolved\n              </Typography>\n            )}\n            />\n          </Tabs>\n          <div className={`${classes.annotationsViewerList} x-scrollbar`}>\n            { this.renderTab(this.state.selectedTab) }\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderTab(index) {\n    switch (index) {\n      case 0:\n        return (\n          <AnnotationList\n            segment={this.props.segment}\n            unresolved\n            isUpsellDemo={this.props.isUpsellDemo}\n          />\n        );\n      case 1:\n        return (<AnnotationList segment={this.props.segment} resolved />);\n    }\n  }\n}\n\nexport default withStyles(styles)(AnnotationTabs);\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport raf from 'raf';\nimport Measure from 'react-measure';\nimport { withStyles } from '@material-ui/core/styles';\n\nimport { LngLatBounds } from 'mapbox-gl';\nimport ReactMapGL, { LinearInterpolator } from 'react-map-gl';\nimport { easeCubic } from 'd3-ease';\n\nimport { derived as DerivedDataApi } from '@commaai/comma-api';\nimport TimelineWorker from '../../timeline';\nimport { MAPBOX_TOKEN } from '../../api/geocode';\n\nconst MAP_STYLE = 'mapbox://styles/commaai/cjj4yzqk201c52ss60ebmow0w';\n\nconst styles = {\n  mapContainer: {\n    width: '100%',\n    cursor: 'default !important'\n  }\n};\n\nclass DriveMap extends Component {\n  constructor(props) {\n    super(props);\n\n    this.initMap = this.initMap.bind(this);\n    this.populateMap = this.populateMap.bind(this);\n    this.posAtOffset = this.posAtOffset.bind(this);\n    this.setPath = this.setPath.bind(this);\n    this.updateMarkerPos = this.updateMarkerPos.bind(this);\n\n    const nextRoute = props.currentSegment && props.currentSegment.route;\n\n    this.isLoadingCoords = false;\n    this.state = {\n      viewport: {\n        width: 640,\n        height: 480,\n        latitude: 37.7577,\n        longitude: -122.4376,\n        zoom: 15\n      },\n      route: nextRoute,\n      coords: [],\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const nextRoute = nextProps.currentSegment && nextProps.currentSegment.route;\n    if (nextRoute !== this.state.route) {\n      if (this.state.coords.length > 0) {\n        this.setPath([]);\n      }\n    }\n\n    const coordsNeedRefresh = nextRoute !== this.state.route || this.state.coords.length === 0;\n    const shouldRefreshMap = coordsNeedRefresh && this.map != null && !this.isLoadingCoords;\n    if (shouldRefreshMap) {\n      this.setState({ route: nextRoute }, this.populateMap.bind(this, nextProps));\n    }\n\n    if (nextProps.startTime !== this.props.startTime) {\n      this.shouldFlyTo = true;\n    }\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.updateMarkerPos();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  getMarkerSource() {\n    return this.map && this.map.getMap().getSource('seekPoint');\n  }\n\n  updateMarkerPos() {\n    if (!this.mounted) {\n      return;\n    }\n\n    const markerSource = this.getMarkerSource();\n    if (markerSource) {\n      if (this.props.currentSegment && this.state.coords.length > 0) {\n        const { routeOffset } = this.props.currentSegment;\n        const offset = TimelineWorker.currentOffset();\n\n        const pos = this.posAtOffset(offset - routeOffset);\n        if (pos) {\n          markerSource.setData({\n            type: 'Point',\n            coordinates: pos\n          });\n          this.moveViewportTo(pos);\n        }\n      } else if (markerSource._data && markerSource._data.coordinates.length > 0) {\n        markerSource.setData({\n          type: 'Point',\n          coordinates: []\n        });\n      }\n    }\n\n    raf(this.updateMarkerPos);\n  }\n\n  moveViewportTo(pos) {\n    const viewport = {\n      ...this.state.viewport,\n      longitude: pos[0],\n      latitude: pos[1]\n    };\n    if (this.shouldFlyTo) {\n      viewport.transitionDuration = 200;\n      viewport.transitionInterpolator = new LinearInterpolator();\n      this.shouldFlyTo = false;\n    }\n\n    this.setState({ viewport });\n  }\n\n  populateMap = async (props) => {\n    if (!props) props = this.props;\n\n    if (!this.map || !props.currentSegment || !this.state.route) {\n      return;\n    }\n    this.isLoadingCoords = true;\n\n    const { route } = this.state;\n    const routeSigUrl = props.currentSegment.url;\n\n    try {\n      const coords = await DerivedDataApi(routeSigUrl).getCoords();\n\n      if (this.state.route !== route) {\n        // handle race, if route changes while coords request was in flight\n        return;\n      }\n\n      const coordsArr = coords.map((coord) => [coord.lng, coord.lat]);\n      this.setPath(coordsArr);\n    } finally {\n      this.isLoadingCoords = false;\n    }\n  }\n\n  setPath(coords) {\n    const map = this.map && this.map.getMap();\n    this.setState({ coords });\n\n    if (map) {\n      map.getSource('route').setData({\n        type: 'Feature',\n        properties: {},\n        geometry: {\n          type: 'LineString',\n          coordinates: coords,\n        }\n      });\n    }\n  }\n\n  posAtOffset(offset) {\n    const offsetSeconds = Math.floor(offset / 1e3);\n    const offsetFractionalPart = (offset % 1e3) / 1000.0;\n    const coordIdx = Math.min(\n      offsetSeconds,\n      this.state.coords.length - 1\n    );\n    const nextCoordIdx = Math.min(\n      offsetSeconds + 1,\n      this.state.coords.length - 1\n    );\n    if (!this.state.coords[coordIdx]) {\n      return null;\n    }\n\n    const [floorLng, floorLat] = this.state.coords[coordIdx];\n    const [ceilLng, ceilLat] = this.state.coords[nextCoordIdx];\n\n    return [\n      floorLng + ((ceilLng - floorLng) * offsetFractionalPart),\n      floorLat + ((ceilLat - floorLat) * offsetFractionalPart)\n    ];\n  }\n\n  initMap(mapComponent) {\n    if (!mapComponent) {\n      this.map = null;\n      return;\n    }\n\n    const map = mapComponent.getMap();\n\n    map.on('load', () => {\n      map.addSource('route', {\n        type: 'geojson',\n        data: {\n          type: 'Feature',\n          properties: {},\n          geometry: {\n            type: 'LineString',\n            coordinates: [],\n          }\n        }\n      });\n      map.addSource('seekPoint', {\n        type: 'geojson',\n        data: {\n          type: 'Point',\n          coordinates: []\n        }\n      });\n\n      const lineGeoJson = {\n        id: 'routeLine',\n        type: 'line',\n        source: 'route',\n        layout: {\n          'line-join': 'round',\n          'line-cap': 'round'\n        },\n        paint: {\n          'line-color': '#888',\n          'line-width': 8\n        }\n      };\n      map.addLayer(lineGeoJson);\n\n      const markerGeoJson = {\n        id: 'marker',\n        type: 'circle',\n        paint: {\n          'circle-radius': 10,\n          'circle-color': '#007cbf'\n        },\n        source: 'seekPoint'\n      };\n\n      map.addLayer(markerGeoJson);\n\n      this.map = mapComponent;\n\n      if (this.state.route && this.props.currentSegment) {\n        this.populateMap();\n      }\n    });\n  }\n\n  render() {\n    return (\n      <Measure\n        bounds\n        onResize={(contentRect) => {\n          this.setState({ viewport: { ...this.state.viewport, width: contentRect.bounds.width } });\n        }}\n      >\n        {({ measureRef }) => (\n          <div ref={measureRef} className={this.props.classes.mapContainer}>\n            <ReactMapGL\n              {...this.state.viewport}\n              mapStyle={MAP_STYLE}\n              onViewportChange={(viewport) => this.setState({ viewport })}\n              mapboxApiAccessToken={MAPBOX_TOKEN}\n              attributionControl={false}\n              ref={this.initMap}\n              dragPan={false}\n            />\n          </div>\n        )}\n      </Measure>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  offset: 'workerState.offset',\n  route: 'workerState.route',\n  segments: 'workerState.segments',\n  segmentNum: 'workerState.segment',\n  currentSegment: 'workerState.currentSegment',\n  startTime: 'workerState.startTime'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DriveMap));\n","// https://video-react.js.org/customize/customize-source/\nimport React, { Component } from 'react';\nimport Hls from '@commaai/hls.js';\n\nexport default class HLSSource extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.hls = new Hls({\n      enableWorker: false,\n      disablePtsDtsCorrectionInMp4Remux: false\n    });\n    this.hls.on(Hls.Events.MANIFEST_PARSED, () => {\n      this.props.video.play();\n    });\n    this.hls.on(Hls.Events.BUFFER_APPENDED, (eventName, data) => {\n      if (this.props.onBufferAppend) {\n        this.props.onBufferAppend();\n      }\n    });\n\n    this.hls.on(Hls.Events.ERROR, (event, data) => {\n      if (data.fatal) {\n        switch (data.type) {\n          case Hls.ErrorTypes.NETWORK_ERROR:\n          // try to recover network error\n            console.log('fatal network error encountered, try to recover');\n            this.hls.startLoad();\n            break;\n          case Hls.ErrorTypes.MEDIA_ERROR:\n            console.log('fatal media error encountered, try to recover');\n            this.hls.recoverMediaError();\n            break;\n          default:\n          // cannot recover\n            this.hls.destroy();\n            this.hls = null;\n            break;\n        }\n      }\n    });\n\n    this.state = {\n      src: ''\n    };\n    // this.hls.on(Hls.Events.STREAM_STATE_TRANSITION, (eventName, data) => {\n    // });\n  }\n\n  componentDidMount() {\n    this.setState({\n      src: this.props.src\n    });\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextProps.src !== nextState.src) {\n      // console.log('Loading media source!', nextProps.src);\n      if (this.state.src && this.state.src.length) {\n        // console.log('this.hls.detachMedia();');\n        this.hls.detachMedia();\n      }\n      this.setState({\n        src: nextProps.src\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { src } = this.state;\n    if (src !== prevState.src && src && src.length) {\n      // console.log('this.hls.loadSource(src);');\n      this.hls.loadSource(src);\n      // console.log('this.hls.attachMedia(this.props.video);');\n      this.hls.attachMedia(this.props.video);\n\n      if (this.props.onSourceLoaded) {\n        this.props.onSourceLoaded();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    // destroy hls video source\n    if (this.hls) {\n      // console.log('this.hls.destroy();');\n      this.hls.destroy();\n      this.hls = null;\n    }\n  }\n\n  render() {\n    return (\n      <source src={this.state.src} type={this.props.type || 'application/x-mpegURL'} />\n    );\n  }\n}\n","export function strokeRoundedRect(ctx, left, top, width, height, radius, strokeWidth, strokeStyle) {\n  roundedRectPath(ctx, left, top, width, height, radius);\n\n  ctx.lineWidth = strokeWidth;\n  ctx.strokeStyle = strokeStyle;\n  ctx.stroke();\n  ctx.closePath();\n}\n\nexport function fillRoundedRect(ctx, left, top, width, height, radius, fillStyle) {\n  roundedRectPath(ctx, left, top, width, height, radius);\n  ctx.fillStyle = fillStyle;\n  ctx.fill();\n  ctx.closePath();\n}\n\nfunction roundedRectPath(ctx, left, top, width, height, radius) {\n  const right = left + width;\n  const bottom = top + height;\n  const K = 4 * (Math.SQRT2 - 1) / 3;\n\n  ctx.beginPath();\n  ctx.moveTo(left + radius, top);\n  ctx.lineTo(right - radius, top);\n  ctx.bezierCurveTo(right + radius * (K - 1), top, right, top + radius * (1 - K), right, top + radius);\n  ctx.lineTo(right, bottom - radius);\n  ctx.bezierCurveTo(right, bottom + radius * (K - 1), right + radius * (K - 1), bottom, right - radius, bottom);\n  ctx.lineTo(left + radius, bottom);\n  ctx.bezierCurveTo(left + radius * (1 - K), bottom, left, bottom + radius * (K - 1), left, bottom - radius);\n  ctx.lineTo(left, top + radius);\n  ctx.bezierCurveTo(left, top + radius * (1 - K), left + radius * (1 - K), top, left + radius, top);\n}\n","import React from 'react';\nimport Button from '@material-ui/core/Button';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Typography from '@material-ui/core/Typography';\n\nexport default function Buffering(props) {\n  const parts = [];\n  if (props.bufferingVideo) {\n    parts.push('video');\n  }\n  if (props.bufferingData) {\n    parts.push('data');\n  }\n  const message = `Buffering ${parts.join(' and ')}`;\n  return (\n    <div\n      style={{\n        zIndex: 50,\n        position: 'absolute',\n        height: '100%',\n        width: '100%',\n        backgroundColor: '#16181Aaa',\n      }}\n    >\n      <div style={{\n        position: 'relative',\n        textAlign: 'center',\n        top: 'calc(50% - 25px)'\n      }}\n      >\n        <CircularProgress\n          color=\"secondary\"\n          thickness={6}\n          size={50}\n        />\n      </div>\n      <div style={{\n        position: 'relative',\n        textAlign: 'center',\n        top: '50%',\n      }}\n      >\n        <Typography>\n          { message }\n        </Typography>\n      </div>\n    </div>\n  );\n}\n","/* eslint-disable camelcase */\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { withStyles } from '@material-ui/core/styles';\nimport raf from 'raf';\nimport { classNames } from 'react-extras';\nimport { multiply } from 'mathjs';\nimport debounce from 'debounce';\nimport PropTypes from 'prop-types';\n\nimport { Player, ControlBar } from 'video-react';\nimport 'video-react/dist/video-react.css'; // CSS for video\nimport { video as VideoApi } from '@commaai/comma-api';\n\nimport theme from '../../theme';\nimport HLSSource from './hlsSource';\nimport TimelineWorker from '../../timeline';\nimport * as LogIndex from '../../timeline/logIndex';\nimport { strokeRoundedRect, fillRoundedRect } from './canvas';\nimport Buffering from './buffering';\n\n// UI Assets\nconst wheelImg = new Image();\nwheelImg.src = require('../../icons/icon-chffr-wheel.svg');\n\n// these constants are named this way so that the names are the same in python and js\n// do not refactor them to have js style or more descriptive names\n// UI Measurements\nconst vwp_w = 1164;\nconst vwp_h = 874;\nconst bdr_s = 30;\n// driver monitoring constants\nconst _PITCH_NATURAL_OFFSET = 0.12; // eslint-disable-line no-underscore-dangle\nconst _YAW_NATURAL_OFFSET = 0.08; // eslint-disable-line no-underscore-dangle\nconst _PITCH_POS_ALLOWANCE = 0.04; // eslint-disable-line no-underscore-dangle\nconst _PITCH_WEIGHT = 1.35; // eslint-disable-line no-underscore-dangle\nconst _METRIC_THRESHOLD = 0.4; // eslint-disable-line no-underscore-dangle\nconst W = 160;\nconst H = 320;\nconst RESIZED_FOCAL = 320.0;\nconst FULL_W = 426;\nconst DM_FACE_THRESHOLD = 0.4; // probs below this disappear\nconst DM_EYE_THRESHOLD = 0.4; // probs below which blink is masked\nconst DM_BLINK_THRESHOLD = 0.5; // probs above this count as blinking\n\n// cache break index files\nconst STREAM_VERSION = 2;\n\nconst styles = (theme) => ({\n  hidden: {\n    display: 'none'\n  },\n  videoContainer: {\n    position: 'relative',\n    width: 850,\n    height: 640\n  },\n  videoImage: {\n    height: 'auto',\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n    zIndex: 1\n  },\n  videoUiCanvas: {\n    height: '100%',\n    left: 0,\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  },\n  thumbnail: {\n    height: '100%',\n    left: 0,\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  }\n});\n\nfunction intrinsicMatrix() {\n  return [\n    950.892854, 0, 584, 0,\n    0, 950.892854, 439, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 0,\n  ];\n}\n\nclass VideoPreview extends Component {\n  constructor(props) {\n    super(props);\n\n    this.updatePreview = this.updatePreview.bind(this);\n    this.onSourceLoaded = this.onSourceLoaded.bind(this);\n    this.onDisableBuffering = this.onDisableBuffering.bind(this);\n    // this.checkVideoBuffer = this.checkVideoBuffer.bind(this);\n\n    this.imageRef = React.createRef();\n    this.videoPlayer = React.createRef();\n    this.canvas_road = React.createRef();\n    this.canvas_lead = React.createRef();\n    this.canvas_carstate = React.createRef();\n    this.canvas_maxspeed = React.createRef();\n    this.canvas_speed = React.createRef();\n    this.canvas_face = React.createRef();\n\n    this.intrinsic = intrinsicMatrix();\n    this.frame = 0;\n\n    this.state = {\n      bufferTime: 4,\n      src: '',\n    };\n  }\n\n  componentDidMount() {\n    const { playSpeed } = this.props;\n    this.mounted = true;\n    if (this.videoPlayer.current) {\n      this.videoPlayer.current.playbackRate = playSpeed || 1;\n    }\n    this.rafLoop = raf(this.updatePreview);\n    this.checkVideoBuffer();\n    this.stopListening = TimelineWorker.onIndexed(() => this.checkDataBuffer());\n  }\n\n  componentDidUpdate(prevProps) {\n    // play state\n    this.checkVideoBuffer();\n    this.updateVideoSource(prevProps);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    if (this.rafLoop) {\n      raf.cancel(this.rafLoop);\n      this.rafLoop = null;\n    }\n    if (this.stopListening) {\n      this.stopListening();\n      this.stopListening = null;\n    }\n    if (this.stopListeningToVideo) {\n      this.stopListeningToVideo();\n      this.stopListeningToVideo = null;\n    }\n  }\n\n  updateVideoSource(prevProps) {\n    const { props } = this;\n    let segment = props.currentSegment;\n    if (!segment && props.nextSegment) {\n      const offset = TimelineWorker.currentOffset();\n      if (props.nextSegment.startOffset - offset < 5000) {\n        segment = props.nextSegment;\n      }\n    }\n    if (!segment) {\n      if (this.state.src !== '') {\n        this.setState({ src: '' });\n      }\n      return;\n    }\n\n    if (props.front) {\n      let base = `${process.env.REACT_APP_VIDEO_CDN}/hls/${props.dongleId}/${segment.url.split('/').pop()}`;\n      base += '/dcamera';\n      // We append count of segments with stream available as a cache-busting method\n      // on stream indexes served before route is fully uploaded\n      let segCount = segment.driverCameraStreamSegCount;\n      let src = `${base}/index.m3u8?v=${STREAM_VERSION}&s=${segCount}`;\n      if (this.state.src !== src) {\n        this.setState({ src });\n      }\n    } else if (this.state.src === '' || !prevProps.currentSegment || prevProps.currentSegment.route !== segment.route) {\n      let videoApi = VideoApi(segment.url, process.env.REACT_APP_VIDEO_CDN);\n      videoApi.getQcameraStreamIndex().then(() => {\n        let src = videoApi.getQcameraStreamIndexUrl() + `?s=${segment.cameraStreamSegCount}`\n        if (src !== this.state.src) {\n          this.setState({src});\n        }\n      }).catch(() => {\n        let src = videoApi.getRearCameraStreamIndexUrl() + `?s=${segment.cameraStreamSegCount}`;\n        if (src !== this.state.src) {\n          this.setState({src});\n        }\n      });\n    }\n  }\n\n  onSourceLoaded() {\n    if (this.videoPlayer.current) {\n      console.log('Calling load with media change');\n      this.videoPlayer.current.load();\n    }\n  }\n\n  onDisableBuffering() {\n    TimelineWorker.disableBuffer();\n  }\n\n  updatePreview() {\n    // schedule next run right away so that we can return early\n    this.rafLoop = raf(this.updatePreview);\n\n    this.frame++;\n    if (this.frame >= 60) {\n      this.frame = 0;\n      this.checkVideoBuffer();\n    }\n\n    // 10 fps\n    if (this.frame % 6 === 0) {\n      this.checkDataBuffer();\n    }\n    if (this.frame % 6 === 3) {\n      this.renderCanvas();\n    }\n  }\n\n  checkDataBuffer = debounce(() => {\n    let isDataBuffering = true;\n    if (this.props.currentSegment) {\n      const monoTime = TimelineWorker.currentLogMonoTime();\n      const monoTimeLength = (`${monoTime}`).length;\n      const logIndex = TimelineWorker.getLogIndex();\n      if (logIndex) {\n        const curIndex = LogIndex.findMonoTime(logIndex, monoTime);\n        const lastEvent = TimelineWorker.getEvent(curIndex, logIndex);\n        let nextEvent = TimelineWorker.getEvent(curIndex + 1, logIndex);\n\n        if (!nextEvent) {\n          nextEvent = TimelineWorker.getEvent(0, TimelineWorker.getNextLogIndex());\n        }\n\n        if (nextEvent && nextEvent.LogMonoTime) {\n          const nextEventTime = Number(nextEvent.LogMonoTime.substr(0, monoTimeLength));\n          const timeDiff = Math.abs(nextEventTime - monoTime);\n\n          isDataBuffering = timeDiff > 1000;\n        }\n        if (isDataBuffering && lastEvent && lastEvent.LogMonoTime) {\n          const monSec = lastEvent.LogMonoTime.substr(0, monoTimeLength);\n          const timeDiff = Math.abs(monoTime - Number(monSec));\n          // 3 seconds of grace\n          isDataBuffering = timeDiff > 3000;\n        }\n      }\n    } else {\n      isDataBuffering = false;\n\n      if (this.props.bufferVideo) {\n        console.log('Exited segment while buffering, exiting buffer state');\n        TimelineWorker.bufferVideo(false);\n      }\n    }\n\n    if (isDataBuffering !== this.props.bufferingData) {\n      console.log('Changing data buffer state to', isDataBuffering);\n      TimelineWorker.bufferData(isDataBuffering);\n    }\n  }, 100)\n\n  checkVideoBuffer = debounce(() => {\n    const videoPlayer = this.videoPlayer.current;\n    const { front } = this.props;\n\n    if (videoPlayer && !videoPlayer.wasConnected) {\n      videoPlayer.wasConnected = true;\n      if (this.stopListeningToVideo) {\n        this.stopListeningToVideo();\n        this.stopListeningToVideo = null;\n      }\n      this.stopListeningToVideo = videoPlayer.subscribeToStateChange(this.checkVideoBuffer);\n    }\n\n    const offset = TimelineWorker.currentOffset();\n    let shouldShowPreview = true;\n    const { bufferTime } = this.state;\n    const { playSpeed } = this.props;\n    let { desiredPlaySpeed } = this.props;\n\n    if (videoPlayer) {\n      const playerState = videoPlayer.getState().player;\n      if (!playerState.buffered || Number.isNaN(playerState.duration)) {\n        return;\n      }\n      let desiredVideoTime = this.currentVideoTime(offset);\n      const curVideoTime = playerState.currentTime;\n      if (desiredPlaySpeed && this.props.currentSegment) {\n        const timeDiff = desiredVideoTime - curVideoTime;\n\n        let desiredBufferedVideoTime = desiredVideoTime;\n        if (this.props.bufferingVideo) {\n          // if we're currently already paused buffering for video\n          // then wait for another few seconds of video t oload\n          desiredBufferedVideoTime += 3 * desiredPlaySpeed;\n        }\n        // clip the duration down slightly to handle rounding errors near the end of video\n        desiredVideoTime = Math.min(playerState.duration - 0.4, desiredVideoTime);\n        desiredBufferedVideoTime = Math.min(playerState.duration - 0.4, desiredBufferedVideoTime);\n\n        let isBuffering = true;\n        let remainingTime = desiredBufferedVideoTime;\n\n        for (let i = 0, buf = playerState.buffered, len = buf.length; i < len; ++i) {\n          let start = buf.start(i);\n          // if we seek to a spot **right** at the start of an already loaded segment then\n          // HLS doesn't actually load that segment. it just expects to jump forwards a bit and be fine\n          // because of this, the first 4 seconds of a given video is almost never available\n          // additionally, sometimes even in the middle of the video it can be off and not load due to rounding errors\n          // we check if we're in the first 5 seconds or if we're *right* before the start\n          // \"stuck seeking\" errors are handled below\n          if (start < 6 && desiredVideoTime < 6) {\n            start = desiredVideoTime;\n            desiredBufferedVideoTime = desiredVideoTime;\n          }\n          if (start > desiredVideoTime && start - desiredVideoTime < 0.5) {\n            start = desiredVideoTime;\n          }\n          if (start <= desiredVideoTime) {\n            if (buf.end(i) >= desiredBufferedVideoTime) {\n              isBuffering = false;\n            } else {\n              remainingTime = Math.min(remainingTime, desiredBufferedVideoTime - buf.end(i));\n            }\n          }\n        }\n\n        if (isBuffering) {\n          // console.log('We need', remainingTime, 'more time buffered...');\n        }\n\n        if (desiredVideoTime > 5 && (playerState.waiting || playerState.seeking)) {\n          isBuffering = true;\n        }\n\n        const timeDiffAbs = Math.abs(timeDiff);\n        if (Number.isFinite(timeDiff) && timeDiffAbs > 0) {\n          if (this.props.isBuffering && playerState.paused && !playerState.seeking && timeDiffAbs > 1.0) {\n            // console.log('SEEK paused', timeDiff);\n            videoPlayer.seek(desiredVideoTime);\n            isBuffering = true;\n          } else if (timeDiffAbs > 1.0) {\n            // console.log('Seeking video', timeDiff, desiredVideoTime, curVideoTime);\n            videoPlayer.seek(desiredVideoTime);\n            if (desiredVideoTime > 5) {\n              isBuffering = true;\n            }\n          } else if (timeDiffAbs > 0.2) {\n            desiredPlaySpeed += timeDiff;\n          // } else {\n          }\n        }\n\n        if (isBuffering && !front) {\n          isBuffering = this.updatePreviewImage(playerState.seeking ? null : timeDiff);\n        } else if (this.state.shouldShowThumbnail) {\n          this.setState({\n            shouldShowThumbnail: false\n          });\n        }\n\n        if (this.props.bufferingVideo !== isBuffering) {\n          // console.log('Changing video buffer state to', isBuffering);\n          TimelineWorker.bufferVideo(isBuffering);\n        }\n\n        shouldShowPreview = isBuffering;\n\n        desiredPlaySpeed = Math.round(desiredPlaySpeed * 5) / 5;\n\n        if (videoPlayer.playbackRate !== desiredPlaySpeed) {\n          videoPlayer.playbackRate = desiredPlaySpeed;\n        }\n\n        if (!isBuffering && !this.props.bufferingData && this.props.currentSegment && playerState.paused) {\n          console.log('Play');\n          videoPlayer.play();\n        }\n        if (!isBuffering && this.props.isBuffering && !playerState.paused) {\n          console.log('Pause for buffering...');\n          videoPlayer.pause();\n        }\n      } else {\n        // desired player speed is 0 or there's no segment\n        // either way, no video to load\n        if (this.props.bufferingVideo) {\n          TimelineWorker.bufferVideo(false);\n        }\n        if (this.props.currentSegment) {\n          if (front || this.updatePreviewImage()) {\n            // no image\n            if (Math.abs(curVideoTime - desiredVideoTime) > 1) {\n              videoPlayer.seek(desiredVideoTime);\n            }\n          }\n        }\n        shouldShowPreview = !this.props.currentSegment || !playerState.buffered.length;\n        if (!playerState.paused && !playerState.seeking && playerState.buffered.length) {\n          console.log('Pause');\n          videoPlayer.pause();\n        }\n      }\n    }\n    if (this.imageRef.current) {\n      if (shouldShowPreview && this.imageRef.current.src !== this.nearestImageFrame(offset)) {\n        this.imageRef.current.src = this.nearestImageFrame(offset);\n      }\n      this.imageRef.current.style.opacity = shouldShowPreview ? 1 : 0;\n    }\n  }, 100)\n\n  updatePreviewImage(timeDiff) {\n    const { shouldShowThumbnail } = this.state;\n    const thumbnail = TimelineWorker.currentThumbnail();\n    const monoTime = TimelineWorker.currentLogMonoTime();\n    const monoTimeLength = (`${monoTime}`).length;\n    let retVal = true;\n    if (thumbnail) {\n      const { thumbnailMonoTime } = this.state;\n      const thumbnailTime = Number(thumbnail.LogMonoTime.substr(0, monoTimeLength));\n      const thumbnailTimeDiff = thumbnailTime;\n\n      if (Number.isFinite(timeDiff) && timeDiff > 0 && timeDiff < thumbnailTimeDiff) {\n        retVal = false;\n        // the video is closer than we are\n      } else if (thumbnailMonoTime !== thumbnail.LogMonoTime || !shouldShowThumbnail) {\n        const base64 = btoa(String.fromCharCode(...new Uint8Array(thumbnail.Thumbnail.Thumbnail)));\n        this.setState({\n          thumbnailData: base64,\n          thumbnailMonoTime: thumbnail.LogMonoTime,\n          shouldShowThumbnail: true\n        });\n      }\n      retVal = false;\n    } else if (shouldShowThumbnail) {\n      this.setState({\n        shouldShowThumbnail: false\n      });\n    }\n\n    return retVal;\n  }\n\n  renderCanvas() {\n    const calibration = TimelineWorker.getCalibration(this.props.route);\n    if (!calibration) {\n      this.lastCalibrationTime = false;\n      return;\n    }\n\n    if (this.props.front) {\n      if (this.canvas_face.current) {\n        const params = { calibration, shouldScale: true };\n        const events = {\n          driverMonitoring: TimelineWorker.currentDriverMonitoring\n        };\n        this.renderEventToCanvas(\n          this.canvas_face.current, params, events, this.renderDriverMonitoring\n        );\n      }\n    }\n\n    if (!this.props.shouldShowUI) {\n      return;\n    }\n\n    if (calibration) {\n      if (this.lastCalibrationTime !== calibration.LogMonoTime) {\n        this.extrinsic = [...calibration.LiveCalibration.ExtrinsicMatrix, 0, 0, 0, 1];\n      }\n      this.lastCalibrationTime = calibration.LogMonoTime;\n    }\n    if (this.canvas_road.current) {\n      const params = { calibration, shouldScale: true };\n      const events = {\n        model: TimelineWorker.currentModel,\n        mpc: TimelineWorker.currentMPC,\n        carState: TimelineWorker.currentCarState,\n      };\n      this.renderEventToCanvas(\n        this.canvas_road.current, params, events, this.drawLaneFull\n      );\n    }\n    if (this.canvas_lead.current) {\n      const params = { calibration, shouldScale: true };\n      const events = { live20: TimelineWorker.currentLive20 };\n      this.renderEventToCanvas(\n        this.canvas_lead.current, params, events, this.renderLeadCars\n      );\n    }\n    if (this.canvas_carstate.current) {\n      const params = { calibration, shouldScale: true };\n      const events = { carState: TimelineWorker.currentCarState };\n      this.renderEventToCanvas(\n        this.canvas_carstate.current, params, events, this.renderCarState\n      );\n    }\n    if (this.canvas_maxspeed.current) {\n      const params = { calibration, shouldScale: true };\n      const events = {\n        live100: TimelineWorker.currentLive100,\n        liveMapData: TimelineWorker.currentLiveMapData,\n        initData: TimelineWorker.currentInitData,\n      };\n      this.renderEventToCanvas(\n        this.canvas_maxspeed.current, params, events, this.renderMaxSpeed\n      );\n    }\n    if (this.canvas_speed.current) {\n      const params = { calibration, shouldScale: true };\n      const events = {\n        live100: TimelineWorker.currentLive100,\n        initData: TimelineWorker.currentInitData,\n      };\n      this.renderEventToCanvas(\n        this.canvas_speed.current, params, events, this.renderSpeed\n      );\n    }\n  }\n\n  renderEventToCanvas(canvas, params, events, renderEvent) {\n    const { width, height } = canvas.getBoundingClientRect();\n\n    if (!params.calibration) {\n      const ctx = canvas.getContext('2d');\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      ctx.clearRect(0, 0, width, height);\n      return; // loading calibration from logs still...\n    }\n\n    let logTime; let\n      monoIndex;\n    const _events = {};\n    let needsRender = false;\n    const eventsSig = Object.keys(events).join(',');\n    Object.keys(events).map((key) => {\n      const event = events[key].apply(TimelineWorker);\n      monoIndex = `${events[key].name}MonoTime${eventsSig}`;\n\n      if (!event) {\n        if (this[monoIndex]) {\n          this[monoIndex] = false;\n          const ctx = canvas.getContext('2d');\n          ctx.setTransform(1, 0, 0, 1, 0, 0);\n          ctx.clearRect(0, 0, width, height);\n          // we have to force re-render when one is missing\n          // this is because there's more than one event being rendered through this flow\n          // this should be re-broken apart such that this isn't an issue\n          // fixing that will also reduce the rendering complexity\n          needsRender = true;\n        }\n      } else {\n        logTime = event ? event.LogMonoTime : null;\n        needsRender = needsRender || logTime !== this[monoIndex];\n        this[monoIndex] = logTime;\n        _events[key] = event;\n      }\n    });\n\n    if (!needsRender) {\n      return;\n    }\n    // will render!\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    // reset transform before anything, just in case\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    // clear all the data\n    ctx.clearRect(0, 0, width, height);\n    // scale original coords onto our current size\n    if (params.shouldScale) {\n      ctx.scale(width / vwp_w, height / vwp_h);\n    }\n\n    renderEvent.apply(this, [{ width, height, ctx }, _events]);\n  }\n\n  renderLeadCars(options, events) {\n    if (!events.live20) {\n      return;\n    }\n    this.lastLive20MonoTime = events.live20.LogMonoTime;\n    const { width, height, ctx } = options;\n\n    const leadOne = events.live20.Live20.LeadOne;\n    const leadTwo = events.live20.Live20.LeadTwo;\n\n    if (leadOne.Status) {\n      this.renderLeadCar(options, leadOne);\n    }\n    if (leadTwo.Status) {\n      this.renderLeadCar(options, leadTwo, true);\n    }\n  }\n\n  renderLeadCar(options, leadData, is2ndCar) {\n    const { width, height, ctx } = options;\n\n    const drel = leadData.DRel;\n    const vrel = leadData.VRel;\n    const yrel = leadData.YRel;\n\n    var x = drel + 2.7;\n    var y = yrel;\n\n    var [x, y, z] = this.carSpaceToImageSpace([drel + 2.7, yrel, 0, 1]);\n\n    if (x < 0 || y < 0) {\n      return;\n    }\n\n    let sz = 25 * 30;\n    sz /= ((drel + 2.7) / 3 + 30);\n    sz = Math.min(Math.max(sz, 15), 30);\n    if (is2ndCar) {\n      sz /= 1.2;\n    }\n\n    let fillAlpha = 0;\n    const speedBuff = 10;\n    const leadBuff = 40;\n\n    if (drel < leadBuff) {\n      fillAlpha = 255 * (1 - (drel / leadBuff));\n      if (vrel < 0) {\n        fillAlpha += 255 * (-1 * (vrel / speedBuff));\n      }\n      fillAlpha = Math.min(fillAlpha, 255) / 255;\n    }\n\n    // glow\n    if (is2ndCar) {\n      ctx.fillStyle = 'rgba(218, 202, 37, 0.5)';\n    } else {\n      ctx.fillStyle = 'rgb(218, 202, 37)';\n    }\n    ctx.lineWidth = 5;\n    const g_xo = sz / 5;\n    const g_yo = sz / 10;\n    ctx.beginPath();\n    ctx.moveTo(x + (sz * 1.35) + g_xo, y + sz + g_yo);\n    ctx.lineTo(x, y - g_xo);\n    ctx.lineTo(x - (sz * 1.35) - g_xo, y + sz + g_yo);\n    ctx.lineTo(x + (sz * 1.35) + g_xo, y + sz + g_yo);\n    ctx.fill();\n\n    if (fillAlpha > 0) {\n      if (is2ndCar) {\n        fillAlpha /= 1.5;\n      }\n      ctx.fillStyle = `rgba(201, 34, 49, ${fillAlpha})`;\n\n      ctx.beginPath();\n      ctx.moveTo(x + (sz * 1.25), y + sz);\n      ctx.lineTo(x, y);\n      ctx.lineTo(x - (sz * 1.25), y + sz);\n      ctx.lineTo(x + (sz * 1.25), y + sz);\n      ctx.fill();\n    }\n  }\n\n  drawLaneFull(options, events) { // ui_draw_vision_lanes\n    const { ctx } = options;\n    if (events) {\n      if (events.model) {\n        this.drawLaneBoundary(ctx, events.model.Model.LeftLane);\n        this.drawLaneBoundary(ctx, events.model.Model.RightLane);\n        this.drawLaneTrack(options, events.model.Model.Path);\n      }\n      if (events.mpc && events.carState) {\n        this.drawLaneTrack(options, events.mpc.LiveMpc, {\n          isMpc: true,\n          isEnabled: events.carState.CarState.CruiseState.Enabled,\n        });\n      }\n    }\n  }\n\n  drawLaneBoundary(ctx, lane) { // ui_draw_lane\n    let color = `rgba(255, 255, 255,${lane.Prob})`;\n\n    let points;\n    if (lane.Points.length > 0) {\n      points = lane.Points;\n    } else {\n      points = [];\n      for (let i = 0; i < 192; i++) {\n        points.push(lane.Poly[0] * (i * i * i) + lane.Poly[1] * (i * i) + lane.Poly[2] * i + lane.Poly[3]);\n      }\n    }\n    this.drawLaneLine(ctx, points, 0.035 * lane.Prob, color, false);\n    const offset = Math.min(lane.Std, 0.7);\n    color = `rgba(255, 255, 255,${lane.Prob})`;\n    this.drawLaneLine(ctx, points, -offset, color, true);\n    this.drawLaneLine(ctx, points, offset, color, true);\n  }\n\n  drawLaneLine(ctx, points, off, color, isGhost) { // ui_draw_lane_line\n    ctx.beginPath();\n    let started = false;\n    const line_height = 49;\n    for (let i = 0; i < line_height; i++) {\n      const px = i;\n      const py = points[i] - off;\n      const [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (y < 0) {\n        continue;\n      }\n      if (!started) {\n        ctx.moveTo(x, y);\n        started = true;\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    for (let i = line_height; i > 0; i--) {\n      const px = i == line_height ? line_height : i;\n      const py = isGhost ? (points[i] - off) : (points[i] + off);\n      const [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (y < 0) {\n        continue;\n      }\n      ctx.lineTo(x, y);\n    }\n    ctx.closePath();\n    if (!isGhost) {\n      ctx.fillStyle = color;\n      ctx.fill();\n    } else {\n      ctx.strokeStyle = color;\n      ctx.lineWidth = 0.1;\n      ctx.stroke();\n    }\n  }\n\n  drawLaneTrack(options, path, params) {\n    const { ctx } = options;\n    let isMpc; let\n      isEnabled;\n    if (params) {\n      isMpc = params.isMpc;\n      isEnabled = params.isEnabled;\n    }\n    ctx.beginPath();\n    let started = false;\n    const offset = isMpc ? 0.3 : 0.5;\n    const path_height = isMpc ? 20 : 49;\n    let points;\n    if (path.Points.length > 0) {\n      points = path.Points;\n    } else {\n      points = [];\n      for (let i = 0; i < 192; i++) {\n        points.push(path.Poly[0] * (i * i * i) + path.Poly[1] * (i * i) + path.Poly[2] * i + path.Poly[3]);\n      }\n    }\n    for (let i = 0; i <= path_height; i++) {\n      let px; let\n        py;\n      if (isMpc) {\n        px = path.X[i];\n        py = path.Y[i] - offset;\n      } else {\n        px = i;\n        py = points[i] - offset;\n      }\n      let [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (i === 0) {\n        y = vwp_h;\n      } else if (y < 0) {\n        continue;\n      }\n\n      if (!started) {\n        ctx.moveTo(x, y);\n        started = true;\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    for (let i = path_height; i >= 0; i--) {\n      let px; let\n        py;\n      if (isMpc) {\n        px = path.X[i];\n        py = path.Y[i] + offset;\n      } else {\n        px = i;\n        py = points[i] + offset;\n      }\n      let [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (i === 0) {\n        y = vwp_h;\n      } else if (y < 0) {\n        continue;\n      }\n      ctx.lineTo(x, y);\n    }\n    ctx.closePath();\n    let track_bg;\n    if (isMpc) {\n      track_bg = ctx.createLinearGradient(vwp_w, vwp_h - 40, vwp_w, vwp_h * 0.4);\n      if (isEnabled) {\n        track_bg.addColorStop(0, 'rgba(23, 134, 68, 0.8)');\n        track_bg.addColorStop(1, 'rgba(14, 89, 45, 0.8)');\n      } else {\n        track_bg.addColorStop(0, 'rgba(23, 88, 134, 0.6)');\n        track_bg.addColorStop(1, 'rgba(15, 58, 89, 0.6)');\n      }\n    } else {\n      track_bg = ctx.createLinearGradient(vwp_w, vwp_h, vwp_w, vwp_h * 0.5);\n      track_bg.addColorStop(0, 'rgba(255, 255, 255, 0.8)');\n      track_bg.addColorStop(1, 'rgba(255, 255, 255, 0.0)');\n    }\n    ctx.fillStyle = track_bg;\n    ctx.fill();\n  }\n\n  renderCarState(options, events) {\n    if (events && events.carState) {\n      this.drawCarStateBorder(options, events.carState.CarState);\n      this.drawCarStateWheel(options, events.carState.CarState);\n    }\n  }\n\n  renderSpeed(options, events) {\n    if (events && events.live100 && events.initData) {\n      this.drawSpeed(options, events.live100.Live100, events.initData.InitData);\n    }\n  }\n\n  drawSpeed(options, Live100, InitData) {\n    const { ctx } = options;\n\n    let speed = Live100.VEgo;\n\n    const metricParam = InitData.Params.Entries.find((entry) => entry.Key === 'IsMetric');\n    const isMetric = metricParam.Value === '1';\n    if (isMetric) {\n      speed = Math.floor(speed * 3.6 + 0.5);\n    } else {\n      speed = Math.floor(speed * 2.2369363 + 0.5);\n    }\n\n    const x = vwp_w / 2;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.font = '700 128px Open Sans';\n    ctx.fillStyle = 'rgb(255,255,255)';\n    ctx.fillText(speed, x, 140);\n\n    ctx.font = '400 48px Open Sans';\n    ctx.fillStyle = 'rgba(255,255,255,200)';\n    if (isMetric) {\n      ctx.fillText('kph', x, 210);\n    } else {\n      ctx.fillText('mph', x, 210);\n    }\n  }\n\n  renderMaxSpeed(options, events) {\n    if (events && events.live100 && events.initData) {\n      const liveMapData = (events.liveMapData && events.liveMapData.LiveMapData) || undefined;\n      this.drawMaxSpeed(options, events.live100.Live100, liveMapData, events.initData.InitData);\n    }\n  }\n\n  drawMaxSpeed(options, Live100, LiveMapData, InitData) {\n    const { ctx } = options;\n\n    const maxSpeed = Live100.VCruise;\n    let maxSpeedCalc = maxSpeed * 0.6225 + 0.5;\n    const isSpeedLimitValid = LiveMapData !== undefined && LiveMapData.SpeedLimitValid;\n    const speedLimit = (LiveMapData && LiveMapData.SpeedLimit) || 0;\n    let speedLimitCalc = speedLimit * 2.2369363 + 0.5;\n\n    let speedLimitOffset = 0;\n    const speedLimitOffsetParam = InitData.Params.Entries.find((entry) => entry.Key === 'SpeedLimitOffset');\n    if (speedLimitOffsetParam) {\n      speedLimitOffset = parseFloat(speedLimitOffsetParam.Value);\n    }\n\n    const metricParam = InitData.Params.Entries.find((entry) => entry.Key === 'IsMetric');\n    if (metricParam.Value === '1') {\n      maxSpeedCalc = maxSpeed + 0.5;\n      speedLimitCalc = speedLimit * 3.6 + 0.5;\n      speedLimitOffset = speedLimitOffset * 3.6 + 0.5;\n    }\n\n    const isCruiseSet = !isNaN(Live100.VCruise) && Live100.VCruise != 0 && Live100.VCruise != 255;\n\n    const isSetOverLimit = (\n      isSpeedLimitValid\n      && Live100.Enabled\n      && isCruiseSet\n      && maxSpeedCalc > (speedLimitCalc + speedLimitOffset)\n    );\n    const hysteresisOffset = 0.5; // TODO adjust to 0.0 if last isEgoOverLimit==true\n    const isEgoOverLimit = isSpeedLimitValid && Live100.VEgo > (speedLimit + speedLimitOffset + hysteresisOffset);\n    let speedLimWidth = Math.floor(180 * (2 / 3));\n    const width = Math.floor(184 * (2 / 3)) + speedLimWidth;\n    let height = Math.floor(202 * (2 / 3));\n\n    let left = bdr_s * 2 + (width - speedLimWidth * 2);\n    let top = bdr_s * 2;\n\n    // background\n    let fillStyle;\n    if (isSetOverLimit) {\n      fillStyle = 'rgba(218, 111, 37, 0.705)';\n    } else {\n      fillStyle = 'rgba(0, 0, 0, 0.392)';\n    }\n    fillRoundedRect(ctx, left, top, width, height, 30, fillStyle);\n\n    // border\n    let strokeStyle;\n    if (isSetOverLimit) {\n      strokeStyle = 'rgba(218, 111, 37, 1.0)';\n    } else if (isSpeedLimitValid && !isEgoOverLimit) {\n      strokeStyle = 'rgba(255, 255, 255, 1.0)';\n    } else if (isSpeedLimitValid && isEgoOverLimit) {\n      strokeStyle = 'rgba(255, 255, 255, 0.078)';\n    } else {\n      strokeStyle = 'rgba(255, 255, 255, 0.392)';\n    }\n    strokeRoundedRect(ctx, left, top, width, height, 20, 10, strokeStyle);\n\n    const textTopY = top + (26 * 4 / 3);\n    const textBottomY = textTopY + (48 * (4 / 3));\n    // MAX text\n    ctx.font = `${26 * (4 / 3)}px Open Sans`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    if (isCruiseSet) {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.784)';\n    } else {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.392)';\n    }\n\n    ctx.fillText('MAX', left + speedLimWidth / 2 + width / 2, textTopY);\n\n    // max speed text\n    if (isCruiseSet) {\n      ctx.font = `700 ${48 * (4 / 3)}px Open Sans`;\n      ctx.fillStyle = 'rgba(255, 255, 255, 1.0)';\n      ctx.fillText(Math.floor(maxSpeedCalc), 2 + left + speedLimWidth / 2 + width / 2, textBottomY);\n    } else {\n      ctx.font = `600 ${42 * (4 / 3)}px Open Sans`;\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.392)';\n      ctx.fillText('N/A', left + speedLimWidth / 2 + width / 2, textBottomY);\n    }\n\n    if (Live100.DecelForTurn && Live100.Enabled) {\n      const turnSpeed = Live100.VCurvature * 2.2369363 + 0.5;\n      ctx.fillStyle = 'rgba(255, 255, 255, 1.0)';\n      ctx.font = `700 ${25 * (4 / 3)}px Open Sans`;\n      ctx.fillText('TURN', 200 * (2 / 3) + left + speedLimWidth / 2 + width / 2, textTopY);\n      ctx.font = `700 ${50 * (4 / 3)}px Open Sans`;\n      ctx.fillText(Math.floor(turnSpeed), 200 * (2 / 3) + left + speedLimWidth / 2 + width / 2, textBottomY);\n    }\n\n    // Speed Limit\n    if (!isSpeedLimitValid) {\n      speedLimWidth -= Math.floor(5 * (2 / 3));\n      height -= Math.floor(10 * (2 / 3)) + 4;\n      left += Math.floor(9 * (2 / 3)) - 1;\n      top += Math.floor(5 * (2 / 3)) + 2;\n    }\n\n    const speedLimBorderRadius = isSpeedLimitValid ? 30 : 15;\n    // background\n    let speedLimFillStyle;\n\n    if (isSpeedLimitValid && isEgoOverLimit) {\n      speedLimFillStyle = 'rgba(218, 111, 37, 0.706)';\n    } else if (isSpeedLimitValid) {\n      speedLimFillStyle = 'rgba(255, 255, 255, 1.0)';\n    } else {\n      speedLimFillStyle = 'rgba(255, 255, 255, 0.392)';\n    }\n    fillRoundedRect(ctx, left, top, speedLimWidth, height, speedLimBorderRadius, speedLimFillStyle);\n\n    // border\n    if (isSpeedLimitValid) {\n      let speedLimStrokeStyle;\n      if (isEgoOverLimit) {\n        speedLimStrokeStyle = 'rgba(218, 111, 37, 1.0)';\n      } else {\n        speedLimStrokeStyle = 'rgba(255, 255, 255, 1.0)';\n      }\n      strokeRoundedRect(ctx, left, top, speedLimWidth, height, 20, 10, speedLimStrokeStyle);\n    }\n\n    ctx.font = `600 ${50 * (2 / 3)}px Open Sans`;\n    if (isSpeedLimitValid && isEgoOverLimit) {\n      ctx.fillStyle = 'rgba(255,255,255,1.0)';\n    } else {\n      ctx.fillStyle = 'rgba(0,0,0,1.0)';\n    }\n    ctx.fillText('SPEED',\n      left + speedLimWidth / 2 + 2,\n      top + (2 / 3) * (isSpeedLimitValid ? 35 : 30));\n    ctx.fillText('LIMIT',\n      left + speedLimWidth / 2,\n      top + (2 / 3) * (isSpeedLimitValid ? 80 : 75));\n\n\n    if (isEgoOverLimit) {\n      ctx.fillStyle = 'rgba(255,255,255,1.0)';\n    } else {\n      ctx.fillStyle = 'rgba(0,0,0,1.0)';\n    }\n    if (isSpeedLimitValid) {\n      ctx.font = `700 ${48 * (4 / 3)}px Open Sans`;\n      ctx.fillText(Math.floor(speedLimitCalc),\n        left + speedLimWidth / 2,\n        textBottomY + 3);\n    } else {\n      ctx.font = `600 ${42 * (4 / 3)}px Open Sans`;\n      ctx.fillText('N/A',\n        left + speedLimWidth / 2,\n        textBottomY + 3);\n    }\n  }\n\n  drawCarStateWheel(options, CarState) {\n    const { ctx } = options;\n\n    const radius = 80;\n    const x = vwp_w - (radius + (bdr_s * 2));\n    const y = radius + (bdr_s * 2);\n\n    // Wheel Background\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n    if (CarState.CruiseState.Enabled) {\n      ctx.fillStyle = theme.palette.states.engagedGreen;\n    } else if (CarState.CruiseState.Available) {\n      ctx.fillStyle = theme.palette.states.drivingBlue;\n    } else {\n      ctx.fillStyle = theme.palette.states.drivingBlue;\n    }\n    ctx.closePath();\n    ctx.fill();\n\n    // Rotate Wheel\n    ctx.translate(x, y);\n    ctx.rotate(0 - CarState.SteeringAngle * Math.PI / 180);\n    ctx.save();\n    ctx.translate(-x, -y);\n\n    // Wheel Image\n    ctx.beginPath();\n    ctx.arc(x, y, radius - (bdr_s / 2), 0, 2 * Math.PI, false);\n    const wheelImgPattern = ctx.createPattern(wheelImg, 'repeat');\n    ctx.fillStyle = wheelImgPattern;\n    ctx.closePath();\n    ctx.translate(vwp_w - ((bdr_s * 2) + bdr_s / 2), (bdr_s * 2) + bdr_s / 2);\n    ctx.fill();\n  }\n\n  drawCarStateBorder(options, carState) {\n    const { ctx } = options;\n    ctx.lineWidth = bdr_s * 2;\n\n    if (carState.CruiseState.Enabled) {\n      ctx.strokeStyle = theme.palette.states.engagedGreen;\n    } else if (carState.CruiseState.Available) {\n      ctx.strokeStyle = theme.palette.states.drivingBlue;\n    } else {\n      ctx.strokeStyle = theme.palette.states.drivingBlue;\n    }\n    ctx.strokeRect(0, 0, vwp_w, vwp_h);\n  }\n\n  renderDriverMonitoring(options, events) {\n    if (!events.driverMonitoring) {\n      return;\n    }\n\n    const { ctx } = options;\n    const driverMonitoring = events.driverMonitoring.DriverMonitoring;\n\n    if (driverMonitoring.FaceProb < 0.8) {\n      return;\n    }\n\n    const xW = vwp_h / 2;\n    const xOffset = vwp_w - xW;\n    let noseSize = 20;\n    ctx.translate(xOffset, 0);\n\n    const isDistracted = this.isDistracted(driverMonitoring);\n\n    const opacity = (driverMonitoring.FaceProb - DM_FACE_THRESHOLD) / (1 - DM_FACE_THRESHOLD) * 255;\n    noseSize *= 1 / (driverMonitoring.FaceProb);\n    let [x, y] = driverMonitoring.FacePosition.map((v) => v + 0.5);\n    x = toX(x);\n    y = toY(y);\n\n    const flatMatrix = this.rot_matrix(...driverMonitoring.FaceOrientation)\n      .reduce((m, v) => m.concat([...v, 1]), [])\n      .concat([0, 0, 0, 1]);\n    flatMatrix[3] = x;\n    flatMatrix[7] = y;\n\n    const p1 = this.matmul(flatMatrix, [0, 0, 0, 1]);\n    const p2 = this.matmul(flatMatrix, [0, 0, 100, 1]);\n\n    let isBlinking = false;\n\n    if (\n      driverMonitoring.LeftBlinkProb + driverMonitoring.RightBlinkProb > 2 * DM_BLINK_THRESHOLD\n      && driverMonitoring.LeftEyeProb > DM_EYE_THRESHOLD\n      && driverMonitoring.RightEyeProb > DM_EYE_THRESHOLD\n    ) {\n      isBlinking = true;\n    }\n\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    if (isDistracted) {\n      ctx.strokeStyle = `rgba(255, 0, 0, ${opacity})`;\n    } else if (isBlinking) {\n      ctx.strokeStyle = `rgba(255, 255, 0, ${opacity})`;\n    } else {\n      ctx.strokeStyle = `rgba(0, 255, 0, ${opacity})`;\n    }\n    ctx.arc(x, y, noseSize, 0, 2 * Math.PI);\n    ctx.stroke();\n    ctx.closePath();\n\n    // print raw and converted values, useful for debugging but super not pretty\n    // ctx.fillStyle = 'rgb(255,255,255)';\n    // ctx.font = '800 14px Open Sans';\n    // ctx.fillText(driverMonitoring.FaceOrientation[2], x + noseSize * 2, y);\n    // ctx.fillText(driverMonitoring.FaceOrientation[1], x, y + noseSize * 2);\n\n    // let pose = this.getDriverPose(driverMonitoring);\n\n    // ctx.fillText(pose.yaw, x + noseSize * 2, y + noseSize / 2);\n    // ctx.fillText(pose.pitch, x, y + noseSize * 2.5);\n\n    ctx.beginPath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = theme.palette.states.drivingBlue;\n    ctx.moveTo((p1[0]), (p1[1]));\n    ctx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;\n    ctx.lineTo((p2[0]), (p2[1]));\n    ctx.stroke();\n    ctx.closePath();\n\n    function toX(x) {\n      return (x * xW);\n    }\n    function toY(y) {\n      return (y * vwp_h);\n    }\n  }\n\n  isDistracted(driverMonitoring) {\n    const pose = this.getDriverPose(driverMonitoring);\n\n    let pitch_error = pose.pitch - _PITCH_NATURAL_OFFSET;\n    const yaw_error = pose.yaw - _YAW_NATURAL_OFFSET;\n    if (pitch_error > 0) {\n      pitch_error = Math.max(pitch_error - _PITCH_POS_ALLOWANCE, 0);\n    }\n\n    pitch_error *= _PITCH_WEIGHT;\n    const pose_metric = Math.sqrt(Math.pow(yaw_error, 2) + Math.pow(pitch_error, 2));\n    if (pose_metric > _METRIC_THRESHOLD) {\n      return true;\n    }\n    return false;\n  }\n\n  getDriverPose(driverMonitoring) {\n    // use driver monitoring units instead of canvas units\n    // that way code can be nearly identical\n    const angles_desc = driverMonitoring.FaceOrientation;\n    const pos_desc = driverMonitoring.FacePosition;\n\n    const pitch_net = angles_desc[0];\n    const yaw_net = angles_desc[1];\n    const roll_net = angles_desc[2];\n\n    const face_pixel_position = [(pos_desc[0] + 0.5) * W - W + FULL_W, (pos_desc[1] + 0.5) * H];\n    const yaw_focal_angle = Math.atan2(face_pixel_position[0] - FULL_W / 2, RESIZED_FOCAL);\n    const pitch_focal_angle = Math.atan2(face_pixel_position[1] - H / 2, RESIZED_FOCAL);\n\n    const roll = roll_net;\n    const pitch = pitch_net + pitch_focal_angle;\n    const yaw = -yaw_net + yaw_focal_angle;\n    return { roll, pitch, yaw };\n  }\n\n  carSpaceToImageSpace(coords) {\n    coords = this.matmul(this.extrinsic, coords);\n    coords = this.matmul(this.intrinsic, coords);\n\n    // project onto 3d with Z\n    coords[0] /= coords[2];\n    coords[1] /= coords[2];\n\n    return coords;\n  }\n\n  rot_matrix(roll, pitch, yaw) {\n    const cr = Math.cos(roll);\n    const sr = Math.sin(roll);\n    const cp = Math.cos(pitch);\n    const sp = Math.sin(pitch);\n    const cy = Math.cos(yaw);\n    const sy = Math.sin(yaw);\n\n    const rr = [\n      [1, 0, 0],\n      [0, cr, -sr],\n      [0, sr, cr]\n    ];\n    const rp = [\n      [cp, 0, sp],\n      [0, 1, 0],\n      [-sp, 0, cp]\n    ];\n    const ry = [\n      [cy, -sy, 0],\n      [sy, cy, 0],\n      [0, 0, 1]\n    ];\n    return multiply(ry, multiply(rp, rr));\n  }\n\n  matmul(matrix, coord) {\n    const b0 = coord[0]; const b1 = coord[1]; const b2 = coord[2]; const\n      b3 = coord[3];\n\n    coord[0] = b0 * matrix[0] + b1 * matrix[1] + b2 * matrix[2] + b3 * matrix[3];\n    coord[1] = b0 * matrix[4] + b1 * matrix[5] + b2 * matrix[6] + b3 * matrix[7];\n    coord[2] = b0 * matrix[8] + b1 * matrix[9] + b2 * matrix[10] + b3 * matrix[11];\n    coord[3] = b0 * matrix[12] + b1 * matrix[13] + b2 * matrix[14] + b3 * matrix[15];\n\n    return coord;\n  }\n\n  currentVideoTime(offset = TimelineWorker.currentOffset()) {\n    if (!this.props.currentSegment) {\n      return 0;\n    }\n    offset -= this.props.currentSegment.routeOffset;\n    offset = offset / 1000;\n\n    if (!this.props.front) {\n      let initData = TimelineWorker.currentInitData();\n      let firstFrameTime = TimelineWorker.firstFrameTime();\n\n      if (initData !== null && firstFrameTime !== null) {\n        offset -= (firstFrameTime - initData.LogMonoTime/1e9);\n      }\n    }\n\n    return offset;\n  }\n\n  // nearest cache-worthy frame of the video\n  // always show a frame before the current offset so that data is what happened\n  // after this frame was seen, that way you can't see things it hasn't reacted to\n  nearestImageFrame(offset = TimelineWorker.currentOffset()) {\n    const segment = this.props.currentSegment || this.props.nextSegment;\n    if (!segment) {\n      return '';\n    }\n    offset -= segment.routeOffset;\n    const seconds = Math.max(1, Math.floor(offset / 1000) * 1);\n\n    return `${segment.url}/sec${seconds}.jpg`;\n  }\n\n  render() {\n    const { classes } = this.props;\n    if (this.props.playSpeed !== this.props.desiredPlaySpeed && !this.props.isBuffering) {\n      console.log(this.props);\n      debugger;\n    }\n    return (\n      <div\n        className={classNames(classes.videoContainer, {\n          [classes.hidden]: false\n        })}\n      >\n        { this.props.isBuffering\n          && (\n          <Buffering\n            bufferingVideo={this.props.bufferingVideo}\n            bufferingData={this.props.bufferingData}\n            onDisableBuffering={this.onDisableBuffering}\n          />\n          )}\n        { this.state.shouldShowThumbnail\n          && (\n          <img\n            style={{ zIndex: 2 }}\n            className={this.props.classes.thumbnail}\n            src={`data:image/jpeg;base64,${this.state.thumbnailData}`}\n          />\n          )}\n        <Player\n          ref={this.videoPlayer}\n          style={{ zIndex: 1 }}\n          autoPlay={!!this.props.currentSegment}\n          muted\n          fluid={false}\n          src={this.state.src}\n          startTime={this.currentVideoTime()}\n          playbackRate={this.props.startTime > Date.now() ? 0 : this.props.playSpeed}\n          width={850}\n          height={640}\n        >\n          <HLSSource\n            onBufferAppend={this.checkVideoBuffer}\n            onSourceLoaded={this.onSourceLoaded}\n            isVideoChild\n          />\n          <ControlBar disabled disableCompletely />\n        </Player>\n        { this.props.shouldShowUI\n          && (\n            <>\n              <canvas\n                ref={this.canvas_road}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 3 }}\n              />\n              <canvas\n                ref={this.canvas_lead}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 4 }}\n              />\n              <canvas\n                ref={this.canvas_carstate}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 5 }}\n              />\n              <canvas\n                ref={this.canvas_maxspeed}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 6 }}\n              />\n              <canvas\n                ref={this.canvas_speed}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 7 }}\n              />\n            </>\n          )}\n        { this.props.front\n          && (\n            <>\n              <canvas\n                ref={this.canvas_face}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 3 }}\n              />\n            </>\n          )}\n      </div>\n    );\n  }\n}\n\nVideoPreview.propTypes = {\n  playSpeed: PropTypes.number.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return state.workerState;\n}\n\nexport default connect(mapStateToProps)(withStyles(styles)(VideoPreview));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport cx from 'classnames';\nimport Obstruction from 'obstruction';\nimport { classNames } from 'react-extras';\n\nimport {\n  withStyles,\n  Grid,\n  FormControl,\n  Select,\n  MenuItem,\n  Typography,\n} from '@material-ui/core';\n\nimport DriveMap from '../DriveMap';\nimport DriveVideo from '../DriveVideo';\n\nconst styles = (theme) => ({\n  mediaOptions: {\n    alignItems: 'center',\n    border: '1px solid rgba(255,255,255,.1)',\n    borderRadius: 50,\n    display: 'flex',\n    marginLeft: 'auto',\n    marginBottom: 12,\n  },\n  mediaOption: {\n    alignItems: 'center',\n    borderRight: '1px solid rgba(255,255,255,.1)',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    minHeight: 32,\n    minWidth: 44,\n    opacity: '0.6',\n    '&.disabled': {\n      cursor: 'default',\n    },\n    '&:last-child': {\n      borderRight: 'none',\n    },\n  },\n  mediaOptionDisabled: {\n    cursor: 'auto',\n  },\n  mediaOptionIcon: {\n    backgroundColor: '#fff',\n    borderRadius: 3,\n    height: 20,\n    margin: '2px 0',\n    width: 30,\n  },\n  mediaOptionText: {\n    fontSize: 12,\n    fontWeight: 500,\n    textAlign: 'center',\n    textTransform: 'uppercase',\n  },\n  mediaSource: {\n    width: '100%',\n  },\n  mediaSourceSelect: {\n    width: '100%',\n  },\n});\n\nconst MediaType = {\n  VIDEO: 'video',\n  DRIVER_VIDEO: 'dcamera',\n  HUD: 'hud',\n  MAP: 'map'\n};\n\nclass Media extends Component {\n  constructor(props) {\n    super(props);\n\n    this.renderMediaOptions = this.renderMediaOptions.bind(this);\n\n    this.state = {\n      inView: MediaType.HUD,\n    };\n  }\n\n  render() {\n    const { classes } = this.props;\n    const { inView } = this.state;\n    return (\n      <>\n        { this.renderMediaOptions() }\n        { inView === MediaType.MAP && <DriveMap /> }\n        { (inView !== MediaType.MAP)\n          && (\n          <DriveVideo\n            shouldShowUI={inView === MediaType.HUD}\n            front={inView === MediaType.DRIVER_VIDEO}\n            onVideoChange={(noVideo) => {\n              this.setState({ inView: noVideo ? MediaType.MAP : inView });\n            }}\n          />\n          )}\n      </>\n    );\n  }\n\n  renderMediaOptions() {\n    const { classes, currentSegment } = this.props;\n    const { inView } = this.state;\n    const mediaSource = 'eon-road-camera';\n    const hasDriverCameraStream = this.props.currentSegment && this.props.currentSegment.hasDriverCameraStream;\n    return (\n      <Grid container>\n        <Grid\n          item\n          xs={hasDriverCameraStream ? 5 : 7}\n        />\n        <Grid\n          item\n          xs={hasDriverCameraStream ? 7 : 5}\n          className={classes.mediaOptions}\n        >\n          <Grid\n            item\n            xs={hasDriverCameraStream ? 3 : 4}\n            className={classes.mediaOption}\n            style={inView === MediaType.HUD ? { opacity: 1 } : { }}\n            onClick={() => this.setState({ inView: MediaType.HUD })}\n          >\n            <Typography className={classes.mediaOptionText}>\n              HUD\n            </Typography>\n          </Grid>\n          <Grid\n            item\n            xs={hasDriverCameraStream ? 3 : 4}\n            className={classes.mediaOption}\n            style={inView === MediaType.VIDEO ? { opacity: 1 } : {}}\n            onClick={() => this.setState({ inView: MediaType.VIDEO })}\n          >\n            <Typography className={classes.mediaOptionText}>\n              Video\n            </Typography>\n          </Grid>\n          { hasDriverCameraStream\n            && (\n            <Grid\n              item\n              xs={3}\n              className={cx(classes.mediaOption, { disabled: !hasDriverCameraStream })}\n              style={inView === MediaType.DRIVER_VIDEO ? { opacity: 1 } : {}}\n              onClick={() => hasDriverCameraStream && this.setState({ inView: MediaType.DRIVER_VIDEO })}\n            >\n              <Typography className={classes.mediaOptionText}>\n                Driver Video\n              </Typography>\n            </Grid>\n            )}\n          <Grid\n            item\n            xs={hasDriverCameraStream ? 3 : 4}\n            className={classes.mediaOption}\n            style={inView === MediaType.MAP ? { opacity: 1 } : { }}\n            onClick={() => this.setState({ inView: MediaType.MAP })}\n          >\n            <Typography className={classes.mediaOptionText}>\n              Map\n            </Typography>\n          </Grid>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  currentSegment: 'workerState.currentSegment',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(Media));\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\nimport { classNames } from 'react-extras';\nimport PropTypes from 'prop-types';\nimport document from 'global/document';\nimport { timeout } from 'thyming';\nimport { partial } from 'ap';\nimport raf from 'raf';\nimport qs from 'querystringify';\nimport { withStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\nimport Snackbar from '@material-ui/core/Snackbar';\n\nimport { raw as RawApi } from '@commaai/comma-api';\nimport TimelineWorker from '../../timeline';\n\nconst styles = (theme) => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    paddingTop: theme.spacing.unit,\n    background: 'transparent',\n    textAlign: 'right'\n  },\n  footerButton: {\n    display: 'inline-block',\n    border: `1px solid ${theme.palette.grey[800]}`,\n    color: theme.palette.grey[50],\n    textDecoration: 'none',\n    borderRadius: 20,\n    padding: '10px 20px',\n    margin: '0px 10px',\n    cursor: 'pointer'\n  }\n});\n\nclass AnnotationsFooter extends Component {\n  constructor(props) {\n    super(props);\n\n    this.copySegmentName = this.copySegmentName.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.downloadSegmentFile = this.downloadSegmentFile.bind(this);\n    this.openInCabana = this.openInCabana.bind(this);\n    this.openWayInOsmEditor = this.openWayInOsmEditor.bind(this);\n    this.updateWayId = this.updateWayId.bind(this);\n\n    this.state = {\n      showCopiedSnack: false,\n      wayId: 0,\n    };\n  }\n\n  componentDidMount() {\n    raf(this.updateWayId);\n  }\n\n  updateWayId() {\n    raf(this.updateWayId);\n\n    const event = TimelineWorker.currentLiveMapData();\n    if (event && event.LiveMapData) {\n      const wayId = parseInt(event.LiveMapData.WayId);\n      if (wayId !== this.state.wayId) {\n        this.setState({ wayId });\n      }\n    } else if (this.state.wayId) {\n      this.setState({ wayId: 0 });\n    }\n  }\n\n  copySegmentName(e) {\n    const { segment } = this.props;\n    if (!segment) {\n      return;\n    }\n    const el = document.createElement('textarea');\n    el.value = `${segment.route}--${segment.segment}`;\n    el.setAttribute('readonly', '');\n    el.style.position = 'absolute';\n    el.style.left = '-9999px';\n    document.body.appendChild(el);\n    el.select();\n    document.execCommand('copy');\n    document.body.removeChild(el);\n\n    this.setState({\n      showCopiedSnack: true\n    });\n    this.snackTimer = timeout(this.handleClose, 1000);\n  }\n\n  async downloadSegmentFile(type) {\n    if (!this.props.segment) {\n      return;\n    }\n\n    const seg = this.props.segment;\n    const segmentKeyPath = `${seg.route.replace('|', '/')}/${seg.segment}`;\n\n    const files = (await RawApi.getRouteFiles(this.props.segment.route));\n    const url = files[type].find((url) => url.indexOf(segmentKeyPath) !== -1);\n\n    if (url) {\n      window.location.href = url;\n    }\n  }\n\n  handleClose() {\n    this.setState({\n      showCopiedSnack: false\n    });\n    this.snackTimer();\n  }\n\n  openInCabana() {\n    const { segment, loop, start } = this.props;\n    const currentOffset = TimelineWorker.currentOffset();\n    const params = {\n      route: segment.route,\n      url: segment.url,\n      seekTime: Math.floor((currentOffset - segment.routeOffset) / 1000)\n    };\n    const routeStartTime = (start + segment.routeOffset);\n\n    if (loop.startTime && loop.startTime > routeStartTime && loop.duration < 180000) {\n      const startTime = Math.floor((loop.startTime - routeStartTime) / 1000);\n      params.segments = [startTime, Math.floor(startTime + (loop.duration / 1000))].join(',');\n    }\n\n    const win = window.open(`https://my.comma.ai/cabana/${qs.stringify(params, true)}`, '_blank');\n    if (win.focus) {\n      win.focus();\n    }\n  }\n\n  openWayInOsmEditor() {\n    const { wayId } = this.state;\n    if (!wayId) {\n      return;\n    }\n\n    const win = window.open(`https://www.openstreetmap.org/way/${wayId}`, '_blank');\n    if (win.focus) {\n      win.focus();\n    }\n  }\n\n  render() {\n    return (\n      <Paper className={this.props.classes.root}>\n        { this.props.segment && this.props.segment.hasVideo\n          && (\n          <a className={this.props.classes.footerButton} onClick={partial(this.downloadSegmentFile, 'cameras')}>\n            Download Camera Segment\n          </a>\n          )}\n        { this.props.segment && this.props.segment.hasDriverCamera\n          && (\n          <a className={this.props.classes.footerButton} onClick={partial(this.downloadSegmentFile, 'dcameras')}>\n            Download Front Camera Segment\n          </a>\n          )}\n        { this.props.segment\n          && (\n          <a className={this.props.classes.footerButton} onClick={partial(this.downloadSegmentFile, 'logs')}>\n            Download Log Segment\n          </a>\n          )}\n        <a className={this.props.classes.footerButton} onClick={this.openWayInOsmEditor} href=\"#\">\n          Edit OpenStreetMap Here\n        </a>\n        <a className={classNames(this.props.classes.footerButton, 'openInCabana')} onClick={this.openInCabana} href=\"#\">\n          View CAN Data in Cabana\n        </a>\n        <a className={this.props.classes.footerButton} onClick={this.copySegmentName} target=\"_blank\">\n          Copy Current Segment\n        </a>\n        <Snackbar\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'center'\n          }}\n          open={this.state.showCopiedSnack}\n          onClose={this.handleClose}\n          ContentProps={{\n            'aria-describedby': 'message-id',\n          }}\n          variant=\"success\"\n          message={<span id=\"message-id\">Copied segment name!</span>}\n        />\n      </Paper>\n    );\n  }\n}\n\nAnnotationsFooter.propTypes = {\n  segment: PropTypes.object.isRequired,\n  loop: PropTypes.object.isRequired,\n  start: PropTypes.number.isRequired\n};\n\nexport default withStyles(styles)(AnnotationsFooter);\n","// in line with xx/chffr/lib/route.py\n\nexport const DeviceType = {\n  ios: 2,\n  one: 3,\n  android: 5,\n};\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\n\nimport {\n  withStyles,\n  Grid,\n  Slide,\n  Paper,\n  Typography,\n  IconButton,\n} from '@material-ui/core';\nimport CloseIcon from '@material-ui/icons/Close';\nimport KeyboardBackspaceIcon from '@material-ui/icons/KeyboardBackspace';\n\nimport AnnotationTabs from './AnnotationTabs';\nimport EonUpsell from './eonUpsell';\nimport Media from './Media';\nimport Timeline from '../Timeline';\nimport TimeDisplay from '../TimeDisplay';\nimport AnnotationsFooter from './footer';\n\nimport { selectRange } from '../../actions';\nimport { DeviceType } from '../../defs/segments';\n\nconst styles = (theme) => ({\n  base: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexGrow: 1,\n  },\n  window: {\n    background: 'linear-gradient(to bottom, #30373B 0%, #272D30 10%, #1D2225 100%)',\n    borderRadius: 8,\n    display: 'flex',\n    flexDirection: 'column',\n    flexGrow: 1,\n    overflowY: 'scroll',\n    margin: 18,\n  },\n  header: {},\n  headerContext: {\n    alignItems: 'center',\n    display: 'flex',\n    padding: 12,\n    paddingLeft: 18,\n    paddingRight: 24,\n  },\n  headerTitle: {\n    fontSize: 22,\n    fontWeight: 700,\n    paddingLeft: 12,\n  },\n  headerActions: {\n    marginLeft: 'auto',\n  },\n  headerTimeline: {},\n  viewer: {\n    padding: theme.spacing.unit * 4,\n  },\n  footer: {\n    alignItems: 'center',\n    background: 'linear-gradient(to bottom, #30373B 0%, #272D30 10%, #1D2225 100%)',\n    display: 'flex',\n    marginTop: 'auto',\n    width: '100%',\n  },\n});\n\nclass Annotations extends Component {\n  constructor(props) {\n    super(props);\n\n    this.close = this.close.bind(this);\n  }\n\n  close() {\n    this.props.dispatch(selectRange(null, null));\n  }\n\n  renderAnnotationsElement(visibleSegment) {\n    if (visibleSegment.deviceType === DeviceType.one) {\n      return (<AnnotationTabs segment={visibleSegment} />);\n    }\n    return (<EonUpsell hook=\"Unlock driving annotations with an EON\" />);\n  }\n\n  render() {\n    const {\n      classes,\n      device,\n      loop,\n      currentSegment,\n      nextSegment,\n      start\n    } = this.props;\n    const visibleSegment = (currentSegment || nextSegment);\n    const routeName = visibleSegment ? visibleSegment.route : 'Nothing visible';\n    const shortName = routeName.split('|')[1];\n    return (\n      <div className={classes.base}>\n        <div className={classes.window}>\n          <div className={classes.header}>\n            <div className={classes.headerContext}>\n              <IconButton aria-label=\"Go Back\" onClick={() => window.history.back()}>\n                <KeyboardBackspaceIcon />\n              </IconButton>\n              <Typography className={classes.headerTitle}>\n                { this.props.device.alias }\n              </Typography>\n              <div className={classes.headerActions}>\n                <IconButton onClick={this.close} aria-label=\"Close\">\n                  <CloseIcon />\n                </IconButton>\n              </div>\n            </div>\n            <Timeline\n              className={classes.headerTimeline}\n              zoomed\n              colored\n              hasThumbnails\n              hasRuler\n              hasGradient\n              tooltipped\n              dragSelection\n            />\n          </div>\n          <div className={classes.viewer}>\n            <Grid container spacing={32}>\n              <Grid item xs={6}>\n                { visibleSegment && this.renderAnnotationsElement(visibleSegment) }\n              </Grid>\n              <Grid item xs={6}>\n                <Media />\n              </Grid>\n            </Grid>\n          </div>\n        </div>\n        <div className={classes.footer}>\n          <AnnotationsFooter segment={visibleSegment} loop={loop} start={start} />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  currentSegment: 'workerState.currentSegment',\n  nextSegment: 'workerState.nextSegment',\n  device: 'workerState.device',\n  loop: 'workerState.loop',\n  start: 'workerState.start'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(Annotations));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport PropTypes from 'prop-types';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport 'mapbox-gl/src/css/mapbox-gl.css';\n\nimport AppHeader from './AppHeader';\nimport Dashboard from './Dashboard';\nimport Annotations from './Annotations';\n\nimport Timelineworker from '../timeline';\nimport { selectRange, selectDevice } from '../actions';\nimport { getDongleID, getZoom } from '../url';\n\nconst styles = (/* theme */) => ({\n  base: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  header: {\n    display: 'flex',\n    height: 64,\n    minHeight: 64,\n  },\n  window: {\n    display: 'flex',\n    flexGrow: 1,\n    minHeight: 0,\n  },\n});\n\nclass ExplorerApp extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      settingDongle: null\n    };\n  }\n\n  componentWillMount() {\n    this.checkProps(this.props);\n  }\n\n  componentWillReceiveProps(props) {\n    this.checkProps(props);\n\n    const isZoomed = props.expanded;\n    const { expanded } = this.props;\n    const wasZoomed = expanded;\n\n    if (isZoomed && !wasZoomed) {\n      Timelineworker.play();\n    }\n    if (!isZoomed && wasZoomed) {\n      Timelineworker.pause();\n    }\n  }\n\n  checkProps(props) {\n    const dongleId = getDongleID(props.pathname);\n    const zoom = getZoom(props.pathname);\n\n    const { settingDongle } = this.state;\n    const curDongle = settingDongle || props.dongleId;\n    const { dispatch } = this.props;\n\n    if (dongleId) {\n      if (curDongle !== dongleId) {\n        if (!settingDongle) {\n          Timelineworker.selectDevice(dongleId);\n          this.setState({\n            settingDongle: dongleId\n          });\n        }\n      } else {\n        this.setState({\n          settingDongle: null\n        });\n      }\n    }\n    dispatch(selectRange(zoom.start, zoom.end));\n  }\n\n  render() {\n    const { classes, expanded } = this.props;\n    return (\n      <div className={classes.base}>\n        <div className={classes.header}>\n          <AppHeader />\n        </div>\n        <div className={classes.window}>\n          { expanded ? (<Annotations />) : (<Dashboard />) }\n        </div>\n      </div>\n    );\n  }\n}\n\nExplorerApp.propTypes = {\n  expanded: PropTypes.bool.isRequired,\n  dispatch: PropTypes.func.isRequired,\n  classes: PropTypes.object.isRequired\n};\n\nconst stateToProps = Obstruction({\n  expanded: 'zoom.expanded',\n  pathname: 'router.location.pathname',\n  dongleId: 'workerState.dongleId'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(ExplorerApp));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport window from 'global/window';\nimport PropTypes from 'prop-types';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\n\nimport { config as AuthConfig } from '@commaai/my-comma-auth';\n\nimport { CommaIcon } from '../icons';\n\nconst styles = (/* theme */) => ({\n  base: {\n    height: '60px',\n    margin: '0 auto',\n    marginTop: '30vh',\n    maxWidth: '560px',\n  },\n  title: {\n    display: 'inline',\n    fontFamily: 'MaisonNeueExtended',\n    fontSize: '24px',\n    fontWeight: 600,\n    lineHeight: '60px',\n    verticalAlign: 'top',\n  },\n  tagline: {\n    padding: '20px 0 52px',\n    fontSize: '18px',\n  },\n  logInButton: {\n    alignItems: 'center',\n    background: '#175886',\n    display: 'flex',\n    borderRadius: '100px',\n    fontSize: '21px',\n    height: '80px',\n    justifyContent: 'center',\n    textDecoration: 'none',\n    width: '100%',\n  },\n  logInText: {\n    fontFamily: 'MaisonNeue',\n    fontSize: '18px',\n    fontWeight: 600,\n  },\n  demoLink: {\n    textDecoration: 'none',\n    justifyContent: 'center',\n    width: '100%',\n    height: '40px',\n    paddingTop: '10px',\n    display: 'flex',\n  },\n  demoLinkText: {\n    fontSize: '18px',\n  },\n});\n\nconst DEMO_LINK = `${window.location.origin}/?demo=1`;\n\nclass AnonymousLanding extends Component {\n  componentWillMount() {\n    if (typeof window.sessionStorage !== 'undefined') {\n      const { pathname } = this.props;\n      sessionStorage.redirectURL = pathname;\n    }\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <div className={classes.base}>\n        <Typography className={classes.title}>\n          <CommaIcon style={{ fontSize: '2em' }} />\n          explorer\n        </Typography>\n        <Typography className={classes.tagline}>\n          Review and annotate your comma.ai driving data.\n        </Typography>\n        <a href={AuthConfig.oauthRedirectLink} className={classes.logInButton}>\n          <Typography className={classes.logInText}>\n            Log in with Google\n          </Typography>\n        </a>\n        <a href={DEMO_LINK} className={classes.demoLink}>\n          <Typography className={classes.demoLinkText}>\n            or try the demo\n          </Typography>\n        </a>\n      </div>\n    );\n  }\n}\n\nAnonymousLanding.propTypes = {\n  pathname: PropTypes.string.isRequired,\n  classes: PropTypes.object.isRequired\n};\n\nconst stateToProps = Obstruction({\n  pathname: 'router.location.pathname'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(AnonymousLanding));\n","import extend from 'xtend';\nimport { WORKER_STATE_UPDATE } from '../actions/types';\n\nconst initialState = {\n};\n\nexport default function workerState(_state = initialState, action) {\n  let state = _state;\n  switch (action.type) {\n    case WORKER_STATE_UPDATE:\n      state = extend(state, action.data);\n      break;\n    default:\n      return state;\n  }\n\n  return state;\n}\n","import { TIMELINE_SELECTION_CHANGED } from '../actions/types';\n\nconst initialState = {\n  start: 0,\n  end: 0,\n  expanded: false\n};\n\nexport default function zoom(_state = initialState, action) {\n  let state = _state;\n  switch (action.type) {\n    case TIMELINE_SELECTION_CHANGED:\n      state = {\n        start: action.start,\n        end: action.end,\n        expanded: !!(action.start && action.end)\n      };\n      break;\n    default:\n      return state;\n  }\n\n  return state;\n}\n","import workerState from './workerState';\nimport zoom from './zoom';\n\nconst reducers = {\n  workerState,\n  zoom\n};\n\nexport default reducers;\n","import window from 'global/window';\nimport { compose } from 'redux';\nimport * as Actions from './actions';\n\nfunction getComposeEnhancers() {\n  if (process.env.NODE_ENV !== 'production' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) {\n    return window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\n      actionCreators: Object.values(Actions).filter((f) => f.name !== 'updateState')\n    });\n  }\n  return compose;\n}\n\nconst composeEnhancers = getComposeEnhancers();\n\nexport default composeEnhancers;\n","import * as Redux from 'redux';\nimport { connectRouter, routerMiddleware } from 'connected-react-router';\nimport thunk from 'redux-thunk';\nimport createHistory from 'history/createBrowserHistory';\nimport reducers from './reducers';\nimport compose from './devtools';\n\nexport const history = createHistory();\n\nexport function createStore() {\n  const store = Redux.createStore(\n    connectRouter(history)(\n      Redux.combineReducers(reducers)\n    ),\n    compose(Redux.applyMiddleware(thunk, routerMiddleware(history)))\n  );\n\n  return store;\n}\n","/* global gtag */\n\nconst GA_TRACKING_ID = 'UA-80079182-7';\n\nexport function initGoogleAnalytics(history) {\n  history.listen((location) => {\n    if (typeof gtag === 'function') {\n      gtag('config', GA_TRACKING_ID, {\n        page_title: document.title,\n        page_location: window.location.href,\n        page_path: location.pathname\n      });\n    }\n  });\n}\n","import React, { Component } from 'react';\nimport { Provider } from 'react-redux';\nimport { Route, Switch, Redirect } from 'react-router';\nimport { ConnectedRouter } from 'connected-react-router';\nimport { timeout } from 'thyming';\nimport document from 'global/document';\nimport qs from 'query-string';\nimport localforage from 'localforage';\nimport Jepsen from 'carly';\nimport Collector from 'collect-methods';\n\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\n\nimport MyCommaAuth, { config as AuthConfig, storage as AuthStorage } from '@commaai/my-comma-auth';\nimport { auth as AuthApi, request as Request } from '@commaai/comma-api';\n\nimport Explorer from './components/explorer';\nimport AnonymousLanding from './components/anonymous';\n\nimport TimelineWorker from './timeline';\nimport { history, createStore } from './store';\nimport { updateState } from './actions';\nimport { initGoogleAnalytics } from './analytics';\nimport * as Demo from './demo';\n\ninitGoogleAnalytics(history);\nconst store = createStore();\n\nTimelineWorker.onStateChange((data) => {\n  store.dispatch(updateState(data));\n});\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      initialized: false,\n      demo: false,\n    };\n\n    this.cancelInit = Collector();\n\n    const initDemoTimeline = Jepsen(() => {\n      TimelineWorker.init(true).then(initDemoState.callback);\n    });\n\n    const checkDemo = Jepsen((isDemo) => {\n      if (isDemo) {\n        return localforage.setItem('isDemo', '1')\n          .then(initDemoTimeline.callback);\n      }\n      return this.auth();\n    });\n\n    const initDemoState = Jepsen(() => {\n      TimelineWorker.selectTimeRange(1564443025000, Date.now());\n      this.setState({\n        initialized: true,\n        demo: true,\n      });\n    });\n\n    this.cancelInit(checkDemo.cancel);\n    this.cancelInit(initDemoTimeline.cancel);\n    this.cancelInit(initDemoState.cancel);\n\n    Demo.init().then(checkDemo.callback);\n  }\n\n  componentWillUnmount() {\n    this.cancelInit();\n    TimelineWorker.stop();\n  }\n\n  async auth() {\n    if (document.location) {\n      if (document.location.pathname == '/auth/g/redirect') {\n        const { code } = qs.parse(document.location.search);\n\n        try {\n          const token = await AuthApi.refreshAccessToken(code, AuthConfig.REDIRECT_URI);\n          if (token) {\n            AuthStorage.setCommaAccessToken(token);\n          }\n          // done authing!!\n        } catch (e) {\n          console.log(e);\n        }\n      }\n    }\n\n    const token = await MyCommaAuth.init();\n    Request.configure(token);\n\n    if (MyCommaAuth.isAuthenticated()) {\n      await TimelineWorker.init();\n    }\n\n    this.setState({ initialized: true });\n  }\n\n  redirectLink() {\n    let url = '/';\n    if (typeof window.sessionStorage !== 'undefined') {\n      url = sessionStorage.redirectURL || '/';\n    }\n    return url;\n  }\n\n  authRoutes() {\n    return (\n      <Switch>\n        <Route path=\"/auth/\" render={() => <Redirect to={this.redirectLink()} />} />\n        <Route path=\"/\" component={Explorer} />\n      </Switch>\n    );\n  }\n\n  ananymousRoutes() {\n    return (\n      <Switch>\n        <Route path=\"/auth/\" render={() => <Redirect to=\"/\" />} />\n        <Route path=\"/\" component={AnonymousLanding} />\n      </Switch>\n    );\n  }\n\n  renderLoading() {\n    return (\n      <Grid container alignItems=\"center\" style={{ width: '100%', height: '100%' }}>\n        <Grid item align=\"center\" xs={12}>\n          <CircularProgress size=\"10vh\" style={{ color: '#525E66' }} />\n        </Grid>\n      </Grid>\n    );\n  }\n\n  render() {\n    if (!this.state.initialized) {\n      return this.renderLoading();\n    }\n    return (\n      <Provider store={store}>\n        <ConnectedRouter history={history}>\n          { (MyCommaAuth.isAuthenticated() || this.state.demo) ? this.authRoutes() : this.ananymousRoutes() }\n        </ConnectedRouter>\n      </Provider>\n    );\n  }\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import Raven from 'raven-js';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport document from 'global/document';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { MuiThemeProvider } from '@material-ui/core/styles';\nimport MuiPickersUtilsProvider from 'material-ui-pickers/utils/MuiPickersUtilsProvider';\nimport DateFnsUtils from 'material-ui-pickers/utils/date-fns-utils';\n\nimport './index.css';\nimport 'react-virtualized/styles.css';\nimport App from './App';\nimport Theme from './theme';\nimport { unregister } from './registerServiceWorker';\n\nif (process.env.NODE_ENV === 'production') {\n  Raven.config(\n    'https://6a242abfa01b4660aa34f150e87de018@sentry.io/1234624',\n    { environment: process.env.NODE_ENV }\n  ).install();\n\n  unregister();\n}\n\nReactDOM.render((\n  <MuiThemeProvider theme={Theme}>\n    <CssBaseline />\n    <MuiPickersUtilsProvider utils={DateFnsUtils}>\n      <App />\n    </MuiPickersUtilsProvider>\n  </MuiThemeProvider>\n), document.getElementById('root'));\n","import * as capnp from 'capnp-ts';\nimport toJSON from '@commaai/capnp-json';\nimport BufferUtils from 'capnp-split/buffer';\nimport { Event, Event_Which as EventWhich } from '@commaai/log_reader/capnp/log.capnp';\n\n// IE\nif (!Number.MAX_SAFE_INTEGER) {\n  Number.MAX_SAFE_INTEGER = (2 ** 53) - 1;\n}\n\nfunction binSearch(index, start, end, milis, nanos) {\n  if (start >= end) {\n    return start;\n  }\n  const searchIndex = Math.floor((end - start) / 2) + start;\n  // searchIndex wont equal end, only start\n\n  if (milis < index[searchIndex][0]\n    || (milis === index[searchIndex][0] && nanos < index[searchIndex][1])) {\n    return binSearch(index, start, searchIndex, milis, nanos);\n  }\n  if (milis > index[searchIndex][0]\n    || (milis === index[searchIndex][0] && nanos > index[searchIndex][1])) {\n    if (searchIndex === index.length - 1\n      || milis < index[searchIndex + 1][0]\n      || (milis === index[searchIndex + 1][0] && nanos < index[searchIndex + 1][1])) {\n      return searchIndex;\n    }\n    return binSearch(index, searchIndex + 1, end, milis, nanos);\n  }\n  return searchIndex;\n}\n\nfunction indexBuffer(index, buffer, bufferIndex) {\n  let offset = 0;\n  const calibrations = [];\n  let lastIndex = index.length ? index.length - 1 : 0;\n  // debugger;\n\n  while (offset < buffer.byteLength) {\n    const messageBuff = BufferUtils.readMessage(buffer, offset);\n    const msg = new capnp.Message(messageBuff, false);\n    const event = msg.getRoot(Event);\n    const monoTime = event.getLogMonoTime().toString();\n    const milis = Number(monoTime.substr(0, monoTime.length - 6));\n    const nanos = Number(monoTime.substr(-6, 6));\n    const messageSize = messageBuff.byteLength;\n    const which = event.which();\n\n    if (which === EventWhich.LIVE_CALIBRATION) {\n      calibrations.push(toJSON(event));\n    }\n\n    if (!index.length\n      || (milis > index[index.length - 1][0]\n      || (milis === index[index.length - 1][0] && nanos > index[index.length - 1][1]))) {\n      index.push([\n        milis,\n        nanos,\n        offset,\n        messageSize,\n        bufferIndex,\n        which\n      ]);\n      lastIndex = index.length - 1;\n    } else {\n      let searchIndex = lastIndex;\n      let incAmount = 1;\n      // debugger;\n      while (searchIndex < index.length - 1\n        && (milis > index[searchIndex][0]\n        || (milis === index[searchIndex][0] && nanos > index[searchIndex][1]))) {\n        incAmount = Math.min(Math.floor(index.length - searchIndex / 2), incAmount * 2);\n        searchIndex = Math.min(searchIndex + incAmount, index.length - 1);\n      }\n      // debugger;\n      searchIndex = binSearch(index, searchIndex - incAmount, searchIndex, milis, nanos);\n      // debugger;\n      searchIndex += 1;\n      lastIndex = searchIndex;\n\n      index.splice(searchIndex, 0, [\n        milis,\n        nanos,\n        offset,\n        messageSize,\n        bufferIndex,\n        which\n      ]);\n    }\n    offset += messageSize;\n  }\n\n  return calibrations;\n}\n\nexport function createIndex(_buffer) {\n  const buffer = Buffer.from(_buffer);\n  const index = [];\n\n  const calibrations = indexBuffer(index, buffer, 0);\n\n  return {\n    index,\n    buffers: [buffer],\n    calibrations\n  };\n}\n\nexport function addToIndex(_index, _newBuff) {\n  const newBuff = Buffer.from(_newBuff);\n  const index = _index;\n  index.buffers.push(newBuff);\n  const calibrations = indexBuffer(index.index, newBuff, index.buffers.length - 1);\n  index.calibrations = index.calibrations.concat(calibrations);\n\n  return index;\n}\n\nexport function findMonoTime(index, monoTime, start = 0, end = index.index.length) {\n  if (start === index.index.length) {\n    return index.index.length - 1;\n  }\n  if (start >= end) {\n    return end;\n  }\n  // index is floored so always increase start\n  const curIndex = Math.floor((end - start) / 2 + start);\n  const curMillis = index.index[curIndex][0];\n  // we can have duplicates so we treat matches as being too high since we're\n  // looking for the first instance of a duplicate\n  if (monoTime < curMillis) {\n    return findMonoTime(index, monoTime, start, curIndex);\n  }\n  if (monoTime > curMillis) {\n    return findMonoTime(index, monoTime, curIndex + 1, end);\n  }\n\n  return curIndex;\n}\n","\nfunction getDefaultStartDate() {\n  const d = new Date();\n  d.setHours(d.getHours() + 1, 0, 0, 0);\n\n  return (new Date(d.getTime() - 1000 * 60 * 60 * 24 * 14)).getTime();\n}\n\nfunction getDefaultEndDate() {\n  const d = new Date();\n  d.setHours(d.getHours() + 1, 0, 0, 0);\n\n  // return (new Date(d.getTime() - 1000 * 60 * 60 * 36)).getTime();\n  return d.getTime();\n}\n\nmodule.exports = {\n  start: getDefaultStartDate(),\n  end: getDefaultEndDate(),\n\n  // dongleId: '99c94dc769b5d96e',\n  // dongleId: 'ff83f397542ab647',\n  // dongleId: 'f1b4c567731f4a1b',\n  dongleId: null,\n\n  route: false,\n  segment: 0,\n  nextSegment: null,\n  playSpeed: 0, // 0 = stopped, 1 = playing, 2 = 2x speed... multiplier on speed\n  desiredPlaySpeed: 0, // the speed the user has selected so that buffering can resume\n  shouldBuffer: true, // if we should bother waiting for buffered data or just roll on\n  bufferingVideo: false, // if we're currently buffering for more data\n  bufferingData: false, // if we're currently buffering for more data\n  offset: 0, // in miliseconds from the start\n  startTime: Date.now(), // millisecond timestamp in which play began\n\n  segments: [],\n  // this data should come from the API server instead\n  // segments: [{\n  //   route: '99c94dc769b5d96e|2018-04-09--10-10-00',\n  //   offset: 10000,\n  //   length: 2558000,\n  //   segments: 43\n  // }, {\n  //   route: '99c94dc769b5d96e|2018-04-09--11-29-08',\n  //   offset: 2658000,\n  //   length: 214000,\n  //   segments: 4\n  // }],\n\n  segmentData: null,\n\n  loop: {\n    // in time instead of offset\n    // this makes it so that the timespan can change without this changing\n    // thats helpful to shared links and other things probably...\n    startTime: null,\n    duration: null\n  },\n\n  profile: {},\n  devices: [],\n  isDemo: false,\n};\n","const Event = require('geval/event');\nconst LogReaderWorker = require('./logReader.worker');\n// const LogReaderSharedWorker = require('./logReader.sharedworker');\n\nconst DataEvent = Event();\n\nlet logReader = null;\n\nfunction handleMessage(msg) {\n  DataEvent.broadcast(msg);\n}\n\nfunction relayMessage(msg) {\n  const port = logReader.port || logReader;\n  port.postMessage(msg.data);\n}\n\nfunction getWorker() {\n  if (logReader) {\n    return logReader;\n  }\n  // if (typeof LogReaderSharedWorker === 'function' && typeof SharedWorker === 'function') {\n  // logReader = new LogReaderSharedWorker();\n  if (typeof LogReaderWorker === 'function') {\n    logReader = new LogReaderWorker();\n  } else {\n    throw new Error('Don\\'t');\n  }\n  const port = logReader.port || logReader;\n\n  const channel = new MessageChannel();\n  const logPort = channel.port1;\n  const apiPort = channel.port2;\n\n  logPort.onmessage = relayMessage;\n  port.onmessage = handleMessage;\n\n  return apiPort;\n}\n\nmodule.exports = getWorker;\n\ngetWorker.onData = DataEvent.listen;\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"60e05d3e393cdbe297d7.worker.js\");\n};"],"sourceRoot":""}