{"version":3,"sources":["timeline/logReader/index.js","timeline/logReader/logReader.worker.js","../../comma-api/dist/request.js","icons/icon-chffr-wheel.svg","timeline/playback.js","timeline/cache.js","url.js","timeline/segments.js","timeline/actions/types.js","timeline/reducers/globalState.js","timeline/reducers/index.js","demo/index.js","timeline/store.js","timeline/actions/index.js","timeline/startup.js","timeline/commands.js","timeline/timeline.js","timeline/index.js","components/AppHeader/TimeFilter.js","icons/index.js","components/TimeDisplay/index.js","components/AppHeader/index.js","actions/types.js","actions/index.js","utils/index.js","components/Annotations/shopButton.js","components/Annotations/eonUpsell.js","components/Dashboard/DeviceList.js","components/Dashboard/DeviceSettingsModal.js","api/geocode.js","components/Timeline/thumbnails.js","colors.js","theme.js","components/Timeline/index.js","components/Dashboard/DriveListItem.js","utils/conversions.js","components/Dashboard/DriveList.js","components/Dashboard/index.js","components/Annotations/AnnotationListItem.js","components/Annotations/greyPandaUpsell.js","components/Annotations/AnnotationList.js","components/Annotations/AnnotationTabs.js","components/DriveMap/index.js","components/DriveVideo/hlsSource.js","components/DriveVideo/canvas.js","components/DriveVideo/buffering.js","components/DriveVideo/index.js","components/Annotations/Media.js","components/Annotations/footer.js","defs/segments.js","components/Annotations/index.js","components/explorer.js","components/anonymous.js","reducers/workerState.js","reducers/zoom.js","reducers/index.js","devtools.js","store.js","analytics.js","App.js","registerServiceWorker.js","index.js","timeline/logIndex.js","../../comma-api/dist/errorHandler.js","../../comma-api/dist/config.js","timeline/initialState.js","../../comma-api/dist/config-request-promise.js","../../comma-api/dist/index.js","../../comma-api/dist/account.js","../../comma-api/dist/annotations.js","../../comma-api/dist/validators.js","../../comma-api/dist/athena.js","../../comma-api/dist/auth.js","../../comma-api/dist/devices.js","../../comma-api/dist/derived.js","../../comma-api/dist/drives.js","../../comma-api/dist/leaderboard.js","../../comma-api/dist/raw.js","../../comma-api/dist/vehicles.js","../../comma-api/dist/video.js"],"names":["Event","require","LogReaderWorker","DataEvent","logReader","handleMessage","msg","broadcast","relayMessage","port","postMessage","data","getWorker","Error","channel","MessageChannel","logPort","port1","apiPort","port2","onmessage","module","exports","onData","listen","Worker","Object","defineProperty","value","patch","postForm","post","get","undefined","_regenerator2","_interopRequireDefault","_asyncToGenerator3","_promise2","_ref","default","mark","_callee","endpoint","wrap","_callee$","_context","prev","next","ensureInit","abrupt","resolve","reject","request","query","json","_errorHandlerFn","stop","this","_x","_x2","apply","arguments","_ref2","_callee2","_callee2$","_context2","body","_x3","_x4","_ref3","_callee3","_callee3$","_context3","_querystringify2","stringify","headers","_x5","_x6","_ref4","_callee4","_callee4$","_context4","_x7","_x8","configure","_instance2","_errorHandler2","_config","obj","__esModule","initPromise","accessToken","errorHandler","config","baseUrl","COMMA_URL_ROOT","jwt","parse","token","initialState","ACTION_SEEK","ACTION_PAUSE","ACTION_PLAY","ACTION_LOOP","ACTION_BUFFER_VIDEO","ACTION_BUFFER_DATA","ACTION_DISABLE_BUFFER","currentOffset","state","offset","Date","now","startTime","playSpeed","loop","loopOffset","start","duration","cachePort","ExpireEvent","onExpire","command","route","segment","getEntry","touch","partial","getDongleID","pathname","parts","split","filter","m","length","getZoom","Number","end","ACTION_UPDATE_SEGMENTS","ACTION_LOAD_SEGMENT_METADATA","ACTION_SEGMENT_METADATA","ACTION_RESOLVE_ANNOTATION","SEGMENT_LENGTH","getCurrentSegment","o","segments","i","len","thisSegment","segmentIndex","Math","floor","url","routeOffset","startOffset","events","deviceType","videoAvailableBetweenOffsets","hpgps","hasVideo","hasDriverCamera","hasDriverCameraStream","cameraStreamSegCount","driverCameraStreamSegCount","distanceMiles","getNextSegment","finishSegment","lastEngage","vidAvail","lastVideoRange","slice","sort","a","b","route_offset_millis","route_offset_nanos","forEach","event","type","end_offset_nanos","offset_nanos","end_offset_millis","offset_millis","end_route_offset_nanos","end_route_offset_millis","segmentsFromMetadata","segmentsData","curSegment","curVideoStartOffset","proc_log","proc_qlog","segmentHasDriverCamera","proc_dcamera","segmentHasDriverCameraStream","segmentHasVideo","proc_camera","canonical_route_name","isFinite","pop","join","start_time_utc_millis","startCoord","start_lng","start_lat","replace","devicetype","locStart","locEnd","push","max","canonical_name","concat","endCoord","end_lng","end_lat","API","hasSegmentMetadata","segmentData","dongleId","console","log","parseSegmentMetadata","_segments","annotations","routeStartTimes","map","_segment","round","segmentNum","end_time_utc_millis","JSON","events_json","plannedDisengageEvents","should_take_control","_event","timestamp","canonical_segment_name","annotation","offset_nanos_part","id","error","is_planned","reason","alert","reduce","closestAlert","nextAlert","closestAlertDiff","abs","alertText2","warn","time","dongle_id","hasCameraAtOffset","some","int","updateSegments","fetchSegmentMetadata","promise","insertSegmentMetadata","resolveAnnotation","reducer","_state","action","found","s","e","warning","currentSegment","nextSegment","range","ACTION_STARTUP_DATA","ACTION_SELECT_DEVICE","ACTION_SELECT_TIME_RANGE","ACTION_UPDATE_DEVICE","isDemoCached","reducers","globalState","deviceIndex","device","devices","find","alias","create_time","device_type","imei","is_owner","last_segment_utc_millis","serial","profile","findIndex","d","store","createStore","reduceReducers","desiredPlaySpeed","speed","min","bufferingVideo","buffering","bufferingData","shouldBuffer","isBuffering","Segments","Reducers","isDemoQuery","qs","window","location","search","demo","init","localforage","getItem","isDemo","selectDevice","demoProfile","demoDevices","dispatch","Devices","listDevices","Account","getProfile","PortState","CreateStore","initAuthPromise","Auth","then","Request","hasGottenSegmentData","hasGottenSegmentDataPromise","Promise","segmentDataHandler","Demo","selectDeviceAction","all","subscribe","getState","commands","close","unlisten","broadcastChannel","play","Playback","pause","seek","bufferVideo","bufferData","disableBuffer","hello","selectTimeRange","selectTimeRangeAction","selectLoop","updateDevice","updateDeviceAction","ports","setCachePort","Cache","demoSegments","BroadcastEvent","DataLogEvent","SegmentTimerStore","segmentsRequest","annotationsRequest","scheduleSegmentUpdate","timeUntilNext","stopTimer","curTime","timeUntilLoop","loopStartOffset","loopStartSegment","timeout","checkSegmentMetadata","annotationsData","Drives","getSegmentMetadata","Annotations","listAnnotations","stack","ensureSegmentDataTimer","ensureSegmentData","entry","UnloadEvent","StateEvent","IndexEvent","InitEvent","InitPromise","addEventListener","startPath","timeline","options","onStateChange","onIndexed","buffers","requestId","openRequests","expire","bind","hasInit","readyPromise","zoom","AuthStorage","getCommaAccessToken","handleData","disconnect","setState","terminate","LogIndex","index","logIndex","_eventCount","logMonoTime","currentLogMonoTime","getLogIndex","curIndex","eventCount","Array","u","getEvent","_logIndex","buffer","capnp","getRoot","CapnpEvent","toJSON","timestampToOffset","EventWhich","FRAME","Frame","TimestampEof","curSegLog","INIT_DATA","initData","create","writable","InitData","Params","parsedEntries","Entries","_paramEntry","Key","byteOffset","Value","paramEntry","fromPointer","getEventByType","MODEL","LIVE20","LIVE100","LIVE_MAP_DATA","LIVE_MPC","CAR_STATE","DRIVER_MONITORING","THUMBNAIL","which","maxTimeDiff","monoTime","curSegNum","indexes","keys","calibrations","TimeSelect","props","handleSelectChange","handleClose","changeStart","changeEnd","handleSave","showPicker","selection","target","setHours","getHours","Timelineworker","getTime","timeRange","weekAgo","fecha","format","twoWeeksAgo","minDate","toISOString","substr","name","selectedOption","onChange","className","classes","headerDropdown","last24HoursText","lastWeekText","last2WeeksText","aria-labelledby","aria-describedby","open","onClose","modal","label","showTodayButton","buttonGroup","variant","onClick","color","Component","stateToProps","Obstruction","connect","withStyles","styles","theme","root","position","padding","spacing","unit","width","margin","left","top","transform","textAlign","fontWeight","marginRight","minWidth","AccountIcon","HistoryBackIcon","HistoryForwardIcon","transform-origin","CommaIcon","chevronPath","rotation","ChevronIcon","DownArrow","UpArrow","RightArrow","timerSteps","jumpBack","amount","TimelineWorker","jumpForward","TimeDisplay","textHolder","React","createRef","updateTime","togglePause","increaseSpeed","decreaseSpeed","displayTime","getDisplayTime","mounted","raf","current","newDisplayTime","indexOf","isPaused","cx","base","isExpanded","expanded","isThin","container","item","xs","align","iconBox","aria-label","icon","dateTime","style","paddingTop","ref","currentTime","alignItems","direction","tinyArrow","tinyArrowIcon","backgroundColor","palette","grey","height","borderRadius","maxWidth","opacity","pointerEvents","transition","paddingBottom","border","display","iconButton","maxHeight","borderRight","justifyContent","fontSize","marginTop","AppHeader","handleClickedAccount","handleLogOut","anchorEl","currentTarget","removeItem","MyCommaAuth","logOut","auth","Boolean","lg","Link","to","logo","src","logoImg","logoText","timeDisplay","selectArea","TimeFilter","aria-owns","aria-haspopup","accountIcon","anchorOrigin","vertical","horizontal","transformOrigin","userMeta","disableGutters","paragraph","email","points","component","href","borderBottom","textDecoration","fontFamily","marginLeft","paddingRight","outline","white","userMetaLink","WORKER_STATE_UPDATE","TIMELINE_SELECTION_CHANGED","selectRange","workerState","curPath","document","desiredPath","urlForState","Types","path","filterEvent","ShopButton","link","shopLink","EonUpsell","imageContainer","eon","content","hook","DeviceList","editingDevice","deviceAlias","isWaitingForApi","handleAliasChange","handleAliasFieldKeyPress","renderDevice","setDeviceAlias","toggleDeviceEdit","cancelEdit","nextProps","selectedDevice","handleDeviceSelected","key","trim","Raven","captureException","message","onlyHasAppDevice","idx","shared","filterDrivingDevice","isSelected","deviceTypePretty","deviceAvatar","deviceInfo","deviceId","isSuperUser","overflowY","cursor","flexDirection","editDeviceIcon","nameField","saveButton","textField","marginBottom","DeviceSettingsModal","loadingDeviceAlias","loadingDeviceShare","hasSavedAlias","shareEmail","handleEmailChange","callOnEnter","shareDevice","hasShared","method","grantDeviceReadPermission","err","statusCode","isOpen","form","formRow","onKeyPress","wrapper","size","fabProgress","minHeight","zIndex","MAPBOX_TOKEN","process","mbxGeocoding","geocodingClient","geocodeApi","getNeighborhood","context","getLocality","getRegion","reverseLookup","coords","reverseGeocode","limit","send","response","features","region","short_code","locality","text","_neighborhood","neighborhood","gutter","renderImage","imgStyles","blank","backgroundSize","backgroundRepeat","backgroundImage","backgroundPosition","startImage","Thumbnails","thumbnail","imgCount","ceil","imgArr","percentToOffset","seconds","imageIndex","endImage","endOffset","Colors","transparent","white10","white12","white20","white30","white40","white50","black","blue50","blue100","blue200","blue300","blue400","blue500","blue600","blue700","blue800","blue900","blue950","blue999","lightBlue50","lightBlue100","lightBlue200","lightBlue300","lightBlue400","lightBlue500","lightBlue600","lightBlue700","lightBlue800","lightBlue900","desatBlue800","red50","red100","red200","red300","red400","red500","red600","red700","red800","red900","lightRed50","lightRed100","lightRed200","lightRed300","lightRed400","lightRed500","lightRed600","lightRed700","lightRed800","lightRed900","lightRed950","lightRed999","green50","green100","green200","green300","green400","green500","green600","green700","green800","green900","lightGreen50","lightGreen100","lightGreen200","lightGreen300","lightGreen400","lightGreen500","lightGreen600","lightGreen700","lightGreen800","lightGreen900","orange50","orange100","orange200","orange300","orange400","orange500","orange600","orange700","orange800","orange900","lightOrange50","lightOrange100","lightOrange200","createMuiTheme","typography","overrides","MuiPaper","MuiSelect","select","selectMenu","MuiInput","grey800","overflow","input","MuiFormLabel","MuiTab","disableUnderline","IconComponent","placeholder","background","grey999","primary","light","grey50","main","grey900","dark","states","drivingBlue","engagedGreen","alertOrange","alertRed","50","100","grey100","200","grey200","300","grey300","400","grey400","500","grey500","600","grey600","700","grey700","800","900","950","grey950","999","lightGrey","lightGrey200","10","12","20","30","40","AlertStatusCodes","percentFromMouseEvent","boundingBox","getBoundingClientRect","pageX","Timeline","getOffset","handleClick","handleMouseMove","handleMouseDown","handleMouseUp","handleMouseLeave","renderSegment","sendSeek","debounce","offsetValue","rulerRemaining","rulerRemainingHovered","dragBar","hoverBead","zoomOverride","dragStart","mouseX","hoverPercent","isHovered","stopListening","forceUpdate","removeEventListener","seekIndex","percent","offsetToPercent","parentElement","isDragSelecting","noseek","dragSelection","querySelector","dragEnd","selectedArea","startPercent","endPercent","endTime","setTimeout","x","toFixed","perc","zoomed","draggerStyle","dragHighlight","endColor","zoomStart","zoomEnd","barStyle","colored","startPerc","widthPerc","zoomDuration","renderSegmentEvents","uncoloredSegment","localStorage","showCurrentEvent","eventStart","eventEnd","segmentColor","alertStatus","hasThumbnails","tooltipped","hasRuler","rounded","hasGradient","hoverOffset","timeString","isNaN","timestampAtOffset","role","onMouseDown","onMouseUp","onMouseMove","onMouseLeave","ruler","statusGradient","renderDragger","renderZoom","title","bounds","onResize","rect","measureRef","thumbnails","mapStateToProps","bottom","borderLeft","whiteSpace","userSelect","DriveListDrive","startLocation","endLocation","handleDriveClicked","drive","GeocodeApi","startDate","formatDriveDuration","milliseconds","minutes","hours","getDrivePoints","classNames","driveHeader","driveHeaderIntro","driveAvatar","driveTitle","toString","driveArrow","driveTimeline","paddingLeft","DriveList","goToAnnotation","filterShortDrives","renderDriveListHeader","renderDriveListSettings","handleClickedSettings","handleClosedSettings","handleOpenedSettingsModal","handleCanceledSettings","handleClosedSettingsModal","showDeviceSettingsModal","deviceAliasSaved","ride","zoomBuffer","driveList","lastEnd","lastSegmentEnd","curRideChunk","unshift","memo","renderZeroRides","drives","DriveListItem","zeroRidesEle","zeroState","header","headerLabel","settingsArea","settingsButton","settingsButtonIcon","onCancel","textTransform","Dashboard","firstAnnotationSegment","count","segCount","sidebar","sidebarHeader","annotateButton","selectedDongleId","flexGrow","DISENGAGEMENT_REASONS","AnnotationEntry","handleChange","handleComment","validate","saving","comment","errorElem","createAnnotation","updateAnnotation","isJoi","eventId","dateString","selectClassName","defaultExpanded","summaryContent","bubble","heading","getTitle","date","pillBody","pillText","alignContent","renderFormField","disabled","displayEmpty","inputProps","isPlanned","disengagementReason","reasonDetailed","panelActions","disableFocusListener","disableHoverListener","resolveButton","cancelButton","formField","toLowerCase","formLabel","formLabelText","PureComponent","GreyPandaUpsellRow","rowFill","image","LOOP_DURATION","AnnotationList","list","memoize","resolved","unresolved","filterEntry","recomputeList","recomputeRowHeights","forceUpdateGrid","handleExpanded","loopStartTime","loopEndTime","getRowHeight","renderEntry","AnnotationListItem","isUpsellDemo","overscanRowCount","rowCount","rowHeight","rowRenderer","AnnotationTabs","selectedTab","annotationsViewer","indicator","annotationsViewerTabIndicator","annotationsViewerTabs","upsellDemo","tabLabelText","badge","tabLabelBadge","badgeContent","annotationsViewerList","renderTab","right","DriveMap","populateMap","isLoadingCoords","routeSigUrl","DerivedDataApi","getCoords","coordsArr","coord","lng","lat","setPath","initMap","posAtOffset","updateMarkerPos","nextRoute","viewport","latitude","longitude","shouldFlyTo","getMap","getSource","markerSource","getMarkerSource","pos","setData","coordinates","moveViewportTo","_data","transitionDuration","transitionInterpolator","LinearInterpolator","properties","geometry","offsetSeconds","offsetFractionalPart","coordIdx","nextCoordIdx","floorLng","floorLat","mapComponent","on","addSource","addLayer","source","layout","paint","contentRect","mapContainer","mapStyle","onViewportChange","mapboxApiAccessToken","attributionControl","dragPan","HLSSource","hls","Hls","enableWorker","disablePtsDtsCorrectionInMp4Remux","Events","MANIFEST_PARSED","video","BUFFER_APPENDED","eventName","onBufferAppend","ERROR","fatal","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","destroy","nextState","detachMedia","prevProps","prevState","loadSource","attachMedia","onSourceLoaded","strokeRoundedRect","ctx","radius","strokeWidth","strokeStyle","roundedRectPath","lineWidth","stroke","closePath","fillRoundedRect","fillStyle","fill","K","SQRT2","beginPath","moveTo","lineTo","bezierCurveTo","Buffering","thickness","wheelImg","Image","vwp_h","VideoPreview","checkDataBuffer","isDataBuffering","monoTimeLength","lastEvent","nextEvent","getNextLogIndex","LogMonoTime","nextEventTime","monSec","checkVideoBuffer","videoPlayer","front","wasConnected","stopListeningToVideo","subscribeToStateChange","shouldShowPreview","bufferTime","playerState","player","buffered","desiredVideoTime","currentVideoTime","curVideoTime","timeDiff","desiredBufferedVideoTime","remainingTime","buf","waiting","seeking","timeDiffAbs","paused","updatePreviewImage","shouldShowThumbnail","playbackRate","imageRef","nearestImageFrame","updatePreview","onDisableBuffering","canvas_road","canvas_lead","canvas_carstate","canvas_maxspeed","canvas_speed","canvas_face","intrinsic","frame","rafLoop","updateVideoSource","cancel","videoApi","VideoApi","getQcameraStreamIndex","getQcameraStreamIndexUrl","catch","getRearCameraStreamIndexUrl","load","renderCanvas","currentThumbnail","retVal","thumbnailMonoTime","thumbnailTimeDiff","base64","btoa","String","fromCharCode","Uint8Array","Thumbnail","thumbnailData","calibration","getCalibration","params","shouldScale","driverMonitoring","currentDriverMonitoring","renderEventToCanvas","renderDriverMonitoring","shouldShowUI","lastCalibrationTime","extrinsic","LiveCalibration","ExtrinsicMatrix","model","currentModel","mpc","currentMPC","carState","currentCarState","drawLaneFull","live20","currentLive20","renderLeadCars","renderCarState","live100","currentLive100","liveMapData","currentLiveMapData","currentInitData","renderMaxSpeed","renderSpeed","canvas","renderEvent","logTime","monoIndex","getContext","setTransform","clearRect","_events","needsRender","eventsSig","scale","lastLive20MonoTime","leadOne","Live20","LeadOne","leadTwo","LeadTwo","Status","renderLeadCar","leadData","is2ndCar","drel","DRel","vrel","VRel","yrel","YRel","carSpaceToImageSpace","y","sz","fillAlpha","g_xo","g_yo","drawLaneBoundary","Model","LeftLane","RightLane","drawLaneTrack","Path","LiveMpc","isMpc","isEnabled","CarState","CruiseState","Enabled","lane","Prob","Points","Poly","drawLaneLine","Std","off","isGhost","started","px","py","track_bg","path_height","X","Y","createLinearGradient","addColorStop","drawCarStateBorder","drawCarStateWheel","drawSpeed","Live100","VEgo","isMetric","textBaseline","font","fillText","vwp_w","LiveMapData","drawMaxSpeed","maxSpeed","VCruise","maxSpeedCalc","isSpeedLimitValid","SpeedLimitValid","speedLimit","SpeedLimit","speedLimitCalc","speedLimitOffset","speedLimitOffsetParam","parseFloat","isCruiseSet","isSetOverLimit","isEgoOverLimit","speedLimWidth","bdr_s","textTopY","textBottomY","DecelForTurn","turnSpeed","VCurvature","arc","PI","Available","translate","rotate","SteeringAngle","save","wheelImgPattern","createPattern","strokeRect","DriverMonitoring","FaceProb","xW","xOffset","noseSize","isDistracted","FacePosition","v","toX","toY","flatMatrix","rot_matrix","FaceOrientation","p1","matmul","p2","isBlinking","LeftBlinkProb","RightBlinkProb","LeftEyeProb","RightEyeProb","pose","getDriverPose","pitch_error","pitch","yaw_error","yaw","sqrt","pow","angles_desc","pos_desc","pitch_net","yaw_net","roll_net","face_pixel_position","yaw_focal_angle","atan2","FULL_W","roll","H","cr","cos","sr","sin","cp","sp","cy","sy","rr","rp","ry","multiply","matrix","b0","b1","b2","b3","firstFrameTime","videoContainer","hidden","autoPlay","muted","fluid","isVideoChild","disableCompletely","videoUiCanvas","videoImage","MediaType","VIDEO","DRIVER_VIDEO","HUD","MAP","Media","renderMediaOptions","inView","DriveVideo","onVideoChange","noVideo","mediaOptions","mediaOption","mediaOptionText","mediaOptionDisabled","mediaOptionIcon","mediaSource","mediaSourceSelect","AnnotationsFooter","copySegmentName","downloadSegmentFile","openInCabana","openWayInOsmEditor","updateWayId","showCopiedSnack","wayId","parseInt","WayId","el","createElement","setAttribute","appendChild","execCommand","removeChild","snackTimer","seg","segmentKeyPath","RawApi","getRouteFiles","files","seekTime","routeStartTime","win","focus","footerButton","ContentProps","DeviceType","visibleSegment","headerContext","history","back","headerTitle","headerActions","headerTimeline","viewer","renderAnnotationsElement","footer","ExplorerApp","settingDongle","checkProps","isZoomed","wasZoomed","curDongle","DEMO_LINK","origin","AnonymousLanding","sessionStorage","redirectURL","tagline","AuthConfig","oauthRedirectLink","logInButton","logInText","demoLink","demoLinkText","lineHeight","verticalAlign","extend","composeEnhancers","getComposeEnhancers","compose","createHistory","GA_TRACKING_ID","initGoogleAnalytics","gtag","page_title","page_location","page_path","Redux","connectRouter","thunk","routerMiddleware","updateState","App","initialized","cancelInit","Collector","initDemoTimeline","Jepsen","initDemoState","callback","checkDemo","setItem","code","AuthApi","refreshAccessToken","REDIRECT_URI","setCommaAccessToken","isAuthenticated","render","redirectLink","Explorer","authRoutes","ananymousRoutes","renderLoading","hostname","match","environment","install","unregister","navigator","serviceWorker","ready","registration","ReactDOM","Theme","utils","DateFnsUtils","getElementById","binSearch","milis","nanos","searchIndex","indexBuffer","bufferIndex","lastIndex","byteLength","messageBuff","BufferUtils","readMessage","getLogMonoTime","messageSize","LIVE_CALIBRATION","incAmount","splice","createIndex","_buffer","Buffer","from","addToIndex","_index","_newBuff","newBuff","findMonoTime","curMillis","MAX_SAFE_INTEGER","handle","ATHENA_URL_ROOT","VIDEO_HOST","COMMA_VIDEO_CDN","getDefaultStartDate","getDefaultEndDate","ConfigRequestPromise","requestFunc","account","_interopRequireWildcard","athena","_derived2","leaderboard","raw","vehicles","_video2","newObj","prototype","hasOwnProperty","call","derived","_isFinite2","_validators","AnnotationValidator","getAnnotation","_start","_end","_verifyAnnotationStar","verifyAnnotationStartEnd","listMyAnnotations","_verifyAnnotationStar2","Joi","object","string","required","number","allow","optional","postJsonRpcPayload","payload","redirect_uri","authResponseText","resp","sent","access_token","status","fetchLocation","_stringify2","locationEndpoint","setDeviceVehicleId","vehicle_id","removeDeviceReadPermission","fetchVehicles","vehicleId","vehicleEndpoint","fetchDevice","deviceEndpoint","pilotPair","pairToken","pair_token","fetchDeviceStats","unpair","fetchDeviceOwner","routeApi","_configRequestPromise2","getJpegUrl","routeOffsetSeconds","_urlJoin2","fetchRoutes","_toConsumableArray3","reverse","getRouteInfo","routeName","getShareSignature","getRouteSegments","listRoutes","createdAfter","getLeaderboard","getCached","urlStore","getLogUrls","fetchMakes","fetchModels","make","fetchVehicle","_slicedToArray3","videoServerHost","_routeSigUrl$split$sl","_routeSigUrl$split$sl2","routeSignature","videoserverRequest","videoserverBaseUrl","storageRequest","getFrontCameraStreamIndexUrl","getRearCameraStreamIndex","getFrontCameraStreamIndexPath"],"mappings":"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","file":"static/js/main.fd78636c.chunk.js","sourcesContent":["const Event = require('geval/event');\nconst LogReaderWorker = require('./logReader.worker');\n// const LogReaderSharedWorker = require('./logReader.sharedworker');\n\nconst DataEvent = Event();\n\nlet logReader = null;\n\nfunction handleMessage(msg) {\n  DataEvent.broadcast(msg);\n}\n\nfunction relayMessage(msg) {\n  const port = logReader.port || logReader;\n  port.postMessage(msg.data);\n}\n\nfunction getWorker() {\n  if (logReader) {\n    return logReader;\n  }\n  // if (typeof LogReaderSharedWorker === 'function' && typeof SharedWorker === 'function') {\n  // logReader = new LogReaderSharedWorker();\n  if (typeof LogReaderWorker === 'function') {\n    logReader = new LogReaderWorker();\n  } else {\n    throw new Error('Don\\'t');\n  }\n  const port = logReader.port || logReader;\n\n  const channel = new MessageChannel();\n  const logPort = channel.port1;\n  const apiPort = channel.port2;\n\n  logPort.onmessage = relayMessage;\n  port.onmessage = handleMessage;\n\n  return apiPort;\n}\n\nmodule.exports = getWorker;\n\ngetWorker.onData = DataEvent.listen;\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"3169a71a42f26bedd369.worker.js\");\n};","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.patch = exports.postForm = exports.post = exports.get = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar get = exports.get = function () {\n  var _ref = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee(endpoint, data) {\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return ensureInit();\n\n          case 2:\n            return _context.abrupt('return', new _promise2.default(function (resolve, reject) {\n              request.get(endpoint, {\n                query: data,\n                json: true\n              }, _errorHandlerFn(resolve, reject));\n            }));\n\n          case 3:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function get(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar post = exports.post = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee2(endpoint, data) {\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return ensureInit();\n\n          case 2:\n            return _context2.abrupt('return', new _promise2.default(function (resolve, reject) {\n              request.post(endpoint, {\n                body: data,\n                json: true\n              }, _errorHandlerFn(resolve, reject));\n            }));\n\n          case 3:\n          case 'end':\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function post(_x3, _x4) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar postForm = exports.postForm = function () {\n  var _ref3 = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee3(endpoint, data) {\n    return _regenerator2.default.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return ensureInit();\n\n          case 2:\n            return _context3.abrupt('return', new _promise2.default(function (resolve, reject) {\n              request.post(endpoint, {\n                body: _querystringify2.default.stringify(data),\n                headers: {\n                  \"Content-Type\": \"application/x-www-form-urlencoded\"\n                }\n              }, _errorHandlerFn(resolve, reject));\n            }));\n\n          case 3:\n          case 'end':\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n\n  return function postForm(_x5, _x6) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nvar patch = exports.patch = function () {\n  var _ref4 = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee4(endpoint, data) {\n    return _regenerator2.default.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return ensureInit();\n\n          case 2:\n            return _context4.abrupt('return', new _promise2.default(function (resolve, reject) {\n              request.patch(endpoint, {\n                body: data,\n                json: true\n              }, _errorHandlerFn(resolve, reject));\n            }));\n\n          case 3:\n          case 'end':\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this);\n  }));\n\n  return function patch(_x7, _x8) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexports.configure = configure;\n\nvar _instance = require('config-request/instance');\n\nvar _instance2 = _interopRequireDefault(_instance);\n\nvar _querystringify = require('querystringify');\n\nvar _querystringify2 = _interopRequireDefault(_querystringify);\n\nvar _errorHandler = require('./errorHandler');\n\nvar _errorHandler2 = _interopRequireDefault(_errorHandler);\n\nvar _config = require('./config');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar request = (0, _instance2.default)();\nvar _errorHandlerFn = _errorHandler2.default;\nvar initPromise;\n\nfunction ensureInit() {\n  if (!initPromise) {\n    initPromise = configure();\n  }\n\n  return initPromise;\n}\n\nfunction configure(accessToken, errorHandler) {\n  var config = {\n    baseUrl: _config.COMMA_URL_ROOT,\n    jwt: false,\n    parse: null\n  };\n\n  if (accessToken) {\n    config.token = 'JWT ' + accessToken;\n  }\n\n  if (errorHandler) {\n    _errorHandlerFn = errorHandler;\n  } else {\n    _errorHandlerFn = _errorHandler2.default;\n  }\n\n  request.configure(config);\n  initPromise = _promise2.default.resolve();\n  return initPromise;\n}","module.exports = __webpack_public_path__ + \"static/media/icon-chffr-wheel.368fbfd6.svg\";","// basic helper functions for controlling playback\n// we shouldn't want to edit the raw state most of the time, helper functions are better\n\nconst initialState = require('./initialState');\n\nconst ACTION_SEEK = 'action_seek';\nconst ACTION_PAUSE = 'action_pause';\nconst ACTION_PLAY = 'action_play';\nconst ACTION_LOOP = 'action_loop';\nconst ACTION_BUFFER_VIDEO = 'action_buffer_video';\nconst ACTION_BUFFER_DATA = 'action_buffer_data';\nconst ACTION_DISABLE_BUFFER = 'action_disable_buffer';\n\n// fetch current playback offset\nexport function currentOffset(state) {\n  let offset = state.offset + (Date.now() - state.startTime) * state.playSpeed;\n\n  if (state.loop && state.loop.startTime) {\n    // respect the loop\n    const loopOffset = state.loop.startTime - state.start;\n    if (offset > loopOffset + state.loop.duration) {\n      offset = ((offset - loopOffset) % state.loop.duration) + loopOffset;\n    }\n  }\n\n  return offset;\n}\n\nexport function reducer(_state = initialState, action) {\n  let state = _state;\n  // console.log(action);\n  let loopOffset = null;\n  if (state.loop && state.loop.startTime !== null) {\n    loopOffset = state.loop.startTime - state.start;\n  }\n  switch (action.type) {\n    case ACTION_SEEK:\n      state = {\n        ...state,\n        offset: action.offset,\n        startTime: Date.now()\n      };\n\n      if (loopOffset !== null) {\n        if (state.offset < loopOffset || state.offset > (loopOffset + state.loop.duration)) {\n          // a seek outside of loop should break out of the loop\n          state.loop = { startTime: null, duration: null };\n          state.loopOffset = null;\n        } else {\n          if (state.offset > (loopOffset + state.loop.duration)) {\n            state.offset = (loopOffset + state.loop.duration) - 1000; // 1 second before end\n          }\n          // intentionally second in case we're in a sub-1-second loop (madness)\n          if (state.offset < loopOffset) {\n            state.offset = loopOffset;\n          }\n        }\n      }\n      break;\n    case ACTION_PAUSE:\n      state = {\n        ...state,\n        offset: currentOffset(state),\n        playSpeed: 0,\n        desiredPlaySpeed: 0\n      };\n      break;\n    case ACTION_PLAY:\n      if (action.speed !== state.desiredPlaySpeed) {\n        state = {\n          ...state,\n          offset: currentOffset(state),\n          desiredPlaySpeed: action.speed,\n          playSpeed: action.speed,\n          startTime: Date.now()\n        };\n      }\n      break;\n    case ACTION_LOOP:\n      state = {\n        ...state,\n        loop: {\n          startTime: action.startTime,\n          duration: action.duration\n        }\n      };\n      if (action.duration > 0 && action.startTime > 0) {\n        state.start = Math.min(action.startTime, state.start);\n        state.end = Math.max(action.startTime + action.duration, state.end);\n      }\n      break;\n    case ACTION_BUFFER_VIDEO:\n      state.bufferingVideo = action.buffering;\n      break;\n    case ACTION_BUFFER_DATA:\n      state.bufferingData = action.buffering;\n      break;\n    case ACTION_DISABLE_BUFFER:\n      state.shouldBuffer = false;\n      break;\n    default:\n      break;\n  }\n\n  const offset = state.offset + (Date.now() - state.startTime) * state.playSpeed;\n  // normalize over loop\n  if (state.loop && state.loop.startTime !== null) {\n    loopOffset = state.loop.startTime - state.start;\n    // has loop, trap offset within the loop\n    if (offset < loopOffset) {\n      state.startTime = Date.now();\n      state.offset = loopOffset;\n    } else if (offset > loopOffset + state.loop.duration) {\n      state.offset = ((offset - loopOffset) % state.loop.duration) + loopOffset;\n      state.startTime = Date.now();\n    }\n  }\n\n  state.bufferingVideo = !!state.bufferingVideo;\n  state.bufferingData = !!state.bufferingData;\n  state.isBuffering = state.shouldBuffer && (state.bufferingVideo || state.bufferingData);\n\n  if (state.isBuffering) {\n    if (state.playSpeed > 0) {\n      console.log('Entering buffer state, pausing things');\n      state.offset = currentOffset(state);\n      state.playSpeed = 0;\n    }\n  } else if (state.playSpeed !== state.desiredPlaySpeed) {\n    console.log('Exiting buffer state, resuming things');\n    state.offset = currentOffset(state);\n    state.startTime = Date.now();\n    state.playSpeed = state.desiredPlaySpeed;\n  }\n\n  return state;\n}\n\nexport function timestampToOffset(state, timestamp) {\n  return timestamp - state.start;\n}\n\n// seek to a specific offset\nexport function seek(offset) {\n  return {\n    type: ACTION_SEEK,\n    offset\n  };\n}\n\n// pause the playback\nexport function pause() {\n  return {\n    type: ACTION_PAUSE\n  };\n}\n\n// resume / change play speed\nexport function play(speed = 1) {\n  return {\n    type: ACTION_PLAY,\n    speed\n  };\n}\n\nexport function selectLoop(startTime, duration) {\n  return {\n    type: ACTION_LOOP,\n    startTime,\n    duration\n  };\n}\n\n// update video buffering state\nexport function bufferVideo(buffering = true) {\n  return {\n    type: ACTION_BUFFER_VIDEO,\n    buffering\n  };\n}\n\n// update data buffering state\nexport function bufferData(buffering = true) {\n  return {\n    type: ACTION_BUFFER_DATA,\n    buffering\n  };\n}\n\nexport function disableBuffer() {\n  return {\n    type: ACTION_DISABLE_BUFFER\n  };\n}\n","import Event from 'geval/event';\nimport { partial } from 'ap';\n// cache all of the data\n\nlet cachePort = null;\n\nconst ExpireEvent = Event();\nexport const onExpire = ExpireEvent.listen;\n\nfunction handleMessage(msg) {\n  if (!msg || !msg.data) {\n    return;\n  }\n  switch (msg.data.command) {\n    case 'expire':\n      ExpireEvent.broadcast(msg.data.data);\n      break;\n    default:\n      break;\n  }\n}\n\nexport function setCachePort(port) {\n  if (cachePort) {\n    cachePort.onmessage = null;\n  }\n  cachePort = port;\n  cachePort.onmessage = handleMessage;\n}\n\nfunction start(route, segment) {\n  cachePort.postMessage({\n    command: 'start',\n    data: { route, segment }\n  });\n}\n\nfunction touch(route, segment) {\n  cachePort.postMessage({\n    command: 'touch',\n    data: { route, segment }\n  });\n}\n\nexport function getEntry(route, segment) {\n  touch(route, segment);\n  return {\n    start: partial(start, route, segment)\n  };\n}\n","\nexport function getDongleID(pathname) {\n  let parts = pathname.split('/');\n  parts = parts.filter((m) => m.length);\n\n  if (parts[0] === 'auth') {\n    return null;\n  }\n\n  return parts[0] || null;\n}\n\nexport function getZoom(pathname) {\n  let parts = pathname.split('/');\n  parts = parts.filter((m) => m.length);\n\n  if (parts.length >= 3 && parts[0] !== 'auth') {\n    return {\n      start: Number(parts[1]),\n      end: Number(parts[2])\n    };\n  }\n  return {\n    start: null,\n    end: null\n  };\n}\n\nexport function getPathname(options) {\n  const path = [\n    options.dongleId\n  ];\n\n  if (options.start && options.end) {\n    path.push(options.start);\n    path.push(options.end);\n  }\n\n  return path.join('/');\n}\n","import initialState from './initialState';\nimport { currentOffset } from './playback';\n\nconst ACTION_UPDATE_SEGMENTS = 'update_segments';\nconst ACTION_LOAD_SEGMENT_METADATA = 'load_segment_metadata';\nconst ACTION_SEGMENT_METADATA = 'segment_metadata';\nconst ACTION_RESOLVE_ANNOTATION = 'resolve_annotation';\n\nconst SEGMENT_LENGTH = 1000 * 60;\n\n/*\nsegments look like, but can contain additional data if they want\nfor example, caching url metadata\n{\n  route: 'dongleid|date',\n  segment: 5\n}\n*/\n\nfunction getCurrentSegment(state, o) {\n  const offset = o === undefined ? currentOffset(state) : o;\n  if (!state.segments) {\n    return null;\n  }\n\n  const { segments } = state;\n\n  for (let i = 0, len = segments.length; i < len; ++i) {\n    const thisSegment = segments[i];\n    // the next segment is after the offset, that means this offset is in a blank\n    if (thisSegment.offset > offset) {\n      break;\n    }\n    if (thisSegment.offset + thisSegment.duration > offset) {\n      const segmentIndex = Math.floor((offset - thisSegment.offset) / SEGMENT_LENGTH);\n      return {\n        url: thisSegment.url,\n        route: thisSegment.route,\n        segment: segmentIndex,\n        routeOffset: thisSegment.offset,\n        startOffset: thisSegment.offset + segmentIndex * SEGMENT_LENGTH,\n        duration: thisSegment.duration,\n        events: thisSegment.events,\n        deviceType: thisSegment.deviceType,\n        videoAvailableBetweenOffsets: thisSegment.videoAvailableBetweenOffsets,\n        hpgps: thisSegment.hpgps,\n        hasVideo: thisSegment.hasVideo,\n        hasDriverCamera: thisSegment.hasDriverCamera,\n        hasDriverCameraStream: thisSegment.hasDriverCameraStream,\n        cameraStreamSegCount: thisSegment.cameraStreamSegCount,\n        driverCameraStreamSegCount: thisSegment.driverCameraStreamSegCount,\n        distanceMiles: thisSegment.distanceMiles,\n      };\n    }\n  }\n  return null;\n}\n\nfunction getNextSegment(state, o) {\n  const offset = o === undefined ? currentOffset(state) : o;\n  if (!state.segments) {\n    return null;\n  }\n\n  const { segments } = state;\n\n  for (let i = 0, len = segments.length; i < len; ++i) {\n    const thisSegment = segments[i];\n    // the next segment is after the offset, that means this offset is in a blank\n    if (thisSegment.offset > offset) {\n      return {\n        url: thisSegment.url,\n        route: thisSegment.route,\n        segment: 0,\n        routeOffset: thisSegment.offset,\n        startOffset: thisSegment.offset,\n        events: thisSegment.events,\n        videoAvailableBetweenOffsets: thisSegment.videoAvailableBetweenOffsets,\n        deviceType: thisSegment.deviceType,\n        hpgps: thisSegment.hpgps,\n        hasVideo: thisSegment.hasVideo,\n        hasDriverCamera: thisSegment.hasDriverCamera,\n        hasDriverCameraStream: thisSegment.hasDriverCameraStream,\n        cameraStreamSegCount: thisSegment.cameraStreamSegCount,\n        driverCameraStreamSegCount: thisSegment.driverCameraStreamSegCount,\n        distanceMiles: thisSegment.distanceMiles,\n      };\n      // already returned, unreachable code\n      // break;\n    }\n    if (thisSegment.offset + thisSegment.duration > offset) {\n      const segmentIndex = Math.floor((offset - thisSegment.offset) / SEGMENT_LENGTH);\n      if (segmentIndex + 1 < thisSegment.segments) {\n        return {\n          url: thisSegment.url,\n          route: thisSegment.route,\n          segment: segmentIndex + 1,\n          routeOffset: thisSegment.offset,\n          startOffset: thisSegment.offset + (segmentIndex + 1) * SEGMENT_LENGTH,\n          duration: thisSegment.duration,\n          events: thisSegment.events,\n          deviceType: thisSegment.deviceType,\n          videoAvailableBetweenOffsets: thisSegment.videoAvailableBetweenOffsets,\n          hpgps: thisSegment.hpgps,\n          hasVideo: thisSegment.hasVideo,\n          hasDriverCamera: thisSegment.hasDriverCamera,\n          hasDriverCameraStream: thisSegment.hasDriverCameraStream,\n          cameraStreamSegCount: thisSegment.cameraStreamSegCount,\n          driverCameraStreamSegCount: thisSegment.driverCameraStreamSegCount,\n          distanceMiles: thisSegment.distanceMiles,\n        };\n      }\n    }\n  }\n\n  return null;\n}\n\nfunction finishSegment(segment) {\n  let lastEngage = null;\n\n  if (segment.hasVideo) {\n    const vidAvail = segment.videoAvailableBetweenOffsets;\n    let lastVideoRange = vidAvail[vidAvail.length - 1];\n    if (!lastVideoRange) {\n      lastVideoRange = [segment.offset, segment.offset + segment.duration];\n    }\n    segment.videoAvailableBetweenOffsets = [ // eslint-disable-line no-param-reassign\n      ...vidAvail.slice(0, vidAvail.length - 1),\n      [lastVideoRange[0], segment.offset + segment.duration]\n    ];\n  }\n  segment.events = segment.events.sort((a, b) => { // eslint-disable-line no-param-reassign\n    if (a.route_offset_millis === b.route_offset_millis) {\n      return a.route_offset_nanos - b.route_offset_nanos;\n    }\n    return a.route_offset_millis - b.route_offset_millis;\n  });\n  segment.events.forEach((event) => {\n    // NOTE sometimes theres 2 disengages in a row and that is NONSENSE\n    switch (event.type) {\n      case 'engage':\n        lastEngage = event;\n        break;\n      case 'disengage':\n        if (lastEngage) {\n          lastEngage.data = {\n            end_offset_nanos: event.offset_nanos,\n            end_offset_millis: event.offset_millis,\n            end_route_offset_nanos: event.route_offset_nanos,\n            end_route_offset_millis: event.route_offset_millis\n          };\n        }\n        break;\n      default:\n        break;\n    }\n  });\n}\n\nfunction segmentsFromMetadata(segmentsData) {\n  let curSegment = null;\n  let curVideoStartOffset = null;\n  const segments = [];\n  segmentsData.segments.forEach((segment) => {\n    if (!segment.url) {\n      return;\n    }\n    if (!(segment.proc_log === 40 || segment.proc_qlog === 40)) {\n      return;\n    }\n    const segmentHasDriverCamera = (segment.proc_dcamera >= 0);\n    const segmentHasDriverCameraStream = (segment.proc_dcamera === 40);\n    const segmentHasVideo = (segment.proc_camera === 40);\n    if (segmentHasVideo && curVideoStartOffset === null) {\n      curVideoStartOffset = segment.offset;\n    }\n    /*\n      route: '99c94dc769b5d96e|2018-04-09--11-29-08',\n      offset: 41348000,\n      duration: 214000,\n      segments: 4\n    */\n    if (!curSegment || curSegment.route !== segment.canonical_route_name) {\n      if (curSegment) {\n        finishSegment(curSegment);\n      }\n      let { url } = segment;\n      const parts = url.split('/');\n\n      if (Number.isFinite(Number(parts.pop()))) {\n        // url has a number at the end\n        url = parts.join('/');\n      }\n      curSegment = {\n        offset: segment.offset - (segment.segment * SEGMENT_LENGTH),\n        route: segment.canonical_route_name,\n        startTime: segment.start_time_utc_millis,\n        startCoord: [segment.start_lng, segment.start_lat],\n        duration: 0,\n        segments: 0,\n        url: url.replace('chffrprivate.blob.core.windows.net', 'chffrprivate-vzn.azureedge.net'),\n        events: [],\n        videoAvailableBetweenOffsets: [],\n        hasVideo: segmentHasVideo,\n        deviceType: segment.devicetype,\n        hpgps: segment.hpgps,\n        hasDriverCamera: segmentHasDriverCamera,\n        hasDriverCameraStream: segmentHasDriverCameraStream,\n        locStart: '',\n        locEnd: '',\n        distanceMiles: 0.0,\n        cameraStreamSegCount: 0,\n        driverCameraStreamSegCount: 0,\n      };\n      segments.push(curSegment);\n    }\n    if (!segmentHasVideo && curVideoStartOffset !== null) {\n      curSegment.videoAvailableBetweenOffsets.push([curVideoStartOffset, segment.offset]);\n      curVideoStartOffset = null;\n    }\n    curSegment.hasVideo = (curSegment.hasVideo || segmentHasVideo);\n    curSegment.hasDriverCamera = (curSegment.hasDriverCamera || segmentHasDriverCamera);\n    if (!curSegment.hasDriverCameraStream) {\n      curSegment.hasDriverCameraStream = segmentHasDriverCameraStream;\n    }\n    curSegment.hpgps = (curSegment.hpgps || segment.hpgps);\n    curSegment.duration = (segment.offset - curSegment.offset) + segment.duration;\n    curSegment.segments = Math.max(curSegment.segments, Number(segment.canonical_name.split('--').pop()) + 1);\n    curSegment.events = curSegment.events.concat(segment.events);\n    curSegment.endCoord = [segment.end_lng, segment.end_lat];\n    curSegment.distanceMiles += segment.length;\n    curSegment.cameraStreamSegCount += Math.floor(segmentHasVideo);\n    curSegment.driverCameraStreamSegCount += Math.floor(segmentHasDriverCameraStream);\n  });\n\n  if (curSegment) {\n    finishSegment(curSegment);\n  }\n\n  return segments;\n}\n\nfunction reducer(_state = initialState, action) {\n  let state = _state;\n  let found = false;\n  switch (action.type) {\n    case ACTION_LOAD_SEGMENT_METADATA:\n      state = {\n        ...state,\n        segmentData: {\n          promise: action.promise,\n          start: action.start,\n          end: action.end,\n          dongleId: state.dongleId\n        }\n      };\n      break;\n    case ACTION_SEGMENT_METADATA:\n      state = {\n        ...state,\n        segmentData: action.data,\n        segments: action.segments\n      };\n      break;\n    case ACTION_RESOLVE_ANNOTATION:\n      state = { ...state };\n      state.segments = state.segments.map((s) => {\n        let segment = s;\n        if (found || segment.route !== action.route) {\n          return segment;\n        }\n        segment = {\n          ...segment,\n          events: segment.events.map((e) => {\n            let event = e;\n            if (found || event.time !== action.event.time || event.type !== action.event.type) {\n              return event;\n            }\n            event = {\n              ...event,\n              id: action.annotation.id,\n              annotation: action.annotation\n            };\n            found = true;\n            return event;\n          })\n        };\n\n        return segment;\n      });\n      if (!found) {\n        console.warning('Resolving unknonwn annotation');\n      }\n      break;\n    default:\n      break;\n  }\n  const currentSegment = getCurrentSegment(state);\n  const nextSegment = getNextSegment(state);\n\n  if (currentSegment) {\n    state.route = currentSegment.route;\n    state.segment = currentSegment.segment;\n  } else {\n    state.route = false;\n    state.segment = 0;\n  }\n\n  state.currentSegment = currentSegment;\n  state.nextSegment = nextSegment;\n\n  state.range = state.end - state.start;\n\n  return state;\n}\n\nfunction updateSegments() {\n  return {\n    type: ACTION_UPDATE_SEGMENTS\n  };\n}\n\nfunction fetchSegmentMetadata(start, end, promise) {\n  return {\n    type: ACTION_LOAD_SEGMENT_METADATA,\n    start,\n    end,\n    promise\n  };\n}\n\nfunction insertSegmentMetadata(data) {\n  return {\n    type: ACTION_SEGMENT_METADATA,\n    segments: segmentsFromMetadata(data),\n    data\n  };\n}\n\nfunction resolveAnnotation(annotation, event, route) {\n  return {\n    type: ACTION_RESOLVE_ANNOTATION,\n    annotation,\n    event,\n    route\n  };\n}\n\nfunction parseSegmentMetadata(state, _segments, annotations) {\n  const routeStartTimes = {};\n  let segments = _segments;\n  segments = segments.map((_segment) => {\n    const segment = _segment;\n    segment.offset = Math.round(segment.start_time_utc_millis) - state.start;\n    if (!routeStartTimes[segment.canonical_route_name]) {\n      const segmentNum = Number(segment.canonical_name.split('--')[2]);\n      segment.segment = segmentNum;\n      routeStartTimes[segment.canonical_route_name] = segment.offset;\n      if (segmentNum > 0) {\n        routeStartTimes[segment.canonical_route_name] -= (SEGMENT_LENGTH * segmentNum);\n      }\n      segment.routeOffset = routeStartTimes[segment.canonical_route_name];\n    } else {\n      segment.routeOffset = routeStartTimes[segment.canonical_route_name];\n    }\n\n    segment.duration = Math.round(segment.end_time_utc_millis - segment.start_time_utc_millis);\n    segment.events = JSON.parse(segment.events_json) || [];\n    const plannedDisengageEvents = segment.events.filter((event) => event.type === 'alert' && event.data && event.data.should_take_control);\n\n    segment.events.forEach((_event) => {\n      const event = _event;\n      event.timestamp = segment.start_time_utc_millis + event.offset_millis;\n      // segment.start_time_utc_millis + event.offset_millis\n      // segment.start_time_utc_millis - state.start + state.start\n\n      event.canonical_segment_name = segment.canonical_name;\n      annotations.forEach((annotation) => {\n        // debugger;\n        if (annotation.canonical_segment_name === event.canonical_segment_name\n          && annotation.offset_millis === event.offset_millis\n          && annotation.offset_nanos_part === event.offset_nanos) {\n          if (event.id) {\n            console.error('Server returned more than one matching annotation-to-event', event, annotation);\n            // debugger;\n          }\n          event.id = annotation.id;\n          event.annotation = annotation;\n        }\n      });\n\n      if (event.data && event.data.is_planned) {\n        let reason;\n\n        const alert = plannedDisengageEvents.reduce((closestAlert, nextAlert) => {\n          const closestAlertDiff = Math.abs(closestAlert.offset_millis - event.offset_millis);\n          if (Math.abs(nextAlert.offset_millis - event.offset_millis) < closestAlertDiff) {\n            return nextAlert;\n          }\n          return closestAlert;\n        }, plannedDisengageEvents[0]);\n        if (alert) {\n          reason = alert.data.alertText2;\n        } else {\n          console.warn('Expected alert corresponding to planned disengagement', event);\n          reason = 'Planned disengagement';\n        }\n\n        event.id = `planned_disengage_${event.time}`;\n        event.annotation = {\n          start_time_utc_millis: event.timestamp,\n          data: {\n            reason,\n          },\n          offset_nanos_part: event.offset_nanos,\n          end_time_utc_millis: event.timestamp,\n          canonical_segment_name: event.canonical_segment_name,\n          dongle_id: state.dongleId,\n          type: event.type,\n          id: event.id,\n          offset_millis: event.offset_millis\n        };\n      }\n    });\n    return segment;\n  });\n\n  return {\n    start: state.start,\n    dongleId: state.dongleId,\n    end: state.end,\n    segments\n  };\n}\n\nfunction hasSegmentMetadata(state) {\n  if (!state) {\n    return false;\n  }\n  if (!state.segmentData) {\n    console.log('No segment data at all');\n    return false;\n  }\n  if (!state.segmentData.segments) {\n    console.log('Still loading...');\n    return false;\n  }\n  if (state.dongleId !== state.segmentData.dongleId) {\n    console.log('Bad dongle id');\n    return false;\n  }\n  if (state.start < state.segmentData.start) {\n    console.log('Bad start offset');\n    return false;\n  }\n  if (state.end > state.segmentData.end) {\n    console.log('Bad end offset');\n    return false;\n  }\n\n  return true;\n}\n\nfunction hasCameraAtOffset(segment, offset) {\n  return segment.videoAvailableBetweenOffsets.some((int) => offset >= int[0] && offset <= int[1]);\n}\n\nconst API = {\n  // helpers\n  getCurrentSegment,\n  getNextSegment,\n  hasSegmentMetadata,\n  parseSegmentMetadata,\n  hasCameraAtOffset,\n\n  // actions\n  updateSegments,\n  fetchSegmentMetadata,\n  insertSegmentMetadata,\n  resolveAnnotation,\n\n  // constants\n  SEGMENT_LENGTH,\n\n  // reducer\n  reducer\n};\nexport default API;\n","// init\nexport const ACTION_STARTUP_DATA = 'ACTION_STARTUP_DATA';\n\n// global state management\nexport const ACTION_SELECT_DEVICE = 'ACTION_SELECT_DEVICE';\nexport const ACTION_SELECT_TIME_RANGE = 'ACTION_SELECT_TIME_RANGE';\nexport const ACTION_UPDATE_DEVICE = 'ACTION_UPDATE_DEVICE';\n","import {\n  ACTION_SELECT_DEVICE,\n  ACTION_SELECT_TIME_RANGE,\n  ACTION_STARTUP_DATA,\n  ACTION_UPDATE_DEVICE,\n} from '../actions/types';\n\nconst initialState = {};\n\nexport default function reducer(_state = initialState, action) {\n  let state = _state;\n  let deviceIndex = null;\n  switch (action.type) {\n    case ACTION_STARTUP_DATA:\n      if (!state.dongleId) {\n        state = {\n          ...state,\n          dongleId: action.devices[0].dongle_id,\n          device: action.devices[0]\n        };\n      } else {\n        state = {\n          ...state,\n          device: action.devices.find((device) => device.dongle_id === state.dongleId)\n        };\n        if (!state.device) {\n          state.device = {\n            alias: null,\n            create_time: 1513041169,\n            device_type: 'unknown',\n            dongle_id: '0000000000000000',\n            imei: '000000000000000',\n            is_owner: false,\n            last_segment_utc_millis: null,\n            serial: '00000000'\n          };\n        }\n      }\n      state.devices = action.devices;\n      state.profile = action.profile;\n      break;\n    case ACTION_SELECT_DEVICE:\n      state = {\n        ...state,\n        dongleId: action.dongleId\n      };\n      if (state.devices) {\n        state.device = state.devices.find((device) => device.dongle_id === action.dongleId);\n      }\n      if (state.segmentData && state.segmentData.dongleId !== state.dongleId) {\n        state.segmentData = null;\n        state.segments = [];\n      }\n      break;\n    case ACTION_SELECT_TIME_RANGE:\n      state.start = action.start;\n      state.end = action.end;\n      state.segmentData = null;\n      state.segments = [];\n      break;\n    case ACTION_UPDATE_DEVICE:\n      deviceIndex = state.devices.findIndex((d) => d.dongle_id === action.device.dongle_id);\n      state.devices[deviceIndex] = action.device;\n      state.device = action.device;\n      break;\n    default:\n      return state;\n  }\n  return state;\n}\n","import globalState from './globalState';\n\nconst reducers = {\n  globalState,\n};\nexport default reducers;\n","import qs from 'query-string';\nimport window from 'global/window';\nimport localforage from 'localforage';\n\nlet isDemoCached;\nexport function isDemoQuery() {\n  return qs.parse(window.location.search).demo === '1';\n}\nexport async function init() {\n  if (isDemoCached !== undefined) return isDemoCached;\n\n  isDemoCached = await localforage.getItem('isDemo') === '1' || isDemoQuery();\n  return isDemoCached;\n}\nexport function isDemo() {\n  return isDemoQuery() || isDemoCached;\n}\n","import { createStore } from 'redux';\nimport reduceReducers from 'reduce-reducers';\n\nimport { reducer as playbackReducer } from './playback';\nimport Segments from './segments';\nimport Reducers from './reducers';\n\nconst store = createStore(reduceReducers(playbackReducer, Segments.reducer, Reducers.globalState));\n\nexport default store;\n","import {\n  ACTION_SELECT_DEVICE,\n  ACTION_SELECT_TIME_RANGE,\n  ACTION_UPDATE_DEVICE,\n} from './types';\n\nexport function updateDevice(device) {\n  return {\n    type: ACTION_UPDATE_DEVICE,\n    device,\n  };\n}\n\nexport function selectDevice(dongleId) {\n  return {\n    type: ACTION_SELECT_DEVICE,\n    dongleId\n  };\n}\n\nexport function selectTimeRange(start, end) {\n  return {\n    type: ACTION_SELECT_TIME_RANGE,\n    start,\n    end\n  };\n}\n","import { devices as Devices, account as Account } from '@commaai/comma-api';\n\nimport store from './store';\nimport { ACTION_STARTUP_DATA } from './actions/types';\n\nconst demoProfile = require('../demo/profile.json');\nconst demoDevices = require('../demo/devices.json');\n\nexport default async function init(isDemo) {\n  if (isDemo) {\n    store.dispatch({\n      type: ACTION_STARTUP_DATA,\n      profile: demoProfile,\n      devices: demoDevices,\n    });\n  } else {\n    console.log('Fetching devices!');\n    let devices = Devices.listDevices();\n    let profile = Account.getProfile();\n    devices = await devices;\n    profile = await profile;\n    console.log('Device list:', devices);\n\n    store.dispatch({\n      type: ACTION_STARTUP_DATA,\n      profile,\n      devices\n    });\n  }\n}\n","import CreateStore from 'weakmap-shim/create-store';\nimport Auth from '@commaai/my-comma-auth';\nimport { request as Request } from '@commaai/comma-api'; // eslint-disable-line\n\nimport {\n  selectDevice as selectDeviceAction,\n  selectTimeRange as selectTimeRangeAction,\n  updateDevice as updateDeviceAction,\n} from './actions';\nimport Segments from './segments';\nimport init from './startup';\nimport * as Playback from './playback';\nimport store from './store';\nimport * as Cache from './cache';\nimport * as Demo from '../demo';\n\nexport const PortState = CreateStore();\n\n// fire off init method / construct init promises\nexport const initAuthPromise = Auth.init().then((token) => {\n  Request.configure(token);\n});\nlet hasGottenSegmentData = null;\nconst hasGottenSegmentDataPromise = new Promise(((resolve) => {\n  hasGottenSegmentData = function segmentDataHandler() {\n    hasGottenSegmentData = null;\n    resolve();\n  };\n}));\n\nstore.subscribe(() => {\n  const state = store.getState();\n\n  if (hasGottenSegmentData && Segments.hasSegmentMetadata(state)) {\n    hasGottenSegmentData();\n  }\n});\n\nfunction close(port) {\n  if (PortState(port).unlisten) {\n    PortState(port).unlisten();\n  }\n  if (PortState(port).broadcastChannel) {\n    PortState(port).broadcastChannel.port1.close();\n  }\n  port.close();\n}\n\nfunction seek(offset) {\n  store.dispatch(Playback.seek(offset));\n}\n\nfunction pause(/* port */) {\n  store.dispatch(Playback.pause());\n}\n\nfunction play(speed) {\n  store.dispatch(Playback.play(speed));\n}\n\nfunction bufferVideo(isBuffering) {\n  store.dispatch(Playback.bufferVideo(isBuffering));\n}\n\nfunction bufferData(isBuffering) {\n  store.dispatch(Playback.bufferData(isBuffering));\n}\n\nfunction disableBuffer(data) {\n  store.dispatch(Playback.disableBuffer(data));\n}\n\nasync function hello(data) {\n  await Demo.init();\n  await initAuthPromise;\n  store.dispatch(selectDeviceAction(data.dongleId));\n\n  await Promise.all([\n    init(Demo.isDemo()),\n    hasGottenSegmentDataPromise\n  ]);\n\n  return 'hello';\n}\n\nfunction resolveAnnotation(data) {\n  const { annotation, event, route } = data;\n\n  store.dispatch(Segments.resolveAnnotation(annotation, event, route));\n}\n\nfunction selectDevice(dongleId) {\n  store.dispatch(selectDeviceAction(dongleId));\n}\n\nfunction updateDevice(device) {\n  store.dispatch(updateDeviceAction(device));\n}\n\nfunction selectTimeRange(data) {\n  const { start, end } = data;\n  store.dispatch(selectTimeRangeAction(start, end));\n}\n\nfunction selectLoop(data) {\n  const { startTime, duration } = data;\n  store.dispatch(Playback.selectLoop(startTime, duration));\n}\n\nfunction cachePort(data, ports) {\n  console.log('Was handed this port!', ports);\n  Cache.setCachePort(ports[0]);\n}\n\nfunction stop() {\n  console.log('Stopping worker!');\n  // if (SegmentTimerStore(state).stopTimer) {\n  //   SegmentTimerStore(state).stopTimer();\n  //   SegmentTimerStore(state).stopTimer = null;\n  // }\n}\n\nexport const commands = {\n  close,\n  play,\n  pause,\n  seek,\n  bufferVideo,\n  bufferData,\n  disableBuffer,\n  hello,\n  resolve: resolveAnnotation,\n  selectDevice,\n  selectTimeRange,\n  selectLoop,\n  updateDevice,\n  cachePort,\n  stop\n};\n","import Event from 'geval/event';\nimport CreateStore from 'weakmap-shim/create-store';\nimport { timeout } from 'thyming';\nimport Collector from 'collect-methods';\nimport { partial } from 'ap';\n\nimport { annotations as Annotations, drives as Drives } from '@commaai/comma-api'; // eslint-disable-line\n\nimport { currentOffset } from './playback';\nimport Segments from './segments';\nimport * as Cache from './cache';\nimport store from './store';\nimport * as Demo from '../demo';\nimport { commands, initAuthPromise } from './commands';\n\nconst demoSegments = require('../demo/segments.json');\n\nconst BroadcastEvent = Event();\nconst DataLogEvent = Event();\nconst SegmentTimerStore = CreateStore();\n\nlet segmentsRequest = null;\nlet annotationsRequest = null;\n\nexport function getState() {\n  return store.getState();\n}\n\nfunction scheduleSegmentUpdate(state) {\n  let timeUntilNext = 30000;\n  const offset = currentOffset(state);\n\n  if (SegmentTimerStore(state).stopTimer) {\n    SegmentTimerStore(state).stopTimer();\n    SegmentTimerStore(state).stopTimer = null;\n  }\n  if (state.nextSegment) {\n    timeUntilNext = state.nextSegment.startOffset - offset;\n  }\n  if (timeUntilNext < 0) {\n    // debugger;\n  }\n  if (state.currentSegment) {\n    const time = (state.currentSegment.routeOffset + state.currentSegment.duration) - offset;\n    timeUntilNext = Math.min(time, timeUntilNext);\n  }\n  if (timeUntilNext < 0) {\n    // debugger;\n  }\n  if (state.loop && state.loop.startTime) {\n    const curTime = state.start + offset;\n    // curTime will be between start and end because we used currentOffset to get it\n    // currentOffset takes into account loops using modulo over duration\n    const timeUntilLoop = 1 + state.loop.startTime + state.loop.duration - curTime;\n    const loopStartOffset = state.loop.startTime - state.start;\n    const loopStartSegment = Segments.getCurrentSegment(state, loopStartOffset);\n    if (!state.currentSegment\n      || !loopStartSegment\n      || loopStartSegment.startOffset !== state.currentSegment.startOffset) {\n      timeUntilNext = Math.min(timeUntilLoop, timeUntilNext);\n    }\n  }\n  if (timeUntilNext < 0) {\n    // debugger;\n  }\n\n  if (timeUntilNext > 0) {\n    timeUntilNext = Math.max(200, timeUntilNext);\n    console.log('Waiting', timeUntilNext, 'for something to change...');\n    SegmentTimerStore(state).stopTimer = timeout(() => {\n      // empty action to churn the butter\n      store.dispatch(Segments.updateSegments());\n    }, timeUntilNext);\n  } else {\n    console.log('There is not task i think its worth waiting for...', timeUntilNext);\n    // debugger;\n  }\n}\n\nasync function checkSegmentMetadata(state) {\n  if (!state.dongleId) {\n    return;\n  }\n  if (Segments.hasSegmentMetadata(state)) {\n    // already has metadata, don't bother\n    return;\n  }\n  await Demo.init();\n  if (segmentsRequest || annotationsRequest) {\n    return;\n  }\n  console.log('We need to update the segment metadata...');\n  const { dongleId } = state;\n  const { start } = state;\n  const { end } = state;\n\n  let segmentData = null;\n  let annotationsData = null;\n  if (Demo.isDemo()) {\n    segmentsRequest = Promise.resolve(demoSegments);\n    annotationsRequest = Promise.resolve([]);\n  } else {\n    segmentsRequest = Drives.getSegmentMetadata(start, end, dongleId);\n    annotationsRequest = Annotations.listAnnotations(start, end, dongleId);\n  }\n  store.dispatch(Segments.fetchSegmentMetadata(start, end));\n\n  try {\n    segmentData = await segmentsRequest;\n    annotationsData = await annotationsRequest;\n  } catch (e) {\n    console.error('Failure fetching segment metadata', e.stack || e);\n    // /@TODO retry this call!\n    return;\n  } finally {\n    segmentsRequest = null;\n    annotationsRequest = null;\n  }\n  if (state.start !== start || state.end !== end || state.dongleId !== dongleId) {\n    checkSegmentMetadata(getState());\n    return;\n  }\n\n  segmentData = Segments.parseSegmentMetadata(state, segmentData, annotationsData);\n  // broken\n  store.dispatch(Segments.insertSegmentMetadata(segmentData));\n  // ensureSegmentData(getState());\n}\n\nlet ensureSegmentDataTimer = null;\nasync function ensureSegmentData(state) {\n  if (ensureSegmentDataTimer) {\n    ensureSegmentDataTimer();\n    ensureSegmentDataTimer = null;\n  }\n\n  let entry = null;\n  if (Date.now() - state.startTime < 1000) {\n    ensureSegmentDataTimer = timeout(() => {\n      ensureSegmentDataTimer = null;\n      return ensureSegmentData(getState());\n    }, 1100 - (Date.now() - state.startTime));\n    return;\n  }\n  if (state.route) {\n    entry = Cache.getEntry(state.route, state.segment, DataLogEvent.broadcast);\n    if (entry) {\n      entry.start();\n    }\n    if (state.segment !== 0) {\n      entry = Cache.getEntry(state.route, 0, DataLogEvent.broadcast);\n      if (entry) {\n        entry.start();\n      }\n    }\n  }\n  const { nextSegment } = state;\n  if (nextSegment) {\n    entry = Cache.getEntry(nextSegment.route, nextSegment.segment, DataLogEvent.broadcast);\n    if (entry) {\n      entry.start();\n    }\n  }\n}\n\nexport function init() {\n  // set up initial schedules\n  initAuthPromise.then(() => {\n    scheduleSegmentUpdate(getState());\n    checkSegmentMetadata(getState());\n  });\n\n  store.subscribe(() => {\n    const state = getState();\n    checkSegmentMetadata(state);\n    scheduleSegmentUpdate(state);\n    ensureSegmentData(state);\n\n    BroadcastEvent.broadcast({\n      command: 'state',\n      data: state\n    });\n  });\n}\n\nexport async function handleMessage(port, msg) {\n  if (msg.data.command) {\n    if (!commands[msg.data.command]) {\n      console.error('Invalid command!', msg.data);\n      return;\n    }\n    let result = commands[msg.data.command](port, msg.data.data, msg.ports);\n    if (result && msg.data.requestId) {\n      result = await result;\n      if (result) {\n        port.postMessage({\n          requestId: msg.data.requestId,\n          command: 'return-value',\n          data: result\n        });\n      }\n    }\n  }\n}\n","/* eslint-disable class-methods-use-this */\nimport window from 'global/window';\nimport Event from 'geval/event';\nimport * as capnp from 'capnp-ts';\nimport { Event as CapnpEvent, Event_Which as EventWhich } from '@commaai/log_reader/capnp/log.capnp';\nimport toJSON from '@commaai/capnp-json';\n\nimport { storage as AuthStorage } from '@commaai/my-comma-auth';\nimport * as Playback from './playback';\nimport * as LogIndex from './logIndex';\nimport * as Cache from './cache';\nimport { getDongleID, getZoom } from '../url';\nimport { getState, init as initTimeline } from './timeline';\nimport { commands } from './commands';\nimport store from './store';\n\nconst LogReaderWorker = require('./logReader');\n\nconst UnloadEvent = Event();\nconst StateEvent = Event();\nconst IndexEvent = Event();\nconst InitEvent = Event();\nconst InitPromise = new Promise(((resolve) => {\n  InitEvent.listen(resolve);\n}));\n\nwindow.addEventListener('beforeunload', UnloadEvent.broadcast);\nconst startPath = window.location ? window.location.pathname : '';\n\n// helper functions\n\nexport class TimelineInterface {\n  constructor(options) {\n    this.options = options || {};\n    this.buffers = {};\n    this.requestId = 1;\n    this.openRequests = {};\n    this.initPromise = InitPromise;\n\n    this.expire = this.expire.bind(this);\n  }\n\n  onStateChange = StateEvent.listen\n\n  onIndexed = IndexEvent.listen\n\n  async init(isDemo) {\n    if (!this.hasInit) {\n      this.hasInit = true;\n      this.isDemo = isDemo;\n\n      initTimeline();\n\n      this.readyPromise = commands.hello({\n        dongleId: getDongleID(startPath),\n        zoom: getZoom(startPath),\n      });\n\n      const token = await AuthStorage.getCommaAccessToken();\n      if (!(token || isDemo)) {\n        return new Promise((resolve, reject) => reject(Error('No auth')));\n      }\n\n      // if (false && typeof TimelineSharedWorker === 'function') {\n      //   worker = new TimelineSharedWorker();\n      //   t.isShared = true;\n      //   t.logReader = new LogReaderWorker();\n      if (typeof LogReaderWorker === 'function') {\n        this.logReader = new LogReaderWorker();\n      }\n\n      // broadcast message\n      // handle message\n      // cache port\n      commands.cachePort(null, [this.logReader.port || this.logReader]);\n\n      LogReaderWorker.onData((msg) => {\n        this.handleData(msg);\n      });\n\n      UnloadEvent.listen(() => this.disconnect());\n      Cache.onExpire(this.expire);\n      this.setState(getState());\n      store.subscribe(() => {\n        const state = store.getState();\n        this.setState(state);\n      });\n\n      InitEvent.broadcast(token);\n    }\n    return this.readyPromise;\n  }\n\n  async stop() {\n    if (!this.hasInit) {\n      return;\n    }\n    await commands.stop();\n    this.hasInit = false;\n    if (this.logReader) {\n      this.logReader.terminate();\n      this.logReader = null;\n    }\n  }\n\n  async getPort() {\n    await this.initPromise;\n    return this.port;\n  }\n\n  async disconnect() {\n    return commands.close();\n  }\n\n  async seek(offset) {\n    return commands.seek(Math.round(offset));\n  }\n\n  async play(speed = 1) {\n    return commands.play(speed);\n  }\n\n  async pause() {\n    return commands.pause();\n  }\n\n  async disableBuffer() {\n    return commands.disableBuffer(true);\n  }\n\n  async bufferVideo(isBuffering = true) {\n    return commands.bufferVideo(isBuffering);\n  }\n\n  async bufferData(isBuffering = true) {\n    return commands.bufferData(isBuffering);\n  }\n\n  async selectTimeRange(start, end) {\n    return commands.selectTimeRange({ start, end });\n  }\n\n  async selectLoop(startTime, duration) {\n    return commands.selectLoop({ startTime, duration });\n  }\n\n  async selectDevice(dongleId) {\n    await this.readyPromise;\n    if (this.state.dongleId === dongleId) {\n      return true;\n    }\n    return commands.selectDevice(dongleId);\n  }\n\n  async resolveAnnotation(annotation, event, route) {\n    return commands.resolve({ annotation, event, route });\n  }\n\n  async updateDevice(device) {\n    return commands.updateDevice(device,);\n  }\n\n  setState(state) {\n    this.state = state;\n    StateEvent.broadcast(state);\n    if (this.logReader) {\n      const port = this.logReader.port || this.logReader;\n      if (this.state.route) {\n        port.postMessage({\n          command: 'touch',\n          data: {\n            route: this.state.route,\n            segment: this.state.segment,\n          }\n        });\n      }\n      if (this.state.nextSegment) {\n        port.postMessage({\n          command: 'touch',\n          data: {\n            route: this.state.nextSegment.route,\n            segment: this.state.nextSegment.segment,\n          }\n        });\n      }\n    }\n  }\n\n  expire(data) {\n    console.log('Expiring cache entry', data);\n    if (this.buffers[data.route] && this.buffers[data.route][data.segment]) {\n      delete this.buffers[data.route][data.segment];\n    }\n  }\n\n  async handleData(msg) {\n    if (!this.buffers[msg.data.route]) {\n      this.buffers[msg.data.route] = {};\n    }\n    if (!this.buffers[msg.data.route][msg.data.segment]) {\n      this.buffers[msg.data.route][msg.data.segment] = LogIndex.createIndex(msg.data.data);\n    } else {\n      LogIndex.addToIndex(this.buffers[msg.data.route][msg.data.segment], msg.data.data);\n    }\n    IndexEvent.broadcast(msg.data.route);\n  }\n\n  getStartMonoTime(route, segment = 0) {\n    if (!this.buffers[route]\n      || !this.buffers[route][segment]\n      || !this.buffers[route][segment].index) {\n      return 0;\n    }\n    return this.buffers[route][segment].index[0][0];\n  }\n\n  getIndex() {\n    if (!this.state || !this.state.route) {\n      return [];\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return [];\n    }\n\n    return this.buffers[this.state.route][this.state.segment].index;\n  }\n\n  currentLogMonoTime() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return null;\n    }\n    let offset = this.currentOffset();\n    const [segment] = this.state.segments.filter((a) => a.route === this.state.route);\n    const logIndex = this.buffers[this.state.route][this.state.segment];\n    if (!segment) {\n      return null;\n    }\n    offset -= segment.offset;\n    const startTime = logIndex.index[0][0];\n\n    return offset + startTime;\n  }\n\n  lastEvents(_eventCount = 10) {\n    const logMonoTime = this.currentLogMonoTime();\n    if (!logMonoTime) {\n      return [];\n    }\n    const logIndex = this.getLogIndex();\n\n    const curIndex = LogIndex.findMonoTime(logIndex, logMonoTime);\n    const eventCount = Math.min(_eventCount, curIndex);\n\n    return [...Array(eventCount)].map((u, i) => this.getEvent(curIndex - i, logIndex));\n  }\n\n  getLogIndex() {\n    return this.buffers[this.state.route]\n      ? this.buffers[this.state.route][this.state.segment]\n      : null;\n  }\n\n  getNextLogIndex() {\n    if (!this.state.nextSegment) {\n      return null;\n    }\n    return this.buffers[this.state.nextSegment.route]\n      ? this.buffers[this.state.nextSegment.route][this.state.nextSegment.segment]\n      : null;\n  }\n\n  getEvent(index, _logIndex) {\n    // millis, nanos, offset, len, buffer\n    const logIndex = _logIndex || this.buffers[this.state.route][this.state.segment];\n    if (index < 0 || index >= logIndex.index.length) {\n      // console.log('Invalid event index', index);\n      return null;\n    }\n    const entry = logIndex.index[index];\n    const buffer = logIndex.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n    const msg = new capnp.Message(buffer, false);\n    const event = msg.getRoot(CapnpEvent);\n    return toJSON(event);\n  }\n\n  currentOffset() {\n    if (this.state) {\n      return Playback.currentOffset(this.state);\n    }\n    return 0;\n  }\n\n  timestampToOffset(timestamp) {\n    if (this.state) {\n      return Playback.timestampToOffset(this.state, timestamp);\n    }\n    return 0;\n  }\n\n  firstFrameTime() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][0]) {\n      return null;\n    }\n\n    const logIndex = this.buffers[this.state.route][0];\n    for(let i = 0; i < logIndex.index.length; i++) {\n      const entry = logIndex.index[i];\n      if (entry[5] === EventWhich.FRAME) {\n        const buffer = logIndex.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n        const msg = new capnp.Message(buffer, false);\n        const event = toJSON(msg.getRoot(CapnpEvent));\n        return event.Frame.TimestampEof / 1e9;\n      }\n    }\n    return null;\n  }\n\n  currentInitData() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return null;\n    }\n\n    const [segment] = this.state.segments.filter((a) => a.route === this.state.route);\n    if (!segment) {\n      return null;\n    }\n\n    // check if any buffered logs have the initdata packet\n    const curSegLog = this.buffers[this.state.route][this.state.segment];\n    const entry = curSegLog.index[0];\n    if (entry[5] !== EventWhich.INIT_DATA) {\n      return null;\n    }\n\n    const buffer = curSegLog.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n    const msg = new capnp.Message(buffer, false);\n    const event = msg.getRoot(CapnpEvent);\n\n    let initData = toJSON(event);\n    // Cast params key-value pointers to Text, as capnp-ts does not yet\n    // apply parameterized struct types like we use for\n    // params: Map(Text, Text)\n    initData = Object.create(initData);\n    Object.defineProperty(initData, 'InitData', { writable: true, value: Object.create(initData.InitData) });\n    Object.defineProperty(initData.InitData, 'Params', { writable: true, value: Object.create(initData.InitData.Params) });\n    const parsedEntries = initData.InitData.Params.Entries.map((_paramEntry) => {\n      if (!_paramEntry.Key.byteOffset || !_paramEntry.Value.byteOffset) {\n        return null;\n      }\n      const paramEntry = Object.create(_paramEntry);\n      Object.defineProperty(paramEntry, 'Key', {\n        writable: false,\n        value: capnp.Text.fromPointer(paramEntry.Key).get()\n      });\n      Object.defineProperty(paramEntry, 'Value', {\n        writable: true,\n        value: capnp.Text.fromPointer(paramEntry.Value).get()\n      });\n\n      return paramEntry;\n    }).filter((paramEntry) => !!paramEntry);\n    Object.defineProperty(initData.InitData.Params, 'Entries', { writable: true, value: parsedEntries });\n\n    return initData;\n  }\n\n  currentModel() {\n    return this.getEventByType(EventWhich.MODEL, 1000);\n  }\n\n  currentLive20() {\n    return this.getEventByType(EventWhich.LIVE20, 1000);\n  }\n\n  currentLive100() {\n    return this.getEventByType(EventWhich.LIVE100, 1000);\n  }\n\n  currentLiveMapData() {\n    return this.getEventByType(EventWhich.LIVE_MAP_DATA, 4000);\n  }\n\n  currentMPC() {\n    return this.getEventByType(EventWhich.LIVE_MPC, 1000);\n  }\n\n  currentCarState() {\n    return this.getEventByType(EventWhich.CAR_STATE, 1000);\n  }\n\n  currentDriverMonitoring() {\n    return this.getEventByType(EventWhich.DRIVER_MONITORING, 1000);\n  }\n\n  currentThumbnail() {\n    return this.getEventByType(EventWhich.THUMBNAIL, 6000);\n  }\n\n  getEventByType(which, maxTimeDiff = -1) {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    if (!this.buffers[this.state.route] || !this.buffers[this.state.route][this.state.segment]) {\n      return null;\n    }\n    const monoTime = this.currentLogMonoTime();\n    let offset = this.currentOffset();\n    const [segment] = this.state.segments.filter((a) => a.route === this.state.route);\n    if (!segment) {\n      return null;\n    }\n\n    for (let curSegNum = this.state.segment; curSegNum >= 0; --curSegNum) {\n      const logIndex = this.buffers[this.state.route][curSegNum];\n      if (!logIndex) {\n        return null;\n      }\n      offset -= segment.offset;\n      const startTime = logIndex.index[0][0];\n      const logMonoTime = offset + startTime;\n      let curIndex = logIndex.index.length - 1;\n      if (curSegNum === this.state.segment) {\n        curIndex = LogIndex.findMonoTime(logIndex, logMonoTime);\n      }\n\n      for (curIndex; curIndex >= 0; --curIndex) {\n        const entry = logIndex.index[curIndex];\n        if (maxTimeDiff !== -1 && monoTime - entry[0] > maxTimeDiff) {\n          return null;\n        }\n        if (entry[5] === which) {\n          const buffer = logIndex.buffers[entry[4]].slice(entry[2], entry[2] + entry[3]);\n          const msg = new capnp.Message(buffer, false);\n          const event = msg.getRoot(CapnpEvent);\n          return toJSON(event);\n        }\n      }\n    }\n\n    return null;\n  }\n\n  getCalibration() {\n    if (!this.state || !this.state.route) {\n      return null;\n    }\n    const indexes = this.buffers[this.state.route];\n\n    if (!indexes) {\n      return null;\n    }\n\n    for (let i = 0, keys = Object.keys(indexes), len = keys.length; i < len; ++i) {\n      const index = indexes[keys[i]];\n      if (index.calibrations && index.calibrations.length) {\n        return index.calibrations[index.calibrations.length - 1];\n      }\n    }\n    return null;\n  }\n}\n// create instance and expose it\nconst timeline = new TimelineInterface();\nexport default timeline;\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport fecha from 'fecha';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport Divider from '@material-ui/core/Divider';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport Modal from '@material-ui/core/Modal';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Paper from '@material-ui/core/Paper';\n\nimport { DateTimePicker } from 'material-ui-pickers';\n\nimport Timelineworker from '../../timeline';\n\nconst styles = (theme) => ({\n  root: {},\n  modal: {\n    position: 'absolute',\n    padding: theme.spacing.unit * 2,\n    width: theme.spacing.unit * 50,\n    margin: '0 auto',\n    left: '50%',\n    top: '40%',\n    transform: 'translate(-50%, -50%)'\n  },\n  buttonGroup: {\n    textAlign: 'right'\n  },\n  headerDropdown: {\n    fontWeight: 500,\n    marginRight: 12,\n    minWidth: 310,\n    textAlign: 'center',\n  },\n});\n\nconst LOOKBACK_WINDOW_MILLIS = 30 * 24 * 3600 * 1000; // 30 days\n\nclass TimeSelect extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleSelectChange = this.handleSelectChange.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.changeStart = this.changeStart.bind(this);\n    this.changeEnd = this.changeEnd.bind(this);\n    this.handleSave = this.handleSave.bind(this);\n\n    this.state = {\n      showPicker: false\n    };\n  }\n\n  handleSelectChange(e) {\n    const selection = e.target.value;\n    const d = new Date();\n    d.setHours(d.getHours() + 1, 0, 0, 0);\n\n    switch (selection) {\n      case '24-hours':\n        Timelineworker.selectTimeRange(d.getTime() - (1000 * 60 * 60 * 24), d.getTime());\n        break;\n      case '1-week':\n        Timelineworker.selectTimeRange(d.getTime() - (1000 * 60 * 60 * 24 * 7), d.getTime());\n        break;\n      case '2-weeks':\n        Timelineworker.selectTimeRange(d.getTime() - (1000 * 60 * 60 * 24 * 14), d.getTime());\n        break;\n      case 'custom':\n        this.setState({\n          showPicker: true,\n          start: this.props.start,\n          end: this.props.end\n        });\n        break;\n    }\n  }\n\n  handleClose() {\n    this.setState({\n      showPicker: false\n    });\n  }\n\n  changeStart(value) {\n    this.setState({\n      start: value.getTime()\n    });\n  }\n\n  changeEnd(value) {\n    this.setState({\n      end: value.getTime()\n    });\n  }\n\n  handleSave() {\n    Timelineworker.selectTimeRange(this.state.start, this.state.end);\n    this.setState({\n      showPicker: false,\n      start: null,\n      end: null\n    });\n  }\n\n  selectedOption() {\n    const timeRange = this.props.end - this.props.start;\n\n    if (Math.abs(this.props.end - Date.now()) < 1000 * 60 * 60) {\n      // ends right around now\n      if (timeRange === 1000 * 60 * 60 * 24 * 14) {\n        return '2-weeks';\n      } if (timeRange === 1000 * 60 * 60 * 24 * 7) {\n        return '1-week';\n      } if (timeRange === 1000 * 60 * 60 * 24) {\n        return '24-hours';\n      }\n    }\n\n    return 'custom';\n  }\n\n  lastWeekText() {\n    if (!this.props.start || !this.props.end) {\n      return '--';\n    }\n\n    const weekAgo = Date.now() - (1000 * 60 * 60 * 24 * 7);\n    return `Last Week${\n      fecha.format(new Date(weekAgo), ' (MMM Do - ')\n    }${fecha.format(new Date(), 'MMM Do)')}`;\n  }\n\n  last2WeeksText() {\n    if (!this.props.start || !this.props.end) {\n      return '--';\n    }\n\n    const twoWeeksAgo = Date.now() - (1000 * 60 * 60 * 24 * 14);\n    return `2 Weeks${\n      fecha.format(new Date(twoWeeksAgo), ' (M/D - ')\n    }${fecha.format(new Date(), 'M/D)')}`;\n  }\n\n  last24HoursText() {\n    if (!this.props.start || !this.props.end) {\n      return '--';\n    }\n    return 'Last 24 Hours';\n  }\n\n  render() {\n    const minDate = new Date(Date.now() - LOOKBACK_WINDOW_MILLIS).toISOString().substr(0, 10);\n\n    return (\n      <>\n        <FormControl>\n          <Select\n            name=\"timerange\"\n            value={this.selectedOption()}\n            onChange={this.handleSelectChange}\n            className={this.props.classes.headerDropdown}\n          >\n            <MenuItem value=\"custom\">Custom</MenuItem>\n            <MenuItem value=\"24-hours\">{ this.last24HoursText() }</MenuItem>\n            <MenuItem value=\"1-week\">{ this.lastWeekText() }</MenuItem>\n            <MenuItem value=\"2-weeks\">{ this.last2WeeksText() }</MenuItem>\n          </Select>\n        </FormControl>\n        <Modal\n          aria-labelledby=\"simple-modal-title\"\n          aria-describedby=\"simple-modal-description\"\n          open={this.state.showPicker}\n          onClose={this.handleClose}\n        >\n          <Paper className={this.props.classes.modal}>\n            <DateTimePicker\n              minDate={minDate}\n              value={new Date(this.state.start || this.props.start || 0)}\n              onChange={this.changeStart}\n              label=\"Start time\"\n              showTodayButton\n            />\n            <DateTimePicker\n              minDate={minDate}\n              value={new Date(this.state.end || this.props.end || 0)}\n              onChange={this.changeEnd}\n              label=\"End time\"\n              showTodayButton\n            />\n            <br />\n            <br />\n            <Divider />\n            <br />\n            <div className={this.props.classes.buttonGroup}>\n              <Button variant=\"contained\" onClick={this.handleClose}>\n                Cancel\n              </Button>\n              &nbsp;\n              <Button variant=\"contained\" color=\"secondary\" onClick={this.handleSave}>\n                Save\n              </Button>\n            </div>\n          </Paper>\n        </Modal>\n      </>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  end: 'workerState.end',\n  start: 'workerState.start'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(TimeSelect));\n","/* eslint-disable react/jsx-props-no-spreading */\nimport React from 'react';\nimport SvgIcon from '@material-ui/core/SvgIcon';\n\nexport function AccountIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <g transform=\"translate(-198.000000, -189.000000)\">\n        <path d=\"M210,189 C203.381053,189 198,194.381053 198,201 C198,207.618947 203.381053,213 210,213 C216.618947,213 222,207.618947 222,201 C222,194.381053 216.618947,189 210,189 Z M216.724916,207.352941 C216.374763,206.716762 215.824522,206.182371 215.099204,205.902453 L212.623121,204.808224 C211.972836,204.553753 211.522639,203.917573 211.472617,203.205053 L211.422595,202.747004 C212.573099,201.856353 213.348438,200.125945 213.348438,198.293749 C213.348438,195.647243 211.697716,193.815047 209.671829,193.815047 C207.645942,193.815047 205.99522,195.647243 205.99522,198.293749 C205.99522,200.125945 206.770559,201.830905 207.921063,202.747004 L207.871041,203.205053 C207.821019,203.917573 207.370822,204.528305 206.720537,204.808224 L204.244453,205.902453 C203.544147,206.182371 202.968895,206.716762 202.618742,207.352941 C201.068063,205.622534 200.117647,203.332288 200.117647,200.813019 C200.117647,195.469113 204.394519,191.117647 209.646818,191.117647 C214.899117,191.117647 219.175989,195.469113 219.175989,200.813019 C219.201,203.332288 218.250584,205.622534 216.724916,207.352941 Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n\nexport function HistoryBackIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M16.8880175,1.0391027 C13.9587286,-0.258687148 10.6253998,-0.358517136 7.5951009,0.839442723 C5.57490164,1.63808263 3.75672231,2.93587248 2.44359279,4.63298228 L1.93854298,2.83604249 C1.83753301,2.23706256 1.3324832,1.93757259 0.726423422,2.03740258 C0.221373607,2.23706256 -0.0816562816,2.7362125 0.0193536814,3.23536244 L1.02945331,7.32839196 C1.13046327,7.8275419 1.53450313,8.12703187 2.03955294,8.12703187 C2.1405629,8.12703187 2.24157287,8.12703187 2.24157287,8.12703187 L6.38298135,7.12873198 C6.88803116,7.028902 7.29207101,6.42992207 7.09005109,5.93077212 C7.09005109,5.3317922 6.48399131,5.03230223 5.9789415,5.23196221 L4.26177213,5.63128216 C5.37288172,4.33349231 6.68601124,3.33519243 8.30217064,2.7362125 C10.8274197,1.73791262 13.5546887,1.83774261 16.0799378,2.93587248 C18.5041769,4.03400235 20.4233662,5.93077212 21.4334658,8.42652183 C22.4435655,10.9222715 22.3425555,13.6176812 21.2314459,16.1134309 C20.1203363,18.6091806 18.201147,20.4061204 15.6758979,21.4044203 C12.1405492,22.7022102 8.20116068,22.1032302 5.37288172,19.6074805 C4.16076216,18.5093506 3.15066253,17.2115608 2.54460276,15.714111 C2.34258283,15.214961 1.73652305,14.9154711 1.23147324,15.115131 C0.726423422,15.314791 0.423393533,15.913771 0.625413459,16.4129209 C1.3324832,18.2098607 2.54460276,19.9069705 3.95874224,21.1049303 C6.18096142,23.0017001 9.00924038,24 11.9385293,24 C13.4536788,24 14.8678182,23.70051 16.2819577,23.2013601 C19.3122566,22.0034002 21.6354858,19.8071405 22.9486153,16.9120708 C24.2617448,14.0170012 24.3627548,10.7226116 23.1506352,7.72771191 C21.9385156,4.73281227 19.9183164,2.33689255 16.8880175,1.0391027 Z\" />\n      <path d=\"M11.7081415,6.22222222 C11.0832566,6.22222222 10.6666667,6.61010101 10.6666667,7.19191919 L10.6666667,13.010101 C10.6666667,13.3010101 10.7708142,13.5919192 11.0832566,13.7858586 L15.2491561,16.6949495 C15.4574511,16.7919192 15.6657461,16.8888889 15.8740411,16.8888889 C16.1864835,16.8888889 16.498926,16.7919192 16.707221,16.5010101 C17.0196634,16.1131313 16.9155159,15.4343434 16.498926,15.1434343 L12.7496164,12.5252525 L12.7496164,7.19191919 C12.7496164,6.61010101 12.3330265,6.22222222 11.7081415,6.22222222 Z\" />\n    </SvgIcon>\n  );\n}\nexport function HistoryForwardIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <g transform=\"matrix(-1, 0, 0, 1, 0, 0)\" transform-origin=\"center\">\n        <path d=\"M16.8880175,1.0391027 C13.9587286,-0.258687148 10.6253998,-0.358517136 7.5951009,0.839442723 C5.57490164,1.63808263 3.75672231,2.93587248 2.44359279,4.63298228 L1.93854298,2.83604249 C1.83753301,2.23706256 1.3324832,1.93757259 0.726423422,2.03740258 C0.221373607,2.23706256 -0.0816562816,2.7362125 0.0193536814,3.23536244 L1.02945331,7.32839196 C1.13046327,7.8275419 1.53450313,8.12703187 2.03955294,8.12703187 C2.1405629,8.12703187 2.24157287,8.12703187 2.24157287,8.12703187 L6.38298135,7.12873198 C6.88803116,7.028902 7.29207101,6.42992207 7.09005109,5.93077212 C7.09005109,5.3317922 6.48399131,5.03230223 5.9789415,5.23196221 L4.26177213,5.63128216 C5.37288172,4.33349231 6.68601124,3.33519243 8.30217064,2.7362125 C10.8274197,1.73791262 13.5546887,1.83774261 16.0799378,2.93587248 C18.5041769,4.03400235 20.4233662,5.93077212 21.4334658,8.42652183 C22.4435655,10.9222715 22.3425555,13.6176812 21.2314459,16.1134309 C20.1203363,18.6091806 18.201147,20.4061204 15.6758979,21.4044203 C12.1405492,22.7022102 8.20116068,22.1032302 5.37288172,19.6074805 C4.16076216,18.5093506 3.15066253,17.2115608 2.54460276,15.714111 C2.34258283,15.214961 1.73652305,14.9154711 1.23147324,15.115131 C0.726423422,15.314791 0.423393533,15.913771 0.625413459,16.4129209 C1.3324832,18.2098607 2.54460276,19.9069705 3.95874224,21.1049303 C6.18096142,23.0017001 9.00924038,24 11.9385293,24 C13.4536788,24 14.8678182,23.70051 16.2819577,23.2013601 C19.3122566,22.0034002 21.6354858,19.8071405 22.9486153,16.9120708 C24.2617448,14.0170012 24.3627548,10.7226116 23.1506352,7.72771191 C21.9385156,4.73281227 19.9183164,2.33689255 16.8880175,1.0391027 Z\" />\n        <path d=\"M11.7081415,6.22222222 C11.0832566,6.22222222 10.6666667,6.61010101 10.6666667,7.19191919 L10.6666667,13.010101 C10.6666667,13.3010101 10.7708142,13.5919192 11.0832566,13.7858586 L15.2491561,16.6949495 C15.4574511,16.7919192 15.6657461,16.8888889 15.8740411,16.8888889 C16.1864835,16.8888889 16.498926,16.7919192 16.707221,16.5010101 C17.0196634,16.1131313 16.9155159,15.4343434 16.498926,15.1434343 L12.7496164,12.5252525 L12.7496164,7.19191919 C12.7496164,6.61010101 12.3330265,6.22222222 11.7081415,6.22222222 Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\nexport function CommaIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      <g transform=\"scale(0.35, 0.35)\" transform-origin=\"center\">\n        <path d=\"M2.3325273,44 C2.3325273,42.9819019 2.25294268,42.1290181 2.37000751,41.3070321 C2.41990001,40.9564305 2.82901847,40.5810595 3.16268975,40.3693706 C4.78942848,39.3369727 6.55659633,38.5126886 8.07113779,37.32861 C12.9769087,33.4931864 15.8847893,28.4440632 16.0437152,21.8852845 C16.0887401,20.0229846 15.4041177,19.5577289 13.8399272,20.2831908 C9.32477801,22.3776079 4.46938637,21.1496084 1.87814052,17.2574961 C-0.947721751,13.012484 -0.549798677,7.36046894 2.83607643,3.65221184 C7.16090397,-1.08410221 14.2770341,-1.22582393 19.1842653,3.29752453 C22.1237851,6.00709044 23.5205316,9.50570155 23.8688055,13.4851451 C25.0365333,26.8169447 18.349722,37.8056121 6.17936039,42.6328324 C4.97488253,43.1103451 3.73973905,43.5025696 2.3325273,44\" />\n      </g>\n    </SvgIcon>\n  );\n}\n\nfunction chevronPath(rotation = 270) {\n  return (\n    <path d=\"M16.8625817,0.35528597 C16.3546389,-0.125475313 15.550396,-0.125475313 15.0847818,0.398991541 L5.3492107,11.1068565 C4.88359643,11.6313233 4.88359643,12.4180236 5.3492107,12.8987849 L15.0847818,23.6066499 C15.3387532,23.8688833 15.6773817,24 16.0160103,24 C16.3123103,24 16.6509389,23.8688833 16.9049103,23.6503554 C17.4128531,23.1695941 17.4551817,22.3391883 16.9472388,21.8147214 L7.97358203,12.0246735 L16.9049103,2.19091996 C17.3705245,1.66645311 17.3705245,0.836047253 16.8625817,0.35528597 Z\" transform={`rotate(${rotation})`} transform-origin=\"center\" />\n  );\n}\n\nexport function ChevronIcon(props) {\n  return (\n    <SvgIcon {...props}>\n      { chevronPath(270) }\n    </SvgIcon>\n  );\n}\nexport const DownArrow = ChevronIcon;\n\nexport function UpArrow(props) {\n  return (\n    <SvgIcon {...props}>\n      { chevronPath(90) }\n    </SvgIcon>\n  );\n}\n\nexport function RightArrow(props) {\n  return (\n    <SvgIcon {...props}>\n      { chevronPath(180) }\n    </SvgIcon>\n  );\n}\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport raf from 'raf';\nimport fecha from 'fecha';\nimport { partial } from 'ap';\nimport cx from 'classnames';\nimport PropTypes from 'prop-types';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport IconButton from '@material-ui/core/IconButton';\nimport PlayArrow from '@material-ui/icons/PlayArrow';\nimport Pause from '@material-ui/icons/Pause';\n\nimport {\n  DownArrow, UpArrow, HistoryForwardIcon, HistoryBackIcon\n} from '../../icons';\n\nimport TimelineWorker from '../../timeline';\n\nconst timerSteps = [\n  0.1,\n  0.25,\n  0.5,\n  1,\n  2,\n  3,\n  4,\n  5\n];\n\nfunction jumpBack(amount) {\n  TimelineWorker.seek(TimelineWorker.currentOffset() - amount);\n}\n\nfunction jumpForward(amount) {\n  TimelineWorker.seek(TimelineWorker.currentOffset() + amount);\n}\nconst styles = (theme) => ({\n  base: {\n    backgroundColor: theme.palette.grey[999],\n    height: '64px',\n    borderRadius: '32px',\n    padding: theme.spacing.unit,\n    maxWidth: 510,\n    margin: '0 auto',\n    minWidth: 450,\n    opacity: 0,\n    pointerEvents: 'none',\n    transition: 'opacity 0.1s ease-in-out',\n    '&.isExpanded': {\n      opacity: 1,\n      pointerEvents: 'auto',\n    },\n    '&.isThin': {\n      height: 50,\n      paddingBottom: 0,\n      paddingTop: 0,\n    },\n  },\n  icon: {\n    width: '98%',\n    height: '98%',\n    '&.dim': {\n      color: theme.palette.grey[700]\n    },\n    '&.small': {\n      width: '60%',\n      height: '60%',\n    },\n    '&.circle': {\n      border: `1px solid ${theme.palette.grey[900]}`,\n      borderRadius: '50%'\n    }\n  },\n  tinyArrow: {\n    display: 'flex',\n    height: 12,\n  },\n  tinyArrowIcon: {\n    width: 12,\n    height: 12,\n    color: theme.palette.grey[700]\n  },\n  iconButton: {\n    maxWidth: '100%',\n    maxHeight: '100%'\n  },\n  iconBox: {\n    display: 'inline-block',\n    borderRight: `1px solid ${theme.palette.grey[900]}`\n  },\n  dateTime: {\n    alignItems: 'center',\n    display: 'flex',\n    justifyContent: 'center',\n  },\n  currentTime: {\n    fontSize: 15,\n    fontWeight: 500,\n    display: 'block',\n    marginTop: 4,\n  }\n});\n\nclass TimeDisplay extends Component {\n  static getDerivedStateFromProps(props, state) {\n    if (props.playSpeed !== 0 && props.playSpeed !== state.playSpeed) {\n      return {\n        ...state,\n        playSpeed: props.playSpeed\n      };\n    }\n    return state;\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.textHolder = React.createRef();\n\n    this.updateTime = this.updateTime.bind(this);\n    this.togglePause = this.togglePause.bind(this);\n    this.increaseSpeed = this.increaseSpeed.bind(this);\n    this.decreaseSpeed = this.decreaseSpeed.bind(this);\n\n    this.state = {\n      playSpeed: 1,\n      displayTime: this.getDisplayTime()\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    raf(this.updateTime);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  getDisplayTime() {\n    const currentOffset = TimelineWorker.currentOffset();\n    const { start } = this.props;\n    if (!Number.isFinite(start)) {\n      return '...';\n    }\n    const now = new Date(currentOffset + start);\n    const dateString = fecha.format(now, 'ddd, D MMM, YYYY @ HH:mm:ss');\n    // var dateString = fecha.format(now, 'MMM D @ HH:mm:ss');\n\n    return dateString;\n  }\n\n  updateTime() {\n    if (!this.mounted || !this.textHolder.current) {\n      return;\n    }\n    const newDisplayTime = this.getDisplayTime();\n    const { displayTime } = this.state;\n    if (newDisplayTime !== displayTime) {\n      this.setState({ displayTime: newDisplayTime });\n    }\n\n    raf(this.updateTime);\n  }\n\n  decreaseSpeed() {\n    const { playSpeed } = this.state;\n    let curIndex = timerSteps.indexOf(playSpeed);\n    if (curIndex === -1) {\n      curIndex = timerSteps.indexOf(1);\n    }\n    curIndex = Math.max(0, curIndex - 1);\n    TimelineWorker.play(timerSteps[curIndex]);\n  }\n\n  increaseSpeed() {\n    const { playSpeed } = this.state;\n    let curIndex = timerSteps.indexOf(playSpeed);\n    if (curIndex === -1) {\n      curIndex = timerSteps.indexOf(1);\n    }\n    curIndex = Math.min(timerSteps.length - 1, curIndex + 1);\n    TimelineWorker.play(timerSteps[curIndex]);\n  }\n\n  togglePause(e) {\n    const { playSpeed } = this.props;\n    if (playSpeed === 0) {\n      TimelineWorker.play(this.state.playSpeed);\n    } else {\n      TimelineWorker.pause();\n    }\n  }\n\n  render() {\n    const { classes } = this.props;\n    const isPaused = this.props.playSpeed === 0;\n    return (\n      <div\n        className={cx(classes.base, {\n          isExpanded: this.props.expanded,\n          isThin: this.props.isThin,\n        })}\n      >\n        <Grid container>\n          <Grid item xs={3}>\n            <Grid container>\n              <Grid item align=\"center\" xs={6} className={classes.iconBox}>\n                <IconButton\n                  onClick={partial(jumpBack, 10000)}\n                  aria-label=\"Jump back 10 seconds\"\n                >\n                  <HistoryBackIcon className={`${classes.icon} small dim`} />\n                </IconButton>\n              </Grid>\n              <Grid item align=\"center\" xs={6} className={classes.iconBox}>\n                <IconButton\n                  onClick={partial(jumpForward, 10000)}\n                  aria-label=\"Jump forward 10 seconds\"\n                >\n                  <HistoryForwardIcon className={`${classes.icon} small dim`} />\n                </IconButton>\n              </Grid>\n            </Grid>\n          </Grid>\n          <Grid item xs={6} className={classes.dateTime}>\n            { !this.props.isThin && (\n              <Typography variant=\"caption\" align=\"center\" style={{ paddingTop: 4 }}>\n                CURRENT PLAYBACK TIME\n              </Typography>\n            )}\n            <Typography variant=\"body1\" align=\"center\">\n              <span ref={this.textHolder} className={classes.currentTime}>\n                { this.state.displayTime }\n              </span>\n            </Typography>\n          </Grid>\n          <Grid item xs={3}>\n            <Grid container>\n              <Grid item align=\"center\" xs={4} className={classes.iconBox}>\n                <Grid container alignItems=\"center\" direction=\"column\">\n                  <Grid item className={classes.tinyArrow}>\n                    <IconButton\n                      className={classes.tinyArrowIcon}\n                      onClick={this.increaseSpeed}\n                      aria-label=\"Increase play speed by 1 step\"\n                    >\n                      <UpArrow className={classes.tinyArrowIcon} />\n                    </IconButton>\n                  </Grid>\n                  <Grid item>\n                    <Typography variant=\"body2\" align=\"center\">\n                      { this.state.playSpeed }\nx\n                    </Typography>\n                  </Grid>\n                  <Grid item className={classes.tinyArrow}>\n                    <IconButton\n                      className={classes.tinyArrowIcon}\n                      onClick={this.decreaseSpeed}\n                      aria-label=\"Decrease play speed by 1 step\"\n                    >\n                      <DownArrow className={classes.tinyArrowIcon} />\n                    </IconButton>\n                  </Grid>\n                </Grid>\n              </Grid>\n              <Grid item align=\"center\" xs={8}>\n                <IconButton\n                  onClick={this.togglePause}\n                  aria-label={isPaused ? 'Unpause' : 'Pause'}\n                >\n                  { isPaused\n                    ? (<PlayArrow className={`${classes.icon} circle`} />)\n                    : (<Pause className={`${classes.icon} circle`} />)}\n                </IconButton>\n              </Grid>\n            </Grid>\n          </Grid>\n        </Grid>\n      </div>\n    );\n  }\n}\n\nTimeDisplay.propTypes = {\n  classes: PropTypes.object.isRequired,\n  playSpeed: PropTypes.number.isRequired,\n  start: PropTypes.number.isRequired\n};\n\nconst stateToProps = Obstruction({\n  expanded: 'zoom.expanded',\n  playSpeed: 'workerState.desiredPlaySpeed',\n  start: 'workerState.start',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(TimeDisplay));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport Obstruction from 'obstruction';\nimport fecha from 'fecha';\nimport localforage from 'localforage';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport Input from '@material-ui/core/Input';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport ListItem from '@material-ui/core/ListItem';\nimport IconButton from '@material-ui/core/IconButton';\n\nimport MyCommaAuth from '@commaai/my-comma-auth';\n\nimport TimeFilter from './TimeFilter';\nimport TimeDisplay from '../TimeDisplay';\nimport { AccountIcon } from '../../icons';\n\nimport Timelineworker from '../../timeline';\n\nconst styles = (theme) => ({\n  base: {\n    backgroundColor: '#1D2225',\n    borderBottom: '1px solid rgba(255, 255, 255, 0.1)',\n    display: 'flex',\n    width: '100%',\n  },\n  logo: {\n    alignItems: 'center',\n    display: 'flex',\n    maxWidth: 200,\n    textDecoration: 'none',\n  },\n  logoImg: {\n    height: '34px',\n    margin: '0px 28px',\n    width: 'auto',\n  },\n  logoText: {\n    fontFamily: 'MaisonNeueExtended',\n    fontSize: 18,\n    fontWeight: 600,\n  },\n  timeDisplay: {\n    alignItems: 'center',\n  },\n  selectArea: {\n    alignItems: 'center',\n    display: 'flex',\n    justifyContent: 'flex-end',\n    marginLeft: 'auto',\n    paddingRight: 28,\n  },\n  accountIcon: {\n    color: '#272D30',\n    height: 34,\n    width: 34,\n  },\n  userMeta: {\n    outline: 'none',\n    padding: `${theme.spacing.unit}px ${theme.spacing.unit * 2}px`,\n    borderBottom: `1px solid ${theme.palette.white[12]}`,\n  },\n  userMetaLink: {\n    textDecoration: 'none',\n    color: '#fff',\n  },\n});\n\nclass AppHeader extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleClickedAccount = this.handleClickedAccount.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.handleLogOut = this.handleLogOut.bind(this);\n\n    this.state = {\n      anchorEl: null,\n    };\n  }\n\n  handleClickedAccount(event) {\n    this.setState({ anchorEl: event.currentTarget });\n  }\n\n  handleClose() {\n    this.setState({ anchorEl: null });\n  }\n\n  handleLogOut() {\n    this.handleClose();\n    localforage.removeItem('isDemo');\n    MyCommaAuth.logOut();\n  }\n\n  render() {\n    const { profile, classes } = this.props;\n    const { auth, anchorEl } = this.state;\n    const open = Boolean(anchorEl);\n\n    if (!profile) {\n      return [];\n    }\n\n    return (\n      <header className={classes.base}>\n        <Grid container spacing={0}>\n          <Grid item container xs={2} lg={4}>\n            <Link to=\"/\" className={classes.logo}>\n              <img src=\"/images/comma-white.png\" className={classes.logoImg} />\n              <Typography className={classes.logoText}>\n                explorer\n              </Typography>\n            </Link>\n          </Grid>\n          <Grid item container xs={6} lg={4} className={classes.timeDisplay}>\n            <TimeDisplay isThin />\n          </Grid>\n          <Grid\n            item\n            xs={4}\n            align=\"right\"\n            className={classes.selectArea}\n          >\n            <TimeFilter />\n            <IconButton\n              aria-owns={open ? 'menu-appbar' : null}\n              aria-haspopup=\"true\"\n              onClick={this.handleClickedAccount}\n            >\n              <AccountIcon className={classes.accountIcon} />\n            </IconButton>\n            <Menu\n              id=\"menu-appbar\"\n              open={open}\n              onClose={this.handleClose}\n              anchorEl={anchorEl}\n              anchorOrigin={{\n                vertical: 'top',\n                horizontal: 'right',\n              }}\n              transformOrigin={{\n                vertical: 'top',\n                horizontal: 'right',\n              }}\n            >\n              <ListItem classes={{ root: classes.userMeta }} disableGutters>\n                <div>\n                  <Typography variant=\"body2\" paragraph>\n                    { profile.email }\n                  </Typography>\n                  <Typography variant=\"body1\" paragraph>\n                    { profile.points }\n                    {' '}\npoints\n                  </Typography>\n                </div>\n              </ListItem>\n              <li>\n                <MenuItem\n                  component=\"a\"\n                  href=\"/useradmin/\"\n                  target=\"_blank\"\n                >\nManage Account\n                </MenuItem>\n              </li>\n              <MenuItem onClick={this.handleLogOut}>Log out</MenuItem>\n            </Menu>\n          </Grid>\n        </Grid>\n      </header>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  dongleId: 'workerState.dongleId',\n  start: 'workerState.start',\n  end: 'workerState.end',\n  profile: 'workerState.profile',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(AppHeader));\n","export const WORKER_STATE_UPDATE = 'workerstate';\nexport const TIMELINE_SELECTION_CHANGED = 'timeline_selection_changed';\n","import { push } from 'connected-react-router';\nimport document from 'global/document';\nimport * as Types from './types';\nimport Timelineworker from '../timeline';\nimport { getDongleID } from '../url';\n\nexport function updateState(data) {\n  return {\n    type: Types.WORKER_STATE_UPDATE,\n    data\n  };\n}\n\nexport function selectRange(start, end) {\n  return (dispatch, getState) => {\n    const state = getState();\n    if (!state.workerState.dongleId) {\n      dispatch({\n        type: Types.TIMELINE_SELECTION_CHANGED,\n        start,\n        end\n      });\n      return;\n    }\n    const curPath = document.location.pathname;\n    const dongleId = getDongleID(curPath) || state.workerState.dongleId;\n    const desiredPath = urlForState(dongleId, start, end);\n\n    if (state.zoom.start !== start || state.zoom.end !== end) {\n      dispatch({\n        type: Types.TIMELINE_SELECTION_CHANGED,\n        start,\n        end\n      });\n    }\n\n    if (!state.workerState.loop.startTime\n      || !state.workerState.loop.duration\n      || state.workerState.loop.startTime < start\n      || state.workerState.loop.startTime + state.workerState.loop.duration > end\n      || state.workerState.loop.duration < end - start) {\n      Timelineworker.selectLoop(start, end - start);\n    }\n\n    if (curPath !== desiredPath) {\n      dispatch(push(desiredPath));\n    }\n  };\n}\n\nexport function selectDevice(dongleId) {\n  return (dispatch, getState) => {\n    const state = getState();\n    if (state.workerState.dongleId !== dongleId) {\n      Timelineworker.selectDevice(dongleId);\n    }\n    const curPath = document.location.pathname;\n    const desiredPath = urlForState(dongleId, state.zoom.start, state.zoom.end);\n\n    if (curPath !== desiredPath) {\n      dispatch(push(desiredPath));\n    }\n  };\n}\n\nfunction urlForState(dongleId, start, end) {\n  const path = [dongleId];\n\n  if (start && end) {\n    path.push(start);\n    path.push(end);\n  }\n\n  return `/${path.join('/')}`;\n}\n","export function filterEvent(event) {\n  return (event.type === 'disengage' || event.type === 'disengage_steer');\n}\n\nexport function formatDriveDuration(duration) {\n  const milliseconds = Math.floor((duration % 1000) / 100);\n  let seconds = Math.floor((duration / 1000) % 60);\n  let minutes = Math.floor((duration / (1000 * 60)) % 60);\n  let hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n  hours = (hours < 10) ? hours : hours;\n  minutes = (minutes < 10) ? minutes : minutes;\n  seconds = (seconds < 10) ? seconds : seconds;\n  return {\n    hours,\n    minutes,\n    seconds,\n    milliseconds,\n  };\n}\n\nexport function getDrivePoints(duration) {\n  const minutes = Math.floor(duration / (1000 * 60));\n  const points = Math.floor(minutes * 1.5); // panda\n  return points;\n}\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n\nconst styles = (theme) => ({\n  shopLink: {\n    textDecoration: 'none',\n  }\n});\n\nclass ShopButton extends Component {\n  render() {\n    return (\n      <a href={this.props.link} target=\"_blank\" className={this.props.classes.shopLink}>\n        <Button variant=\"outlined\">\n          Shop\n        </Button>\n      </a>\n    );\n  }\n}\n\nexport default withStyles(styles)(ShopButton);\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\n\nimport ShopButton from './shopButton';\n\nconst styles = (theme) => ({\n  root: {\n    display: 'flex',\n    paddingTop: '48px'\n  },\n  eon: {\n    display: 'block',\n    width: '100%',\n  },\n  content: {\n    padding: '20px 12px',\n    textAlign: 'center'\n  },\n  imageContainer: {\n    display: 'flex',\n    alignItems: 'center',\n  }\n});\n\nclass EonUpsell extends Component {\n  render() {\n    return (\n      <div className={this.props.classes.root}>\n        <Grid item xs={6} className={this.props.classes.imageContainer}>\n          <img\n            src=\"https://comma.ai/eon-offroad-transparent-01.png\"\n            className={this.props.classes.eon}\n          />\n        </Grid>\n        <Grid item xs={6} className={this.props.classes.content}>\n          <Typography>{ this.props.hook }</Typography>\n          <ShopButton link=\"https://comma.ai/shop/products/eon-dashcam-devkit/?ref=explorer\" />\n        </Grid>\n      </div>\n    );\n  }\n}\n\nexport default withStyles(styles)(EonUpsell);\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport Raven from 'raven-js';\nimport cx from 'classnames';\n\nimport {\n  withStyles,\n  Grid,\n  Button,\n  Typography,\n  FormHelperText,\n  ExpansionPanel,\n  ExpansionPanelSummary,\n  LinearProgress,\n  FormControl,\n  TextField,\n} from '@material-ui/core';\nimport Pencil from '@material-ui/icons/Edit';\n\nimport { devices as Devices } from '@commaai/comma-api';\nimport Timelineworker from '../../timeline';\nimport EonUpsell from '../Annotations/eonUpsell';\n\nconst styles = (theme) => ({\n  base: {\n    height: '100%',\n    overflowY: 'scroll',\n  },\n  device: {\n    alignItems: 'center',\n    cursor: 'pointer',\n    display: 'flex',\n    padding: 32,\n    paddingTop: 16,\n    paddingBottom: 16,\n    '&.isSelected': {\n      backgroundColor: '#171B1D',\n    }\n  },\n  deviceAvatar: {\n    backgroundColor: '#1D2225',\n    borderRadius: 30,\n    height: 46,\n    width: 46,\n  },\n  deviceInfo: {\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    marginLeft: 16,\n  },\n  deviceAlias: {},\n  deviceId: {\n    color: '#525E66',\n    fontFamily: 'MaisonNeueMono',\n  },\n\n  editDeviceIcon: {\n    color: 'white',\n    '&:hover': {\n      color: theme.palette.grey[100]\n    }\n  },\n  nameField: {\n    marginRight: theme.spacing.unit,\n  },\n  saveButton: {\n    marginRight: theme.spacing.unit,\n  },\n  textField: {\n    marginBottom: theme.spacing.unit\n  },\n});\n\nclass DeviceList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      editingDevice: null,\n      deviceAlias: '',\n      isWaitingForApi: false,\n      error: null,\n    };\n\n    this.handleAliasChange = this.handleAliasChange.bind(this);\n    this.handleAliasFieldKeyPress = this.handleAliasFieldKeyPress.bind(this);\n    this.renderDevice = this.renderDevice.bind(this);\n    this.setDeviceAlias = this.setDeviceAlias.bind(this);\n    this.toggleDeviceEdit = this.toggleDeviceEdit.bind(this);\n    this.cancelEdit = this.cancelEdit.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.selectedDevice !== this.props.selectedDevice\n        && nextProps.selectedDevice !== this.state.editingDevice) {\n      this.setState({ editingDevice: null });\n    }\n  }\n\n  toggleDeviceEdit(device) {\n    if (this.state.editingDevice === device.dongle_id) {\n      this.setState({ editingDevice: null });\n    } else {\n      this.props.handleDeviceSelected(device.dongle_id);\n      this.setState({ editingDevice: device.dongle_id, deviceAlias: device.alias });\n    }\n  }\n\n  cancelEdit() {\n    this.setState({ editingDevice: null });\n  }\n\n  handleAliasChange(e) {\n    this.setState({ deviceAlias: e.target.value });\n  }\n\n  handleAliasFieldKeyPress(dongle_id, e) {\n    if (e.key === 'Enter' && !this.state.isWaitingForApi) {\n      this.setDeviceAlias(dongle_id);\n    }\n  }\n\n  async setDeviceAlias(dongle_id) {\n    this.setState({ isWaitingForApi: true });\n    try {\n      const device = await Devices.setDeviceAlias(dongle_id, this.state.deviceAlias.trim());\n      Timelineworker.updateDevice(device);\n      this.setState({ isWaitingForApi: false, editingDevice: null });\n    } catch (e) {\n      Raven.captureException(e);\n      this.setState({ error: e.message, isWaitingForApi: false });\n    }\n  }\n\n  deviceTypePretty(deviceType) {\n    if (deviceType === 'neo') {\n      return 'EON';\n    }\n    return deviceType;\n  }\n\n  render() {\n    const { devices } = this.props;\n    const dongleId = this.props.selectedDevice;\n    let found = !dongleId;\n    let onlyHasAppDevice = true;\n    devices.forEach((device, idx) => {\n      if (device.dongle_id === dongleId) {\n        found = true;\n      }\n      onlyHasAppDevice = onlyHasAppDevice && (device.device_type !== 'neo' && device.device_type !== 'panda');\n    });\n\n    if (!found) {\n      devices.push({\n        dongle_id: dongleId,\n        shared: true,\n        alias: 'Shared device',\n      });\n    }\n\n    return (\n      <div className={this.props.classes.base}>\n        { devices.filter(this.filterDrivingDevice).map(this.renderDevice) }\n        { onlyHasAppDevice && <EonUpsell hook=\"Upgrade to an EON to augment your driving experience\" /> }\n      </div>\n    );\n  }\n\n  renderDevice(device) {\n    const { classes } = this.props;\n    const isSelected = (this.props.selectedDevice === device.dongle_id);\n    const alias = device.alias || this.deviceTypePretty(device.device_type);\n    return (\n      <div\n        key={device.dongle_id}\n        onClick={partial(this.props.handleDeviceSelected, device.dongle_id)}\n        className={cx(classes.device, [{ isSelected }])}\n      >\n        <div className={classes.deviceAvatar} />\n        <div className={classes.deviceInfo}>\n          <Typography variant=\"body2\" className={classes.deviceAlias}>\n            { alias }\n          </Typography>\n          <Typography variant=\"caption\" className={classes.deviceId}>\n            (\n            { device.dongle_id }\n)\n          </Typography>\n        </div>\n      </div>\n    );\n\n    const oldRender = (\n      <ExpansionPanel\n        classes={{ expanded: classes.expanded }}\n        key={device.dongle_id}\n        expanded={this.props.selectedDevice === device.dongle_id}\n        onChange={partial(this.props.handleDeviceSelected, device.dongle_id)}\n        className={classes.expansion}\n      >\n        <ExpansionPanelSummary>\n          <Grid container>\n            <Grid item xs={10}>\n              { this.state.editingDevice === device.dongle_id\n                ? (\n                  <>\n                    { this.state.isWaitingForApi && <LinearProgress /> }\n                    { this.state.error !== null && <FormHelperText error>{ this.state.error }</FormHelperText> }\n                    <TextField\n                      id=\"name\"\n                      label=\"Name\"\n                      className={classes.textField}\n                      value={this.state.deviceAlias}\n                      onChange={this.handleAliasChange}\n                      onKeyPress={partial(this.handleAliasFieldKeyPress, device.dongle_id)}\n                    />\n                  </>\n                )\n                : (\n                  <Typography className={classes.deviceListItemName}>\n                    { (`${alias} (${device.dongle_id})`) }\n                  </Typography>\n                )}\n            </Grid>\n            { (!device.shared && (device.is_owner || this.props.isSuperUser))\n              && (\n              <Grid item xs={2}>\n                <Pencil className={classes.editDeviceIcon} onClick={partial(this.toggleDeviceEdit, device)} />\n              </Grid>\n              )}\n            { this.state.editingDevice === device.dongle_id\n              && (\n                <>\n                  <Grid item xs={6}>\n                    <Button\n                      variant=\"outlined\"\n                      onClick={partial(this.setDeviceAlias, device.dongle_id)}\n                      className={classes.saveButton}\n                    >\n                    Save\n                    </Button>\n                  </Grid>\n                  <Grid item xs={6}>\n                    <Button variant=\"outlined\" onClick={this.cancelEdit}>\n                    Cancel\n                    </Button>\n                  </Grid>\n                </>\n              )}\n          </Grid>\n        </ExpansionPanelSummary>\n      </ExpansionPanel>\n    );\n  }\n\n  filterDrivingDevice(device) {\n    return device.device_type !== 'panda';\n  }\n}\n\nconst stateToProps = Obstruction({\n  devices: 'workerState.devices',\n  isSuperUser: 'workerState.profile.superuser',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DeviceList));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport Raven from 'raven-js';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport Modal from '@material-ui/core/Modal';\nimport Paper from '@material-ui/core/Paper';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\n\nimport CheckIcon from '@material-ui/icons/Check';\nimport SaveIcon from '@material-ui/icons/Save';\nimport ShareIcon from '@material-ui/icons/Share';\n\nimport { devices as Devices } from '@commaai/comma-api';\nimport Timelineworker from '../../timeline';\n\nconst styles = (theme) => ({\n  modal: {\n    position: 'absolute',\n    padding: theme.spacing.unit * 2,\n    width: theme.spacing.unit * 50,\n    left: '50%',\n    top: '40%',\n    transform: 'translate(-50%, -50%)'\n  },\n  textField: {\n  },\n  buttonGroup: {\n    textAlign: 'right'\n  },\n  form: {\n    paddingTop: theme.spacing.unit,\n    paddingBottom: theme.spacing.unit\n  },\n  formRow: {\n    minHeight: 75\n  },\n  fabProgress: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    zIndex: 1,\n  },\n  wrapper: {\n    margin: theme.spacing.unit,\n    position: 'relative',\n    display: 'inline-block'\n  }\n});\n\nclass DeviceSettingsModal extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      deviceAlias: '',\n      loadingDeviceAlias: false,\n      loadingDeviceShare: false,\n      hasSavedAlias: false,\n      shareEmail: ''\n    };\n\n    this.handleAliasChange = this.handleAliasChange.bind(this);\n    this.handleEmailChange = this.handleEmailChange.bind(this);\n    this.callOnEnter = this.callOnEnter.bind(this);\n    this.setDeviceAlias = this.setDeviceAlias.bind(this);\n    this.shareDevice = this.shareDevice.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.device && nextProps.device.alias !== this.state.deviceAlias) {\n      this.setState({ deviceAlias: nextProps.device.alias });\n    }\n  }\n\n  handleAliasChange(e) {\n    this.setState({\n      deviceAlias: e.target.value,\n      hasSavedAlias: e.target.value === this.props.device.dongle_id ? this.state.hasSavedAlias : false\n    });\n  }\n\n  handleEmailChange(e) {\n    this.setState({\n      shareEmail: e.target.value,\n      hasShared: false\n    });\n  }\n\n  callOnEnter(method, e) {\n    if (e.key === 'Enter') {\n      method();\n    }\n  }\n\n  async setDeviceAlias() {\n    const { dongle_id } = this.props.device;\n\n    if (this.state.loadingDeviceAlias) {\n      return;\n    }\n\n    this.setState({\n      loadingDeviceAlias: true,\n      hasSavedAlias: false\n    });\n    try {\n      const device = await Devices.setDeviceAlias(dongle_id, this.state.deviceAlias.trim());\n      Timelineworker.updateDevice(device);\n      this.setState({\n        loadingDeviceAlias: false,\n        hasSavedAlias: true\n      });\n    } catch (e) {\n      Raven.captureException(e);\n      this.setState({ error: e.message, loadingDeviceAlias: false });\n    }\n  }\n\n  async shareDevice() {\n    if (this.state.loadingDeviceShare) {\n      return;\n    }\n\n    const { dongle_id } = this.props.device;\n    const email = this.state.shareEmail;\n\n    this.setState({\n      loadingDeviceShare: true,\n      hasShared: false\n    });\n    try {\n      await Devices.grantDeviceReadPermission(dongle_id, this.state.shareEmail.trim());\n      this.setState({\n        loadingDeviceShare: false,\n        shareEmail: '',\n        hasShared: true\n      });\n    } catch (e) {\n      const err = e;\n      console.log(e, err);\n      console.log(err.statusCode);\n      debugger;\n      Raven.captureException(e);\n      this.setState({ error: e.message, loadingDeviceShare: false });\n    }\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <Modal\n        aria-labelledby=\"device-settings-modal\"\n        aria-describedby=\"device-settings-modal-description\"\n        open={this.props.isOpen}\n        onClose={this.props.onClose}\n      >\n        <Paper className={classes.modal}>\n          <Typography variant=\"title\">\n            Edit Device\n          </Typography>\n          <Divider />\n          <div className={classes.form}>\n            <div className={classes.formRow}>\n              <TextField\n                id=\"device_alias\"\n                label=\"Device Name\"\n                className={classes.textField}\n                value={this.state.deviceAlias}\n                onChange={this.handleAliasChange}\n                onKeyPress={partial(this.callOnEnter, this.setDeviceAlias)}\n              />\n              { (this.props.device.alias !== this.state.deviceAlias || this.state.hasSavedAlias)\n                  && (\n                  <div className={classes.wrapper}>\n                    <IconButton\n                      variant=\"fab\"\n                      onClick={this.setDeviceAlias}\n                    >\n                      { this.state.hasSavedAlias && <CheckIcon /> || <SaveIcon /> }\n                    </IconButton>\n                    {this.state.loadingDeviceAlias && <CircularProgress size={48} className={classes.fabProgress} />}\n                  </div>\n                  )}\n            </div>\n            <div className={classes.formRow}>\n              <TextField\n                id=\"device_share\"\n                label=\"Share by Email\"\n                className={classes.textField}\n                value={this.state.shareEmail}\n                onChange={this.handleEmailChange}\n                onKeyPress={partial(this.callOnEnter, this.shareDevice)}\n              />\n              { (this.state.shareEmail.length > 0 || this.state.hasShared)\n                  && (\n                  <div className={classes.wrapper}>\n                    <IconButton\n                      variant=\"fab\"\n                      onClick={this.shareDevice}\n                    >\n                      { this.state.hasShared && <CheckIcon /> || <ShareIcon /> }\n                    </IconButton>\n                    {this.state.loadingDeviceShare && <CircularProgress size={48} className={classes.fabProgress} />}\n                  </div>\n                  )}\n            </div>\n          </div>\n          <div className={classes.buttonGroup}>\n            <Button variant=\"contained\" onClick={this.props.onClose}>\n              Close\n            </Button>\n            &nbsp;\n          </div>\n        </Paper>\n      </Modal>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  device: 'workerState.device',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DeviceSettingsModal));\n","import Raven from 'raven-js';\n\nexport const MAPBOX_TOKEN = process.env.REACT_APP_MAPBOX_TOKEN;\n\nconst mbxGeocoding = require('@mapbox/mapbox-sdk/services/geocoding');\n\nlet geocodingClient = null;\nif (MAPBOX_TOKEN) {\n  geocodingClient = mbxGeocoding({\n    accessToken: MAPBOX_TOKEN\n  });\n} else {\n  console.warn('Missing mapbox token');\n}\n\nexport default function geocodeApi() {\n  function getNeighborhood(context) {\n    return (context.id.indexOf('neighborhood') !== -1);\n  }\n\n  function getLocality(context) {\n    return (context.id.indexOf('place') !== -1);\n  }\n\n  function getRegion(context) {\n    return (context.id.indexOf('region') !== -1);\n  }\n\n  return {\n    async reverseLookup(coords) {\n      if (geocodingClient === null) {\n        return null;\n      }\n\n      const response = await geocodingClient.reverseGeocode({\n        query: [coords[0], coords[1]],\n        limit: 1,\n      }).send();\n\n      try {\n        const { features } = response.body;\n        if (features[0].context) {\n          let region = features[0].context.filter(getRegion)[0].short_code;\n          if (region.indexOf('US-') !== -1) { region = region.substr(3); }\n          const locality = features[0].context.filter(getLocality)[0].text;\n          const _neighborhood = features[0].context.filter(getNeighborhood)[0];\n          const neighborhood = _neighborhood ? _neighborhood.text : locality;\n\n          return {\n            region,\n            locality,\n            neighborhood,\n          };\n        }\n      } catch (err) {\n        Raven.captureException(err);\n      }\n    }\n  };\n}\n","import React from 'react';\nimport { partial } from 'ap';\n\nconst gutter = 0;\n\nfunction renderImage(imgStyles, data, i) {\n  if (data.blank) {\n    return (\n      <div\n        key={i}\n        className=\"thumbnailImage blank\"\n        style={{\n          ...imgStyles,\n          width: imgStyles.width * data.length,\n        }}\n      />\n    );\n  }\n  return (\n    <div\n      key={i}\n      className=\"thumbnailImage images\"\n      style={{\n        ...imgStyles,\n        width: imgStyles.width * data.length,\n        marginLeft: gutter,\n        backgroundSize: `auto ${imgStyles.height}px`,\n        backgroundRepeat: 'repeat-x',\n        backgroundImage: `url(${data.url})`,\n        backgroundPosition: `${data.startImage * imgStyles.width}px`\n      }}\n    />\n  );\n}\n\nexport default function Thumbnails(props) {\n  const { thumbnail } = props;\n  const imgStyles = {\n    display: 'inline-block',\n    height: thumbnail.height,\n    width: (1164 / 874) * thumbnail.height,\n  };\n  // console.log('Thumbnail props', props);\n  const imgCount = Math.ceil(thumbnail.width / imgStyles.width);\n  imgStyles.marginRight = gutter / 2;\n\n  const imgArr = [];\n  let currentSegment = null;\n\n  if (!Number.isFinite(imgCount)) {\n    return [];\n  }\n  for (let i = 0; i < imgCount; ++i) {\n    const offset = props.percentToOffset((i + 0.5) / imgCount);\n    const segment = props.getCurrentSegment(offset);\n    if (!segment) {\n      if (currentSegment && !currentSegment.blank) {\n        imgArr.push(currentSegment);\n        currentSegment = null;\n      }\n      if (!currentSegment) {\n        currentSegment = {\n          blank: true,\n          length: 0\n        };\n      }\n      currentSegment.length += 1;\n    } else {\n      // 12 per file, 5s each\n      let seconds = Math.floor((offset - segment.routeOffset) / 1000);\n      const url = `${segment.url}/${segment.segment}/sprite.jpg`;\n      seconds %= 60;\n\n      if (currentSegment && (currentSegment.blank || currentSegment.segment !== segment.segment)) {\n        imgArr.push(currentSegment);\n        currentSegment = null;\n      }\n\n      const imageIndex = Math.floor(seconds / 5);\n\n      if (currentSegment) {\n        if (imageIndex === currentSegment.endImage + 1) {\n          currentSegment.endImage = imageIndex;\n        } else {\n          imgArr.push(currentSegment);\n          currentSegment = null;\n        }\n      }\n\n      if (!currentSegment) {\n        currentSegment = {\n          segment: segment.segment,\n          startOffset: seconds,\n          startImage: imageIndex,\n          endImage: imageIndex,\n          length: 0,\n          url\n        };\n      }\n\n      currentSegment.length += 1;\n      currentSegment.endOffset = seconds;\n    }\n  }\n\n  if (currentSegment) {\n    imgArr.push(currentSegment);\n  }\n\n  return imgArr.map(partial(renderImage, imgStyles));\n}\n","const Colors = {\n  transparent: 'transparent',\n  white: '#fff',\n  white10: 'rgba(255, 255, 255, 0.1)',\n  white12: 'rgba(255, 255, 255, 0.12)',\n  white20: 'rgba(255, 255, 255, 0.2)',\n  white30: 'rgba(255, 255, 255, 0.3)',\n  white40: 'rgba(255, 255, 255, 0.4)',\n  white50: 'rgba(255, 255, 255, 0.5)',\n  black: '#030404',\n  blue50: '#258FDA',\n  blue100: '#2284c9',\n  blue200: '#1f79b8',\n  blue300: '#1c6ea8',\n  blue400: '#1a6397',\n  blue500: '#175886',\n  blue600: '#144d75',\n  blue700: '#114265',\n  blue800: '#0e3754',\n  blue900: '#0b2c43',\n  blue950: '#061622',\n  blue999: '#030b11',\n  lightBlue50: '#eef6fc',\n  lightBlue100: '#ddeef9',\n  lightBlue200: '#cde5f6',\n  lightBlue300: '#bcddf4',\n  lightBlue400: '#abd4f1',\n  lightBlue500: '#9acbee',\n  lightBlue600: '#8ac3eb',\n  lightBlue700: '#79bae8',\n  lightBlue800: '#68b1e5',\n  lightBlue900: '#57a9e3',\n  desatBlue800: '#657f92',\n  red50: '#da2535',\n  red100: '#c92231',\n  red200: '#b81f2d',\n  red300: '#971a25',\n  red400: '#861721',\n  red500: '#75141d',\n  red600: '#651118',\n  red700: '#540e14',\n  red800: '#430b10',\n  red900: '#32090c',\n  lightRed50: '#fceeef',\n  lightRed100: '#f9dde0',\n  lightRed200: '#f6cdd0',\n  lightRed300: '#f4bcc1',\n  lightRed400: '#f1abb1',\n  lightRed500: '#ee9aa2',\n  lightRed600: '#eb8a92',\n  lightRed700: '#e87983',\n  lightRed800: '#e56873',\n  lightRed900: '#e35764',\n  lightRed950: '#e04754',\n  lightRed999: '#dd3645',\n  green50: '#22c967',\n  green100: '#20b85f',\n  green200: '#1da756',\n  green300: '#1a974e',\n  green400: '#178645',\n  green500: '#14753c',\n  green600: '#116534',\n  green700: '#0e542b',\n  green800: '#0c4323',\n  green900: '#09321a',\n  lightGreen50: '#eefcf4',\n  lightGreen100: '#def9e9',\n  lightGreen200: '#cdf6de',\n  lightGreen300: '#bcf4d3',\n  lightGreen400: '#abf1c8',\n  lightGreen500: '#9beebd',\n  lightGreen600: '#8aebb2',\n  lightGreen700: '#79e8a7',\n  lightGreen800: '#68e59c',\n  lightGreen900: '#25da70',\n  orange50: '#da6f25',\n  orange100: '#c96722',\n  orange200: '#b85e1f',\n  orange300: '#a7551c',\n  orange400: '#964d19',\n  orange500: '#864417',\n  orange600: '#753c14',\n  orange700: '#643311',\n  orange800: '#532b0e',\n  orange900: '#42220b',\n  lightOrange50: '#fcf4ee',\n  lightOrange100: '#f9e8dd',\n  lightOrange200: '#f6ddcc',\n  lightOrange200: '#f4d2bb',\n  lightOrange300: '#f1c7aa',\n  lightOrange400: '#eebc9a',\n  lightOrange500: '#ebb189',\n  lightOrange600: '#e8a678',\n  lightOrange700: '#e59b67',\n  lightOrange800: '#e08546',\n  lightOrange900: '#dd7a35',\n  yellow50: '#f1ebaa',\n  yellow100: '#eee79a',\n  yellow200: '#ebe389',\n  yellow300: '#e8df78',\n  yellow400: '#e5db67',\n  yellow500: '#e3d756',\n  yellow600: '#e0d346',\n  yellow700: '#ddcf35',\n  yellow800: '#daca25',\n  yellow900: '#c9bb22',\n  grey50: '#6e7d84',\n  grey100: '#65737a',\n  grey200: '#5c696f',\n  grey300: '#535f64',\n  grey400: '#4b5559',\n  grey500: '#424a4f',\n  grey600: '#394044',\n  grey700: '#303639',\n  grey800: '#272c2f',\n  grey900: '#1e2224',\n  grey950: '#151819',\n  grey999: '#0c0e0f',\n  lightGrey50: '#f8f9f9',\n  lightGrey100: '#eeeff0',\n  lightGrey200: '#e3e6e8',\n  lightGrey300: '#d8dcdf',\n  lightGrey400: '#cdd3d6',\n  lightGrey500: '#c3c9cd',\n  lightGrey600: '#b8c0c4',\n  lightGrey700: '#adb6bb',\n  lightGrey800: '#a3adb2',\n  lightGrey900: '#98a3a9',\n  lightGrey950: '#8d9aa1',\n  lightGrey999: '#77878f',\n};\n\nexport default Colors;\n","import { createMuiTheme } from '@material-ui/core/styles';\nimport Colors from './colors';\nimport { ChevronIcon } from './icons';\n\nconst theme = createMuiTheme({\n  typography: {\n    fontFamily: 'MaisonNeue',\n  },\n  overrides: {\n    MuiPaper: {\n      root: {\n        backgroundColor: '#30373B'\n      },\n    },\n    MuiSelect: {\n      select: {\n        padding: '12px',\n        paddingRight: '48px',\n        margin: '0px',\n        '&>div': {\n          margin: '0',\n        }\n      },\n      selectMenu: {\n        paddingRight: 54,\n      },\n      icon: {\n        marginRight: 20,\n        color: '#272D30'\n      }\n    },\n    MuiInput: {\n      root: {\n        position: 'relative',\n        border: `1px solid ${Colors.grey800}`,\n        borderRadius: 20,\n        overflow: 'hidden'\n      },\n      input: {\n        padding: '12px 16px',\n        '&::placeholder': {\n          opacity: 1,\n          color: Colors.white30\n        }\n      }\n    },\n    MuiFormLabel: {\n      root: {\n        marginLeft: 16,\n        marginTop: 4\n      }\n    },\n    MuiTab: {\n      root: {\n        minHeight: 40,\n      }\n    },\n  },\n  props: {\n    MuiSelect: {\n      disableUnderline: true,\n      IconComponent: ChevronIcon\n    },\n    MuiInput: {\n      disableUnderline: true\n    }\n  },\n  palette: {\n    type: 'dark',\n    placeholder: Colors.white30,\n    background: {\n      default: Colors.grey999\n    },\n    primary: {\n      light: Colors.grey50,\n      main: Colors.grey900,\n      dark: Colors.grey999\n    },\n    states: {\n      drivingBlue: Colors.blue500,\n      engagedGreen: Colors.green400,\n      alertOrange: Colors.orange50,\n      alertRed: Colors.red100,\n    },\n    grey: {\n      50: Colors.grey50,\n      100: Colors.grey100,\n      200: Colors.grey200,\n      300: Colors.grey300,\n      400: Colors.grey400,\n      500: Colors.grey500,\n      600: Colors.grey600,\n      700: Colors.grey700,\n      800: Colors.grey800,\n      900: Colors.grey900,\n      950: Colors.grey950,\n      999: Colors.grey999\n    },\n    lightGrey: {\n      200: Colors.lightGrey200,\n    },\n    white: {\n      10: Colors.white10,\n      12: Colors.white12,\n      20: Colors.white20,\n      30: Colors.white30,\n      40: Colors.white40,\n      50: Colors.white50,\n    },\n    error: {\n      main: 'rgba(209,106,35,0.72)'\n    }\n  }\n});\n\nexport default theme;\n","// timeline minimap\n// rapidly change high level timeline stuff\n// rapid seeking, etc\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { withStyles } from '@material-ui/core/styles';\nimport raf from 'raf';\nimport debounce from 'debounce';\nimport document from 'global/document';\nimport fecha from 'fecha';\nimport cx from 'classnames';\nimport { partial } from 'ap';\nimport PropTypes from 'prop-types';\n\nimport Measure from 'react-measure';\nimport Tooltip from '@material-ui/core/Tooltip';\n\nimport Thumbnails from './thumbnails';\nimport theme from '../../theme';\nimport TimelineWorker from '../../timeline';\nimport Segments from '../../timeline/segments';\nimport { selectRange } from '../../actions';\n\nconst styles = (/* theme */) => ({\n  base: {\n    backgroundColor: '#1D2225',\n    minHeight: '32px',\n    overflow: 'hidden',\n    position: 'relative',\n    width: '100%',\n    '&.hasThumbnails.hasRuler': {\n      minHeight: '80px',\n    },\n  },\n  rounded: {\n    borderRadius: '10px 10px 0px 0px'\n  },\n  segments: {\n    position: 'absolute',\n    top: '0px',\n    left: '0px',\n    width: '100%',\n    height: '100%',\n    '&.hasThumbnails': {\n      height: '40%'\n    },\n    '&.hasThumbnails.hasRuler': {\n      height: '100%',\n    },\n  },\n  segment: {\n    position: 'relative',\n    height: '100%',\n    background: theme.palette.states.drivingBlue,\n  },\n  ruler: {\n    background: '#272D30d9',\n    bottom: 0,\n    position: 'absolute',\n    top: 12,\n    width: '100%',\n  },\n  rulerRemaining: {\n    background: '#1D2225',\n    borderLeft: '1px solid #D8DDDF',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    height: '100%',\n    opacity: 0.45,\n    pointerEvents: 'none',\n    width: '100%',\n  },\n  statusGradient: {\n    background: 'linear-gradient(rgba(0, 0, 0, 0.0) 4%, rgba(255, 255, 255, 0.025) 10%, rgba(0, 0, 0, 0.1) 25%, rgba(0, 0, 0, 0.4))',\n    height: 12,\n    left: 0,\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  },\n  segmentColor: {\n    position: 'absolute',\n    display: 'inline-block',\n    height: '100%',\n    width: '100%',\n    '&.active': {},\n    '&.engage': {\n      background: theme.palette.states.engagedGreen,\n    },\n    '&.alert': {\n      '&.userPrompt': {\n        background: theme.palette.states.alertOrange,\n      },\n      '&.critical': {\n        background: theme.palette.states.alertRed,\n      }\n    }\n  },\n  uncoloredSegment: {\n    background: theme.palette.states.drivingBlue,\n    height: '100%',\n    width: '100%',\n  },\n  hoverBead: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: 50,\n    height: '100%'\n  },\n  dragHighlight: {\n    background: 'rgba(255, 255, 255, 0.1)',\n    position: 'absolute',\n    height: '100%',\n  },\n  thumbnails: {\n    position: 'absolute',\n    height: '60%',\n    top: 12,\n    width: '100%',\n    whiteSpace: 'nowrap',\n    userSelect: 'none',\n    '& img': {\n      pointerEvents: 'none',\n    },\n    '&.hasRuler': {\n      height: '30%',\n    },\n    '& > div': {\n      display: 'inline-block'\n    }\n  },\n});\n\nconst AlertStatusCodes = [\n  'normal',\n  'userPrompt',\n  'critical'\n];\n\nfunction percentFromMouseEvent(e) {\n  const boundingBox = e.currentTarget.getBoundingClientRect();\n  const x = e.pageX - boundingBox.left;\n  return x / boundingBox.width;\n}\n\nclass Timeline extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getOffset = this.getOffset.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.handleMouseLeave = this.handleMouseLeave.bind(this);\n    this.percentToOffset = this.percentToOffset.bind(this);\n    this.renderSegment = this.renderSegment.bind(this);\n    this.sendSeek = debounce(this.sendSeek.bind(this), 1000 / 60);\n\n\n    this.offsetValue = React.createRef();\n    this.rulerRemaining = React.createRef();\n    this.rulerRemainingHovered = React.createRef();\n    this.dragBar = React.createRef();\n    this.hoverBead = React.createRef();\n    // this.canvas_speed = React.createRef();\n    const { zoomOverride, zoom } = this.props;\n    this.state = {\n      dragStart: null,\n      zoom: zoomOverride || zoom,\n      mouseX: 0,\n      hoverPercent: 0,\n      isHovered: false,\n      thumbnail: {\n        height: 0,\n        width: 0\n      }\n    };\n  }\n\n  componentWillMount() {\n    document.addEventListener('mouseup', this.handleMouseUp, false);\n    this.stopListening = TimelineWorker.onIndexed(() => this.forceUpdate());\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    raf(this.getOffset);\n  }\n\n  componentWillReceiveProps(props) {\n    this.setState({\n      zoom: props.zoomOverride || props.zoom\n    });\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    document.removeEventListener('mouseup', this.handleMouseUp, false);\n    this.stopListening();\n  }\n\n  getOffset() {\n    if (!this.mounted) {\n      return;\n    }\n    raf(this.getOffset);\n    let offset = TimelineWorker.currentOffset();\n    if (this.seekIndex) {\n      offset = this.seekIndex;\n    }\n    offset = Math.floor(offset);\n    const percent = this.offsetToPercent(offset);\n    if (this.rulerRemaining.current && this.rulerRemaining.current.parentElement) {\n      this.rulerRemaining.current.style.left = `${Math.floor(10000 * percent) / 100}%`;\n    }\n    const { isHovered } = this.state;\n    if (!isHovered\n      && this.rulerRemainingHovered.current\n      && this.rulerRemainingHovered.current.parentElement) {\n      this.rulerRemainingHovered.current.style.left = `${Math.floor(10000 * percent) / 100}%`;\n    }\n  }\n\n  handleClick(e) {\n    if (this.isDragSelecting) {\n      console.log('Is a drag event');\n      this.isDragSelecting = false;\n      return;\n    }\n    const { noseek } = this.props;\n    if (noseek) {\n      return;\n    }\n    const percent = percentFromMouseEvent(e);\n\n    TimelineWorker.seek(this.percentToOffset(percent));\n  }\n\n  handleMouseDown(e) {\n    const { classes, dragSelection } = this.props;\n    if (!dragSelection) {\n      return;\n    }\n    // make sure they're clicking & dragging and not just moving the mouse around\n    if (e.currentTarget.parentElement.querySelector(`.${classes.base}:active`) !== e.currentTarget) {\n      return;\n    }\n\n    const percent = percentFromMouseEvent(e);\n    this.setState({\n      dragStart: percent,\n      dragEnd: percent\n    });\n  }\n\n  handleMouseUp(e) {\n    const { dragStart, dragEnd } = this.state;\n    const { dragSelection } = this.props;\n    if (!dragSelection) {\n      return;\n    }\n    if (!dragStart) {\n      return;\n    }\n    const selectedArea = Math.abs(dragStart - dragEnd) * 100;\n    const startPercent = Math.min(dragStart, dragEnd);\n    const endPercent = Math.max(dragStart, dragEnd);\n    const startOffset = Math.round(this.percentToOffset(startPercent));\n    const endOffset = Math.round(this.percentToOffset(endPercent));\n\n    if (selectedArea > 0.1) {\n      const currentOffset = TimelineWorker.currentOffset();\n      if (currentOffset < startOffset || currentOffset > endOffset) {\n        TimelineWorker.seek(startOffset);\n      }\n      const { start, dispatch } = this.props;\n      const startTime = startOffset + start;\n      const endTime = endOffset + start;\n\n      this.isDragSelecting = true;\n      setTimeout(() => { this.isDragSelecting = false; });\n      dispatch(selectRange(startTime, endTime));\n    } else if (e.currentTarget !== document) {\n      this.handleClick(e);\n    }\n\n    this.setState({\n      dragStart: null,\n      dragEnd: null\n    });\n  }\n\n  handleMouseMove(e) {\n    const boundingBox = e.currentTarget.getBoundingClientRect();\n    const x = e.pageX - boundingBox.left;\n    const percent = x / boundingBox.width;\n\n    this.setState({\n      mouseX: x,\n      hoverPercent: percent,\n      isHovered: true,\n    });\n\n    // mouseover highlight\n    if (this.rulerRemainingHovered.current && this.rulerRemainingHovered.current.parentElement) {\n      let { hoverPercent } = this.state;\n      hoverPercent = (hoverPercent * 100).toFixed(2);\n      this.rulerRemainingHovered.current.style.left = `${hoverPercent}%`;\n    }\n\n    const { classes, dragSelection } = this.props;\n    const { dragStart } = this.state;\n    // drag highlight\n    if (e.currentTarget.parentElement.querySelector(`.${classes.base}:active`) !== e.currentTarget) {\n      return; // ignore mouseover\n    }\n    if (!dragSelection) {\n      this.seekIndex = this.percentToOffset(percent);\n      this.sendSeek();\n    } if (dragStart) {\n      this.setState({\n        dragEnd: percent\n      });\n    }\n    // do other things for drag selection!\n  }\n\n  handleMouseLeave() {\n    this.setState({ isHovered: false });\n  }\n\n  percentToOffset(perc) {\n    const { zoom } = this.state;\n    const { zoomed, range, start } = this.props;\n    if (zoomed) {\n      return perc * (zoom.end - zoom.start) + (zoom.start - start);\n    }\n    return perc * range;\n  }\n\n  offsetToPercent(offset) {\n    const { zoom } = this.state;\n    const { zoomed, range, start } = this.props;\n    if (zoomed) {\n      return (offset - (zoom.start - start)) / (zoom.end - zoom.start);\n    }\n    return offset / range;\n  }\n\n  sendSeek() {\n    if (this.seekIndex) {\n      TimelineWorker.seek(this.seekIndex);\n      this.seekIndex = null;\n    }\n  }\n\n  renderDragger() {\n    const { dragStart, dragEnd } = this.state;\n    const { dragSelection, classes } = this.props;\n    if (!dragSelection || !dragStart) {\n      return [];\n    }\n    const draggerStyle = {\n      left: `${100 * Math.min(dragStart, dragEnd)}%`,\n      width: `${100 * Math.abs(dragStart - dragEnd)}%`,\n    };\n    return (\n      <div\n        ref={this.dragBar}\n        className={classes.dragHighlight}\n        style={draggerStyle}\n      />\n    );\n  }\n\n  renderZoom() {\n    const {\n      zoom, dragSelection, zoomed, start, range\n    } = this.props;\n    if (!dragSelection || !zoom.expanded || zoomed) {\n      return [];\n    }\n    const color = `${theme.palette.grey[50]}cc`;\n    const endColor = `${theme.palette.grey[200]}aa`;\n    const zoomStart = (zoom.start - start) / range;\n    const zoomEnd = (zoom.end - start) / range;\n    const barStyle = {\n      background: `linear-gradient(to left,${color},${endColor},${color})`,\n      left: `${100 * Math.min(zoomStart, zoomEnd)}%`,\n      width: `${100 * Math.abs(zoomStart - zoomEnd)}%`,\n    };\n    return (\n      <div\n        style={barStyle}\n      />\n    );\n  }\n\n  renderSegment(segment) {\n    const {\n      classes, range, zoomed, start, colored\n    } = this.props;\n    const { zoom } = this.state;\n    let startPerc = (100 * segment.offset) / range;\n    let widthPerc = (100 * segment.duration) / range;\n    if (zoomed) {\n      const startOffset = zoom.start - start;\n      const endOffset = zoom.end - start;\n      const zoomDuration = endOffset - startOffset;\n      if (segment.offset > endOffset) {\n        return [];\n      }\n      if (segment.offset + segment.duration < startOffset) {\n        return [];\n      }\n      startPerc = (100 * (segment.offset - startOffset)) / zoomDuration;\n      widthPerc = (100 * segment.duration) / zoomDuration;\n    }\n    const style = {\n      position: 'absolute',\n      width: `${widthPerc}%`,\n      left: `${startPerc}%`,\n    };\n    return (\n      <div\n        key={segment.route + segment.offset}\n        className={classes.segment}\n        style={style}\n      >\n        { colored ? this.renderSegmentEvents(segment) : (\n          <div className={classes.uncoloredSegment} />\n        ) }\n      </div>\n    );\n  }\n\n  renderSegmentEvents(segment) {\n    const { classes } = this.props;\n    return segment.events\n      .filter((event) => event.data && event.data.end_route_offset_millis)\n      .map((event) => {\n        const style = {\n          left: `${(event.route_offset_millis / segment.duration) * 100}%`,\n          width: `${((event.data.end_route_offset_millis - event.route_offset_millis) / segment.duration) * 100}%`,\n        };\n        if (localStorage.showCurrentEvent) {\n          const time = TimelineWorker.currentOffset();\n          const eventStart = event.route_offset_millis + segment.offset;\n          const eventEnd = event.data.end_route_offset_millis + segment.offset;\n          if (time > eventStart && time < eventEnd) {\n            console.log('Current event:', event);\n          }\n        }\n        return (\n          <div\n            key={segment.route + event.time + event.type}\n            style={style}\n            className={cx(classes.segmentColor, event.type, {\n              [`${AlertStatusCodes[event.data.alertStatus]}`]: event.data.alertStatus,\n            })}\n          />\n        );\n      });\n  }\n\n  render() {\n    const {\n      classes,\n      hasThumbnails,\n      tooltipped,\n      hasRuler,\n      start,\n      className,\n      style,\n      rounded,\n      segments,\n      hasGradient\n    } = this.props;\n    const { hoverPercent, thumbnail, mouseX } = this.state;\n    const hoverOffset = this.percentToOffset(hoverPercent);\n    let timeString = null;\n    if (tooltipped) {\n      if (Number.isNaN(hoverOffset)) {\n        timeString = 'N/A';\n      } else {\n        const timestampAtOffset = start + hoverOffset;\n        timeString = fecha.format(timestampAtOffset, 'M/D HH:mm:ss');\n      }\n    }\n    return (\n      <div\n        className={className}\n        style={style}\n      >\n        <div\n          role=\"presentation\"\n          className={cx(classes.base, {\n            rounded,\n            hasRuler,\n            hasThumbnails,\n          })}\n          onMouseDown={this.handleMouseDown}\n          onMouseUp={this.handleMouseUp}\n          onMouseMove={this.handleMouseMove}\n          onMouseLeave={this.handleMouseLeave}\n          onClick={this.handleClick}\n        >\n          <div className={cx(classes.segments, { hasThumbnails, hasRuler })}>\n            { segments && segments.map(this.renderSegment) }\n            { hasRuler && (\n              <div className={classes.ruler}>\n                <div\n                  ref={this.rulerRemaining}\n                  className={classes.rulerRemaining}\n                />\n                <div\n                  ref={this.rulerRemainingHovered}\n                  className={classes.rulerRemaining}\n                />\n              </div>\n            ) }\n            { hasGradient && (\n              <div\n                className={cx(classes.statusGradient, {\n                  hasRuler,\n                })}\n              />\n            ) }\n            { this.renderDragger() }\n            { this.renderZoom() }\n          </div>\n          { tooltipped\n            && (\n            <Tooltip title={timeString}>\n              <div\n                ref={this.hoverBead}\n                className={classes.hoverBead}\n                style={{ left: mouseX - 25 }}\n              />\n            </Tooltip>\n            )}\n          { hasThumbnails\n            && (\n            <Measure\n              bounds\n              onResize={(rect) => this.setState({ thumbnail: rect.bounds })}\n            >\n              { (options) => (\n                <div\n                  ref={options.measureRef}\n                  className={cx(classes.thumbnails, {\n                    hasRuler,\n                  })}\n                >\n                  <Thumbnails\n                    getCurrentSegment={partial(Segments.getCurrentSegment, this.props)}\n                    percentToOffset={this.percentToOffset}\n                    thumbnail={thumbnail}\n                    className={classes.thumbnail}\n                    hasRuler={hasRuler}\n                  />\n                </div>\n              )}\n            </Measure>\n            )}\n        </div>\n      </div>\n    );\n  }\n}\n\nTimeline.propTypes = {\n  zoom: PropTypes.object.isRequired,\n  zoomOverride: PropTypes.object,\n  zoomed: PropTypes.bool,\n  colored: PropTypes.bool,\n  start: PropTypes.number.isRequired,\n  range: PropTypes.number.isRequired,\n  classes: PropTypes.object.isRequired,\n  dragSelection: PropTypes.bool,\n  hasThumbnails: PropTypes.bool,\n  hasRuler: PropTypes.bool,\n  tooltipped: PropTypes.bool,\n  hasGradient: PropTypes.bool,\n  rounded: PropTypes.bool,\n  segments: PropTypes.array.isRequired,\n  className: PropTypes.string,\n  style: PropTypes.object,\n  dispatch: PropTypes.func.isRequired,\n  noseek: PropTypes.bool,\n};\n\nfunction mapStateToProps(state) {\n  return {\n    ...state.workerState,\n    zoom: state.zoom\n  };\n}\n\nexport default connect(mapStateToProps)(withStyles(styles)(Timeline));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\nimport { classNames } from 'react-extras';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\n\nimport { selectRange } from '../../actions';\nimport { formatDriveDuration, getDrivePoints } from '../../utils';\nimport GeocodeApi from '../../api/geocode';\nimport Timeline from '../Timeline';\nimport { RightArrow } from '../../icons';\nimport { KM_PER_MI } from '../../utils/conversions';\n\nconst styles = (theme) => ({\n  drive: {\n    background: 'rgba(255, 255, 255, 0.0)',\n    background: 'linear-gradient(to bottom, #30373B 0%, #1D2225 100%)',\n    borderTop: '1px solid rgba(255, 255, 255, .05)',\n    borderRadius: 8,\n    cursor: 'pointer',\n    display: 'flex',\n    flexDirection: 'column',\n    marginBottom: 12,\n    overflow: 'hidden',\n    padding: 0,\n    transition: 'background .2s',\n    '&:hover': {}\n  },\n  driveHeader: {\n    alignItems: 'center',\n    padding: 18,\n    paddingLeft: 24,\n    paddingRight: 24,\n  },\n  driveHeaderIntro: {\n    display: 'flex',\n  },\n  driveAvatar: {\n    alignItems: 'center',\n    background: '#404B4F',\n    borderRadius: 30,\n    color: '#fff',\n    display: 'flex',\n    fontWeight: 600,\n    height: 52,\n    justifyContent: 'center',\n    margin: '0px 3%',\n    width: 52,\n  },\n  driveTitle: {\n    marginLeft: '10%',\n  },\n  driveTimeline: {},\n  driveArrow: {\n    color: '#404B4F',\n    height: '100%',\n    marginLeft: '25%',\n    width: 32,\n  },\n});\n\nclass DriveListDrive extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      startLocation: null,\n      endLocation: null,\n    };\n\n    this.handleDriveClicked = this.handleDriveClicked.bind(this);\n  }\n\n  componentDidMount() {\n    const { drive } = this.props;\n    this.mounted = true;\n    GeocodeApi().reverseLookup(drive.startCoord).then((startLocation) => {\n      if (!this.mounted) {\n        return;\n      }\n      this.setState({ startLocation });\n    });\n    GeocodeApi().reverseLookup(drive.endCoord).then((endLocation) => {\n      if (!this.mounted) {\n        return;\n      }\n      this.setState({ endLocation });\n    });\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  handleDriveClicked(drive) {\n    const startTime = drive.startTime - 1000;\n    const endTime = drive.startTime + drive.duration + 1000;\n    this.props.dispatch(selectRange(startTime, endTime));\n  }\n\n  render() {\n    const { drive, deviceAlias, classes } = this.props;\n    const { startLocation, endLocation } = this.state;\n    const startTime = fecha.format(new Date(drive.startTime), 'HH:mm');\n    const startDate = fecha.format(new Date(drive.startTime), 'ddd, MMM D');\n    const endTime = fecha.format(new Date(drive.startTime + drive.duration + 1000), 'HH:mm');\n    const duration = formatDriveDuration(drive.duration);\n    const points = getDrivePoints(drive.duration);\n    return (\n      <li\n        key={drive.startTime}\n        className={classNames(classes.drive, 'DriveEntry')}\n        onClick={partial(this.handleDriveClicked, drive)}\n      >\n        <div className={classes.driveHeader}>\n          <Grid container>\n            <Grid item xs={4} className={classes.driveHeaderIntro}>\n              <div className={classes.driveAvatar}>\n                { drive.annotations }\n              </div>\n              <div className={classes.driveTitle}>\n                <Typography variant=\"body2\">\n                  { `${startDate} @ ${startTime} to ${endTime}` }\n                </Typography>\n                <Typography>\n                  { deviceAlias }\n                </Typography>\n              </div>\n            </Grid>\n            <Grid item xs={2}>\n              <Typography variant=\"body2\">\n                { duration.hours > 0 && `${duration.hours.toString()}hr ` }\n                { `${duration.minutes} min` }\n              </Typography>\n              <Typography>\n                { `${points} points` }\n              </Typography>\n            </Grid>\n            <Grid item xs={2}>\n              <Typography variant=\"body2\">\n                { startLocation && startLocation.neighborhood }\n              </Typography>\n              <Typography>\n                { startLocation && (`${startLocation.locality}, ${startLocation.region}`) }\n              </Typography>\n            </Grid>\n            <Grid item xs={2}>\n              <Typography variant=\"body2\">\n                { endLocation && endLocation.neighborhood }\n              </Typography>\n              <Typography>\n                { endLocation && (`${endLocation.locality}, ${endLocation.region}`) }\n              </Typography>\n            </Grid>\n            <Grid item xs={1}>\n              <Typography variant=\"body2\">\n                { `${+drive.distanceMiles.toFixed(1)} mi` }\n              </Typography>\n              <Typography>\n                { `${+(drive.distanceMiles * KM_PER_MI).toFixed(1)} km` }\n              </Typography>\n            </Grid>\n            <Grid item xs={1}>\n              <RightArrow className={classes.driveArrow} />\n            </Grid>\n          </Grid>\n        </div>\n        <Timeline\n          className={classes.driveTimeline}\n          zoomed\n          colored\n          hasThumbnails\n          hasGradient\n          zoomOverride={{\n            start: drive.startTime,\n            end: drive.startTime + drive.duration\n          }}\n        />\n      </li>\n    );\n  }\n}\n\nexport default connect(() => ({}))(withStyles(styles)(DriveListDrive));\n","export const KM_PER_MI = 1.60934;\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\n\nimport {\n  withStyles,\n  Typography,\n  Grid,\n  Menu,\n  MenuItem,\n  ListItem,\n  IconButton,\n} from '@material-ui/core';\nimport SettingsIcon from '@material-ui/icons/Settings';\n\nimport { filterEvent } from '../../utils';\nimport { selectRange } from '../../actions';\nimport DeviceSettingsModal from './DeviceSettingsModal';\nimport DriveListItem from './DriveListItem';\n\nconst MIN_TIME_BETWEEN_ROUTES = 60000; // 1 minute\n\nconst styles = (theme) => ({\n  header: {\n    alignItems: 'center',\n    borderBottom: '1px solid rgba(255, 255, 255, 0.1)',\n    padding: 16,\n    paddingLeft: 48,\n    paddingRight: 60,\n  },\n  headerLabel: {\n    cursor: 'default',\n    textTransform: 'uppercase',\n  },\n  drives: {\n    height: '100%',\n    margin: 0,\n    overflowY: 'scroll',\n    padding: 16,\n    paddingLeft: 24,\n    paddingRight: 24,\n  },\n  zeroState: {\n    padding: '16px 48px',\n  },\n  settingsArea: {\n    display: 'flex',\n    justifyContent: 'flex-end',\n  },\n  settingsButton: {\n    border: '1px solid #272D30'\n  },\n  settingsButtonIcon: {\n    color: '#272D30',\n  },\n});\n\nclass DriveList extends Component {\n  constructor(props) {\n    super(props);\n\n    this.goToAnnotation = this.goToAnnotation.bind(this);\n    this.filterShortDrives = this.filterShortDrives.bind(this);\n    this.renderDriveListHeader = this.renderDriveListHeader.bind(this);\n    this.renderDriveListSettings = this.renderDriveListSettings.bind(this);\n    this.handleClickedSettings = this.handleClickedSettings.bind(this);\n    this.handleClosedSettings = this.handleClosedSettings.bind(this);\n    this.handleOpenedSettingsModal = this.handleOpenedSettingsModal.bind(this);\n    this.handleCanceledSettings = this.handleCanceledSettings.bind(this);\n    this.handleClosedSettingsModal = this.handleClosedSettingsModal.bind(this);\n\n    this.state = {\n      anchorEl: null,\n      showDeviceSettingsModal: false\n    };\n  }\n\n  componentWillReceiveProps(props) {\n    if (props.device && !this.state.deviceAliasSaved) {\n      this.setState({ deviceAliasSaved: props.device.alias });\n    }\n  }\n\n  filterShortDrives(ride) {\n    return ride.duration > 60000;\n  }\n\n  goToAnnotation(segment) {\n    const startTime = segment.startTime - this.props.zoomBuffer;\n    const endTime = segment.startTime + segment.duration + this.props.zoomBuffer;\n    this.props.dispatch(selectRange(startTime, endTime));\n  }\n\n  handleClickedSettings(event) {\n    this.setState({ anchorEl: event.currentTarget });\n  }\n\n  handleClosedSettings() {\n    this.setState({ anchorEl: null });\n  }\n\n  handleOpenedSettingsModal(device) {\n    this.setState({ showDeviceSettingsModal: true });\n  }\n\n  handleClosedSettingsModal() {\n    this.setState({ showDeviceSettingsModal: false });\n  }\n\n  handleCanceledSettings() {\n    this.setState({\n      anchorEl: null,\n      showDeviceSettingsModal: false,\n    });\n  }\n\n  handleClose() {\n    this.setState({\n      showPicker: false\n    });\n  }\n\n  render() {\n    const { classes, device, segments } = this.props;\n\n    if (!device) {\n      return [];\n    }\n\n    const driveList = [];\n    let lastEnd = 0;\n    let lastSegmentEnd = 0;\n    let curRideChunk = null;\n    this.props.segments.forEach((segment) => {\n      if (!curRideChunk || segment.startTime - lastEnd > MIN_TIME_BETWEEN_ROUTES) {\n        curRideChunk = {\n          segments: 0,\n          startTime: segment.startTime,\n          offset: segment.offset,\n          duration: 0,\n          annotations: 0,\n          startCoord: segment.startCoord,\n          endCoord: segment.endCoord,\n          distanceMiles: segment.distanceMiles,\n        };\n        driveList.unshift(curRideChunk);\n        lastSegmentEnd = segment.startTime;\n      }\n      curRideChunk.duration += segment.startTime - lastSegmentEnd;\n      curRideChunk.duration += segment.duration;\n      lastSegmentEnd = segment.startTime + segment.duration;\n      curRideChunk.segments++;\n      lastEnd = segment.startTime + segment.duration;\n      curRideChunk.annotations += segment.events.filter(filterEvent)\n        .reduce((memo, event) => (event.id ? memo : memo + 1), 0);\n    });\n\n    return (\n      <>\n        { this.renderDriveListHeader() }\n        { driveList.length === 0 && this.renderZeroRides() }\n        <ul className={classes.drives}>\n          { driveList.filter(this.filterShortDrives).map((drive) => (\n            <DriveListItem\n              key={drive.startTime}\n              drive={drive}\n              deviceAlias={device.alias}\n            />\n          ))}\n        </ul>\n      </>\n    );\n  }\n\n  renderZeroRides() {\n    const { classes } = this.props;\n    let zeroRidesEle = null;\n    const { device } = this.props;\n    const hasDrivesInQuery = (device && device.last_segment_utc_millis !== null)\n      && (device.last_segment_utc_millis >= this.props.start);\n\n    if (hasDrivesInQuery) {\n      zeroRidesEle = <Typography>Loading...</Typography>;\n    } else {\n      zeroRidesEle = (\n        <Typography>\nLooks like you haven\n          {'\\''}\nt driven in the selected time range.\n        </Typography>\n      );\n    }\n\n    return (\n      <div className={classes.zeroState}>\n        <Grid container>\n          { zeroRidesEle }\n        </Grid>\n      </div>\n    );\n  }\n\n  renderDriveListHeader() {\n    const { classes, device } = this.props;\n    return (\n      <div className={classes.header}>\n        <Grid container alignItems=\"center\">\n          <Grid item xs={4}>\n            <Typography variant=\"title\">\n              { device.alias }\n              {' '}\nDrives\n            </Typography>\n          </Grid>\n          <Grid item xs={2}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Duration\n            </Typography>\n          </Grid>\n          <Grid item xs={2}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Origin\n            </Typography>\n          </Grid>\n          <Grid item xs={2}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Destination\n            </Typography>\n          </Grid>\n          <Grid item xs={1}>\n            <Typography variant=\"caption\" className={classes.headerLabel}>\n              Distance\n            </Typography>\n          </Grid>\n          <Grid item xs={1} className={classes.settingsArea}>\n            { ((device && !device.shared && device.is_owner) || this.props.isSuperUser)\n              && this.renderDriveListSettings()}\n          </Grid>\n        </Grid>\n      </div>\n    );\n  }\n\n  renderDriveListSettings() {\n    const { classes, device } = this.props;\n    const { anchorEl } = this.state;\n    const open = Boolean(anchorEl);\n    return (\n      <>\n        <IconButton\n          className={classes.settingsButton}\n          onClick={partial(this.handleOpenedSettingsModal, device)}\n        >\n          <SettingsIcon className={classes.settingsButtonIcon} />\n        </IconButton>\n        <DeviceSettingsModal\n          isOpen={this.state.showDeviceSettingsModal}\n          onClose={this.handleClosedSettingsModal}\n          onCancel={this.handleCanceledSettings}\n        />\n      </>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  segments: 'workerState.segments',\n  start: 'workerState.start',\n  device: 'workerState.device',\n  isSuperUser: 'workerState.profile.superuser',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DriveList));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Modal from '@material-ui/core/Modal';\n\nimport { selectRange, selectDevice } from '../../actions';\nimport { filterEvent } from '../../utils';\nimport DeviceList from './DeviceList';\nimport DriveList from './DriveList';\nimport Timelineworker from '../../timeline';\n\nconst ZOOM_BUFFER = 1000; // 1 second on either end\n\nconst styles = (theme) => ({\n  base: {\n    background: 'linear-gradient(180deg, #1D2225 0%, #16181A 100%)',\n    display: 'flex',\n    overflow: 'hidden',\n    flexGrow: 1,\n    minWidth: '100%',\n  },\n  sidebar: {\n    background: 'linear-gradient(180deg, #1B2023 0%, #111516 100%)',\n    display: 'flex',\n    flexDirection: 'column',\n    minWidth: 280,\n    width: '20%',\n  },\n  sidebarHeader: {\n    alignItems: 'center',\n    padding: 24,\n  },\n  window: {\n    display: 'flex',\n    flexGrow: 1,\n    flexDirection: 'column',\n  },\n  annotateButton: {\n    background: '#fff',\n    borderRadius: 30,\n    color: '#404B4F',\n    height: 50,\n    textTransform: 'none',\n    width: '80%',\n    '&:hover': {\n      background: '#fff',\n      color: '#404B4F',\n    }\n  },\n});\n\nclass Dashboard extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleDeviceSelected = this.handleDeviceSelected.bind(this);\n    this.goToAnnotation = this.goToAnnotation.bind(this);\n  }\n\n  handleDeviceSelected(dongleId) {\n    this.props.dispatch(selectDevice(dongleId));\n  }\n\n  goToAnnotation(segment) {\n    if (segment == null) { return; }\n    const startTime = segment.startTime - ZOOM_BUFFER;\n    const endTime = segment.startTime + segment.duration + ZOOM_BUFFER;\n    this.props.dispatch(selectRange(startTime, endTime));\n  }\n\n  render() {\n    const { classes } = this.props;\n    let firstAnnotationSegment = null;\n    const newAnnotations = this.props.segments.reduce((count, segment) => {\n      const segCount = segment.events.filter(filterEvent).reduce((memo, event) => (event.id ? memo : memo + 1), 0);\n      if (!firstAnnotationSegment && segCount > 0) {\n        firstAnnotationSegment = segment;\n      }\n      return count + segCount;\n    }, 0);\n\n    return (\n      <div className={classes.base}>\n        <div className={classes.sidebar}>\n          <div className={classes.sidebarHeader}>\n            <Button\n              size=\"large\"\n              variant=\"outlined\"\n              className={classes.annotateButton}\n              onClick={partial(this.goToAnnotation, firstAnnotationSegment)}\n            >\n              Annotate\n            </Button>\n          </div>\n          <DeviceList\n            selectedDevice={this.props.selectedDongleId}\n            handleDeviceSelected={this.handleDeviceSelected}\n          />\n        </div>\n        <div className={classes.window}>\n          <DriveList />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  segments: 'workerState.segments',\n  selectedDongleId: 'workerState.dongleId',\n  device: 'workerState.device',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(Dashboard));\n","import React, { PureComponent } from 'react';\nimport fecha from 'fecha';\nimport Raven from 'raven-js';\nimport { classNames } from 'react-extras';\n\nimport {\n  withStyles,\n  Grid,\n  Typography,\n  ExpansionPanel,\n  ExpansionPanelSummary,\n  ExpansionPanelDetails,\n  ExpansionPanelActions,\n  Divider,\n  Select,\n  MenuItem,\n  Button,\n  TextField,\n  Tooltip,\n  FormHelperText,\n  LinearProgress,\n} from '@material-ui/core';\n\nimport { annotations as Annotations } from '@commaai/comma-api';\nimport Timelineworker from '../../timeline';\n\nconst DISENGAGEMENT_REASONS = [\n  { value: 'arbitrary', title: 'I wanted to take over', header: true },\n  { value: 'different-way', title: 'Go a different way' },\n  { value: 'lanes', title: 'Change lanes' },\n  { value: 'too-slow', title: 'Accelerate quicker' },\n  { value: 'exit', title: 'Take an exit' },\n  { value: 'stop-light', title: 'Stop at light' },\n  { value: 'stop-sign', title: 'Stop at sign' },\n  { value: 'other-desire', title: 'Other (explain in comment)' },\n\n  { value: 'danger', title: 'I needed to take over for safety', header: true },\n  { value: 'sharp-turn', title: 'Turn too sharp' },\n  { value: 'bad-lanes', title: 'Lanes misidentified' },\n  { value: 'bad-lead-car', title: 'Lead car misidentified' },\n  { value: 'other-safety', title: 'Other (explain in comment)' },\n];\n\nconst styles = (theme) => ({\n  base: {\n    backgroundColor: '#272D30',\n  },\n  isExpanded: {\n    minHeight: 'initial',\n    margin: '0px 0',\n    backgroundColor: '#1D2225',\n  },\n  bubble: {\n    background: 'linear-gradient(to bottom, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.55) 100%)',\n    border: '1px solid rgba(255, 255, 255, 0.2)',\n    borderRadius: 60,\n    height: 28,\n    width: 28,\n  },\n  heading: {\n    fontWeight: 500,\n    paddingLeft: '5%',\n  },\n  date: {\n    color: theme.palette.grey[100],\n    fontWeight: 500,\n  },\n  pillBody: {\n    textAlign: 'center',\n  },\n  pillText: {\n    color: '#65737a',\n    border: '1px solid #65737a57',\n    borderRadius: 15,\n    display: 'inline-block',\n    fontWeight: 500,\n    margin: '0 auto',\n    padding: '6px 10px',\n  },\n  summaryContent: {\n    padding: '0px',\n    '&>:last-child': {\n      padding: '0px'\n    }\n  },\n  formField: {\n    alignItems: 'center',\n    display: 'flex',\n    marginBottom: 12,\n    width: '100%',\n  },\n  formLabel: {\n    paddingRight: '24px'\n  },\n  formLabelText: {\n    fontWeight: 500,\n    textAlign: 'right',\n  },\n  select: {\n    margin: 0,\n    width: '100%',\n  },\n  placeholder: {\n    color: theme.palette.placeholder\n  },\n  panelActions: {\n    justifyContent: 'flex-start',\n    paddingBottom: 36,\n    paddingLeft: '27%',\n    paddingRight: 24,\n    paddingTop: 0,\n  },\n  resolveButton: {\n    background: 'linear-gradient(to bottom, rgb(82, 94, 102) 0%, rgb(64, 75, 79) 100%)',\n    borderRadius: 30,\n    color: '#fff',\n    padding: '12px 24px',\n    textTransform: 'none',\n  },\n  cancelButton: {\n    background: 'transparent',\n    border: '1px solid #272D30',\n    borderRadius: 30,\n    padding: '12px 24px',\n    textTransform: 'none',\n  },\n  reasonDetailed: {\n    paddingLeft: '30px',\n    color: theme.palette.lightGrey[200],\n  }\n});\n\nclass AnnotationEntry extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleComment = this.handleComment.bind(this);\n    this.validate = this.validate.bind(this);\n\n    if (this.props.event.annotation) {\n      this.state = {\n        ...this.props.event.annotation.data,\n        saving: false,\n        id: this.props.event.id\n      };\n    } else {\n      this.state = {\n        saving: false\n      };\n    }\n  }\n\n  componentWillReceiveProps(props) {\n    if (props.event.annotation) {\n      this.setState({\n        ...props.event.annotation.data,\n        saving: false,\n        id: props.event.id\n      });\n    } else {\n      this.setState({\n        saving: false\n      });\n    }\n  }\n\n  handleChange(e) {\n    this.setState({\n      reason: e.target.value\n    });\n  }\n\n  handleComment(e) {\n    this.setState({\n      comment: e.target.value\n    });\n  }\n\n  async validate() {\n    const { event, segment } = this.props;\n    if (this.state.saving) {\n      return false;\n    }\n    if (!this.state.reason || this.state.reason === '') {\n      this.setState({\n        error: 'You must select a reason',\n        errorElem: 'reason'\n      });\n      return;\n    }\n\n    if (this.state.reason === 'other' && !this.state.comment.length) {\n      this.setState({\n        error: 'You must describe your reason',\n        errorElem: 'comment'\n      });\n      return;\n    }\n\n    // no error\n    this.setState({\n      error: false,\n      errorElem: false,\n      saving: true\n    });\n\n    let data = null;\n\n    try {\n      if (!this.state.id) {\n        data = await Annotations.createAnnotation({\n          canonical_segment_name: event.canonical_segment_name,\n          offset_nanos_part: event.offset_nanos,\n          offset_millis: event.offset_millis,\n          start_time_utc_millis: event.timestamp,\n          end_time_utc_millis: event.timestamp,\n          type: event.type,\n          data: {\n            reason: this.state.reason,\n            comment: this.state.comment\n          }\n        });\n        Timelineworker.resolveAnnotation(data, event, segment.route);\n      } else {\n        data = await Annotations.updateAnnotation(this.state.id, {\n          reason: this.state.reason,\n          comment: this.state.comment\n        });\n      }\n\n      Timelineworker.selectLoop(null, null);\n    } catch (e) {\n      Raven.captureException(e);\n      // no error\n      const error = e;\n      const { message } = error;\n      if (!error.isJoi) {\n        this.setState({\n          error: message,\n          errorElem: 'reason',\n          saving: false\n        });\n      } else {\n        this.setState({\n          error: message,\n          errorElem: 'reason',\n          saving: false\n        });\n      }\n      return;\n    }\n\n    this.setState({\n      id: data.id,\n      error: false,\n      errorElem: false,\n      saving: false\n    });\n  }\n\n  render() {\n    const {\n      event, eventId, segment, classes, style\n    } = this.props;\n    const dateString = fecha.format(new Date(event.timestamp), 'MMM D @ HH:mm:ss');\n    const reason = this.state.reason || '';\n    const comment = this.state.comment || '';\n    let selectClassName = this.props.classes.select;\n    if (!reason.length) {\n      selectClassName += ` ${this.props.classes.placeholder}`;\n    }\n\n    return (\n      <ExpansionPanel\n        style={style}\n        classes={{ expanded: classes.isExpanded }}\n        className={classNames(classes.base, 'AnnotationListEntry')}\n        key={eventId}\n        expanded={this.props.expanded}\n        onChange={this.props.onChange}\n        defaultExpanded={this.props.defaultExpanded}\n      >\n        <ExpansionPanelSummary\n          classes={{ content: classes.summaryContent }}\n        >\n          <Grid container alignItems=\"center\">\n            <Grid item xs={1}>\n              <div className={classes.bubble} />\n            </Grid>\n            <Grid item xs={5}>\n              <Typography className={classes.heading}>\n                { this.getTitle() }\n              </Typography>\n            </Grid>\n            <Grid item xs={3}>\n              <Typography className={classes.date}>\n                [\n                { dateString }\n]\n              </Typography>\n            </Grid>\n            <Grid item xs={3} className={classes.pillBody}>\n              <Typography className={classes.pillText}>\n                Disengaged\n              </Typography>\n            </Grid>\n          </Grid>\n        </ExpansionPanelSummary>\n        { !this.state.saving && <Divider style={{ marginBottom: 4 }} /> }\n        { this.state.saving && <LinearProgress /> }\n        <ExpansionPanelDetails>\n          <Grid container alignContent=\"center\" alignItems=\"center\">\n            { this.renderFormField('Reason', (\n              <Select\n                disabled={this.state.saving}\n                displayEmpty\n                error={this.state.errorElem === 'reason'}\n                value={reason}\n                onChange={this.handleChange}\n                className={selectClassName}\n                inputProps={{ name: 'reason', id: 'reason-simple' }}\n              >\n                { reason === ''\n                  && (\n                  <MenuItem disabled value=\"\">\n                    Choose one\n                  </MenuItem>\n                  )}\n                { this.isPlanned()\n                  && (\n                  <MenuItem value={event.annotation.data.reason}>\n                    { event.annotation.data.reason }\n                  </MenuItem>\n                  )}\n                { DISENGAGEMENT_REASONS.map((disengagementReason) => (\n                  <MenuItem\n                    key={disengagementReason.value}\n                    value={disengagementReason.value}\n                    className={!disengagementReason.header ? this.props.classes.reasonDetailed : ''}\n                  >\n                    { disengagementReason.title }\n                  </MenuItem>\n                ))}\n              </Select>\n            ))}\n            { this.renderFormField('Comment', (\n              <TextField\n                onChange={this.handleComment}\n                placeholder=\"Add a comment...\"\n                className={classes.select}\n                error={this.state.errorElem === 'Comment'}\n                disabled={this.state.saving}\n                value={comment}\n              />\n            ))}\n          </Grid>\n        </ExpansionPanelDetails>\n        <ExpansionPanelActions className={classes.panelActions}>\n          <Tooltip\n            id=\"tooltip-annot\"\n            title=\"Grey Panda required to annotate\"\n            disableFocusListener={segment.hpgps || this.isPlanned()}\n            disableHoverListener={segment.hpgps || this.isPlanned()}\n          >\n            <div>\n              <Button\n                onClick={this.validate}\n                size=\"large\"\n                disabled={this.state.saving || this.isPlanned() || !segment.hpgps}\n                className={classes.resolveButton}\n              >\n                Resolve Annotation\n              </Button>\n            </div>\n          </Tooltip>\n          <Button\n            size=\"large\"\n            disabled={this.state.saving}\n            onClick={this.props.onChange}\n            className={classes.cancelButton}\n          >\n            Cancel\n          </Button>\n        </ExpansionPanelActions>\n      </ExpansionPanel>\n    );\n  }\n\n  renderFormField(label, form) {\n    const { classes } = this.props;\n    return (\n      <div className={classes.formField}>\n        { this.state.errorElem === label.toLowerCase() && (\n        <Grid item xs={12}>\n          <FormHelperText error>\n            { this.state.error }\n          </FormHelperText>\n        </Grid>\n        )}\n        <Grid item xs={3} className={classes.formLabel}>\n          <Typography className={classes.formLabelText}>\n            { label }\n:\n          </Typography>\n        </Grid>\n        <Grid item xs={9} style={{ paddingRight: 40 }}>\n          { form }\n        </Grid>\n      </div>\n    );\n  }\n\n  getTitle() {\n    if (this.isPlanned()) {\n      return 'Planned Disengagement';\n    } if (this.props.event.type === 'disengage_steer') {\n      return 'Steering Override';\n    } if (this.props.event.type === 'disengage') {\n      return 'Disengagement';\n    }\n  }\n\n  isPlanned() {\n    const { event } = this.props;\n    return (event.data && event.annotation && event.data.is_planned);\n  }\n}\n\nexport default withStyles(styles)(AnnotationEntry);\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\n\nimport ShopButton from './shopButton';\n\nconst styles = (theme) => ({\n  root: {\n    height: '96px',\n    padding: '12px 0',\n  },\n  rowFill: {\n    height: '100%',\n    textAlign: 'center'\n  },\n  image: {\n    display: 'inline-block',\n    height: '72px',\n    width: 'auto'\n  }\n});\n\nclass GreyPandaUpsellRow extends Component {\n  render() {\n    return (\n      <Grid container className={this.props.classes.root}>\n        <Grid item xs={6} className={this.props.classes.rowFill}>\n          <img src=\"/images/grey-panda-tsp.png\" className={this.props.classes.image} />\n        </Grid>\n        <Grid item xs={6} className={this.props.classes.rowFill}>\n          <Typography>\n            Upgrade to a Grey Panda and help improve openpilot\n          </Typography>\n          <ShopButton link=\"https://comma.ai/shop/products/panda-obd-ii-dongle/?ref=explorer\" />\n        </Grid>\n      </Grid>\n    );\n  }\n}\n\nexport default withStyles(styles)(GreyPandaUpsellRow);\n","import React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\nimport { withStyles } from '@material-ui/core/styles';\nimport { AutoSizer, List } from 'react-virtualized';\nimport memoize from 'memoize-one';\n\nimport AnnotationListItem from './AnnotationListItem';\nimport GreyPandaUpsellRow from './greyPandaUpsell';\nimport Timelineworker from '../../timeline';\nimport { selectRange } from '../../actions';\nimport { filterEvent } from '../../utils';\n\nconst LOOP_DURATION = 10000;\n\nconst styles = (theme) => ({\n  base: {\n    border: '1px solid rgba(255,255,255,0.04)',\n    borderRadius: 5,\n    overflow: 'hidden'\n  }\n});\n\nclass AnnotationList extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      expanded: false\n    };\n  }\n\n  // TODO: Migrate deprecated lifecycle method\n  componentWillReceiveProps(nextProps) {\n    if (this.state.expanded) {\n      if (nextProps.loop.startTime === null || nextProps.resolved !== this.props.resolved) {\n        this.setState({ expanded: false }, () => {\n          this.recomputeList();\n        });\n      }\n    }\n  }\n\n  list = null\n\n  filter = memoize((resolved, unresolved, list) => list.filter(this.filterEntry));\n\n  recomputeList = () => {\n    if (this.list) {\n      this.list.recomputeRowHeights();\n      this.list.forceUpdateGrid();\n    }\n  }\n\n  handleExpanded = (eventId, timestamp) => {\n    const { zoom } = this.props;\n    const isExpanded = this.state.expanded !== eventId && eventId;\n    this.setState({\n      expanded: isExpanded ? eventId : null\n    });\n\n    this.recomputeList();\n\n    if (isExpanded) {\n      const loopStartTime = timestamp - LOOP_DURATION / 2;\n      const loopEndTime = loopStartTime + LOOP_DURATION;\n      if (zoom && (loopStartTime < zoom.start || loopEndTime > zoom.end)) {\n        this.props.dispatch(selectRange(loopStartTime, loopEndTime));\n      } else {\n        // 5 seconds before, 5 seconds after...\n        Timelineworker.selectLoop(loopStartTime, LOOP_DURATION);\n      }\n    } else if (zoom && zoom.expanded) {\n      Timelineworker.selectLoop(zoom.start, zoom.end - zoom.start);\n    }\n  }\n\n  getEvent(index) {\n    const { segment } = this.props;\n    const events = (segment || {}).events || [];\n    const filteredList = this.filter(this.props.resolved, this.props.unresolved, events);\n\n    return filteredList[index];\n  }\n\n  getRowHeight = ({ index }) => {\n    const event = this.getEvent(index);\n\n    const eventId = `${event.time}:${index}`;\n\n    const expanded = this.state.expanded === eventId;\n\n    return !expanded ? 64 : 314; // TODO: is 314 safe?\n  }\n\n  render() {\n    const {\n      segment, classes, isUpsellDemo, resolved, unresolved\n    } = this.props;\n    const events = (segment || {}).events || [];\n\n    return (\n      <div className={classes.base} style={{ height: '100%' }}>\n        {!(segment.hpgps || isUpsellDemo || resolved) && <GreyPandaUpsellRow />}\n        <AutoSizer>\n          {({ height, width }) => (\n            <List\n              ref={(ref) => this.list = ref}\n              height={height}\n              width={width}\n              overscanRowCount={10}\n              // noRowsRenderer={this.noRowsRenderer}\n              rowCount={this.filter(resolved, unresolved, events).length}\n              rowHeight={this.getRowHeight}\n              rowRenderer={this.renderEntry}\n            />\n          )}\n        </AutoSizer>\n      </div>\n    );\n  }\n\n  filterEntry = (event) => {\n    if (this.props.resolved && !event.id) {\n      return false;\n    }\n    if (this.props.unresolved && event.id) {\n      return false;\n    }\n    return filterEvent(event);\n  }\n\n  renderEntry = ({ index, key, style }) => {\n    const { segment } = this.props;\n    const event = this.getEvent(index);\n    const eventId = `${event.time}:${index}`;\n    return (\n      <AnnotationListItem\n        key={eventId}\n        style={style}\n        segment={segment}\n        eventId={eventId}\n        event={event}\n        expanded={this.state.expanded === eventId}\n        disabled={!segment.hpgps}\n        onChange={partial(this.handleExpanded, eventId, event.timestamp)}\n      />\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  start: 'workerState.start',\n  loop: 'workerState.loop',\n  zoom: 'zoom'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(AnnotationList));\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\nimport { partial } from 'ap';\nimport fecha from 'fecha';\nimport { classNames } from 'react-extras';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport Badge from '@material-ui/core/Badge';\n\nimport AnnotationList from './AnnotationList';\nimport { filterEvent } from '../../utils';\n\nconst styles = (theme) => ({\n  root: {\n  },\n  upsellDemo: {\n    cursor: 'default',\n    pointerEvents: 'none',\n    opacity: 0.8\n  },\n  annotationsViewer: {\n    display: 'flex',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    overflow: 'hidden',\n    flexDirection: 'column',\n  },\n  annotationsViewerTabs: {\n    marginBottom: 12,\n    width: '100%',\n  },\n  tabLabelBadge: {\n    backgroundColor: theme.palette.grey[100],\n    borderRadius: 24,\n    marginRight: 24,\n    minWidth: 28,\n    top: -4,\n  },\n  tabLabelText: {\n    fontWeight: 500,\n    paddingLeft: 24,\n    textTransform: 'none',\n  },\n  annotationsViewerTabIndicator: {\n    backgroundColor: theme.palette.grey[100],\n    borderRadius: 8,\n    height: 6,\n  },\n  annotationsViewerList: {\n    height: '100%',\n    overflowY: 'scroll',\n  },\n});\n\nclass AnnotationTabs extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n\n    this.state = {\n      selectedTab: 0\n    };\n  }\n\n  handleChange(event, selectedTab) {\n    this.setState({ selectedTab });\n  }\n\n  count(resolved) {\n    return this.props.segment.events.filter((event) => {\n      if (!filterEvent(event)) {\n        return false;\n      }\n      if (resolved && event.id) {\n        return true;\n      }\n      if (!resolved && !event.id) {\n        return true;\n      }\n    }).length;\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <div style={{ position: 'relative', height: '100%' }}>\n        <div className={classes.annotationsViewer}>\n          <Tabs\n            value={this.state.selectedTab}\n            onChange={this.handleChange}\n            classes={{\n              indicator: classes.annotationsViewerTabIndicator\n            }}\n            className={classNames(classes.annotationsViewerTabs, {\n              [classes.upsellDemo]: this.props.isUpsellDemo\n            })}\n          >\n            <Tab label={(\n              <Typography className={classes.tabLabelText}>\n                <Badge classes={{ badge: classes.tabLabelBadge }} badgeContent={this.count(false)}>\n                  &nbsp;\n                </Badge>\n                Annotations Unresolved\n              </Typography>\n            )}\n            />\n            <Tab label={(\n              <Typography className={classes.tabLabelText}>\n                <Badge classes={{ badge: classes.tabLabelBadge }} badgeContent={this.count(true)}>\n                  &nbsp;\n                </Badge>\n                Resolved\n              </Typography>\n            )}\n            />\n          </Tabs>\n          <div className={`${classes.annotationsViewerList} x-scrollbar`}>\n            { this.renderTab(this.state.selectedTab) }\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderTab(index) {\n    switch (index) {\n      case 0:\n        return (\n          <AnnotationList\n            segment={this.props.segment}\n            unresolved\n            isUpsellDemo={this.props.isUpsellDemo}\n          />\n        );\n      case 1:\n        return (<AnnotationList segment={this.props.segment} resolved />);\n    }\n  }\n}\n\nexport default withStyles(styles)(AnnotationTabs);\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport raf from 'raf';\nimport Measure from 'react-measure';\nimport { withStyles } from '@material-ui/core/styles';\n\nimport { LngLatBounds } from 'mapbox-gl';\nimport ReactMapGL, { LinearInterpolator } from 'react-map-gl';\nimport { easeCubic } from 'd3-ease';\n\nimport { derived as DerivedDataApi } from '@commaai/comma-api';\nimport TimelineWorker from '../../timeline';\nimport { MAPBOX_TOKEN } from '../../api/geocode';\n\nconst MAP_STYLE = 'mapbox://styles/commaai/cjj4yzqk201c52ss60ebmow0w';\n\nconst styles = {\n  mapContainer: {\n    width: '100%',\n    cursor: 'default !important'\n  }\n};\n\nclass DriveMap extends Component {\n  constructor(props) {\n    super(props);\n\n    this.initMap = this.initMap.bind(this);\n    this.populateMap = this.populateMap.bind(this);\n    this.posAtOffset = this.posAtOffset.bind(this);\n    this.setPath = this.setPath.bind(this);\n    this.updateMarkerPos = this.updateMarkerPos.bind(this);\n\n    const nextRoute = props.currentSegment && props.currentSegment.route;\n\n    this.isLoadingCoords = false;\n    this.state = {\n      viewport: {\n        width: 640,\n        height: 480,\n        latitude: 37.7577,\n        longitude: -122.4376,\n        zoom: 15\n      },\n      route: nextRoute,\n      coords: [],\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const nextRoute = nextProps.currentSegment && nextProps.currentSegment.route;\n    if (nextRoute !== this.state.route) {\n      if (this.state.coords.length > 0) {\n        this.setPath([]);\n      }\n    }\n\n    const coordsNeedRefresh = nextRoute !== this.state.route || this.state.coords.length === 0;\n    const shouldRefreshMap = coordsNeedRefresh && this.map != null && !this.isLoadingCoords;\n    if (shouldRefreshMap) {\n      this.setState({ route: nextRoute }, this.populateMap.bind(this, nextProps));\n    }\n\n    if (nextProps.startTime !== this.props.startTime) {\n      this.shouldFlyTo = true;\n    }\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.updateMarkerPos();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  getMarkerSource() {\n    return this.map && this.map.getMap().getSource('seekPoint');\n  }\n\n  updateMarkerPos() {\n    if (!this.mounted) {\n      return;\n    }\n\n    const markerSource = this.getMarkerSource();\n    if (markerSource) {\n      if (this.props.currentSegment && this.state.coords.length > 0) {\n        const { routeOffset } = this.props.currentSegment;\n        const offset = TimelineWorker.currentOffset();\n\n        const pos = this.posAtOffset(offset - routeOffset);\n        if (pos) {\n          markerSource.setData({\n            type: 'Point',\n            coordinates: pos\n          });\n          this.moveViewportTo(pos);\n        }\n      } else if (markerSource._data && markerSource._data.coordinates.length > 0) {\n        markerSource.setData({\n          type: 'Point',\n          coordinates: []\n        });\n      }\n    }\n\n    raf(this.updateMarkerPos);\n  }\n\n  moveViewportTo(pos) {\n    const viewport = {\n      ...this.state.viewport,\n      longitude: pos[0],\n      latitude: pos[1]\n    };\n    if (this.shouldFlyTo) {\n      viewport.transitionDuration = 200;\n      viewport.transitionInterpolator = new LinearInterpolator();\n      this.shouldFlyTo = false;\n    }\n\n    this.setState({ viewport });\n  }\n\n  populateMap = async (props) => {\n    if (!props) props = this.props;\n\n    if (!this.map || !props.currentSegment || !this.state.route) {\n      return;\n    }\n    this.isLoadingCoords = true;\n\n    const { route } = this.state;\n    const routeSigUrl = props.currentSegment.url;\n\n    try {\n      const coords = await DerivedDataApi(routeSigUrl).getCoords();\n\n      if (this.state.route !== route) {\n        // handle race, if route changes while coords request was in flight\n        return;\n      }\n\n      const coordsArr = coords.map((coord) => [coord.lng, coord.lat]);\n      this.setPath(coordsArr);\n    } finally {\n      this.isLoadingCoords = false;\n    }\n  }\n\n  setPath(coords) {\n    const map = this.map && this.map.getMap();\n    this.setState({ coords });\n\n    if (map) {\n      map.getSource('route').setData({\n        type: 'Feature',\n        properties: {},\n        geometry: {\n          type: 'LineString',\n          coordinates: coords,\n        }\n      });\n    }\n  }\n\n  posAtOffset(offset) {\n    const offsetSeconds = Math.floor(offset / 1e3);\n    const offsetFractionalPart = (offset % 1e3) / 1000.0;\n    const coordIdx = Math.min(\n      offsetSeconds,\n      this.state.coords.length - 1\n    );\n    const nextCoordIdx = Math.min(\n      offsetSeconds + 1,\n      this.state.coords.length - 1\n    );\n    if (!this.state.coords[coordIdx]) {\n      return null;\n    }\n\n    const [floorLng, floorLat] = this.state.coords[coordIdx];\n    const [ceilLng, ceilLat] = this.state.coords[nextCoordIdx];\n\n    return [\n      floorLng + ((ceilLng - floorLng) * offsetFractionalPart),\n      floorLat + ((ceilLat - floorLat) * offsetFractionalPart)\n    ];\n  }\n\n  initMap(mapComponent) {\n    if (!mapComponent) {\n      this.map = null;\n      return;\n    }\n\n    const map = mapComponent.getMap();\n\n    map.on('load', () => {\n      map.addSource('route', {\n        type: 'geojson',\n        data: {\n          type: 'Feature',\n          properties: {},\n          geometry: {\n            type: 'LineString',\n            coordinates: [],\n          }\n        }\n      });\n      map.addSource('seekPoint', {\n        type: 'geojson',\n        data: {\n          type: 'Point',\n          coordinates: []\n        }\n      });\n\n      const lineGeoJson = {\n        id: 'routeLine',\n        type: 'line',\n        source: 'route',\n        layout: {\n          'line-join': 'round',\n          'line-cap': 'round'\n        },\n        paint: {\n          'line-color': '#888',\n          'line-width': 8\n        }\n      };\n      map.addLayer(lineGeoJson);\n\n      const markerGeoJson = {\n        id: 'marker',\n        type: 'circle',\n        paint: {\n          'circle-radius': 10,\n          'circle-color': '#007cbf'\n        },\n        source: 'seekPoint'\n      };\n\n      map.addLayer(markerGeoJson);\n\n      this.map = mapComponent;\n\n      if (this.state.route && this.props.currentSegment) {\n        this.populateMap();\n      }\n    });\n  }\n\n  render() {\n    return (\n      <Measure\n        bounds\n        onResize={(contentRect) => {\n          this.setState({ viewport: { ...this.state.viewport, width: contentRect.bounds.width } });\n        }}\n      >\n        {({ measureRef }) => (\n          <div ref={measureRef} className={this.props.classes.mapContainer}>\n            <ReactMapGL\n              {...this.state.viewport}\n              mapStyle={MAP_STYLE}\n              onViewportChange={(viewport) => this.setState({ viewport })}\n              mapboxApiAccessToken={MAPBOX_TOKEN}\n              attributionControl={false}\n              ref={this.initMap}\n              dragPan={false}\n            />\n          </div>\n        )}\n      </Measure>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  offset: 'workerState.offset',\n  route: 'workerState.route',\n  segments: 'workerState.segments',\n  segmentNum: 'workerState.segment',\n  currentSegment: 'workerState.currentSegment',\n  startTime: 'workerState.startTime'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(DriveMap));\n","// https://video-react.js.org/customize/customize-source/\nimport React, { Component } from 'react';\nimport Hls from '@commaai/hls.js';\n\nexport default class HLSSource extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.hls = new Hls({\n      enableWorker: false,\n      disablePtsDtsCorrectionInMp4Remux: false\n    });\n    this.hls.on(Hls.Events.MANIFEST_PARSED, () => {\n      this.props.video.play();\n    });\n    this.hls.on(Hls.Events.BUFFER_APPENDED, (eventName, data) => {\n      if (this.props.onBufferAppend) {\n        this.props.onBufferAppend();\n      }\n    });\n\n    this.hls.on(Hls.Events.ERROR, (event, data) => {\n      if (data.fatal) {\n        switch (data.type) {\n          case Hls.ErrorTypes.NETWORK_ERROR:\n          // try to recover network error\n            console.log('fatal network error encountered, try to recover');\n            this.hls.startLoad();\n            break;\n          case Hls.ErrorTypes.MEDIA_ERROR:\n            console.log('fatal media error encountered, try to recover');\n            this.hls.recoverMediaError();\n            break;\n          default:\n          // cannot recover\n            this.hls.destroy();\n            this.hls = null;\n            break;\n        }\n      }\n    });\n\n    this.state = {\n      src: ''\n    };\n    // this.hls.on(Hls.Events.STREAM_STATE_TRANSITION, (eventName, data) => {\n    // });\n  }\n\n  componentDidMount() {\n    this.setState({\n      src: this.props.src\n    });\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextProps.src !== nextState.src) {\n      // console.log('Loading media source!', nextProps.src);\n      if (this.state.src && this.state.src.length) {\n        // console.log('this.hls.detachMedia();');\n        this.hls.detachMedia();\n      }\n      this.setState({\n        src: nextProps.src\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { src } = this.state;\n    if (src !== prevState.src && src && src.length) {\n      // console.log('this.hls.loadSource(src);');\n      this.hls.loadSource(src);\n      // console.log('this.hls.attachMedia(this.props.video);');\n      this.hls.attachMedia(this.props.video);\n\n      if (this.props.onSourceLoaded) {\n        this.props.onSourceLoaded();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    // destroy hls video source\n    if (this.hls) {\n      // console.log('this.hls.destroy();');\n      this.hls.destroy();\n      this.hls = null;\n    }\n  }\n\n  render() {\n    return (\n      <source src={this.state.src} type={this.props.type || 'application/x-mpegURL'} />\n    );\n  }\n}\n","export function strokeRoundedRect(ctx, left, top, width, height, radius, strokeWidth, strokeStyle) {\n  roundedRectPath(ctx, left, top, width, height, radius);\n\n  ctx.lineWidth = strokeWidth;\n  ctx.strokeStyle = strokeStyle;\n  ctx.stroke();\n  ctx.closePath();\n}\n\nexport function fillRoundedRect(ctx, left, top, width, height, radius, fillStyle) {\n  roundedRectPath(ctx, left, top, width, height, radius);\n  ctx.fillStyle = fillStyle;\n  ctx.fill();\n  ctx.closePath();\n}\n\nfunction roundedRectPath(ctx, left, top, width, height, radius) {\n  const right = left + width;\n  const bottom = top + height;\n  const K = 4 * (Math.SQRT2 - 1) / 3;\n\n  ctx.beginPath();\n  ctx.moveTo(left + radius, top);\n  ctx.lineTo(right - radius, top);\n  ctx.bezierCurveTo(right + radius * (K - 1), top, right, top + radius * (1 - K), right, top + radius);\n  ctx.lineTo(right, bottom - radius);\n  ctx.bezierCurveTo(right, bottom + radius * (K - 1), right + radius * (K - 1), bottom, right - radius, bottom);\n  ctx.lineTo(left + radius, bottom);\n  ctx.bezierCurveTo(left + radius * (1 - K), bottom, left, bottom + radius * (K - 1), left, bottom - radius);\n  ctx.lineTo(left, top + radius);\n  ctx.bezierCurveTo(left, top + radius * (1 - K), left + radius * (1 - K), top, left + radius, top);\n}\n","import React from 'react';\nimport Button from '@material-ui/core/Button';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Typography from '@material-ui/core/Typography';\n\nexport default function Buffering(props) {\n  const parts = [];\n  if (props.bufferingVideo) {\n    parts.push('video');\n  }\n  if (props.bufferingData) {\n    parts.push('data');\n  }\n  const message = `Buffering ${parts.join(' and ')}`;\n  return (\n    <div\n      style={{\n        zIndex: 50,\n        position: 'absolute',\n        height: '100%',\n        width: '100%',\n        backgroundColor: '#16181Aaa',\n      }}\n    >\n      <div style={{\n        position: 'relative',\n        textAlign: 'center',\n        top: 'calc(50% - 25px)'\n      }}\n      >\n        <CircularProgress\n          color=\"secondary\"\n          thickness={6}\n          size={50}\n        />\n      </div>\n      <div style={{\n        position: 'relative',\n        textAlign: 'center',\n        top: '50%',\n      }}\n      >\n        <Typography>\n          { message }\n        </Typography>\n      </div>\n    </div>\n  );\n}\n","/* eslint-disable camelcase */\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { withStyles } from '@material-ui/core/styles';\nimport raf from 'raf';\nimport { classNames } from 'react-extras';\nimport { multiply } from 'mathjs';\nimport debounce from 'debounce';\nimport PropTypes from 'prop-types';\n\nimport { Player, ControlBar } from 'video-react';\nimport 'video-react/dist/video-react.css'; // CSS for video\nimport { video as VideoApi } from '@commaai/comma-api';\n\nimport theme from '../../theme';\nimport HLSSource from './hlsSource';\nimport TimelineWorker from '../../timeline';\nimport * as LogIndex from '../../timeline/logIndex';\nimport { strokeRoundedRect, fillRoundedRect } from './canvas';\nimport Buffering from './buffering';\n\n// UI Assets\nconst wheelImg = new Image();\nwheelImg.src = require('../../icons/icon-chffr-wheel.svg');\n\n// these constants are named this way so that the names are the same in python and js\n// do not refactor them to have js style or more descriptive names\n// UI Measurements\nconst vwp_w = 1164;\nconst vwp_h = 874;\nconst bdr_s = 30;\n// driver monitoring constants\nconst _PITCH_NATURAL_OFFSET = 0.12; // eslint-disable-line no-underscore-dangle\nconst _YAW_NATURAL_OFFSET = 0.08; // eslint-disable-line no-underscore-dangle\nconst _PITCH_POS_ALLOWANCE = 0.04; // eslint-disable-line no-underscore-dangle\nconst _PITCH_WEIGHT = 1.35; // eslint-disable-line no-underscore-dangle\nconst _METRIC_THRESHOLD = 0.4; // eslint-disable-line no-underscore-dangle\nconst W = 160;\nconst H = 320;\nconst RESIZED_FOCAL = 320.0;\nconst FULL_W = 426;\nconst DM_FACE_THRESHOLD = 0.4; // probs below this disappear\nconst DM_EYE_THRESHOLD = 0.4; // probs below which blink is masked\nconst DM_BLINK_THRESHOLD = 0.5; // probs above this count as blinking\n\n// cache break index files\nconst STREAM_VERSION = 2;\n\nconst styles = (theme) => ({\n  hidden: {\n    display: 'none'\n  },\n  videoContainer: {\n    position: 'relative',\n    width: 850,\n    height: 640\n  },\n  videoImage: {\n    height: 'auto',\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n    zIndex: 1\n  },\n  videoUiCanvas: {\n    height: '100%',\n    left: 0,\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  },\n  thumbnail: {\n    height: '100%',\n    left: 0,\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  }\n});\n\nfunction intrinsicMatrix() {\n  return [\n    950.892854, 0, 584, 0,\n    0, 950.892854, 439, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 0,\n  ];\n}\n\nclass VideoPreview extends Component {\n  constructor(props) {\n    super(props);\n\n    this.updatePreview = this.updatePreview.bind(this);\n    this.onSourceLoaded = this.onSourceLoaded.bind(this);\n    this.onDisableBuffering = this.onDisableBuffering.bind(this);\n    // this.checkVideoBuffer = this.checkVideoBuffer.bind(this);\n\n    this.imageRef = React.createRef();\n    this.videoPlayer = React.createRef();\n    this.canvas_road = React.createRef();\n    this.canvas_lead = React.createRef();\n    this.canvas_carstate = React.createRef();\n    this.canvas_maxspeed = React.createRef();\n    this.canvas_speed = React.createRef();\n    this.canvas_face = React.createRef();\n\n    this.intrinsic = intrinsicMatrix();\n    this.frame = 0;\n\n    this.state = {\n      bufferTime: 4,\n      src: '',\n    };\n  }\n\n  componentDidMount() {\n    const { playSpeed } = this.props;\n    this.mounted = true;\n    if (this.videoPlayer.current) {\n      this.videoPlayer.current.playbackRate = playSpeed || 1;\n    }\n    this.rafLoop = raf(this.updatePreview);\n    this.checkVideoBuffer();\n    this.stopListening = TimelineWorker.onIndexed(() => this.checkDataBuffer());\n  }\n\n  componentDidUpdate(prevProps) {\n    // play state\n    this.checkVideoBuffer();\n    this.updateVideoSource(prevProps);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    if (this.rafLoop) {\n      raf.cancel(this.rafLoop);\n      this.rafLoop = null;\n    }\n    if (this.stopListening) {\n      this.stopListening();\n      this.stopListening = null;\n    }\n    if (this.stopListeningToVideo) {\n      this.stopListeningToVideo();\n      this.stopListeningToVideo = null;\n    }\n  }\n\n  updateVideoSource(prevProps) {\n    const { props } = this;\n    let segment = props.currentSegment;\n    if (!segment && props.nextSegment) {\n      const offset = TimelineWorker.currentOffset();\n      if (props.nextSegment.startOffset - offset < 5000) {\n        segment = props.nextSegment;\n      }\n    }\n    console.log(segment);\n    if (!segment) {\n      if (this.state.src !== '') {\n        this.setState({ src: '' });\n      }\n      return;\n    }\n\n    if (props.front) {\n      let base = `${process.env.REACT_APP_VIDEO_CDN}/hls/${props.dongleId}/${segment.url.split('/').pop()}`;\n      base += '/dcamera';\n      // We append count of segments with stream available as a cache-busting method\n      // on stream indexes served before route is fully uploaded\n      let segCount = segment.driverCameraStreamSegCount;\n      let src = `${base}/index.m3u8?v=${STREAM_VERSION}&s=${segCount}`;\n      if (this.state.src !== src) {\n        this.setState({ src });\n      }\n    } else if (this.state.src === '' || !prevProps.currentSegment || prevProps.currentSegment.route !== segment.route) {\n      let videoApi = VideoApi(segment.url, process.env.REACT_APP_VIDEO_CDN);\n      videoApi.getQcameraStreamIndex().then(() => {\n        let src = videoApi.getQcameraStreamIndexUrl() + `?s=${segment.cameraStreamSegCount}`\n        if (src !== this.state.src) {\n          this.setState({src});\n        }\n      }).catch(() => {\n        let src = videoApi.getRearCameraStreamIndexUrl() + `?s=${segment.cameraStreamSegCount}`;\n        if (src !== this.state.src) {\n          this.setState({src});\n        }\n      });\n    }\n  }\n\n  onSourceLoaded() {\n    if (this.videoPlayer.current) {\n      console.log('Calling load with media change');\n      this.videoPlayer.current.load();\n    }\n  }\n\n  onDisableBuffering() {\n    TimelineWorker.disableBuffer();\n  }\n\n  updatePreview() {\n    // schedule next run right away so that we can return early\n    this.rafLoop = raf(this.updatePreview);\n\n    this.frame++;\n    if (this.frame >= 60) {\n      this.frame = 0;\n      this.checkVideoBuffer();\n    }\n\n    // 10 fps\n    if (this.frame % 6 === 0) {\n      this.checkDataBuffer();\n    }\n    if (this.frame % 6 === 3) {\n      this.renderCanvas();\n    }\n  }\n\n  checkDataBuffer = debounce(() => {\n    let isDataBuffering = true;\n    if (this.props.currentSegment) {\n      const monoTime = TimelineWorker.currentLogMonoTime();\n      const monoTimeLength = (`${monoTime}`).length;\n      const logIndex = TimelineWorker.getLogIndex();\n      if (logIndex) {\n        const curIndex = LogIndex.findMonoTime(logIndex, monoTime);\n        const lastEvent = TimelineWorker.getEvent(curIndex, logIndex);\n        let nextEvent = TimelineWorker.getEvent(curIndex + 1, logIndex);\n\n        if (!nextEvent) {\n          nextEvent = TimelineWorker.getEvent(0, TimelineWorker.getNextLogIndex());\n        }\n\n        if (nextEvent && nextEvent.LogMonoTime) {\n          const nextEventTime = Number(nextEvent.LogMonoTime.substr(0, monoTimeLength));\n          const timeDiff = Math.abs(nextEventTime - monoTime);\n\n          isDataBuffering = timeDiff > 1000;\n        }\n        if (isDataBuffering && lastEvent && lastEvent.LogMonoTime) {\n          const monSec = lastEvent.LogMonoTime.substr(0, monoTimeLength);\n          const timeDiff = Math.abs(monoTime - Number(monSec));\n          // 3 seconds of grace\n          isDataBuffering = timeDiff > 3000;\n        }\n      }\n    } else {\n      isDataBuffering = false;\n\n      if (this.props.bufferVideo) {\n        console.log('Exited segment while buffering, exiting buffer state');\n        TimelineWorker.bufferVideo(false);\n      }\n    }\n\n    if (isDataBuffering !== this.props.bufferingData) {\n      console.log('Changing data buffer state to', isDataBuffering);\n      TimelineWorker.bufferData(isDataBuffering);\n    }\n  }, 100)\n\n  checkVideoBuffer = debounce(() => {\n    const videoPlayer = this.videoPlayer.current;\n    const { front } = this.props;\n\n    if (videoPlayer && !videoPlayer.wasConnected) {\n      videoPlayer.wasConnected = true;\n      if (this.stopListeningToVideo) {\n        this.stopListeningToVideo();\n        this.stopListeningToVideo = null;\n      }\n      this.stopListeningToVideo = videoPlayer.subscribeToStateChange(this.checkVideoBuffer);\n    }\n\n    const offset = TimelineWorker.currentOffset();\n    let shouldShowPreview = true;\n    const { bufferTime } = this.state;\n    const { playSpeed } = this.props;\n    let { desiredPlaySpeed } = this.props;\n\n    if (videoPlayer) {\n      const playerState = videoPlayer.getState().player;\n      if (!playerState.buffered || Number.isNaN(playerState.duration)) {\n        return;\n      }\n      let desiredVideoTime = this.currentVideoTime(offset);\n      const curVideoTime = playerState.currentTime;\n      if (desiredPlaySpeed && this.props.currentSegment) {\n        const timeDiff = desiredVideoTime - curVideoTime;\n\n        let desiredBufferedVideoTime = desiredVideoTime;\n        if (this.props.bufferingVideo) {\n          // if we're currently already paused buffering for video\n          // then wait for another few seconds of video t oload\n          desiredBufferedVideoTime += 3 * desiredPlaySpeed;\n        }\n        // clip the duration down slightly to handle rounding errors near the end of video\n        desiredVideoTime = Math.min(playerState.duration - 0.4, desiredVideoTime);\n        desiredBufferedVideoTime = Math.min(playerState.duration - 0.4, desiredBufferedVideoTime);\n\n        let isBuffering = true;\n        let remainingTime = desiredBufferedVideoTime;\n\n        for (let i = 0, buf = playerState.buffered, len = buf.length; i < len; ++i) {\n          let start = buf.start(i);\n          // if we seek to a spot **right** at the start of an already loaded segment then\n          // HLS doesn't actually load that segment. it just expects to jump forwards a bit and be fine\n          // because of this, the first 4 seconds of a given video is almost never available\n          // additionally, sometimes even in the middle of the video it can be off and not load due to rounding errors\n          // we check if we're in the first 5 seconds or if we're *right* before the start\n          // \"stuck seeking\" errors are handled below\n          if (start < 6 && desiredVideoTime < 6) {\n            start = desiredVideoTime;\n            desiredBufferedVideoTime = desiredVideoTime;\n          }\n          if (start > desiredVideoTime && start - desiredVideoTime < 0.5) {\n            start = desiredVideoTime;\n          }\n          if (start <= desiredVideoTime) {\n            if (buf.end(i) >= desiredBufferedVideoTime) {\n              isBuffering = false;\n            } else {\n              remainingTime = Math.min(remainingTime, desiredBufferedVideoTime - buf.end(i));\n            }\n          }\n        }\n\n        if (isBuffering) {\n          // console.log('We need', remainingTime, 'more time buffered...');\n        }\n\n        if (desiredVideoTime > 5 && (playerState.waiting || playerState.seeking)) {\n          isBuffering = true;\n        }\n\n        const timeDiffAbs = Math.abs(timeDiff);\n        if (Number.isFinite(timeDiff) && timeDiffAbs > 0) {\n          if (this.props.isBuffering && playerState.paused && !playerState.seeking && timeDiffAbs > 1.0) {\n            // console.log('SEEK paused', timeDiff);\n            videoPlayer.seek(desiredVideoTime);\n            isBuffering = true;\n          } else if (timeDiffAbs > 1.0) {\n            // console.log('Seeking video', timeDiff, desiredVideoTime, curVideoTime);\n            videoPlayer.seek(desiredVideoTime);\n            if (desiredVideoTime > 5) {\n              isBuffering = true;\n            }\n          } else if (timeDiffAbs > 0.2) {\n            desiredPlaySpeed += timeDiff;\n          // } else {\n          }\n        }\n\n        if (isBuffering && !front) {\n          isBuffering = this.updatePreviewImage(playerState.seeking ? null : timeDiff);\n        } else if (this.state.shouldShowThumbnail) {\n          this.setState({\n            shouldShowThumbnail: false\n          });\n        }\n\n        if (this.props.bufferingVideo !== isBuffering) {\n          // console.log('Changing video buffer state to', isBuffering);\n          TimelineWorker.bufferVideo(isBuffering);\n        }\n\n        shouldShowPreview = isBuffering;\n\n        desiredPlaySpeed = Math.round(desiredPlaySpeed * 5) / 5;\n\n        if (videoPlayer.playbackRate !== desiredPlaySpeed) {\n          videoPlayer.playbackRate = desiredPlaySpeed;\n        }\n\n        if (!isBuffering && !this.props.bufferingData && this.props.currentSegment && playerState.paused) {\n          console.log('Play');\n          videoPlayer.play();\n        }\n        if (!isBuffering && this.props.isBuffering && !playerState.paused) {\n          console.log('Pause for buffering...');\n          videoPlayer.pause();\n        }\n      } else {\n        // desired player speed is 0 or there's no segment\n        // either way, no video to load\n        if (this.props.bufferingVideo) {\n          TimelineWorker.bufferVideo(false);\n        }\n        if (this.props.currentSegment) {\n          if (front || this.updatePreviewImage()) {\n            // no image\n            if (Math.abs(curVideoTime - desiredVideoTime) > 1) {\n              videoPlayer.seek(desiredVideoTime);\n            }\n          }\n        }\n        shouldShowPreview = !this.props.currentSegment || !playerState.buffered.length;\n        if (!playerState.paused && !playerState.seeking && playerState.buffered.length) {\n          console.log('Pause');\n          videoPlayer.pause();\n        }\n      }\n    }\n    if (this.imageRef.current) {\n      if (shouldShowPreview && this.imageRef.current.src !== this.nearestImageFrame(offset)) {\n        this.imageRef.current.src = this.nearestImageFrame(offset);\n      }\n      this.imageRef.current.style.opacity = shouldShowPreview ? 1 : 0;\n    }\n  }, 100)\n\n  updatePreviewImage(timeDiff) {\n    const { shouldShowThumbnail } = this.state;\n    const thumbnail = TimelineWorker.currentThumbnail();\n    const monoTime = TimelineWorker.currentLogMonoTime();\n    const monoTimeLength = (`${monoTime}`).length;\n    let retVal = true;\n    if (thumbnail) {\n      const { thumbnailMonoTime } = this.state;\n      const thumbnailTime = Number(thumbnail.LogMonoTime.substr(0, monoTimeLength));\n      const thumbnailTimeDiff = thumbnailTime;\n\n      if (Number.isFinite(timeDiff) && timeDiff > 0 && timeDiff < thumbnailTimeDiff) {\n        retVal = false;\n        // the video is closer than we are\n      } else if (thumbnailMonoTime !== thumbnail.LogMonoTime || !shouldShowThumbnail) {\n        const base64 = btoa(String.fromCharCode(...new Uint8Array(thumbnail.Thumbnail.Thumbnail)));\n        this.setState({\n          thumbnailData: base64,\n          thumbnailMonoTime: thumbnail.LogMonoTime,\n          shouldShowThumbnail: true\n        });\n      }\n      retVal = false;\n    } else if (shouldShowThumbnail) {\n      this.setState({\n        shouldShowThumbnail: false\n      });\n    }\n\n    return retVal;\n  }\n\n  renderCanvas() {\n    const calibration = TimelineWorker.getCalibration(this.props.route);\n    if (!calibration) {\n      this.lastCalibrationTime = false;\n      return;\n    }\n\n    if (this.props.front) {\n      if (this.canvas_face.current) {\n        const params = { calibration, shouldScale: true };\n        const events = {\n          driverMonitoring: TimelineWorker.currentDriverMonitoring\n        };\n        this.renderEventToCanvas(\n          this.canvas_face.current, params, events, this.renderDriverMonitoring\n        );\n      }\n    }\n\n    if (!this.props.shouldShowUI) {\n      return;\n    }\n\n    if (calibration) {\n      if (this.lastCalibrationTime !== calibration.LogMonoTime) {\n        this.extrinsic = [...calibration.LiveCalibration.ExtrinsicMatrix, 0, 0, 0, 1];\n      }\n      this.lastCalibrationTime = calibration.LogMonoTime;\n    }\n    if (this.canvas_road.current) {\n      const params = { calibration, shouldScale: true };\n      const events = {\n        model: TimelineWorker.currentModel,\n        mpc: TimelineWorker.currentMPC,\n        carState: TimelineWorker.currentCarState,\n      };\n      this.renderEventToCanvas(\n        this.canvas_road.current, params, events, this.drawLaneFull\n      );\n    }\n    if (this.canvas_lead.current) {\n      const params = { calibration, shouldScale: true };\n      const events = { live20: TimelineWorker.currentLive20 };\n      this.renderEventToCanvas(\n        this.canvas_lead.current, params, events, this.renderLeadCars\n      );\n    }\n    if (this.canvas_carstate.current) {\n      const params = { calibration, shouldScale: true };\n      const events = { carState: TimelineWorker.currentCarState };\n      this.renderEventToCanvas(\n        this.canvas_carstate.current, params, events, this.renderCarState\n      );\n    }\n    if (this.canvas_maxspeed.current) {\n      const params = { calibration, shouldScale: true };\n      const events = {\n        live100: TimelineWorker.currentLive100,\n        liveMapData: TimelineWorker.currentLiveMapData,\n        initData: TimelineWorker.currentInitData,\n      };\n      this.renderEventToCanvas(\n        this.canvas_maxspeed.current, params, events, this.renderMaxSpeed\n      );\n    }\n    if (this.canvas_speed.current) {\n      const params = { calibration, shouldScale: true };\n      const events = {\n        live100: TimelineWorker.currentLive100,\n        initData: TimelineWorker.currentInitData,\n      };\n      this.renderEventToCanvas(\n        this.canvas_speed.current, params, events, this.renderSpeed\n      );\n    }\n  }\n\n  renderEventToCanvas(canvas, params, events, renderEvent) {\n    const { width, height } = canvas.getBoundingClientRect();\n\n    if (!params.calibration) {\n      const ctx = canvas.getContext('2d');\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      ctx.clearRect(0, 0, width, height);\n      return; // loading calibration from logs still...\n    }\n\n    let logTime; let\n      monoIndex;\n    const _events = {};\n    let needsRender = false;\n    const eventsSig = Object.keys(events).join(',');\n    Object.keys(events).map((key) => {\n      const event = events[key].apply(TimelineWorker);\n      monoIndex = `${events[key].name}MonoTime${eventsSig}`;\n\n      if (!event) {\n        if (this[monoIndex]) {\n          this[monoIndex] = false;\n          const ctx = canvas.getContext('2d');\n          ctx.setTransform(1, 0, 0, 1, 0, 0);\n          ctx.clearRect(0, 0, width, height);\n          // we have to force re-render when one is missing\n          // this is because there's more than one event being rendered through this flow\n          // this should be re-broken apart such that this isn't an issue\n          // fixing that will also reduce the rendering complexity\n          needsRender = true;\n        }\n      } else {\n        logTime = event ? event.LogMonoTime : null;\n        needsRender = needsRender || logTime !== this[monoIndex];\n        this[monoIndex] = logTime;\n        _events[key] = event;\n      }\n    });\n\n    if (!needsRender) {\n      return;\n    }\n    // will render!\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    // reset transform before anything, just in case\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    // clear all the data\n    ctx.clearRect(0, 0, width, height);\n    // scale original coords onto our current size\n    if (params.shouldScale) {\n      ctx.scale(width / vwp_w, height / vwp_h);\n    }\n\n    renderEvent.apply(this, [{ width, height, ctx }, _events]);\n  }\n\n  renderLeadCars(options, events) {\n    if (!events.live20) {\n      return;\n    }\n    this.lastLive20MonoTime = events.live20.LogMonoTime;\n    const { width, height, ctx } = options;\n\n    const leadOne = events.live20.Live20.LeadOne;\n    const leadTwo = events.live20.Live20.LeadTwo;\n\n    if (leadOne.Status) {\n      this.renderLeadCar(options, leadOne);\n    }\n    if (leadTwo.Status) {\n      this.renderLeadCar(options, leadTwo, true);\n    }\n  }\n\n  renderLeadCar(options, leadData, is2ndCar) {\n    const { width, height, ctx } = options;\n\n    const drel = leadData.DRel;\n    const vrel = leadData.VRel;\n    const yrel = leadData.YRel;\n\n    var x = drel + 2.7;\n    var y = yrel;\n\n    var [x, y, z] = this.carSpaceToImageSpace([drel + 2.7, yrel, 0, 1]);\n\n    if (x < 0 || y < 0) {\n      return;\n    }\n\n    let sz = 25 * 30;\n    sz /= ((drel + 2.7) / 3 + 30);\n    sz = Math.min(Math.max(sz, 15), 30);\n    if (is2ndCar) {\n      sz /= 1.2;\n    }\n\n    let fillAlpha = 0;\n    const speedBuff = 10;\n    const leadBuff = 40;\n\n    if (drel < leadBuff) {\n      fillAlpha = 255 * (1 - (drel / leadBuff));\n      if (vrel < 0) {\n        fillAlpha += 255 * (-1 * (vrel / speedBuff));\n      }\n      fillAlpha = Math.min(fillAlpha, 255) / 255;\n    }\n\n    // glow\n    if (is2ndCar) {\n      ctx.fillStyle = 'rgba(218, 202, 37, 0.5)';\n    } else {\n      ctx.fillStyle = 'rgb(218, 202, 37)';\n    }\n    ctx.lineWidth = 5;\n    const g_xo = sz / 5;\n    const g_yo = sz / 10;\n    ctx.beginPath();\n    ctx.moveTo(x + (sz * 1.35) + g_xo, y + sz + g_yo);\n    ctx.lineTo(x, y - g_xo);\n    ctx.lineTo(x - (sz * 1.35) - g_xo, y + sz + g_yo);\n    ctx.lineTo(x + (sz * 1.35) + g_xo, y + sz + g_yo);\n    ctx.fill();\n\n    if (fillAlpha > 0) {\n      if (is2ndCar) {\n        fillAlpha /= 1.5;\n      }\n      ctx.fillStyle = `rgba(201, 34, 49, ${fillAlpha})`;\n\n      ctx.beginPath();\n      ctx.moveTo(x + (sz * 1.25), y + sz);\n      ctx.lineTo(x, y);\n      ctx.lineTo(x - (sz * 1.25), y + sz);\n      ctx.lineTo(x + (sz * 1.25), y + sz);\n      ctx.fill();\n    }\n  }\n\n  drawLaneFull(options, events) { // ui_draw_vision_lanes\n    const { ctx } = options;\n    if (events) {\n      if (events.model) {\n        this.drawLaneBoundary(ctx, events.model.Model.LeftLane);\n        this.drawLaneBoundary(ctx, events.model.Model.RightLane);\n        this.drawLaneTrack(options, events.model.Model.Path);\n      }\n      if (events.mpc && events.carState) {\n        this.drawLaneTrack(options, events.mpc.LiveMpc, {\n          isMpc: true,\n          isEnabled: events.carState.CarState.CruiseState.Enabled,\n        });\n      }\n    }\n  }\n\n  drawLaneBoundary(ctx, lane) { // ui_draw_lane\n    let color = `rgba(255, 255, 255,${lane.Prob})`;\n\n    let points;\n    if (lane.Points.length > 0) {\n      points = lane.Points;\n    } else {\n      points = [];\n      for (let i = 0; i < 192; i++) {\n        points.push(lane.Poly[0] * (i * i * i) + lane.Poly[1] * (i * i) + lane.Poly[2] * i + lane.Poly[3]);\n      }\n    }\n    this.drawLaneLine(ctx, points, 0.035 * lane.Prob, color, false);\n    const offset = Math.min(lane.Std, 0.7);\n    color = `rgba(255, 255, 255,${lane.Prob})`;\n    this.drawLaneLine(ctx, points, -offset, color, true);\n    this.drawLaneLine(ctx, points, offset, color, true);\n  }\n\n  drawLaneLine(ctx, points, off, color, isGhost) { // ui_draw_lane_line\n    ctx.beginPath();\n    let started = false;\n    const line_height = 49;\n    for (let i = 0; i < line_height; i++) {\n      const px = i;\n      const py = points[i] - off;\n      const [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (y < 0) {\n        continue;\n      }\n      if (!started) {\n        ctx.moveTo(x, y);\n        started = true;\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    for (let i = line_height; i > 0; i--) {\n      const px = i == line_height ? line_height : i;\n      const py = isGhost ? (points[i] - off) : (points[i] + off);\n      const [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (y < 0) {\n        continue;\n      }\n      ctx.lineTo(x, y);\n    }\n    ctx.closePath();\n    if (!isGhost) {\n      ctx.fillStyle = color;\n      ctx.fill();\n    } else {\n      ctx.strokeStyle = color;\n      ctx.lineWidth = 0.1;\n      ctx.stroke();\n    }\n  }\n\n  drawLaneTrack(options, path, params) {\n    const { ctx } = options;\n    let isMpc; let\n      isEnabled;\n    if (params) {\n      isMpc = params.isMpc;\n      isEnabled = params.isEnabled;\n    }\n    ctx.beginPath();\n    let started = false;\n    const offset = isMpc ? 0.3 : 0.5;\n    const path_height = isMpc ? 20 : 49;\n    let points;\n    if (path.Points.length > 0) {\n      points = path.Points;\n    } else {\n      points = [];\n      for (let i = 0; i < 192; i++) {\n        points.push(path.Poly[0] * (i * i * i) + path.Poly[1] * (i * i) + path.Poly[2] * i + path.Poly[3]);\n      }\n    }\n    for (let i = 0; i <= path_height; i++) {\n      let px; let\n        py;\n      if (isMpc) {\n        px = path.X[i];\n        py = path.Y[i] - offset;\n      } else {\n        px = i;\n        py = points[i] - offset;\n      }\n      let [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (i === 0) {\n        y = vwp_h;\n      } else if (y < 0) {\n        continue;\n      }\n\n      if (!started) {\n        ctx.moveTo(x, y);\n        started = true;\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    for (let i = path_height; i >= 0; i--) {\n      let px; let\n        py;\n      if (isMpc) {\n        px = path.X[i];\n        py = path.Y[i] + offset;\n      } else {\n        px = i;\n        py = points[i] + offset;\n      }\n      let [x, y, z] = this.carSpaceToImageSpace([px, py, 0.0, 1.0]);\n      if (i === 0) {\n        y = vwp_h;\n      } else if (y < 0) {\n        continue;\n      }\n      ctx.lineTo(x, y);\n    }\n    ctx.closePath();\n    let track_bg;\n    if (isMpc) {\n      track_bg = ctx.createLinearGradient(vwp_w, vwp_h - 40, vwp_w, vwp_h * 0.4);\n      if (isEnabled) {\n        track_bg.addColorStop(0, 'rgba(23, 134, 68, 0.8)');\n        track_bg.addColorStop(1, 'rgba(14, 89, 45, 0.8)');\n      } else {\n        track_bg.addColorStop(0, 'rgba(23, 88, 134, 0.6)');\n        track_bg.addColorStop(1, 'rgba(15, 58, 89, 0.6)');\n      }\n    } else {\n      track_bg = ctx.createLinearGradient(vwp_w, vwp_h, vwp_w, vwp_h * 0.5);\n      track_bg.addColorStop(0, 'rgba(255, 255, 255, 0.8)');\n      track_bg.addColorStop(1, 'rgba(255, 255, 255, 0.0)');\n    }\n    ctx.fillStyle = track_bg;\n    ctx.fill();\n  }\n\n  renderCarState(options, events) {\n    if (events && events.carState) {\n      this.drawCarStateBorder(options, events.carState.CarState);\n      this.drawCarStateWheel(options, events.carState.CarState);\n    }\n  }\n\n  renderSpeed(options, events) {\n    if (events && events.live100 && events.initData) {\n      this.drawSpeed(options, events.live100.Live100, events.initData.InitData);\n    }\n  }\n\n  drawSpeed(options, Live100, InitData) {\n    const { ctx } = options;\n\n    let speed = Live100.VEgo;\n\n    const metricParam = InitData.Params.Entries.find((entry) => entry.Key === 'IsMetric');\n    const isMetric = metricParam.Value === '1';\n    if (isMetric) {\n      speed = Math.floor(speed * 3.6 + 0.5);\n    } else {\n      speed = Math.floor(speed * 2.2369363 + 0.5);\n    }\n\n    const x = vwp_w / 2;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.font = '700 128px Open Sans';\n    ctx.fillStyle = 'rgb(255,255,255)';\n    ctx.fillText(speed, x, 140);\n\n    ctx.font = '400 48px Open Sans';\n    ctx.fillStyle = 'rgba(255,255,255,200)';\n    if (isMetric) {\n      ctx.fillText('kph', x, 210);\n    } else {\n      ctx.fillText('mph', x, 210);\n    }\n  }\n\n  renderMaxSpeed(options, events) {\n    if (events && events.live100 && events.initData) {\n      const liveMapData = (events.liveMapData && events.liveMapData.LiveMapData) || undefined;\n      this.drawMaxSpeed(options, events.live100.Live100, liveMapData, events.initData.InitData);\n    }\n  }\n\n  drawMaxSpeed(options, Live100, LiveMapData, InitData) {\n    const { ctx } = options;\n\n    const maxSpeed = Live100.VCruise;\n    let maxSpeedCalc = maxSpeed * 0.6225 + 0.5;\n    const isSpeedLimitValid = LiveMapData !== undefined && LiveMapData.SpeedLimitValid;\n    const speedLimit = (LiveMapData && LiveMapData.SpeedLimit) || 0;\n    let speedLimitCalc = speedLimit * 2.2369363 + 0.5;\n\n    let speedLimitOffset = 0;\n    const speedLimitOffsetParam = InitData.Params.Entries.find((entry) => entry.Key === 'SpeedLimitOffset');\n    if (speedLimitOffsetParam) {\n      speedLimitOffset = parseFloat(speedLimitOffsetParam.Value);\n    }\n\n    const metricParam = InitData.Params.Entries.find((entry) => entry.Key === 'IsMetric');\n    if (metricParam.Value === '1') {\n      maxSpeedCalc = maxSpeed + 0.5;\n      speedLimitCalc = speedLimit * 3.6 + 0.5;\n      speedLimitOffset = speedLimitOffset * 3.6 + 0.5;\n    }\n\n    const isCruiseSet = !isNaN(Live100.VCruise) && Live100.VCruise != 0 && Live100.VCruise != 255;\n\n    const isSetOverLimit = (\n      isSpeedLimitValid\n      && Live100.Enabled\n      && isCruiseSet\n      && maxSpeedCalc > (speedLimitCalc + speedLimitOffset)\n    );\n    const hysteresisOffset = 0.5; // TODO adjust to 0.0 if last isEgoOverLimit==true\n    const isEgoOverLimit = isSpeedLimitValid && Live100.VEgo > (speedLimit + speedLimitOffset + hysteresisOffset);\n    let speedLimWidth = Math.floor(180 * (2 / 3));\n    const width = Math.floor(184 * (2 / 3)) + speedLimWidth;\n    let height = Math.floor(202 * (2 / 3));\n\n    let left = bdr_s * 2 + (width - speedLimWidth * 2);\n    let top = bdr_s * 2;\n\n    // background\n    let fillStyle;\n    if (isSetOverLimit) {\n      fillStyle = 'rgba(218, 111, 37, 0.705)';\n    } else {\n      fillStyle = 'rgba(0, 0, 0, 0.392)';\n    }\n    fillRoundedRect(ctx, left, top, width, height, 30, fillStyle);\n\n    // border\n    let strokeStyle;\n    if (isSetOverLimit) {\n      strokeStyle = 'rgba(218, 111, 37, 1.0)';\n    } else if (isSpeedLimitValid && !isEgoOverLimit) {\n      strokeStyle = 'rgba(255, 255, 255, 1.0)';\n    } else if (isSpeedLimitValid && isEgoOverLimit) {\n      strokeStyle = 'rgba(255, 255, 255, 0.078)';\n    } else {\n      strokeStyle = 'rgba(255, 255, 255, 0.392)';\n    }\n    strokeRoundedRect(ctx, left, top, width, height, 20, 10, strokeStyle);\n\n    const textTopY = top + (26 * 4 / 3);\n    const textBottomY = textTopY + (48 * (4 / 3));\n    // MAX text\n    ctx.font = `${26 * (4 / 3)}px Open Sans`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    if (isCruiseSet) {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.784)';\n    } else {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.392)';\n    }\n\n    ctx.fillText('MAX', left + speedLimWidth / 2 + width / 2, textTopY);\n\n    // max speed text\n    if (isCruiseSet) {\n      ctx.font = `700 ${48 * (4 / 3)}px Open Sans`;\n      ctx.fillStyle = 'rgba(255, 255, 255, 1.0)';\n      ctx.fillText(Math.floor(maxSpeedCalc), 2 + left + speedLimWidth / 2 + width / 2, textBottomY);\n    } else {\n      ctx.font = `600 ${42 * (4 / 3)}px Open Sans`;\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.392)';\n      ctx.fillText('N/A', left + speedLimWidth / 2 + width / 2, textBottomY);\n    }\n\n    if (Live100.DecelForTurn && Live100.Enabled) {\n      const turnSpeed = Live100.VCurvature * 2.2369363 + 0.5;\n      ctx.fillStyle = 'rgba(255, 255, 255, 1.0)';\n      ctx.font = `700 ${25 * (4 / 3)}px Open Sans`;\n      ctx.fillText('TURN', 200 * (2 / 3) + left + speedLimWidth / 2 + width / 2, textTopY);\n      ctx.font = `700 ${50 * (4 / 3)}px Open Sans`;\n      ctx.fillText(Math.floor(turnSpeed), 200 * (2 / 3) + left + speedLimWidth / 2 + width / 2, textBottomY);\n    }\n\n    // Speed Limit\n    if (!isSpeedLimitValid) {\n      speedLimWidth -= Math.floor(5 * (2 / 3));\n      height -= Math.floor(10 * (2 / 3)) + 4;\n      left += Math.floor(9 * (2 / 3)) - 1;\n      top += Math.floor(5 * (2 / 3)) + 2;\n    }\n\n    const speedLimBorderRadius = isSpeedLimitValid ? 30 : 15;\n    // background\n    let speedLimFillStyle;\n\n    if (isSpeedLimitValid && isEgoOverLimit) {\n      speedLimFillStyle = 'rgba(218, 111, 37, 0.706)';\n    } else if (isSpeedLimitValid) {\n      speedLimFillStyle = 'rgba(255, 255, 255, 1.0)';\n    } else {\n      speedLimFillStyle = 'rgba(255, 255, 255, 0.392)';\n    }\n    fillRoundedRect(ctx, left, top, speedLimWidth, height, speedLimBorderRadius, speedLimFillStyle);\n\n    // border\n    if (isSpeedLimitValid) {\n      let speedLimStrokeStyle;\n      if (isEgoOverLimit) {\n        speedLimStrokeStyle = 'rgba(218, 111, 37, 1.0)';\n      } else {\n        speedLimStrokeStyle = 'rgba(255, 255, 255, 1.0)';\n      }\n      strokeRoundedRect(ctx, left, top, speedLimWidth, height, 20, 10, speedLimStrokeStyle);\n    }\n\n    ctx.font = `600 ${50 * (2 / 3)}px Open Sans`;\n    if (isSpeedLimitValid && isEgoOverLimit) {\n      ctx.fillStyle = 'rgba(255,255,255,1.0)';\n    } else {\n      ctx.fillStyle = 'rgba(0,0,0,1.0)';\n    }\n    ctx.fillText('SPEED',\n      left + speedLimWidth / 2 + 2,\n      top + (2 / 3) * (isSpeedLimitValid ? 35 : 30));\n    ctx.fillText('LIMIT',\n      left + speedLimWidth / 2,\n      top + (2 / 3) * (isSpeedLimitValid ? 80 : 75));\n\n\n    if (isEgoOverLimit) {\n      ctx.fillStyle = 'rgba(255,255,255,1.0)';\n    } else {\n      ctx.fillStyle = 'rgba(0,0,0,1.0)';\n    }\n    if (isSpeedLimitValid) {\n      ctx.font = `700 ${48 * (4 / 3)}px Open Sans`;\n      ctx.fillText(Math.floor(speedLimitCalc),\n        left + speedLimWidth / 2,\n        textBottomY + 3);\n    } else {\n      ctx.font = `600 ${42 * (4 / 3)}px Open Sans`;\n      ctx.fillText('N/A',\n        left + speedLimWidth / 2,\n        textBottomY + 3);\n    }\n  }\n\n  drawCarStateWheel(options, CarState) {\n    const { ctx } = options;\n\n    const radius = 80;\n    const x = vwp_w - (radius + (bdr_s * 2));\n    const y = radius + (bdr_s * 2);\n\n    // Wheel Background\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n    if (CarState.CruiseState.Enabled) {\n      ctx.fillStyle = theme.palette.states.engagedGreen;\n    } else if (CarState.CruiseState.Available) {\n      ctx.fillStyle = theme.palette.states.drivingBlue;\n    } else {\n      ctx.fillStyle = theme.palette.states.drivingBlue;\n    }\n    ctx.closePath();\n    ctx.fill();\n\n    // Rotate Wheel\n    ctx.translate(x, y);\n    ctx.rotate(0 - CarState.SteeringAngle * Math.PI / 180);\n    ctx.save();\n    ctx.translate(-x, -y);\n\n    // Wheel Image\n    ctx.beginPath();\n    ctx.arc(x, y, radius - (bdr_s / 2), 0, 2 * Math.PI, false);\n    const wheelImgPattern = ctx.createPattern(wheelImg, 'repeat');\n    ctx.fillStyle = wheelImgPattern;\n    ctx.closePath();\n    ctx.translate(vwp_w - ((bdr_s * 2) + bdr_s / 2), (bdr_s * 2) + bdr_s / 2);\n    ctx.fill();\n  }\n\n  drawCarStateBorder(options, carState) {\n    const { ctx } = options;\n    ctx.lineWidth = bdr_s * 2;\n\n    if (carState.CruiseState.Enabled) {\n      ctx.strokeStyle = theme.palette.states.engagedGreen;\n    } else if (carState.CruiseState.Available) {\n      ctx.strokeStyle = theme.palette.states.drivingBlue;\n    } else {\n      ctx.strokeStyle = theme.palette.states.drivingBlue;\n    }\n    ctx.strokeRect(0, 0, vwp_w, vwp_h);\n  }\n\n  renderDriverMonitoring(options, events) {\n    if (!events.driverMonitoring) {\n      return;\n    }\n\n    const { ctx } = options;\n    const driverMonitoring = events.driverMonitoring.DriverMonitoring;\n\n    if (driverMonitoring.FaceProb < 0.8) {\n      return;\n    }\n\n    const xW = vwp_h / 2;\n    const xOffset = vwp_w - xW;\n    let noseSize = 20;\n    ctx.translate(xOffset, 0);\n\n    const isDistracted = this.isDistracted(driverMonitoring);\n\n    const opacity = (driverMonitoring.FaceProb - DM_FACE_THRESHOLD) / (1 - DM_FACE_THRESHOLD) * 255;\n    noseSize *= 1 / (driverMonitoring.FaceProb);\n    let [x, y] = driverMonitoring.FacePosition.map((v) => v + 0.5);\n    x = toX(x);\n    y = toY(y);\n\n    const flatMatrix = this.rot_matrix(...driverMonitoring.FaceOrientation)\n      .reduce((m, v) => m.concat([...v, 1]), [])\n      .concat([0, 0, 0, 1]);\n    flatMatrix[3] = x;\n    flatMatrix[7] = y;\n\n    const p1 = this.matmul(flatMatrix, [0, 0, 0, 1]);\n    const p2 = this.matmul(flatMatrix, [0, 0, 100, 1]);\n\n    let isBlinking = false;\n\n    if (\n      driverMonitoring.LeftBlinkProb + driverMonitoring.RightBlinkProb > 2 * DM_BLINK_THRESHOLD\n      && driverMonitoring.LeftEyeProb > DM_EYE_THRESHOLD\n      && driverMonitoring.RightEyeProb > DM_EYE_THRESHOLD\n    ) {\n      isBlinking = true;\n    }\n\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    if (isDistracted) {\n      ctx.strokeStyle = `rgba(255, 0, 0, ${opacity})`;\n    } else if (isBlinking) {\n      ctx.strokeStyle = `rgba(255, 255, 0, ${opacity})`;\n    } else {\n      ctx.strokeStyle = `rgba(0, 255, 0, ${opacity})`;\n    }\n    ctx.arc(x, y, noseSize, 0, 2 * Math.PI);\n    ctx.stroke();\n    ctx.closePath();\n\n    // print raw and converted values, useful for debugging but super not pretty\n    // ctx.fillStyle = 'rgb(255,255,255)';\n    // ctx.font = '800 14px Open Sans';\n    // ctx.fillText(driverMonitoring.FaceOrientation[2], x + noseSize * 2, y);\n    // ctx.fillText(driverMonitoring.FaceOrientation[1], x, y + noseSize * 2);\n\n    // let pose = this.getDriverPose(driverMonitoring);\n\n    // ctx.fillText(pose.yaw, x + noseSize * 2, y + noseSize / 2);\n    // ctx.fillText(pose.pitch, x, y + noseSize * 2.5);\n\n    ctx.beginPath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = theme.palette.states.drivingBlue;\n    ctx.moveTo((p1[0]), (p1[1]));\n    ctx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;\n    ctx.lineTo((p2[0]), (p2[1]));\n    ctx.stroke();\n    ctx.closePath();\n\n    function toX(x) {\n      return (x * xW);\n    }\n    function toY(y) {\n      return (y * vwp_h);\n    }\n  }\n\n  isDistracted(driverMonitoring) {\n    const pose = this.getDriverPose(driverMonitoring);\n\n    let pitch_error = pose.pitch - _PITCH_NATURAL_OFFSET;\n    const yaw_error = pose.yaw - _YAW_NATURAL_OFFSET;\n    if (pitch_error > 0) {\n      pitch_error = Math.max(pitch_error - _PITCH_POS_ALLOWANCE, 0);\n    }\n\n    pitch_error *= _PITCH_WEIGHT;\n    const pose_metric = Math.sqrt(Math.pow(yaw_error, 2) + Math.pow(pitch_error, 2));\n    if (pose_metric > _METRIC_THRESHOLD) {\n      return true;\n    }\n    return false;\n  }\n\n  getDriverPose(driverMonitoring) {\n    // use driver monitoring units instead of canvas units\n    // that way code can be nearly identical\n    const angles_desc = driverMonitoring.FaceOrientation;\n    const pos_desc = driverMonitoring.FacePosition;\n\n    const pitch_net = angles_desc[0];\n    const yaw_net = angles_desc[1];\n    const roll_net = angles_desc[2];\n\n    const face_pixel_position = [(pos_desc[0] + 0.5) * W - W + FULL_W, (pos_desc[1] + 0.5) * H];\n    const yaw_focal_angle = Math.atan2(face_pixel_position[0] - FULL_W / 2, RESIZED_FOCAL);\n    const pitch_focal_angle = Math.atan2(face_pixel_position[1] - H / 2, RESIZED_FOCAL);\n\n    const roll = roll_net;\n    const pitch = pitch_net + pitch_focal_angle;\n    const yaw = -yaw_net + yaw_focal_angle;\n    return { roll, pitch, yaw };\n  }\n\n  carSpaceToImageSpace(coords) {\n    coords = this.matmul(this.extrinsic, coords);\n    coords = this.matmul(this.intrinsic, coords);\n\n    // project onto 3d with Z\n    coords[0] /= coords[2];\n    coords[1] /= coords[2];\n\n    return coords;\n  }\n\n  rot_matrix(roll, pitch, yaw) {\n    const cr = Math.cos(roll);\n    const sr = Math.sin(roll);\n    const cp = Math.cos(pitch);\n    const sp = Math.sin(pitch);\n    const cy = Math.cos(yaw);\n    const sy = Math.sin(yaw);\n\n    const rr = [\n      [1, 0, 0],\n      [0, cr, -sr],\n      [0, sr, cr]\n    ];\n    const rp = [\n      [cp, 0, sp],\n      [0, 1, 0],\n      [-sp, 0, cp]\n    ];\n    const ry = [\n      [cy, -sy, 0],\n      [sy, cy, 0],\n      [0, 0, 1]\n    ];\n    return multiply(ry, multiply(rp, rr));\n  }\n\n  matmul(matrix, coord) {\n    const b0 = coord[0]; const b1 = coord[1]; const b2 = coord[2]; const\n      b3 = coord[3];\n\n    coord[0] = b0 * matrix[0] + b1 * matrix[1] + b2 * matrix[2] + b3 * matrix[3];\n    coord[1] = b0 * matrix[4] + b1 * matrix[5] + b2 * matrix[6] + b3 * matrix[7];\n    coord[2] = b0 * matrix[8] + b1 * matrix[9] + b2 * matrix[10] + b3 * matrix[11];\n    coord[3] = b0 * matrix[12] + b1 * matrix[13] + b2 * matrix[14] + b3 * matrix[15];\n\n    return coord;\n  }\n\n  currentVideoTime(offset = TimelineWorker.currentOffset()) {\n    if (!this.props.currentSegment) {\n      return 0;\n    }\n    offset -= this.props.currentSegment.routeOffset;\n    offset = offset / 1000;\n\n    if (!this.props.front) {\n      let initData = TimelineWorker.currentInitData();\n      let firstFrameTime = TimelineWorker.firstFrameTime();\n\n      if (initData !== null && firstFrameTime !== null) {\n        offset -= (firstFrameTime - initData.LogMonoTime/1e9);\n      }\n    }\n\n    return offset;\n  }\n\n  // nearest cache-worthy frame of the video\n  // always show a frame before the current offset so that data is what happened\n  // after this frame was seen, that way you can't see things it hasn't reacted to\n  nearestImageFrame(offset = TimelineWorker.currentOffset()) {\n    const segment = this.props.currentSegment || this.props.nextSegment;\n    if (!segment) {\n      return '';\n    }\n    offset -= segment.routeOffset;\n    const seconds = Math.max(1, Math.floor(offset / 1000) * 1);\n\n    return `${segment.url}/sec${seconds}.jpg`;\n  }\n\n  render() {\n    const { classes } = this.props;\n    if (this.props.playSpeed !== this.props.desiredPlaySpeed && !this.props.isBuffering) {\n      console.log(this.props);\n      debugger;\n    }\n    return (\n      <div\n        className={classNames(classes.videoContainer, {\n          [classes.hidden]: false\n        })}\n      >\n        { this.props.isBuffering\n          && (\n          <Buffering\n            bufferingVideo={this.props.bufferingVideo}\n            bufferingData={this.props.bufferingData}\n            onDisableBuffering={this.onDisableBuffering}\n          />\n          )}\n        { this.state.shouldShowThumbnail\n          && (\n          <img\n            style={{ zIndex: 2 }}\n            className={this.props.classes.thumbnail}\n            src={`data:image/jpeg;base64,${this.state.thumbnailData}`}\n          />\n          )}\n        <Player\n          ref={this.videoPlayer}\n          style={{ zIndex: 1 }}\n          autoPlay={!!this.props.currentSegment}\n          muted\n          fluid={false}\n          src={this.state.src}\n          startTime={this.currentVideoTime()}\n          playbackRate={this.props.startTime > Date.now() ? 0 : this.props.playSpeed}\n          width={850}\n          height={640}\n        >\n          <HLSSource\n            onBufferAppend={this.checkVideoBuffer}\n            onSourceLoaded={this.onSourceLoaded}\n            isVideoChild\n          />\n          <ControlBar disabled disableCompletely />\n        </Player>\n        { this.props.shouldShowUI\n          && (\n            <>\n              <canvas\n                ref={this.canvas_road}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 3 }}\n              />\n              <canvas\n                ref={this.canvas_lead}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 4 }}\n              />\n              <canvas\n                ref={this.canvas_carstate}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 5 }}\n              />\n              <canvas\n                ref={this.canvas_maxspeed}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 6 }}\n              />\n              <canvas\n                ref={this.canvas_speed}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 7 }}\n              />\n            </>\n          )}\n        { this.props.front\n          && (\n            <>\n              <canvas\n                ref={this.canvas_face}\n                className={classes.videoUiCanvas}\n                style={{ zIndex: 3 }}\n              />\n            </>\n          )}\n      </div>\n    );\n  }\n}\n\nVideoPreview.propTypes = {\n  playSpeed: PropTypes.number.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return state.workerState;\n}\n\nexport default connect(mapStateToProps)(withStyles(styles)(VideoPreview));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport cx from 'classnames';\nimport Obstruction from 'obstruction';\nimport { classNames } from 'react-extras';\n\nimport {\n  withStyles,\n  Grid,\n  FormControl,\n  Select,\n  MenuItem,\n  Typography,\n} from '@material-ui/core';\n\nimport DriveMap from '../DriveMap';\nimport DriveVideo from '../DriveVideo';\n\nconst styles = (theme) => ({\n  mediaOptions: {\n    alignItems: 'center',\n    border: '1px solid rgba(255,255,255,.1)',\n    borderRadius: 50,\n    display: 'flex',\n    marginLeft: 'auto',\n    marginBottom: 12,\n  },\n  mediaOption: {\n    alignItems: 'center',\n    borderRight: '1px solid rgba(255,255,255,.1)',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    cursor: 'pointer',\n    minHeight: 32,\n    minWidth: 44,\n    opacity: '0.6',\n    '&.disabled': {\n      cursor: 'default',\n    },\n    '&:last-child': {\n      borderRight: 'none',\n    },\n  },\n  mediaOptionDisabled: {\n    cursor: 'auto',\n  },\n  mediaOptionIcon: {\n    backgroundColor: '#fff',\n    borderRadius: 3,\n    height: 20,\n    margin: '2px 0',\n    width: 30,\n  },\n  mediaOptionText: {\n    fontSize: 12,\n    fontWeight: 500,\n    textAlign: 'center',\n    textTransform: 'uppercase',\n  },\n  mediaSource: {\n    width: '100%',\n  },\n  mediaSourceSelect: {\n    width: '100%',\n  },\n});\n\nconst MediaType = {\n  VIDEO: 'video',\n  DRIVER_VIDEO: 'dcamera',\n  HUD: 'hud',\n  MAP: 'map'\n};\n\nclass Media extends Component {\n  constructor(props) {\n    super(props);\n\n    this.renderMediaOptions = this.renderMediaOptions.bind(this);\n\n    this.state = {\n      inView: MediaType.HUD,\n    };\n  }\n\n  render() {\n    const { classes } = this.props;\n    const { inView } = this.state;\n    return (\n      <>\n        { this.renderMediaOptions() }\n        { inView === MediaType.MAP && <DriveMap /> }\n        { (inView !== MediaType.MAP)\n          && (\n          <DriveVideo\n            shouldShowUI={inView === MediaType.HUD}\n            front={inView === MediaType.DRIVER_VIDEO}\n            onVideoChange={(noVideo) => {\n              this.setState({ inView: noVideo ? MediaType.MAP : inView });\n            }}\n          />\n          )}\n      </>\n    );\n  }\n\n  renderMediaOptions() {\n    const { classes, currentSegment } = this.props;\n    const { inView } = this.state;\n    const mediaSource = 'eon-road-camera';\n    const hasDriverCameraStream = this.props.currentSegment && this.props.currentSegment.hasDriverCameraStream;\n    return (\n      <Grid container>\n        <Grid\n          item\n          xs={hasDriverCameraStream ? 5 : 7}\n        />\n        <Grid\n          item\n          xs={hasDriverCameraStream ? 7 : 5}\n          className={classes.mediaOptions}\n        >\n          <Grid\n            item\n            xs={hasDriverCameraStream ? 3 : 4}\n            className={classes.mediaOption}\n            style={inView === MediaType.HUD ? { opacity: 1 } : { }}\n            onClick={() => this.setState({ inView: MediaType.HUD })}\n          >\n            <Typography className={classes.mediaOptionText}>\n              HUD\n            </Typography>\n          </Grid>\n          <Grid\n            item\n            xs={hasDriverCameraStream ? 3 : 4}\n            className={classes.mediaOption}\n            style={inView === MediaType.VIDEO ? { opacity: 1 } : {}}\n            onClick={() => this.setState({ inView: MediaType.VIDEO })}\n          >\n            <Typography className={classes.mediaOptionText}>\n              Video\n            </Typography>\n          </Grid>\n          { hasDriverCameraStream\n            && (\n            <Grid\n              item\n              xs={3}\n              className={cx(classes.mediaOption, { disabled: !hasDriverCameraStream })}\n              style={inView === MediaType.DRIVER_VIDEO ? { opacity: 1 } : {}}\n              onClick={() => hasDriverCameraStream && this.setState({ inView: MediaType.DRIVER_VIDEO })}\n            >\n              <Typography className={classes.mediaOptionText}>\n                Driver Video\n              </Typography>\n            </Grid>\n            )}\n          <Grid\n            item\n            xs={hasDriverCameraStream ? 3 : 4}\n            className={classes.mediaOption}\n            style={inView === MediaType.MAP ? { opacity: 1 } : { }}\n            onClick={() => this.setState({ inView: MediaType.MAP })}\n          >\n            <Typography className={classes.mediaOptionText}>\n              Map\n            </Typography>\n          </Grid>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  currentSegment: 'workerState.currentSegment',\n});\n\nexport default connect(stateToProps)(withStyles(styles)(Media));\n","import React, { Component } from 'react';\nimport Obstruction from 'obstruction';\nimport { classNames } from 'react-extras';\nimport PropTypes from 'prop-types';\nimport document from 'global/document';\nimport { timeout } from 'thyming';\nimport { partial } from 'ap';\nimport raf from 'raf';\nimport qs from 'querystringify';\nimport { withStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\nimport Snackbar from '@material-ui/core/Snackbar';\n\nimport { raw as RawApi } from '@commaai/comma-api';\nimport TimelineWorker from '../../timeline';\n\nconst styles = (theme) => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    paddingTop: theme.spacing.unit,\n    background: 'transparent',\n    textAlign: 'right'\n  },\n  footerButton: {\n    display: 'inline-block',\n    border: `1px solid ${theme.palette.grey[800]}`,\n    color: theme.palette.grey[50],\n    textDecoration: 'none',\n    borderRadius: 20,\n    padding: '10px 20px',\n    margin: '0px 10px',\n    cursor: 'pointer'\n  }\n});\n\nclass AnnotationsFooter extends Component {\n  constructor(props) {\n    super(props);\n\n    this.copySegmentName = this.copySegmentName.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.downloadSegmentFile = this.downloadSegmentFile.bind(this);\n    this.openInCabana = this.openInCabana.bind(this);\n    this.openWayInOsmEditor = this.openWayInOsmEditor.bind(this);\n    this.updateWayId = this.updateWayId.bind(this);\n\n    this.state = {\n      showCopiedSnack: false,\n      wayId: 0,\n    };\n  }\n\n  componentDidMount() {\n    raf(this.updateWayId);\n  }\n\n  updateWayId() {\n    raf(this.updateWayId);\n\n    const event = TimelineWorker.currentLiveMapData();\n    if (event && event.LiveMapData) {\n      const wayId = parseInt(event.LiveMapData.WayId);\n      if (wayId !== this.state.wayId) {\n        this.setState({ wayId });\n      }\n    } else if (this.state.wayId) {\n      this.setState({ wayId: 0 });\n    }\n  }\n\n  copySegmentName(e) {\n    const { segment } = this.props;\n    if (!segment) {\n      return;\n    }\n    const el = document.createElement('textarea');\n    el.value = `${segment.route}--${segment.segment}`;\n    el.setAttribute('readonly', '');\n    el.style.position = 'absolute';\n    el.style.left = '-9999px';\n    document.body.appendChild(el);\n    el.select();\n    document.execCommand('copy');\n    document.body.removeChild(el);\n\n    this.setState({\n      showCopiedSnack: true\n    });\n    this.snackTimer = timeout(this.handleClose, 1000);\n  }\n\n  async downloadSegmentFile(type) {\n    if (!this.props.segment) {\n      return;\n    }\n\n    const seg = this.props.segment;\n    const segmentKeyPath = `${seg.route.replace('|', '/')}/${seg.segment}`;\n\n    const files = (await RawApi.getRouteFiles(this.props.segment.route));\n    const url = files[type].find((url) => url.indexOf(segmentKeyPath) !== -1);\n\n    if (url) {\n      window.location.href = url;\n    }\n  }\n\n  handleClose() {\n    this.setState({\n      showCopiedSnack: false\n    });\n    this.snackTimer();\n  }\n\n  openInCabana() {\n    const { segment, loop, start } = this.props;\n    const currentOffset = TimelineWorker.currentOffset();\n    const params = {\n      route: segment.route,\n      url: segment.url,\n      seekTime: Math.floor((currentOffset - segment.routeOffset) / 1000)\n    };\n    const routeStartTime = (start + segment.routeOffset);\n\n    if (loop.startTime && loop.startTime > routeStartTime && loop.duration < 180000) {\n      const startTime = Math.floor((loop.startTime - routeStartTime) / 1000);\n      params.segments = [startTime, Math.floor(startTime + (loop.duration / 1000))].join(',');\n    }\n\n    const win = window.open(`https://my.comma.ai/cabana/${qs.stringify(params, true)}`, '_blank');\n    if (win.focus) {\n      win.focus();\n    }\n  }\n\n  openWayInOsmEditor() {\n    const { wayId } = this.state;\n    if (!wayId) {\n      return;\n    }\n\n    const win = window.open(`https://www.openstreetmap.org/way/${wayId}`, '_blank');\n    if (win.focus) {\n      win.focus();\n    }\n  }\n\n  render() {\n    return (\n      <Paper className={this.props.classes.root}>\n        { this.props.segment && this.props.segment.hasVideo\n          && (\n          <a className={this.props.classes.footerButton} onClick={partial(this.downloadSegmentFile, 'cameras')}>\n            Download Camera Segment\n          </a>\n          )}\n        { this.props.segment && this.props.segment.hasDriverCamera\n          && (\n          <a className={this.props.classes.footerButton} onClick={partial(this.downloadSegmentFile, 'dcameras')}>\n            Download Front Camera Segment\n          </a>\n          )}\n        { this.props.segment\n          && (\n          <a className={this.props.classes.footerButton} onClick={partial(this.downloadSegmentFile, 'logs')}>\n            Download Log Segment\n          </a>\n          )}\n        <a className={this.props.classes.footerButton} onClick={this.openWayInOsmEditor} href=\"#\">\n          Edit OpenStreetMap Here\n        </a>\n        <a className={classNames(this.props.classes.footerButton, 'openInCabana')} onClick={this.openInCabana} href=\"#\">\n          View CAN Data in Cabana\n        </a>\n        <a className={this.props.classes.footerButton} onClick={this.copySegmentName} target=\"_blank\">\n          Copy Current Segment\n        </a>\n        <Snackbar\n          anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'center'\n          }}\n          open={this.state.showCopiedSnack}\n          onClose={this.handleClose}\n          ContentProps={{\n            'aria-describedby': 'message-id',\n          }}\n          variant=\"success\"\n          message={<span id=\"message-id\">Copied segment name!</span>}\n        />\n      </Paper>\n    );\n  }\n}\n\nAnnotationsFooter.propTypes = {\n  segment: PropTypes.object.isRequired,\n  loop: PropTypes.object.isRequired,\n  start: PropTypes.number.isRequired\n};\n\nexport default withStyles(styles)(AnnotationsFooter);\n","// in line with xx/chffr/lib/route.py\n\nexport const DeviceType = {\n  ios: 2,\n  one: 3,\n  android: 5,\n};\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\n\nimport {\n  withStyles,\n  Grid,\n  Slide,\n  Paper,\n  Typography,\n  IconButton,\n} from '@material-ui/core';\nimport CloseIcon from '@material-ui/icons/Close';\nimport KeyboardBackspaceIcon from '@material-ui/icons/KeyboardBackspace';\n\nimport AnnotationTabs from './AnnotationTabs';\nimport EonUpsell from './eonUpsell';\nimport Media from './Media';\nimport Timeline from '../Timeline';\nimport TimeDisplay from '../TimeDisplay';\nimport AnnotationsFooter from './footer';\n\nimport { selectRange } from '../../actions';\nimport { DeviceType } from '../../defs/segments';\n\nconst styles = (theme) => ({\n  base: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexGrow: 1,\n  },\n  window: {\n    background: 'linear-gradient(to bottom, #30373B 0%, #272D30 10%, #1D2225 100%)',\n    borderRadius: 8,\n    display: 'flex',\n    flexDirection: 'column',\n    flexGrow: 1,\n    overflowY: 'scroll',\n    margin: 18,\n  },\n  header: {},\n  headerContext: {\n    alignItems: 'center',\n    display: 'flex',\n    padding: 12,\n    paddingLeft: 18,\n    paddingRight: 24,\n  },\n  headerTitle: {\n    fontSize: 22,\n    fontWeight: 700,\n    paddingLeft: 12,\n  },\n  headerActions: {\n    marginLeft: 'auto',\n  },\n  headerTimeline: {},\n  viewer: {\n    padding: theme.spacing.unit * 4,\n  },\n  footer: {\n    alignItems: 'center',\n    background: 'linear-gradient(to bottom, #30373B 0%, #272D30 10%, #1D2225 100%)',\n    display: 'flex',\n    marginTop: 'auto',\n    width: '100%',\n  },\n});\n\nclass Annotations extends Component {\n  constructor(props) {\n    super(props);\n\n    this.close = this.close.bind(this);\n  }\n\n  close() {\n    this.props.dispatch(selectRange(null, null));\n  }\n\n  renderAnnotationsElement(visibleSegment) {\n    if (visibleSegment.deviceType === DeviceType.one) {\n      return (<AnnotationTabs segment={visibleSegment} />);\n    }\n    return (<EonUpsell hook=\"Unlock driving annotations with an EON\" />);\n  }\n\n  render() {\n    const {\n      classes,\n      device,\n      loop,\n      currentSegment,\n      nextSegment,\n      start\n    } = this.props;\n    const visibleSegment = (currentSegment || nextSegment);\n    const routeName = visibleSegment ? visibleSegment.route : 'Nothing visible';\n    const shortName = routeName.split('|')[1];\n    return (\n      <div className={classes.base}>\n        <div className={classes.window}>\n          <div className={classes.header}>\n            <div className={classes.headerContext}>\n              <IconButton aria-label=\"Go Back\" onClick={() => window.history.back()}>\n                <KeyboardBackspaceIcon />\n              </IconButton>\n              <Typography className={classes.headerTitle}>\n                { this.props.device.alias }\n              </Typography>\n              <div className={classes.headerActions}>\n                <IconButton onClick={this.close} aria-label=\"Close\">\n                  <CloseIcon />\n                </IconButton>\n              </div>\n            </div>\n            <Timeline\n              className={classes.headerTimeline}\n              zoomed\n              colored\n              hasThumbnails\n              hasRuler\n              hasGradient\n              tooltipped\n              dragSelection\n            />\n          </div>\n          <div className={classes.viewer}>\n            <Grid container spacing={32}>\n              <Grid item xs={6}>\n                { visibleSegment && this.renderAnnotationsElement(visibleSegment) }\n              </Grid>\n              <Grid item xs={6}>\n                <Media />\n              </Grid>\n            </Grid>\n          </div>\n        </div>\n        <div className={classes.footer}>\n          <AnnotationsFooter segment={visibleSegment} loop={loop} start={start} />\n        </div>\n      </div>\n    );\n  }\n}\n\nconst stateToProps = Obstruction({\n  currentSegment: 'workerState.currentSegment',\n  nextSegment: 'workerState.nextSegment',\n  device: 'workerState.device',\n  loop: 'workerState.loop',\n  start: 'workerState.start'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(Annotations));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport PropTypes from 'prop-types';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport 'mapbox-gl/src/css/mapbox-gl.css';\n\nimport AppHeader from './AppHeader';\nimport Dashboard from './Dashboard';\nimport Annotations from './Annotations';\n\nimport Timelineworker from '../timeline';\nimport { selectRange, selectDevice } from '../actions';\nimport { getDongleID, getZoom } from '../url';\n\nconst styles = (/* theme */) => ({\n  base: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  header: {\n    display: 'flex',\n    height: 64,\n    minHeight: 64,\n  },\n  window: {\n    display: 'flex',\n    flexGrow: 1,\n    minHeight: 0,\n  },\n});\n\nclass ExplorerApp extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      settingDongle: null\n    };\n  }\n\n  componentWillMount() {\n    this.checkProps(this.props);\n  }\n\n  componentWillReceiveProps(props) {\n    this.checkProps(props);\n\n    const isZoomed = props.expanded;\n    const { expanded } = this.props;\n    const wasZoomed = expanded;\n\n    if (isZoomed && !wasZoomed) {\n      Timelineworker.play();\n    }\n    if (!isZoomed && wasZoomed) {\n      Timelineworker.pause();\n    }\n  }\n\n  checkProps(props) {\n    const dongleId = getDongleID(props.pathname);\n    const zoom = getZoom(props.pathname);\n\n    const { settingDongle } = this.state;\n    const curDongle = settingDongle || props.dongleId;\n    const { dispatch } = this.props;\n\n    if (dongleId) {\n      if (curDongle !== dongleId) {\n        if (!settingDongle) {\n          Timelineworker.selectDevice(dongleId);\n          this.setState({\n            settingDongle: dongleId\n          });\n        }\n      } else {\n        this.setState({\n          settingDongle: null\n        });\n      }\n    }\n    dispatch(selectRange(zoom.start, zoom.end));\n  }\n\n  render() {\n    const { classes, expanded } = this.props;\n    return (\n      <div className={classes.base}>\n        <div className={classes.header}>\n          <AppHeader />\n        </div>\n        <div className={classes.window}>\n          { expanded ? (<Annotations />) : (<Dashboard />) }\n        </div>\n      </div>\n    );\n  }\n}\n\nExplorerApp.propTypes = {\n  expanded: PropTypes.bool.isRequired,\n  dispatch: PropTypes.func.isRequired,\n  classes: PropTypes.object.isRequired\n};\n\nconst stateToProps = Obstruction({\n  expanded: 'zoom.expanded',\n  pathname: 'router.location.pathname',\n  dongleId: 'workerState.dongleId'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(ExplorerApp));\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Obstruction from 'obstruction';\nimport window from 'global/window';\nimport PropTypes from 'prop-types';\n\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\n\nimport { config as AuthConfig } from '@commaai/my-comma-auth';\n\nimport { CommaIcon } from '../icons';\n\nconst styles = (/* theme */) => ({\n  base: {\n    height: '60px',\n    margin: '0 auto',\n    marginTop: '30vh',\n    maxWidth: '560px',\n  },\n  title: {\n    display: 'inline',\n    fontFamily: 'MaisonNeueExtended',\n    fontSize: '24px',\n    fontWeight: 600,\n    lineHeight: '60px',\n    verticalAlign: 'top',\n  },\n  tagline: {\n    padding: '20px 0 52px',\n    fontSize: '18px',\n  },\n  logInButton: {\n    alignItems: 'center',\n    background: '#175886',\n    display: 'flex',\n    borderRadius: '100px',\n    fontSize: '21px',\n    height: '80px',\n    justifyContent: 'center',\n    textDecoration: 'none',\n    width: '100%',\n  },\n  logInText: {\n    fontFamily: 'MaisonNeue',\n    fontSize: '18px',\n    fontWeight: 600,\n  },\n  demoLink: {\n    textDecoration: 'none',\n    justifyContent: 'center',\n    width: '100%',\n    height: '40px',\n    paddingTop: '10px',\n    display: 'flex',\n  },\n  demoLinkText: {\n    fontSize: '18px',\n  },\n});\n\nconst DEMO_LINK = `${window.location.origin}/?demo=1`;\n\nclass AnonymousLanding extends Component {\n  componentWillMount() {\n    if (typeof window.sessionStorage !== 'undefined') {\n      const { pathname } = this.props;\n      sessionStorage.redirectURL = pathname;\n    }\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <div className={classes.base}>\n        <Typography className={classes.title}>\n          <CommaIcon style={{ fontSize: '2em' }} />\n          explorer\n        </Typography>\n        <Typography className={classes.tagline}>\n          Review and annotate your comma.ai driving data.\n        </Typography>\n        <a href={AuthConfig.oauthRedirectLink} className={classes.logInButton}>\n          <Typography className={classes.logInText}>\n            Log in with Google\n          </Typography>\n        </a>\n        <a href={DEMO_LINK} className={classes.demoLink}>\n          <Typography className={classes.demoLinkText}>\n            or try the demo\n          </Typography>\n        </a>\n      </div>\n    );\n  }\n}\n\nAnonymousLanding.propTypes = {\n  pathname: PropTypes.string.isRequired,\n  classes: PropTypes.object.isRequired\n};\n\nconst stateToProps = Obstruction({\n  pathname: 'router.location.pathname'\n});\n\nexport default connect(stateToProps)(withStyles(styles)(AnonymousLanding));\n","import extend from 'xtend';\nimport { WORKER_STATE_UPDATE } from '../actions/types';\n\nconst initialState = {\n};\n\nexport default function workerState(_state = initialState, action) {\n  let state = _state;\n  switch (action.type) {\n    case WORKER_STATE_UPDATE:\n      state = extend(state, action.data);\n      break;\n    default:\n      return state;\n  }\n\n  return state;\n}\n","import { TIMELINE_SELECTION_CHANGED } from '../actions/types';\n\nconst initialState = {\n  start: 0,\n  end: 0,\n  expanded: false\n};\n\nexport default function zoom(_state = initialState, action) {\n  let state = _state;\n  switch (action.type) {\n    case TIMELINE_SELECTION_CHANGED:\n      state = {\n        start: action.start,\n        end: action.end,\n        expanded: !!(action.start && action.end)\n      };\n      break;\n    default:\n      return state;\n  }\n\n  return state;\n}\n","import workerState from './workerState';\nimport zoom from './zoom';\n\nconst reducers = {\n  workerState,\n  zoom\n};\n\nexport default reducers;\n","import window from 'global/window';\nimport { compose } from 'redux';\nimport * as Actions from './actions';\n\nfunction getComposeEnhancers() {\n  if (process.env.NODE_ENV !== 'production' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) {\n    return window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\n      actionCreators: Object.values(Actions).filter((f) => f.name !== 'updateState')\n    });\n  }\n  return compose;\n}\n\nconst composeEnhancers = getComposeEnhancers();\n\nexport default composeEnhancers;\n","import * as Redux from 'redux';\nimport { connectRouter, routerMiddleware } from 'connected-react-router';\nimport thunk from 'redux-thunk';\nimport createHistory from 'history/createBrowserHistory';\nimport reducers from './reducers';\nimport compose from './devtools';\n\nexport const history = createHistory();\n\nexport function createStore() {\n  const store = Redux.createStore(\n    connectRouter(history)(\n      Redux.combineReducers(reducers)\n    ),\n    compose(Redux.applyMiddleware(thunk, routerMiddleware(history)))\n  );\n\n  return store;\n}\n","/* global gtag */\n\nconst GA_TRACKING_ID = 'UA-80079182-7';\n\nexport function initGoogleAnalytics(history) {\n  history.listen((location) => {\n    if (typeof gtag === 'function') {\n      gtag('config', GA_TRACKING_ID, {\n        page_title: document.title,\n        page_location: window.location.href,\n        page_path: location.pathname\n      });\n    }\n  });\n}\n","import React, { Component } from 'react';\nimport { Provider } from 'react-redux';\nimport { Route, Switch, Redirect } from 'react-router';\nimport { ConnectedRouter } from 'connected-react-router';\nimport { timeout } from 'thyming';\nimport document from 'global/document';\nimport qs from 'query-string';\nimport localforage from 'localforage';\nimport Jepsen from 'carly';\nimport Collector from 'collect-methods';\n\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\n\nimport MyCommaAuth, { config as AuthConfig, storage as AuthStorage } from '@commaai/my-comma-auth';\nimport { auth as AuthApi, request as Request } from '@commaai/comma-api';\n\nimport Explorer from './components/explorer';\nimport AnonymousLanding from './components/anonymous';\n\nimport TimelineWorker from './timeline';\nimport { history, createStore } from './store';\nimport { updateState } from './actions';\nimport { initGoogleAnalytics } from './analytics';\nimport * as Demo from './demo';\n\ninitGoogleAnalytics(history);\nconst store = createStore();\n\nTimelineWorker.onStateChange((data) => {\n  store.dispatch(updateState(data));\n});\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      initialized: false,\n      demo: false,\n    };\n\n    this.cancelInit = Collector();\n\n    const initDemoTimeline = Jepsen(() => {\n      TimelineWorker.init(true).then(initDemoState.callback);\n    });\n\n    const checkDemo = Jepsen((isDemo) => {\n      if (isDemo) {\n        return localforage.setItem('isDemo', '1')\n          .then(initDemoTimeline.callback);\n      }\n      return this.auth();\n    });\n\n    const initDemoState = Jepsen(() => {\n      TimelineWorker.selectTimeRange(1564443025000, Date.now());\n      this.setState({\n        initialized: true,\n        demo: true,\n      });\n    });\n\n    this.cancelInit(checkDemo.cancel);\n    this.cancelInit(initDemoTimeline.cancel);\n    this.cancelInit(initDemoState.cancel);\n\n    Demo.init().then(checkDemo.callback);\n  }\n\n  componentWillUnmount() {\n    this.cancelInit();\n    TimelineWorker.stop();\n  }\n\n  async auth() {\n    if (document.location) {\n      if (document.location.pathname == '/auth/g/redirect') {\n        const { code } = qs.parse(document.location.search);\n\n        try {\n          const token = await AuthApi.refreshAccessToken(code, AuthConfig.REDIRECT_URI);\n          if (token) {\n            AuthStorage.setCommaAccessToken(token);\n          }\n          // done authing!!\n        } catch (e) {\n          console.log(e);\n        }\n      }\n    }\n\n    const token = await MyCommaAuth.init();\n    Request.configure(token);\n\n    if (MyCommaAuth.isAuthenticated()) {\n      await TimelineWorker.init();\n    }\n\n    this.setState({ initialized: true });\n  }\n\n  redirectLink() {\n    let url = '/';\n    if (typeof window.sessionStorage !== 'undefined') {\n      url = sessionStorage.redirectURL || '/';\n    }\n    return url;\n  }\n\n  authRoutes() {\n    return (\n      <Switch>\n        <Route path=\"/auth/\" render={() => <Redirect to={this.redirectLink()} />} />\n        <Route path=\"/\" component={Explorer} />\n      </Switch>\n    );\n  }\n\n  ananymousRoutes() {\n    return (\n      <Switch>\n        <Route path=\"/auth/\" render={() => <Redirect to=\"/\" />} />\n        <Route path=\"/\" component={AnonymousLanding} />\n      </Switch>\n    );\n  }\n\n  renderLoading() {\n    return (\n      <Grid container alignItems=\"center\" style={{ width: '100%', height: '100%' }}>\n        <Grid item align=\"center\" xs={12}>\n          <CircularProgress size=\"10vh\" style={{ color: '#525E66' }} />\n        </Grid>\n      </Grid>\n    );\n  }\n\n  render() {\n    if (!this.state.initialized) {\n      return this.renderLoading();\n    }\n    return (\n      <Provider store={store}>\n        <ConnectedRouter history={history}>\n          { (MyCommaAuth.isAuthenticated() || this.state.demo) ? this.authRoutes() : this.ananymousRoutes() }\n        </ConnectedRouter>\n      </Provider>\n    );\n  }\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import Raven from 'raven-js';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport document from 'global/document';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { MuiThemeProvider } from '@material-ui/core/styles';\nimport MuiPickersUtilsProvider from 'material-ui-pickers/utils/MuiPickersUtilsProvider';\nimport DateFnsUtils from 'material-ui-pickers/utils/date-fns-utils';\n\nimport './index.css';\nimport 'react-virtualized/styles.css';\nimport App from './App';\nimport Theme from './theme';\nimport { unregister } from './registerServiceWorker';\n\nif (process.env.NODE_ENV === 'production') {\n  Raven.config(\n    'https://6a242abfa01b4660aa34f150e87de018@sentry.io/1234624',\n    { environment: process.env.NODE_ENV }\n  ).install();\n\n  unregister();\n}\n\nReactDOM.render((\n  <MuiThemeProvider theme={Theme}>\n    <CssBaseline />\n    <MuiPickersUtilsProvider utils={DateFnsUtils}>\n      <App />\n    </MuiPickersUtilsProvider>\n  </MuiThemeProvider>\n), document.getElementById('root'));\n","import * as capnp from 'capnp-ts';\nimport toJSON from '@commaai/capnp-json';\nimport BufferUtils from 'capnp-split/buffer';\nimport { Event, Event_Which as EventWhich } from '@commaai/log_reader/capnp/log.capnp';\n\n// IE\nif (!Number.MAX_SAFE_INTEGER) {\n  Number.MAX_SAFE_INTEGER = (2 ** 53) - 1;\n}\n\nfunction binSearch(index, start, end, milis, nanos) {\n  if (start >= end) {\n    return start;\n  }\n  const searchIndex = Math.floor((end - start) / 2) + start;\n  // searchIndex wont equal end, only start\n\n  if (milis < index[searchIndex][0]\n    || (milis === index[searchIndex][0] && nanos < index[searchIndex][1])) {\n    return binSearch(index, start, searchIndex, milis, nanos);\n  }\n  if (milis > index[searchIndex][0]\n    || (milis === index[searchIndex][0] && nanos > index[searchIndex][1])) {\n    if (searchIndex === index.length - 1\n      || milis < index[searchIndex + 1][0]\n      || (milis === index[searchIndex + 1][0] && nanos < index[searchIndex + 1][1])) {\n      return searchIndex;\n    }\n    return binSearch(index, searchIndex + 1, end, milis, nanos);\n  }\n  return searchIndex;\n}\n\nfunction indexBuffer(index, buffer, bufferIndex) {\n  let offset = 0;\n  const calibrations = [];\n  let lastIndex = index.length ? index.length - 1 : 0;\n  // debugger;\n\n  while (offset < buffer.byteLength) {\n    const messageBuff = BufferUtils.readMessage(buffer, offset);\n    const msg = new capnp.Message(messageBuff, false);\n    const event = msg.getRoot(Event);\n    const monoTime = event.getLogMonoTime().toString();\n    const milis = Number(monoTime.substr(0, monoTime.length - 6));\n    const nanos = Number(monoTime.substr(-6, 6));\n    const messageSize = messageBuff.byteLength;\n    const which = event.which();\n\n    if (which === EventWhich.LIVE_CALIBRATION) {\n      calibrations.push(toJSON(event));\n    }\n\n    if (!index.length\n      || (milis > index[index.length - 1][0]\n      || (milis === index[index.length - 1][0] && nanos > index[index.length - 1][1]))) {\n      index.push([\n        milis,\n        nanos,\n        offset,\n        messageSize,\n        bufferIndex,\n        which\n      ]);\n      lastIndex = index.length - 1;\n    } else {\n      let searchIndex = lastIndex;\n      let incAmount = 1;\n      // debugger;\n      while (searchIndex < index.length - 1\n        && (milis > index[searchIndex][0]\n        || (milis === index[searchIndex][0] && nanos > index[searchIndex][1]))) {\n        incAmount = Math.min(Math.floor(index.length - searchIndex / 2), incAmount * 2);\n        searchIndex = Math.min(searchIndex + incAmount, index.length - 1);\n      }\n      // debugger;\n      searchIndex = binSearch(index, searchIndex - incAmount, searchIndex, milis, nanos);\n      // debugger;\n      searchIndex += 1;\n      lastIndex = searchIndex;\n\n      index.splice(searchIndex, 0, [\n        milis,\n        nanos,\n        offset,\n        messageSize,\n        bufferIndex,\n        which\n      ]);\n    }\n    offset += messageSize;\n  }\n\n  return calibrations;\n}\n\nexport function createIndex(_buffer) {\n  const buffer = Buffer.from(_buffer);\n  const index = [];\n\n  const calibrations = indexBuffer(index, buffer, 0);\n\n  return {\n    index,\n    buffers: [buffer],\n    calibrations\n  };\n}\n\nexport function addToIndex(_index, _newBuff) {\n  const newBuff = Buffer.from(_newBuff);\n  const index = _index;\n  index.buffers.push(newBuff);\n  const calibrations = indexBuffer(index.index, newBuff, index.buffers.length - 1);\n  index.calibrations = index.calibrations.concat(calibrations);\n\n  return index;\n}\n\nexport function findMonoTime(index, monoTime, start = 0, end = index.index.length) {\n  if (start === index.index.length) {\n    return index.index.length - 1;\n  }\n  if (start >= end) {\n    return end;\n  }\n  // index is floored so always increase start\n  const curIndex = Math.floor((end - start) / 2 + start);\n  const curMillis = index.index[curIndex][0];\n  // we can have duplicates so we treat matches as being too high since we're\n  // looking for the first instance of a duplicate\n  if (monoTime < curMillis) {\n    return findMonoTime(index, monoTime, start, curIndex);\n  }\n  if (monoTime > curMillis) {\n    return findMonoTime(index, monoTime, curIndex + 1, end);\n  }\n\n  return curIndex;\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (resolve, reject) {\n  return handle;\n\n  function handle(err, data, response) {\n    if (err) {\n      if (err.statusCode === 0) {\n        err = new Error('There was an unexpected server error, please try again later.');\n      }\n\n      return reject(err);\n    }\n\n    resolve(data);\n  }\n};","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar COMMA_URL_ROOT = exports.COMMA_URL_ROOT = 'https://api.commadotai.com/';\nvar ATHENA_URL_ROOT = exports.ATHENA_URL_ROOT = 'https://athena.comma.ai/';\nvar VIDEO_HOST = exports.VIDEO_HOST = process.env.COMMA_VIDEO_CDN;\n\nif (!VIDEO_HOST) {\n  exports.VIDEO_HOST = VIDEO_HOST = 'https://my-comma-video.azureedge.net';\n}","\nfunction getDefaultStartDate() {\n  const d = new Date();\n  d.setHours(d.getHours() + 1, 0, 0, 0);\n\n  return (new Date(d.getTime() - 1000 * 60 * 60 * 24 * 14)).getTime();\n}\n\nfunction getDefaultEndDate() {\n  const d = new Date();\n  d.setHours(d.getHours() + 1, 0, 0, 0);\n\n  // return (new Date(d.getTime() - 1000 * 60 * 60 * 36)).getTime();\n  return d.getTime();\n}\n\nmodule.exports = {\n  start: getDefaultStartDate(),\n  end: getDefaultEndDate(),\n\n  // dongleId: '99c94dc769b5d96e',\n  // dongleId: 'ff83f397542ab647',\n  // dongleId: 'f1b4c567731f4a1b',\n  dongleId: null,\n\n  route: false,\n  segment: 0,\n  nextSegment: null,\n  playSpeed: 0, // 0 = stopped, 1 = playing, 2 = 2x speed... multiplier on speed\n  desiredPlaySpeed: 0, // the speed the user has selected so that buffering can resume\n  shouldBuffer: true, // if we should bother waiting for buffered data or just roll on\n  bufferingVideo: false, // if we're currently buffering for more data\n  bufferingData: false, // if we're currently buffering for more data\n  offset: 0, // in miliseconds from the start\n  startTime: Date.now(), // millisecond timestamp in which play began\n\n  segments: [],\n  // this data should come from the API server instead\n  // segments: [{\n  //   route: '99c94dc769b5d96e|2018-04-09--10-10-00',\n  //   offset: 10000,\n  //   length: 2558000,\n  //   segments: 43\n  // }, {\n  //   route: '99c94dc769b5d96e|2018-04-09--11-29-08',\n  //   offset: 2658000,\n  //   length: 214000,\n  //   segments: 4\n  // }],\n\n  segmentData: null,\n\n  loop: {\n    // in time instead of offset\n    // this makes it so that the timespan can change without this changing\n    // thats helpful to shared links and other things probably...\n    startTime: null,\n    duration: null\n  },\n\n  profile: {},\n  devices: [],\n  isDemo: false,\n};\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nexports.default = ConfigRequestPromise;\n\nvar _instance = require('config-request/instance');\n\nvar _instance2 = _interopRequireDefault(_instance);\n\nvar _errorHandler = require('./errorHandler');\n\nvar _errorHandler2 = _interopRequireDefault(_errorHandler);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ConfigRequestPromise() {\n  var cr = (0, _instance2.default)();\n  var origGet = cr.get,\n      origPost = cr.post,\n      origPatch = cr.patch;\n  cr.get = wrap(cr.get.bind(cr));\n  cr.post = wrap(cr.post.bind(cr));\n  cr.patch = wrap(cr.patch.bind(cr));\n  return cr;\n}\n\nvar wrap = function wrap(requestFunc) {\n  return function (path, options) {\n    return new _promise2.default(function (resolve, reject) {\n      requestFunc(path, options || {}, (0, _errorHandler2.default)(resolve, reject));\n    });\n  };\n};","'use strict';\n\nvar _account = require('./account');\n\nvar account = _interopRequireWildcard(_account);\n\nvar _annotations = require('./annotations');\n\nvar annotations = _interopRequireWildcard(_annotations);\n\nvar _athena = require('./athena');\n\nvar athena = _interopRequireWildcard(_athena);\n\nvar _auth = require('./auth');\n\nvar auth = _interopRequireWildcard(_auth);\n\nvar _devices = require('./devices');\n\nvar devices = _interopRequireWildcard(_devices);\n\nvar _derived = require('./derived');\n\nvar _derived2 = _interopRequireDefault(_derived);\n\nvar _errorHandler = require('./errorHandler');\n\nvar _errorHandler2 = _interopRequireDefault(_errorHandler);\n\nvar _drives = require('./drives');\n\nvar drives = _interopRequireWildcard(_drives);\n\nvar _leaderboard = require('./leaderboard');\n\nvar leaderboard = _interopRequireWildcard(_leaderboard);\n\nvar _raw = require('./raw');\n\nvar raw = _interopRequireWildcard(_raw);\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nvar _vehicles = require('./vehicles');\n\nvar vehicles = _interopRequireWildcard(_vehicles);\n\nvar _video = require('./video');\n\nvar _video2 = _interopRequireDefault(_video);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nmodule.exports = {\n  account: account,\n  annotations: annotations,\n  athena: athena,\n  auth: auth,\n  devices: devices,\n  derived: _derived2.default,\n  drives: drives,\n  errorHandler: _errorHandler2.default,\n  leaderboard: leaderboard,\n  raw: raw,\n  request: request,\n  vehicles: vehicles,\n  video: _video2.default\n};","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getProfile = getProfile;\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction getProfile(dongle_id) {\n  var profile = dongle_id || 'me';\n  return request.get('v1/' + profile + '/');\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _isFinite = require('babel-runtime/core-js/number/is-finite');\n\nvar _isFinite2 = _interopRequireDefault(_isFinite);\n\nexports.createAnnotation = createAnnotation;\nexports.getAnnotation = getAnnotation;\nexports.updateAnnotation = updateAnnotation;\nexports.listAnnotations = listAnnotations;\nexports.listMyAnnotations = listMyAnnotations;\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nvar _validators = require('./validators');\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction createAnnotation(data) {\n  data = _validators.AnnotationValidator.validate(data);\n\n  if (data.error) {\n    throw data.error;\n  }\n\n  data = data.value;\n  return request.post('v1/annotations/new', data);\n}\n\nfunction getAnnotation(id) {\n  return request.get('v1/annotations/' + id);\n}\n\nfunction updateAnnotation(id, data) {\n  return request.patch('v1/annotations/' + id, {\n    data: data\n  });\n}\n\nfunction listAnnotations(_start, _end, dongleId) {\n  if (!dongleId.length) {\n    throw new Error('Invalid or empty dongleId');\n  }\n\n  var _verifyAnnotationStar = verifyAnnotationStartEnd(_start, _end),\n      start = _verifyAnnotationStar.start,\n      end = _verifyAnnotationStar.end;\n\n  return request.get('v1/devices/' + dongleId + '/annotations/', {\n    from: start,\n    to: end\n  });\n}\n\nfunction listMyAnnotations(_start, _end) {\n  var _verifyAnnotationStar2 = verifyAnnotationStartEnd(_start, _end),\n      start = _verifyAnnotationStar2.start,\n      end = _verifyAnnotationStar2.end;\n\n  return request.get('v1/me/annotations/', {\n    from: start,\n    to: end\n  });\n}\n\nfunction verifyAnnotationStartEnd(start, end) {\n  start = Number(start);\n  end = Number(end);\n\n  if (!(0, _isFinite2.default)(start)) {\n    throw new Error('Invalid start time');\n  }\n\n  if (!(0, _isFinite2.default)(end)) {\n    throw new Error('Invalid end time');\n  }\n\n  return {\n    start: start,\n    end: end\n  };\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Joi = require('joi-browser');\n\nvar AnnotationValidator = exports.AnnotationValidator = Joi.object().keys({\n  canonical_segment_name: Joi.string().required(),\n  offset_nanos_part: Joi.number().required(),\n  offset_millis: Joi.number().required(),\n  start_time_utc_millis: Joi.number().required(),\n  end_time_utc_millis: Joi.number().required(),\n  type: Joi.string().required(),\n  data: Joi.object().keys({\n    reason: Joi.string().required(),\n    comment: Joi.string().allow('').optional()\n  })\n});","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.post = exports.configure = undefined;\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar configure = exports.configure = function () {\n  var _ref = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee(accessToken) {\n    var config;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            config = {\n              baseUrl: _config.ATHENA_URL_ROOT,\n              jwt: false,\n              parse: null\n            };\n\n            if (accessToken) {\n              config.token = 'JWT ' + accessToken;\n            }\n\n            request.configure(config);\n\n          case 3:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function configure(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar post = exports.post = function () {\n  var _ref2 = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee2(endpoint, data) {\n    return _regenerator2.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return ensureInit();\n\n          case 2:\n            return _context2.abrupt('return', new _promise2.default(function (resolve, reject) {\n              request.post(endpoint, {\n                body: data,\n                json: true\n              }, (0, _errorHandler2.default)(resolve, reject));\n            }));\n\n          case 3:\n          case 'end':\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n\n  return function post(_x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.postJsonRpcPayload = postJsonRpcPayload;\n\nvar _instance = require('config-request/instance');\n\nvar _instance2 = _interopRequireDefault(_instance);\n\nvar _errorHandler = require('./errorHandler');\n\nvar _errorHandler2 = _interopRequireDefault(_errorHandler);\n\nvar _config = require('./config');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar request = (0, _instance2.default)();\nvar initPromise;\n\nfunction ensureInit() {\n  if (!initPromise) {\n    initPromise = configure();\n  }\n\n  return initPromise;\n}\n\nfunction postJsonRpcPayload(dongleId, payload) {\n  return post(dongleId, payload);\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.refreshAccessToken = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar refreshAccessToken = exports.refreshAccessToken = function () {\n  var _ref = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee(code, redirect_uri) {\n    var authResponseText, resp;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return request.postForm('v2/auth/', {\n              code: code,\n              redirect_uri: redirect_uri\n            });\n\n          case 2:\n            authResponseText = _context.sent;\n            resp = JSON.parse(authResponseText);\n\n            if (!(resp.access_token != null)) {\n              _context.next = 10;\n              break;\n            }\n\n            _context.next = 7;\n            return request.configure(resp.access_token);\n\n          case 7:\n            return _context.abrupt('return', resp.access_token);\n\n          case 10:\n            if (!(resp.response !== undefined)) {\n              _context.next = 14;\n              break;\n            }\n\n            throw new Error('Could not exchange oauth code for access token: response ' + resp.response.status);\n\n          case 14:\n            throw new Error('Could not exchange oauth code for access token: response ' + authResponseText);\n\n          case 15:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function refreshAccessToken(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchLocation = undefined;\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar fetchLocation = exports.fetchLocation = function () {\n  var _ref = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee(dongleId) {\n    var locationEndpoint, location;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            locationEndpoint = 'v1/devices/' + dongleId + '/location';\n            _context.next = 3;\n            return request.get(locationEndpoint);\n\n          case 3:\n            location = _context.sent;\n\n            if (!(location !== undefined && location.error === undefined)) {\n              _context.next = 8;\n              break;\n            }\n\n            return _context.abrupt('return', location);\n\n          case 8:\n            throw Error(\"Could not fetch device location: \" + (0, _stringify2.default)(location));\n\n          case 9:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function fetchLocation(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.listDevices = listDevices;\nexports.setDeviceAlias = setDeviceAlias;\nexports.setDeviceVehicleId = setDeviceVehicleId;\nexports.grantDeviceReadPermission = grantDeviceReadPermission;\nexports.removeDeviceReadPermission = removeDeviceReadPermission;\nexports.fetchVehicles = fetchVehicles;\nexports.fetchDevice = fetchDevice;\nexports.pilotPair = pilotPair;\nexports.fetchDeviceStats = fetchDeviceStats;\nexports.unpair = unpair;\nexports.fetchDeviceOwner = fetchDeviceOwner;\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction listDevices() {\n  return request.get('v1/me/devices/');\n} // Devices API\n// ~~~~~~~~~~~\n\n\nfunction setDeviceAlias(dongle_id, alias) {\n  return request.patch('v1/devices/' + dongle_id + '/', {\n    alias: alias\n  });\n}\n\nfunction setDeviceVehicleId(dongle_id, vehicle_id) {\n  return request.patch('v1/devices/' + dongle_id + '/', {\n    vehicle_id: vehicle_id\n  });\n}\n\nfunction grantDeviceReadPermission(dongle_id, email) {\n  return request.post('v1/devices/' + dongle_id + '/add_user', {\n    email: email\n  });\n}\n\nfunction removeDeviceReadPermission(dongle_id, email) {\n  return request.post('v1/devices/' + dongle_id + '/del_user', {\n    email: email\n  });\n}\n\nfunction fetchVehicles(vehicleId) {\n  var vehicleEndpoint = 'v1/vehicles/' + vehicleId;\n  return request.get(vehicleEndpoint);\n}\n\nfunction fetchDevice(dongleId) {\n  var deviceEndpoint = 'v1.1/devices/' + dongleId + '/';\n  return request.get(deviceEndpoint);\n}\n\nfunction pilotPair(imei, serial, pairToken) {\n  return request.postForm('v2/pilotpair/', {\n    imei: imei,\n    serial: serial,\n    pair_token: pairToken\n  });\n}\n\nfunction fetchDeviceStats(dongleId) {\n  return request.get('v1.1/devices/' + dongleId + '/stats');\n}\n\nfunction unpair(dongleId) {\n  return request.post('v1/devices/' + dongleId + '/unpair');\n}\n\nfunction fetchDeviceOwner(dongleId) {\n  return request.get('v1/devices/' + dongleId + '/owner');\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nexports.default = routeApi;\n\nvar _urlJoin = require('url-join');\n\nvar _urlJoin2 = _interopRequireDefault(_urlJoin);\n\nvar _configRequestPromise = require('./config-request-promise');\n\nvar _configRequestPromise2 = _interopRequireDefault(_configRequestPromise);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction routeApi(routeSigUrl) {\n  var request = (0, _configRequestPromise2.default)();\n  var baseUrl = routeSigUrl + '/';\n  request.configure({\n    baseUrl: baseUrl,\n    parse: null\n  });\n  return {\n    getCoords: function () {\n      var _ref = (0, _asyncToGenerator3.default)(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee() {\n        var coords;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return request.get('route.coords');\n\n              case 2:\n                coords = _context.sent;\n                return _context.abrupt('return', JSON.parse(coords));\n\n              case 4:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getCoords() {\n        return _ref.apply(this, arguments);\n      }\n\n      return getCoords;\n    }(),\n    getJpegUrl: function getJpegUrl(routeOffsetSeconds) {\n      return (0, _urlJoin2.default)(baseUrl, 'sec' + routeOffsetSeconds.toString() + '.jpg');\n    }\n  };\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchRoutes = undefined;\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _isFinite = require('babel-runtime/core-js/number/is-finite');\n\nvar _isFinite2 = _interopRequireDefault(_isFinite);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar fetchRoutes = exports.fetchRoutes = function () {\n  var _ref = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee(dongleId, start, end) {\n    var segments;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getSegmentMetadata(start, end, dongleId);\n\n          case 2:\n            segments = _context.sent;\n            segments = parseSegmentMetadata(start, end, segments);\n            return _context.abrupt('return', segmentsFromMetadata(segments).reverse());\n\n          case 5:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function fetchRoutes(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.getSegmentMetadata = getSegmentMetadata;\nexports.getRouteInfo = getRouteInfo;\nexports.getShareSignature = getShareSignature;\nexports.getRouteSegments = getRouteSegments;\nexports.listRoutes = listRoutes;\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar SEGMENT_LENGTH = 1000 * 60; // Drives api\n// ~~~~~~~~~~\n\nfunction getSegmentMetadata(start, end, dongleId) {\n  return request.get('v1/devices/' + dongleId + '/segments', {\n    from: start,\n    to: end\n  });\n}\n\nfunction getRouteInfo(routeName) {\n  return request.get('v1/route/' + routeName + '/');\n}\n\nfunction getShareSignature(routeName) {\n  return request.get('v1/route/' + routeName + '/share_signature');\n}\n\nfunction getRouteSegments(routeName) {\n  return request.get('v1/route/' + routeName + '/segments');\n}\n\nfunction listRoutes(dongleId, limit, createdAfter) {\n  var params = {\n    limit: limit\n  };\n\n  if (typeof createdAfter !== 'undefined') {\n    params.createdAfter = createdAfter;\n  }\n\n  return request.get('v1/devices/' + dongleId + '/routes', params);\n}\n\nfunction parseSegmentMetadata(start, end, segments) {\n  var lastSegmentTime = 0;\n  var routeStartTimes = {};\n  return segments.map(function (segment) {\n    segment.offset = Math.round(segment.start_time_utc_millis) - start;\n\n    if (!routeStartTimes[segment.canonical_route_name]) {\n      var segmentNum = Number(segment.canonical_name.split('--')[2]);\n      segment.segment = segmentNum;\n\n      if (segmentNum > 0) {\n        routeStartTimes[segment.canonical_route_name] = segment.offset - SEGMENT_LENGTH * segmentNum;\n      } else {\n        routeStartTimes[segment.canonical_route_name] = segment.offset;\n      }\n\n      segment.routeOffset = routeStartTimes[segment.canonical_route_name];\n    } else {\n      segment.routeOffset = routeStartTimes[segment.canonical_route_name];\n    }\n\n    lastSegmentTime = segment.offset;\n    segment.duration = Math.round(segment.end_time_utc_millis - segment.start_time_utc_millis);\n    return segment;\n  });\n}\n\nfunction segmentsFromMetadata(segmentsData) {\n  var curSegment = null;\n  var curStopTime = null;\n  var curVideoStartOffset = null;\n  var segments = [];\n  segmentsData.forEach(function (segment) {\n    if (!segment.url) {\n      return;\n    }\n\n    if (!(segment.proc_log === 40 || segment.proc_qlog === 40)) {\n      return;\n    }\n\n    var segmentHasDriverCamera = segment.proc_dcamera >= 0;\n    var segmentHasDriverCameraStream = segment.proc_dcamera === 40;\n    var segmentHasVideo = segment.proc_camera === 40;\n\n    if (segmentHasVideo && curVideoStartOffset === null) {\n      curVideoStartOffset = segment.offset;\n    }\n\n    curStopTime = segment.start_time_utc_millis;\n\n    if (!curSegment || curSegment.route !== segment.canonical_route_name) {\n      if (curSegment) {\n        finishSegment(curSegment);\n      }\n\n      var url = segment.url;\n      var parts = url.split('/');\n\n      if ((0, _isFinite2.default)(Number(parts.pop()))) {\n        // url has a number at the end\n        url = parts.join('/');\n      }\n\n      curSegment = {\n        dongleId: segment.dongle_id,\n        offset: segment.offset - segment.segment * SEGMENT_LENGTH,\n        route: segment.canonical_route_name,\n        startTime: segment.start_time_utc_millis,\n        startCoord: [segment.start_lng, segment.start_lat],\n        duration: 0,\n        segments: 0,\n        url: url.replace('chffrprivate.blob.core.windows.net', 'chffrprivate-vzn.azureedge.net'),\n        events: [],\n        videoAvailableBetweenOffsets: [],\n        hasVideo: segmentHasVideo,\n        deviceType: segment.devicetype,\n        hpgps: segment.hpgps,\n        hasDriverCamera: segmentHasDriverCamera,\n        hasDriverCameraStream: segmentHasDriverCameraStream,\n        locStart: '',\n        locEnd: '',\n        distanceMiles: 0.0,\n        cameraStreamSegCount: 0,\n        driverCameraStreamSegCount: 0\n      };\n      segments.push(curSegment);\n    }\n\n    if (!segmentHasVideo && curVideoStartOffset !== null) {\n      curSegment.videoAvailableBetweenOffsets.push([curVideoStartOffset, segment.offset]);\n      curVideoStartOffset = null;\n    }\n\n    curSegment.hasVideo = curSegment.hasVideo || segmentHasVideo;\n    curSegment.hasDriverCamera = curSegment.hasDriverCamera || segmentHasDriverCamera;\n    curSegment.hasDriverCameraStream = curSegment.hasDriverCameraStream || segmentHasDriverCameraStream;\n    curSegment.hpgps = curSegment.hpgps || segment.hpgps;\n    curSegment.duration = segment.offset - curSegment.offset + segment.duration;\n    curSegment.segments = Math.max(curSegment.segments, Number(segment.canonical_name.split('--').pop()) + 1);\n    curSegment.events = curSegment.events.concat(segment.events);\n    curSegment.endCoord = [segment.end_lng, segment.end_lat];\n    curSegment.distanceMiles += segment.length;\n    curSegment.cameraStreamSegCount += Math.floor(segmentHasVideo);\n    curSegment.driverCameraStreamSegCount += Math.floor(segmentHasDriverCameraStream);\n  });\n\n  if (curSegment) {\n    finishSegment(curSegment);\n  }\n\n  return segments;\n\n  function finishSegment(segment) {\n    var lastEngage = null;\n\n    if (segment.hasVideo) {\n      var lastVideoRange = segment.videoAvailableBetweenOffsets[segment.videoAvailableBetweenOffsets.length - 1] || [segment.offset, segment.offset + segment.duration];\n      segment.videoAvailableBetweenOffsets = [].concat((0, _toConsumableArray3.default)(segment.videoAvailableBetweenOffsets.slice(0, segment.videoAvailableBetweenOffsets.length - 1)), [[lastVideoRange[0], segment.offset + segment.duration]]);\n    }\n  }\n}\n\nfunction hasSegmentMetadata(state) {\n  if (!state.segmentData) {\n    console.log('No segment data at all');\n    return false;\n  }\n\n  if (!state.segmentData.segments) {\n    console.log('Still loading...');\n    return false;\n  }\n\n  if (state.dongleId !== state.segmentData.dongleId) {\n    console.log('Bad dongle id');\n    ;\n    return false;\n  }\n\n  if (state.start < state.segmentData.start) {\n    console.log('Bad start offset');\n    return false;\n  }\n\n  if (state.end > state.segmentData.end) {\n    console.log('Bad end offset');\n    return false;\n  }\n\n  if (state.end > state.segmentData.end) {\n    console.log('Bad end offset');\n    return false;\n  }\n\n  return state.start >= state.segmentData.start && state.end <= state.segmentData.end;\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getLeaderboard = getLeaderboard;\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction getLeaderboard() {\n  return request.get('v2/leaderboard/');\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar getCached = function () {\n  var _ref = (0, _asyncToGenerator3.default)(\n  /*#__PURE__*/\n  _regenerator2.default.mark(function _callee(endpoint, routeName, params) {\n    var path, data;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!urlStore[routeName]) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt('return', urlStore[routeName]);\n\n          case 2:\n            path = 'v1/route/' + routeName + '/' + endpoint;\n\n            if (params !== undefined) {\n              path += '?' + _querystringify2.default.stringify(params);\n            }\n\n            _context.next = 6;\n            return request.get(path);\n\n          case 6:\n            data = _context.sent;\n            urlStore[routeName] = data;\n            setTimeout(function () {\n              delete urlStore[routeName];\n            }, 1000 * 60 * 45); // expires in 1h, lets reset in 45m\n\n            return _context.abrupt('return', urlStore[routeName]);\n\n          case 10:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function getCached(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.getRouteFiles = getRouteFiles;\nexports.getLogUrls = getLogUrls;\n\nvar _querystringify = require('querystringify');\n\nvar _querystringify2 = _interopRequireDefault(_querystringify);\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar urlStore = {};\n\nfunction getRouteFiles(routeName) {\n  return getCached('files', routeName);\n}\n\nfunction getLogUrls(routeName, params) {\n  return getCached('log_urls', routeName, params);\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchMakes = fetchMakes;\nexports.fetchModels = fetchModels;\nexports.fetchVehicle = fetchVehicle;\n\nvar _request = require('./request');\n\nvar request = _interopRequireWildcard(_request);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction fetchMakes() {\n  return request.get('v1/vehicles/makes/');\n} // Vehicle API\n// ~~~~~~~~~~~\n\n\nfunction fetchModels(make) {\n  return request.get('v1/vehicles/makes/' + make);\n}\n\nfunction fetchVehicle(vehicleId) {\n  return request.get('v1/vehicles/' + vehicleId.toString());\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nexports.default = videoApi;\n\nvar _urlJoin = require('url-join');\n\nvar _urlJoin2 = _interopRequireDefault(_urlJoin);\n\nvar _configRequestPromise = require('./config-request-promise');\n\nvar _configRequestPromise2 = _interopRequireDefault(_configRequestPromise);\n\nvar _config = require('./config');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction videoApi(routeSigUrl, videoServerHost) {\n  if (!videoServerHost) {\n    videoServerHost = _config.VIDEO_HOST;\n  }\n\n  var _routeSigUrl$split$sl = routeSigUrl.split('/').slice(5, 7),\n      _routeSigUrl$split$sl2 = (0, _slicedToArray3.default)(_routeSigUrl$split$sl, 2),\n      dongleId = _routeSigUrl$split$sl2[0],\n      routeSignature = _routeSigUrl$split$sl2[1];\n\n  var videoserverRequest = (0, _configRequestPromise2.default)();\n  var videoserverBaseUrl = videoServerHost + '/hls/' + dongleId + '/' + routeSignature + '/';\n  videoserverRequest.configure({\n    baseUrl: videoserverBaseUrl,\n    parse: null\n  });\n  var storageRequest = (0, _configRequestPromise2.default)();\n  storageRequest.configure({\n    baseUrl: routeSigUrl + '/',\n    parse: null\n  });\n  return {\n    getRearCameraStreamIndexUrl: function getRearCameraStreamIndexUrl() {\n      return (0, _urlJoin2.default)(videoserverBaseUrl, 'index.m3u8');\n    },\n    getFrontCameraStreamIndexUrl: function getFrontCameraStreamIndexUrl() {\n      return (0, _urlJoin2.default)(videoserverBaseUrl, 'dcamera/index.m3u8');\n    },\n    getQcameraStreamIndexUrl: function getQcameraStreamIndexUrl() {\n      return (0, _urlJoin2.default)(routeSigUrl, 'qcamera.m3u8');\n    },\n    getRearCameraStreamIndex: function getRearCameraStreamIndex() {\n      return videoserverRequest.get('index.m3u8');\n    },\n    getFrontCameraStreamIndexPath: function getFrontCameraStreamIndexPath() {\n      return videoserverRequest.get('dcamera/index.m3u8');\n    },\n    getQcameraStreamIndex: function getQcameraStreamIndex() {\n      return storageRequest.get('qcamera.m3u8');\n    }\n  };\n}"],"sourceRoot":""}